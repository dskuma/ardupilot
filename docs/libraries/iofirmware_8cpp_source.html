<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APM:Libraries: libraries/AP_IOMCU/iofirmware/iofirmware.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_6b8d684a66c1f48643f8b9058ebb5fe9.html">AP_IOMCU</a></li><li class="navelem"><a class="el" href="dir_71b7089171119bdff6355f9596c1d6b3.html">iofirmware</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">iofirmware.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="iofirmware_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">   This program is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">   it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">   the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">   (at your option) any later version.</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"></span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">   This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">   GNU General Public License for more details.</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"></span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">   You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"> */</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="comment">/*</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment">  IOMCU main firmware</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment"> */</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &lt;<a class="code" href="AP__HAL_8h.html">AP_HAL/AP_HAL.h</a>&gt;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span> </div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Math_8h.html">AP_Math/AP_Math.h</a>&gt;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &lt;<a class="code" href="crc_8h.html">AP_Math/crc.h</a>&gt;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;<a class="code" href="iofirmware_8h.html">iofirmware.h</a>&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &lt;<a class="code" href="AP__HAL__ChibiOS_2RCInput_8h.html">AP_HAL_ChibiOS/RCInput.h</a>&gt;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &lt;<a class="code" href="AP__HAL__ChibiOS_2RCOutput_8h.html">AP_HAL_ChibiOS/RCOutput.h</a>&gt;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &quot;<a class="code" href="analog_8h.html">analog.h</a>&quot;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &quot;<a class="code" href="rc_8h.html">rc.h</a>&quot;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &lt;<a class="code" href="watchdog_8h.html">AP_HAL_ChibiOS/hwdef/common/watchdog.h</a>&gt;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span> </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="keyword">extern</span> <span class="keyword">const</span> <a class="code hl_class" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a> &amp;<a class="code hl_variable" href="iofirmware_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span> </div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="comment">// we build this file with optimisation to lower the interrupt</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="comment">// latency. This helps reduce the chance of losing an RC input byte</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="comment">// due to missing a UART interrupt</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#pragma GCC optimize(&quot;O2&quot;)</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span> </div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">   36</a></span><span class="keyword">static</span> <a class="code hl_class" href="classAP__IOMCU__FW.html">AP_IOMCU_FW</a> <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>;</div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span> </div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="keywordtype">void</span> <a class="code hl_function" href="iofirmware_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a>();</div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="keywordtype">void</span> <a class="code hl_function" href="iofirmware_8cpp.html#afe461d27b9c48d5921c00d521181f12f">loop</a>();</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#undef CH_DBG_ENABLE_STACK_CHECK</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#ab93d9ee904f15d4f2c26ef2a1394a1d7">   42</a></span><span class="preprocessor">#define CH_DBG_ENABLE_STACK_CHECK FALSE</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span> </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">   44</a></span><span class="keyword">const</span> <a class="code hl_class" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code hl_variable" href="iofirmware_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a> = <a class="code hl_function" href="namespaceAP__HAL.html#a478ddf5b4f7ab239ea980838c36e1bb1">AP_HAL::get_HAL</a>();</div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="comment">/*</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="comment"> enable testing of IOMCU reset using safety switch</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="comment"> a value of 0 means normal operation</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="comment"> a value of 1 means test with watchdog</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="comment"> a value of 2 means test with reboot</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="comment">*/</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#ac2d73cffc9f52f5cddcd8c6f29357ec5">   52</a></span><span class="preprocessor">#define IOMCU_ENABLE_RESET_TEST 0</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span> </div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="comment">//#define IOMCU_LOOP_TIMING_DEBUG</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="comment">// enable timing GPIO pings</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span><span class="preprocessor">#ifdef IOMCU_LOOP_TIMING_DEBUG</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="preprocessor">#undef TOGGLE_PIN_DEBUG</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span><span class="preprocessor">#define TOGGLE_PIN_DEBUG(pin) do { palToggleLine(HAL_GPIO_LINE_GPIO ## pin); } while (0)</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="comment">// pending events on the main thread</span></div>
<div class="foldopen" id="foldopen00062" data-start="{" data-end="};">
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06">   62</a></span><span class="keyword">enum</span> <a class="code hl_enumeration" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06">ioevents</a> {</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06af23b75144c072b1255b0274aab89ee12">   63</a></span>    <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06af23b75144c072b1255b0274aab89ee12">IOEVENT_PWM</a> = EVENT_MASK(1),</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a566cc3b837181645b59574fc6af58910">   64</a></span>    <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a566cc3b837181645b59574fc6af58910">IOEVENT_TX_BEGIN</a> = EVENT_MASK(2),</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a8186f067e8f3343c8a798b4bbe833547">   65</a></span>    <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a8186f067e8f3343c8a798b4bbe833547">IOEVENT_TX_END</a> = EVENT_MASK(3),</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>};</div>
</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="comment">// see https://github.com/MaJerle/stm32-usart-uart-dma-rx-tx for a discussion of how to run</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="comment">// separate tx and rx streams</span></div>
<div class="foldopen" id="foldopen00070" data-start="{" data-end="}">
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#a08502f422ced5354942473a0f282e3cc">   70</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="iofirmware_8cpp.html#a08502f422ced5354942473a0f282e3cc">setup_rx_dma</a>(hal_uart_driver* <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>)</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>{</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;CR3 &amp;= ~USART_CR3_DMAR;</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    dmaStreamDisable(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmarx);</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    dmaStreamSetMemory0(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmarx, &amp;<a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.rx_io_packet);</div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    dmaStreamSetTransactionSize(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmarx, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.rx_io_packet));</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    dmaStreamSetPeripheral(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmarx, &amp;(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;DR));</div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    dmaStreamSetMode(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmarx, <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmarxmode    | STM32_DMA_CR_DIR_P2M |</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>                     STM32_DMA_CR_MINC | STM32_DMA_CR_TCIE);</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    dmaStreamEnable(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmarx);</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;CR3 |= USART_CR3_DMAR;</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>}</div>
</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="foldopen" id="foldopen00083" data-start="{" data-end="}">
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#a653ccb1f7a547130f836735ae7d1af53">   83</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="iofirmware_8cpp.html#a653ccb1f7a547130f836735ae7d1af53">setup_tx_dma</a>(hal_uart_driver* <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>)</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>{</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;CR3 &amp;= ~USART_CR3_DMAT;</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    dmaStreamDisable(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatx);</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    dmaStreamSetMemory0(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatx, &amp;<a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>);</div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    dmaStreamSetTransactionSize(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatx, <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_function" href="structIOPacket.html#ae4b6c1ba8ca5e98e2429c364bc1e404f">get_size</a>());</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    <span class="comment">// starting the UART allocates the peripheral statically, so we need to reinstate it after swapping</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    dmaStreamSetPeripheral(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatx, &amp;(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;DR));</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    dmaStreamSetMode(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatx, <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatxmode    | STM32_DMA_CR_DIR_M2P |</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>                     STM32_DMA_CR_MINC | STM32_DMA_CR_TCIE);</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <span class="comment">// enable transmission complete interrupt</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;SR = ~USART_SR_TC;</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;CR1 |= USART_CR1_TCIE;</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span> </div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    dmaStreamEnable(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatx);</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span> </div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;CR3 |= USART_CR3_DMAT;</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>}</div>
</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span> </div>
<div class="foldopen" id="foldopen00102" data-start="{" data-end="}">
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#a762f9f47c54b061a9024d4575a0b34ee">  102</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="iofirmware_8cpp.html#a762f9f47c54b061a9024d4575a0b34ee">dma_rx_end_cb</a>(hal_uart_driver *<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>)</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>{</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    chSysLockFromISR();</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;CR3 &amp;= ~USART_CR3_DMAR;</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span> </div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>    dmaStreamDisable(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmarx);</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span> </div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_function" href="classAP__IOMCU__FW.html#ac14e26cad684438adbf4dc26186e1295">process_io_packet</a>();</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span> </div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    <a class="code hl_function" href="iofirmware_8cpp.html#a08502f422ced5354942473a0f282e3cc">setup_rx_dma</a>(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>);</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span> </div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span><span class="preprocessor">#if AP_HAL_SHARED_DMA_ENABLED</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    <span class="comment">// indicate that a response needs to be sent</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    uint32_t mask = chEvtGetAndClearEventsI(<a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a566cc3b837181645b59574fc6af58910">IOEVENT_TX_BEGIN</a>);</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <span class="keywordflow">if</span> (mask) {</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>        <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#a8772412872d631bd7cf45fd977313067">err_lock</a>++;</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    }</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    <span class="comment">// the FMU code waits 10ms for a reply so this should be easily fast enough</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    chEvtSignalI(<a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#a416c0720ab52a33e06e40b989ecfb39a">thread_ctx</a>, <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a566cc3b837181645b59574fc6af58910">IOEVENT_TX_BEGIN</a>);</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <a class="code hl_function" href="iofirmware_8cpp.html#a653ccb1f7a547130f836735ae7d1af53">setup_tx_dma</a>(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>);</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    chSysUnlockFromISR();</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>}</div>
</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="foldopen" id="foldopen00127" data-start="{" data-end="}">
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#a99a6124b5472520c8491a1516afb32ae">  127</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="iofirmware_8cpp.html#a99a6124b5472520c8491a1516afb32ae">dma_tx_end_cb</a>(hal_uart_driver *<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>)</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>{</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    <span class="comment">// DMA stream has already been disabled at this point</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;CR3 &amp;= ~USART_CR3_DMAT;</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span> </div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    (void)<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;SR;</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    (void)<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;DR;</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    (void)<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;DR;</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span> </div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span><span class="preprocessor">#ifdef HAL_GPIO_LINE_GPIO108</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    <a class="code hl_define" href="AP__HAL__ChibiOS_2RCOutput_8h.html#a0a1754fe5ac9fa4efc193420918b35e5">TOGGLE_PIN_DEBUG</a>(108);</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    <a class="code hl_define" href="AP__HAL__ChibiOS_2RCOutput_8h.html#a0a1754fe5ac9fa4efc193420918b35e5">TOGGLE_PIN_DEBUG</a>(108);</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span><span class="preprocessor">#if AP_HAL_SHARED_DMA_ENABLED</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    chSysLockFromISR();</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    chEvtSignalI(<a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#a416c0720ab52a33e06e40b989ecfb39a">thread_ctx</a>, <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a8186f067e8f3343c8a798b4bbe833547">IOEVENT_TX_END</a>);</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    chSysUnlockFromISR();</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>}</div>
</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span> </div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span><span class="comment">/* replacement for ChibiOS uart_lld_serve_interrupt() */</span></div>
<div class="foldopen" id="foldopen00148" data-start="{" data-end="}">
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#abbc0f2f755b4172f1c3680c20a02f0dc">  148</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="iofirmware_8cpp.html#abbc0f2f755b4172f1c3680c20a02f0dc">idle_rx_handler</a>(hal_uart_driver *<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>)</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>{</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    <span class="keyword">volatile</span> uint16_t sr;</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    sr = <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;SR; <span class="comment">/* SR reset step 1.*/</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    uint32_t cr1 = <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;CR1;</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span> </div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <span class="keywordflow">if</span> (sr &amp; (USART_SR_LBD | USART_SR_ORE | <span class="comment">/* overrun error - packet was too big for DMA or DMA was too slow */</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>              USART_SR_NE |     <span class="comment">/* noise error - we have lost a byte due to noise */</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>              USART_SR_FE |</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>              USART_SR_PE)) {       <span class="comment">/* framing error - start/stop bit lost or line break */</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>        (void)<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;DR;  <span class="comment">/* SR reset step 2 - clear ORE | FE.*/</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span> </div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>        <span class="comment">/* send a line break - this will abort transmission/reception on the other end */</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        chSysLockFromISR();</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;SR = ~USART_SR_LBD;</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>        <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;CR1 = cr1 | USART_CR1_SBK;</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span> </div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#ab751d54220c9d18e4f0edb5a6a41a4e5">num_errors</a>++;</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>        <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#a2d8d52b8440e318e100513ef6ca0e856">err_uart</a>++;</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>        <span class="comment">/* disable RX DMA */</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>        <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;CR3 &amp;= ~USART_CR3_DMAR;</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span> </div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>        <a class="code hl_function" href="iofirmware_8cpp.html#a08502f422ced5354942473a0f282e3cc">setup_rx_dma</a>(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>);</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span> </div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>        chSysUnlockFromISR();</div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    }</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    <span class="keywordflow">if</span> ((sr &amp; USART_SR_TC) &amp;&amp; (cr1 &amp; USART_CR1_TCIE)) {</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>        <span class="comment">/* TC interrupt cleared and disabled.*/</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>        <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;SR &amp;= ~USART_SR_TC;</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>        <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;CR1 = cr1 &amp; ~USART_CR1_TCIE;</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span><span class="preprocessor">#ifdef HAL_GPIO_LINE_GPIO105</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>        <a class="code hl_define" href="AP__HAL__ChibiOS_2RCOutput_8h.html#a0a1754fe5ac9fa4efc193420918b35e5">TOGGLE_PIN_DEBUG</a>(105);</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>        <a class="code hl_define" href="AP__HAL__ChibiOS_2RCOutput_8h.html#a0a1754fe5ac9fa4efc193420918b35e5">TOGGLE_PIN_DEBUG</a>(105);</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>        <span class="comment">/* End of transmission, a callback is generated.*/</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        <a class="code hl_function" href="iofirmware_8cpp.html#a99a6124b5472520c8491a1516afb32ae">dma_tx_end_cb</a>(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>);</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    }</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span> </div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    <span class="keywordflow">if</span> ((sr &amp; USART_SR_IDLE) &amp;&amp; (cr1 &amp; USART_CR1_IDLEIE)) {</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>        (void)<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;DR;  <span class="comment">/* SR reset step 2 - clear IDLE.*/</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span> </div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>        <span class="comment">/* the DMA size is the maximum packet size, but smaller packets are perfectly possible leading to </span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span><span class="comment">           an IDLE ISR. The data still must be processed. */</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span> </div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>        <span class="comment">/* End of receive, a callback is generated.*/</span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        <a class="code hl_function" href="iofirmware_8cpp.html#a762f9f47c54b061a9024d4575a0b34ee">dma_rx_end_cb</a>(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>);</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    }</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>}</div>
</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span> </div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespaceChibiOS.html">ChibiOS</a>;</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span> </div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span><span class="preprocessor">#if AP_HAL_SHARED_DMA_ENABLED</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span><span class="comment">/*</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span><span class="comment"> copy of uart_lld_serve_tx_end_irq() from ChibiOS hal_uart_lld</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span><span class="comment"> that is re-instated upon switching the DMA channel</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span><span class="comment"> */</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span><span class="keyword">static</span> <span class="keywordtype">void</span> uart_lld_serve_tx_end_irq(hal_uart_driver *<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>, uint32_t flags)</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>{</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    dmaStreamDisable(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatx);</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span> </div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <span class="comment">/* A callback is generated, if enabled, after a completed transfer.*/</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    _uart_tx1_isr_code(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>);</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>}</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span> </div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span><span class="keywordtype">void</span> AP_IOMCU_FW::tx_dma_allocate(Shared_DMA *ctx)</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>{</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    hal_uart_driver *<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a> = &amp;UARTD2;</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    chSysLock();</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatx == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>        <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatx = dmaStreamAllocI(STM32_UART_USART2_TX_DMA_STREAM,</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>                                        <a class="code hl_define" href="stm32f1__mcuconf_8h.html#ad1d292d78abf8f0b5a9e210d217a1cfe">STM32_UART_USART2_IRQ_PRIORITY</a>,</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>                                        (stm32_dmaisr_t)uart_lld_serve_tx_end_irq,</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>                                        (<span class="keywordtype">void</span> *)<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>);</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    }</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    chSysUnlock();</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>}</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span> </div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span><span class="comment">/*</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span><span class="comment">  deallocate DMA channel</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span><span class="comment"> */</span></div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span><span class="keywordtype">void</span> AP_IOMCU_FW::tx_dma_deallocate(Shared_DMA *ctx)</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>{</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    hal_uart_driver *<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a> = &amp;UARTD2;</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    chSysLock();</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatx != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>        <span class="comment">// defensively make sure the DMA is fully shutdown before swapping</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>        <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;usart-&gt;CR3 &amp;= ~USART_CR3_DMAT;</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>        dmaStreamDisable(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatx);</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>        dmaStreamSetPeripheral(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatx, <span class="keyword">nullptr</span>);</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>        dmaStreamFreeI(<a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatx);</div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>        <a class="code hl_variable" href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a>-&gt;dmatx = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    }</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    chSysUnlock();</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>}</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span><span class="preprocessor">#endif </span><span class="comment">// AP_HAL_SHARED_DMA_ENABLED</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span> </div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span><span class="comment">/*</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span><span class="comment"> * UART driver configuration structure.</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00250" data-start="{" data-end="};">
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#aa1d515f6e94ee0ec97697af7ecca27d3">  250</a></span><span class="keyword">static</span> UARTConfig <a class="code hl_variable" href="iofirmware_8cpp.html#aa1d515f6e94ee0ec97697af7ecca27d3">uart_cfg</a> = {</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    <span class="keyword">nullptr</span>,</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>    <a class="code hl_function" href="iofirmware_8cpp.html#a99a6124b5472520c8491a1516afb32ae">dma_tx_end_cb</a>,</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>    <a class="code hl_function" href="iofirmware_8cpp.html#a762f9f47c54b061a9024d4575a0b34ee">dma_rx_end_cb</a>,</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <span class="keyword">nullptr</span>,</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    <span class="keyword">nullptr</span>,            <span class="comment">// error</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    <a class="code hl_function" href="iofirmware_8cpp.html#abbc0f2f755b4172f1c3680c20a02f0dc">idle_rx_handler</a>,    <span class="comment">// global irq</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    <span class="keyword">nullptr</span>,            <span class="comment">// idle</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    1500000,      <span class="comment">//1.5MBit</span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    USART_CR1_IDLEIE,</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    0,</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    0</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>};</div>
</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="foldopen" id="foldopen00264" data-start="{" data-end="}">
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d">  264</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="iofirmware_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>{</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>    <a class="code hl_variable" href="iofirmware_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a44ed5c21ed9aae558cff53d73c3714b5">rcin</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCInput.html#a0eea79c26e71b819edc74bffe6c82631">init</a>();</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    <a class="code hl_variable" href="iofirmware_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a4e77bfeee3a2494cc4407a91d03e1067">init</a>();</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_function" href="classAP__IOMCU__FW.html#ac44fd3950057730a5a93041166c4529f">init</a>();</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span> </div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_function" href="classAP__IOMCU__FW.html#aa791a6eba91a650216f00d837e5d8fbd">calculate_fw_crc</a>();</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span> </div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    uartStart(&amp;UARTD2, &amp;<a class="code hl_variable" href="iofirmware_8cpp.html#aa1d515f6e94ee0ec97697af7ecca27d3">uart_cfg</a>);</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    uartStartReceive(&amp;UARTD2, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.rx_io_packet), &amp;<a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.rx_io_packet);</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span><span class="preprocessor">#if AP_HAL_SHARED_DMA_ENABLED</span></div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>    <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.tx_dma_handle-&gt;unlock();</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    <span class="comment">// disable the pieces from the UART which will get enabled later</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>    chSysLock();</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    UARTD2.usart-&gt;CR3 &amp;= ~USART_CR3_DMAT;</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>    chSysUnlock();</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>}</div>
</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span> </div>
<div class="foldopen" id="foldopen00283" data-start="{" data-end="}">
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#afe461d27b9c48d5921c00d521181f12f">  283</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="iofirmware_8cpp.html#afe461d27b9c48d5921c00d521181f12f">loop</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>{</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_function" href="classAP__IOMCU__FW.html#aa6e97452785d6ade70465f15a87978f4">update</a>();</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>}</div>
</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span> </div>
<div class="foldopen" id="foldopen00288" data-start="{" data-end="}">
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#ac44fd3950057730a5a93041166c4529f">  288</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#ac44fd3950057730a5a93041166c4529f">AP_IOMCU_FW::init</a>()</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>{</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    <span class="comment">// the first protocol version must be 4 to allow downgrade to</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>    <span class="comment">// old NuttX based firmwares</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a64c64375629e44c2b59d509afefb396b">config</a>.<a class="code hl_variable" href="structpage__config.html#a56a0d12ab164b29b3779a60e1186c2f0">protocol_version</a> = <a class="code hl_define" href="ioprotocol_8h.html#ab6a43f107bb611895b832f73d73f7e0a">IOMCU_PROTOCOL_VERSION</a>;</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a64c64375629e44c2b59d509afefb396b">config</a>.<a class="code hl_variable" href="structpage__config.html#a01e1ee64f325beb637fc02493cf58180">protocol_version2</a> = <a class="code hl_define" href="ioprotocol_8h.html#ab28b63126d2120799fd9d79423233a5d">IOMCU_PROTOCOL_VERSION2</a>;</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a64c64375629e44c2b59d509afefb396b">config</a>.<a class="code hl_variable" href="structpage__config.html#a990912c76079dc5245132dc97b0f9a31">mcuid</a> = (*(uint32_t *)DBGMCU_BASE);</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span><span class="preprocessor">#if defined(STM32F103xB) || defined(STM32F103x8)</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#a64c64375629e44c2b59d509afefb396b">config</a>.<a class="code hl_variable" href="structpage__config.html#a990912c76079dc5245132dc97b0f9a31">mcuid</a> == 0) {</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>        <span class="comment">// Errata 2.2.2 - Debug registers cannot be read by user software</span></div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a64c64375629e44c2b59d509afefb396b">config</a>.<a class="code hl_variable" href="structpage__config.html#a990912c76079dc5245132dc97b0f9a31">mcuid</a> = 0x20036410;  <span class="comment">// STM32F10x (Medium Density) rev Y</span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>    }</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a64c64375629e44c2b59d509afefb396b">config</a>.<a class="code hl_variable" href="structpage__config.html#a918b5ac1d39e462a210c71bdf61e7f84">cpuid</a> = SCB-&gt;CPUID;</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span> </div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a416c0720ab52a33e06e40b989ecfb39a">thread_ctx</a> = chThdGetSelfX();</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span> </div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span><span class="preprocessor">#if AP_HAL_SHARED_DMA_ENABLED</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    tx_dma_handle = <span class="keyword">new</span> ChibiOS::Shared_DMA(STM32_UART_USART2_TX_DMA_STREAM, <a class="code hl_define" href="shared__dma_8h.html#a90dbf2b4ba7f8a63571807363926226c">SHARED_DMA_NONE</a>,</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>                        <a class="code hl_define" href="functor_8h.html#a00e5874203cecc310017f9166f2c0e36">FUNCTOR_BIND_MEMBER</a>(&amp;AP_IOMCU_FW::tx_dma_allocate, <span class="keywordtype">void</span>, Shared_DMA *),</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>                        <a class="code hl_define" href="functor_8h.html#a00e5874203cecc310017f9166f2c0e36">FUNCTOR_BIND_MEMBER</a>(&amp;AP_IOMCU_FW::tx_dma_deallocate, <span class="keywordtype">void</span>, Shared_DMA *));</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    tx_dma_handle-&gt;lock();</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>    <span class="comment">// deallocate so that the uart initializes correctly</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>    tx_dma_deallocate(tx_dma_handle);</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>    <span class="keywordflow">if</span> (palReadLine(HAL_GPIO_PIN_IO_HW_DETECT1) == 1 &amp;&amp; palReadLine(HAL_GPIO_PIN_IO_HW_DETECT2) == 0) {</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a32b6b03c8197f0a0add346f4aaf02802">has_heater</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    }</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span> </div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>    <span class="comment">//Set Heater pin mode</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#abcc5bc0a2a54b9df32c9a7726b94ab7a">heater_pwm_polarity</a>) {</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>        palSetLineMode(HAL_GPIO_PIN_HEATER, PAL_MODE_OUTPUT_PUSHPULL);</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>        palSetLineMode(HAL_GPIO_PIN_HEATER, PAL_MODE_OUTPUT_OPENDRAIN);</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    }</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    <a class="code hl_function" href="analog_8cpp.html#a2b815e6730e8723a6d1d06d9ef8f31c0">adc_init</a>();</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    <a class="code hl_function" href="classAP__IOMCU__FW.html#aab861b3ef551e27c3738f2e7e9648ec4">rcin_serial_init</a>();</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span> </div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    <span class="comment">// power on spektrum port</span></div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    palSetLineMode(HAL_GPIO_PIN_SPEKTRUM_PWR_EN, PAL_MODE_OUTPUT_PUSHPULL);</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    <a class="code hl_define" href="iofirmware_8h.html#af2d65b8aa3958b959290f64f8a01833f">SPEKTRUM_POWER</a>(1);</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span> </div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>    <span class="comment">// we generally do no allocations after setup completes</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#a89e38aeb5fffc9ca586372ccd6bf037d">freemem</a> = <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a2a2e64f649d25593951054d44c0ed53b">available_memory</a>();</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span> </div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#aa33de8bfb64bde7ebdcbdb9668a24838">was_watchdog_safety_off</a>()) {</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#afb075a7e5438b6f0bae228e0b6be0cc2">force_safety_off</a>();</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    }</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>}</div>
</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span> </div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span> </div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span><span class="preprocessor">#if CH_DBG_ENABLE_STACK_CHECK == TRUE</span></div>
<div class="foldopen" id="foldopen00343" data-start="{" data-end="}">
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#ae604357e19347d62bbfc958f65c2dd5a">  343</a></span><span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code hl_function" href="iofirmware_8cpp.html#ae604357e19347d62bbfc958f65c2dd5a">stackCheck</a>(uint16_t&amp; mstack, uint16_t&amp; pstack) {</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    <span class="keyword">extern</span> stkalign_t <a class="code hl_variable" href="stm32__util_8h.html#a68d2969cdd4c714b4ae13df76d767a53">__main_stack_base__</a>[];</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    <span class="keyword">extern</span> stkalign_t <a class="code hl_variable" href="stm32__util_8h.html#af74d38f8c713c1d45d7065083a06278e">__main_stack_end__</a>[];</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    uint32_t stklimit = (uint32_t)<a class="code hl_variable" href="stm32__util_8h.html#af74d38f8c713c1d45d7065083a06278e">__main_stack_end__</a>;</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>    uint32_t stkbase  = (uint32_t)<a class="code hl_variable" href="stm32__util_8h.html#a68d2969cdd4c714b4ae13df76d767a53">__main_stack_base__</a>;</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>    uint32_t *crawl   = (uint32_t *)stkbase;</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span> </div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>    <span class="keywordflow">while</span> (*crawl == 0x55555555 &amp;&amp; crawl &lt; (uint32_t *)stklimit) {</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>        crawl++;</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>    }</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    uint32_t <a class="code hl_function" href="malloc_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a> = (uint32_t)crawl - stkbase;</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    chDbgAssert(<a class="code hl_function" href="malloc_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a> &gt; 0, <span class="stringliteral">&quot;mstack exhausted&quot;</span>);</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    mstack = (uint16_t)<a class="code hl_function" href="malloc_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a>;</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span> </div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    <span class="keyword">extern</span> stkalign_t <a class="code hl_variable" href="stm32__util_8h.html#ae92115e7706564de8765ed65cb8f45bd">__main_thread_stack_base__</a>[];</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>    <span class="keyword">extern</span> stkalign_t <a class="code hl_variable" href="stm32__util_8h.html#a0d9fbf860357a191810118fbe30be6b1">__main_thread_stack_end__</a>[];</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    stklimit = (uint32_t)<a class="code hl_variable" href="stm32__util_8h.html#a0d9fbf860357a191810118fbe30be6b1">__main_thread_stack_end__</a>;</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>    stkbase  = (uint32_t)<a class="code hl_variable" href="stm32__util_8h.html#ae92115e7706564de8765ed65cb8f45bd">__main_thread_stack_base__</a>;</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>    crawl   = (uint32_t *)stkbase;</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span> </div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>    <span class="keywordflow">while</span> (*crawl == 0x55555555 &amp;&amp; crawl &lt; (uint32_t *)stklimit) {</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>        crawl++;</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    }</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    <a class="code hl_function" href="malloc_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a> = (uint32_t)crawl - stkbase;</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>    chDbgAssert(<a class="code hl_function" href="malloc_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a> &gt; 0, <span class="stringliteral">&quot;pstack exhausted&quot;</span>);</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    pstack = (uint16_t)<a class="code hl_function" href="malloc_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a>;</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>}</div>
</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span><span class="preprocessor">#endif </span><span class="comment">/* CH_DBG_ENABLE_STACK_CHECK == TRUE */</span><span class="preprocessor"></span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span> </div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span><span class="comment">/*</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span><span class="comment"> Update loop design.</span></div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span><span class="comment"></span> </div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span><span class="comment"> Considerations - the F100 is quite slow and so processing time needs to be used effectively.</span></div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span><span class="comment"> The CPU time slices required by dshot are generally faster than those required for other processing.</span></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span><span class="comment"> Dshot requires even updates at at least 1Khz and generally faster if SERVO_DSHOT_RATE is used.</span></div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span><span class="comment"> The two most time sensitive regular functions are (1) PWM updates which run at loop rate triggered from the FMU</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span><span class="comment"> (and thus require efficient code page write) and (2) rcin updates which run at a fixed 1Khz cycle (a speed</span></div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span><span class="comment"> which is assumed by the rcin protocol handlers) and require efficient code read. The FMU sends code page</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span><span class="comment"> requests which require a response within 10ms in order to prevent the IOMCU being considered to have failed,</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span><span class="comment"> however code page requests are always initiated by the FMU and so the IOMCU only ever needs to be ready</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span><span class="comment"> to read requests - writing responses are always in response to a request. Finally, PWM channels 3-4 share a DMA</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span><span class="comment"> channel with UART TX and so access needs to be mediated.</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span><span class="comment"></span> </div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span><span class="comment"> Design -</span></div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span><span class="comment"> 1. requests are read using circular DMA. In other words the RX side of the UART is always ready. Once</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span><span class="comment"> a request has been processed DMA is immediately set up for a new request.</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span><span class="comment"> 2. responses are only ever sent in response to a request. As soon as a request is received the ISR only</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span><span class="comment"> ever requests that a response be sent - it never actually sends a response.</span></div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span><span class="comment"> 3. The update loop waits for four different events:</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span><span class="comment">    3a - a request has been received and should be processed. This does not require the TX DMA lock.</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span><span class="comment">    3b - a response needs to be sent. This requires the TX DMA lock.</span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span><span class="comment">    3c - a response has been sent. This allows the TX DMA lock to be released.</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span><span class="comment">    3d - an out of band PWM request, usually triggered by a failsafe needs to be processed.</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span><span class="comment"> Since requests are processed continuously it is possible for 3b and 3c to occur simultaneously. Since the</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span><span class="comment"> TX lock is already held to send the previous response, there is no need to do anything with the lock in order</span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span><span class="comment"> to process the next response.</span></div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span><span class="comment"></span> </div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span><span class="comment"> Profiling shows that sending a response takes very little time - 10s of microseconds - and so a response is sent</span></div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span><span class="comment"> if required at the beginning of the update. This means that by the end of the update there is a very high chance</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span><span class="comment"> that the response will have already been sent and this is therefore checked. If the response has been sent the</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span><span class="comment"> lock is released. If for some reason the response has not gone out, as soon as it does an event will be posted</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span><span class="comment"> and the update loop will run again.</span></div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span><span class="comment"></span> </div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span><span class="comment"> This design means that on average the update loop is idle with the TX DMA channel unlocked. This maximises the</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span><span class="comment"> time that dshot can run uninterrupted leading to very efficient and even output.</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span><span class="comment"></span> </div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span><span class="comment"> Finally the update loop has a timeout which forces updates to progress even in the absence of requests from the</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span><span class="comment"> FMU. Since responses will always be triggered in a timely fashion, regardlesss of the timeout, this can be</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span><span class="comment"> set relatively long.</span></div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span><span class="comment"></span> </div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span><span class="comment"> If compiled without sharing, DMA - and thus dshot - is not used on channels 3-4, there are no locks and responses</span></div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span><span class="comment"> are always setup in the request ISR handler.</span></div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00416" data-start="{" data-end="}">
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#aa6e97452785d6ade70465f15a87978f4">  416</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#aa6e97452785d6ade70465f15a87978f4">AP_IOMCU_FW::update</a>()</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>{</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>    eventmask_t mask = chEvtWaitAnyTimeout(<a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06af23b75144c072b1255b0274aab89ee12">IOEVENT_PWM</a> | <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a8186f067e8f3343c8a798b4bbe833547">IOEVENT_TX_END</a> | <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a566cc3b837181645b59574fc6af58910">IOEVENT_TX_BEGIN</a>, TIME_US2I(1000));</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span><span class="preprocessor">#ifdef HAL_GPIO_LINE_GPIO107</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>    <a class="code hl_define" href="AP__HAL__ChibiOS_2RCOutput_8h.html#a0a1754fe5ac9fa4efc193420918b35e5">TOGGLE_PIN_DEBUG</a>(107);</div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span> </div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>    <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#a1ee477f812b7b4beb2c3964e715ad9bc">total_ticks</a>++;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>    <span class="keywordflow">if</span> (mask) {</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>        <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#a565f2c9c72e450ab0874a829c4d75902">total_events</a>++;</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    }</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span> </div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span><span class="preprocessor">#if AP_HAL_SHARED_DMA_ENABLED</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>    <span class="comment">// See discussion above</span></div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>    <span class="keywordflow">if</span> ((mask &amp; <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a566cc3b837181645b59574fc6af58910">IOEVENT_TX_BEGIN</a>) &amp;&amp; !(mask &amp; <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a8186f067e8f3343c8a798b4bbe833547">IOEVENT_TX_END</a>)) {        <span class="comment">// 3b - lock required to send response</span></div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>        tx_dma_handle-&gt;lock();</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!(mask &amp; <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a566cc3b837181645b59574fc6af58910">IOEVENT_TX_BEGIN</a>) &amp;&amp; (mask &amp; <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a8186f067e8f3343c8a798b4bbe833547">IOEVENT_TX_END</a>)) { <span class="comment">// 3c - response sent, lock can be released</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>        tx_dma_handle-&gt;unlock();</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    }   <span class="comment">// else 3b and 3c   - current lock required for new response</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span> </div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>    <span class="comment">// send a response if required</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>    <span class="keywordflow">if</span> (mask &amp; <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a566cc3b837181645b59574fc6af58910">IOEVENT_TX_BEGIN</a>) {</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>        chSysLock();</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>        <a class="code hl_function" href="iofirmware_8cpp.html#a653ccb1f7a547130f836735ae7d1af53">setup_tx_dma</a>(&amp;UARTD2);</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>        chSysUnlock();</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>    }</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span> </div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>    <span class="comment">// we get the timestamp once here, and avoid fetching it</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>    <span class="comment">// within the DMA callbacks</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a4dbb86a1eefe373da375c0beaee26106">last_ms</a> = <a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a255cdf7fb87b22b8047e3371a57b23e4">loop_counter</a>++;</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span> </div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9f12c96acc2ceabc7e8531f23d3ab86">do_reboot</a> &amp;&amp; (<a class="code hl_variable" href="classAP__IOMCU__FW.html#a4dbb86a1eefe373da375c0beaee26106">last_ms</a> &gt; <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8b282febfad6c55df810f4fa0fd16346">reboot_time</a>)) {</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Scheduler.html#a9fc1cebafebb6588842f4f0e18c7a996">reboot</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>        <span class="keywordflow">while</span> (<span class="keyword">true</span>) {}</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>    }</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    <span class="keywordflow">if</span> ((mask &amp; <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06af23b75144c072b1255b0274aab89ee12">IOEVENT_PWM</a>) ||</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>        (<a class="code hl_variable" href="classAP__IOMCU__FW.html#a90afbe235dd406e74193315a77caf983">last_safety_off</a> != <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a>)) {</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a90afbe235dd406e74193315a77caf983">last_safety_off</a> = <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a>;</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>        <a class="code hl_function" href="classAP__IOMCU__FW.html#a474694d94410652f5e014731cca92734">pwm_out_update</a>();</div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>    }</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span> </div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>    uint32_t now = <a class="code hl_variable" href="classAP__IOMCU__FW.html#a4dbb86a1eefe373da375c0beaee26106">last_ms</a>;</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>    uint32_t now_us = <a class="code hl_function" href="namespaceAP__HAL.html#a8293355e35887733b1fd151aef08a787">AP_HAL::micros</a>();</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span> </div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#a0d087b3c82d398e8af2cb4b275f52c71">timestamp_ms</a> = <a class="code hl_variable" href="classAP__IOMCU__FW.html#a4dbb86a1eefe373da375c0beaee26106">last_ms</a>;</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>    <span class="comment">// output SBUS if enabled</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.features &amp; <a class="code hl_define" href="ioprotocol_8h.html#a37fbeb1e1fad6729b8d577ed32bcb9db">P_SETUP_FEATURES_SBUS1_OUT</a>) &amp;&amp;</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a> &amp;&amp;</div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>        now - <a class="code hl_variable" href="classAP__IOMCU__FW.html#aef04d668a1a738b37338ed0bad80ee7a">sbus_last_ms</a> &gt;= <a class="code hl_variable" href="classAP__IOMCU__FW.html#a9468ae045e671313d30ce03f8767acc9">sbus_interval_ms</a>) {</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>        <span class="comment">// output a new SBUS frame</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#aef04d668a1a738b37338ed0bad80ee7a">sbus_last_ms</a> = now;</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>        <a class="code hl_function" href="rc_8cpp.html#ac546ed0d264ed9fd5199b63c3fa70272">sbus_out_write</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab5fb85fb1f85ad381a98faedf42b1a1a">reg_servo</a>.pwm, <a class="code hl_define" href="ioprotocol_8h.html#a8fdf176415a905cbb9a151a8c3cda86b">IOMCU_MAX_RC_CHANNELS</a>);</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>    }</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>    <span class="comment">// handle FMU failsafe</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>    <span class="keywordflow">if</span> (now - <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab55f1d13336499eb33e65f5473fd23ae">fmu_data_received_time</a> &gt; 200) {</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>        <span class="comment">// we are not getting input from the FMU. Fill in failsafe values at 100Hz</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>        <span class="keywordflow">if</span> (now - <a class="code hl_variable" href="classAP__IOMCU__FW.html#a81d74737c2cc12ff80d7dd17e2d76aa2">last_failsafe_ms</a> &gt; 10) {</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>            <a class="code hl_function" href="classAP__IOMCU__FW.html#a528efc78233e1a0114c0636d1858cf7d">fill_failsafe_pwm</a>();</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>            chEvtSignal(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a416c0720ab52a33e06e40b989ecfb39a">thread_ctx</a>, <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06af23b75144c072b1255b0274aab89ee12">IOEVENT_PWM</a>);</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a81d74737c2cc12ff80d7dd17e2d76aa2">last_failsafe_ms</a> = now;</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>        }</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>        <span class="comment">// turn amber on</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>        <a class="code hl_define" href="iofirmware_8h.html#aa99daddb196278a70d757ae3838ef4fa">AMBER_SET</a>(1);</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a81d74737c2cc12ff80d7dd17e2d76aa2">last_failsafe_ms</a> = now;</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>        <span class="comment">// turn amber off</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>        <a class="code hl_define" href="iofirmware_8h.html#aa99daddb196278a70d757ae3838ef4fa">AMBER_SET</a>(0);</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>    }</div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span> </div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>    <span class="comment">// update status page at 20Hz</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    <span class="keywordflow">if</span> (now - <a class="code hl_variable" href="classAP__IOMCU__FW.html#a4b4741b7d5df86a9a790658cee42a439">last_status_ms</a> &gt; 50) {</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a4b4741b7d5df86a9a790658cee42a439">last_status_ms</a> = now;</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>        <a class="code hl_function" href="classAP__IOMCU__FW.html#a8e632861c976b85cbfa481f6c0297c89">page_status_update</a>();</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    }</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span><span class="preprocessor">#ifdef HAL_WITH_BIDIR_DSHOT</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>    <span class="comment">// EDT updates are semt at ~1Hz per ESC, but we want to make sure</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>    <span class="comment">// that we don&#39;t delay updates unduly so sample at 5Hz</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>    <span class="keywordflow">if</span> (now - last_telem_ms &gt; 200) {</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>        last_telem_ms = now;</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>        <a class="code hl_function" href="classAP__IOMCU__FW.html#a22dc905a20b58d37d5fbc5261433f45a">telem_update</a>();</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>    }</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    <span class="comment">// run fast loop functions at 1Khz</span></div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>    <span class="keywordflow">if</span> (now_us - <a class="code hl_variable" href="classAP__IOMCU__FW.html#a4914fac72fcff6f6f0bf79c64ef39460">last_fast_loop_us</a> &gt;= 1000)</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    {</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a4914fac72fcff6f6f0bf79c64ef39460">last_fast_loop_us</a> = now_us;</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>        <a class="code hl_function" href="classAP__IOMCU__FW.html#a08a7b7d2cfa6a7e5b152a71481e23fd7">heater_update</a>();</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>        <a class="code hl_function" href="classAP__IOMCU__FW.html#a1a711e065227a9bee8bee196b61b6124">rcin_update</a>();</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>        <a class="code hl_function" href="classAP__IOMCU__FW.html#a08015b8cec98d8b18b61bfd1dd7e3ef2">rcin_serial_update</a>();</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span><span class="preprocessor">#ifdef HAL_WITH_BIDIR_DSHOT</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>        <a class="code hl_function" href="classAP__IOMCU__FW.html#a29a8366f97ed72a0cf6418025ba991bc">erpm_update</a>();</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>    }</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span> </div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>    <span class="comment">// run remaining functions at 100Hz</span></div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>    <span class="comment">// these are all relatively expensive and take ~10ms to complete</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>    <span class="comment">// so there is no way they can effectively be run faster than 100Hz</span></div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>    <span class="keywordflow">if</span> (now - <a class="code hl_variable" href="classAP__IOMCU__FW.html#a2a86cf5c4f77aba865987dfb97cbda16">last_slow_loop_ms</a> &gt; 10) {</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a2a86cf5c4f77aba865987dfb97cbda16">last_slow_loop_ms</a> = now;</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>        <a class="code hl_function" href="classAP__IOMCU__FW.html#a6a00574abc4606791259e65ec376a0a1">safety_update</a>();</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>        <a class="code hl_function" href="classAP__IOMCU__FW.html#a43030d57d47a80e97578178e5c21115e">rcout_config_update</a>();</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a9d89ae5e312d39c697f03d8269be933b">timer_tick</a>();</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#aed0efa98cece9e24792eb9ba3231abb6">dsm_bind_state</a>) {</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>            <a class="code hl_function" href="classAP__IOMCU__FW.html#ad52ea909c69b2dc1bc01a47a3a3255b9">dsm_bind_step</a>();</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>        }</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>        <a class="code hl_function" href="classAP__IOMCU__FW.html#add72dc29f89933f29d7652038824650d">GPIO_write</a>();</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span><span class="preprocessor">#if CH_DBG_ENABLE_STACK_CHECK == TRUE</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>        <a class="code hl_function" href="iofirmware_8cpp.html#ae604357e19347d62bbfc958f65c2dd5a">stackCheck</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#ad289a2cbbb52a251dc7151e41cbc379b">freemstack</a>, <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#a610d89ed9e8d5ef57b6a50b5f06bd2dd">freepstack</a>);</div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>    }</div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span><span class="preprocessor">#if AP_HAL_SHARED_DMA_ENABLED</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>    <span class="comment">// check whether a response has now been sent</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>    mask = chEvtGetAndClearEvents(<a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a8186f067e8f3343c8a798b4bbe833547">IOEVENT_TX_END</a>);</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span> </div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>    <span class="keywordflow">if</span> (mask) {</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>        tx_dma_handle-&gt;unlock();</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>    }</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span><span class="preprocessor">#ifdef HAL_GPIO_LINE_GPIO107</span></div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>    <a class="code hl_define" href="AP__HAL__ChibiOS_2RCOutput_8h.html#a0a1754fe5ac9fa4efc193420918b35e5">TOGGLE_PIN_DEBUG</a>(107);</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>}</div>
</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span> </div>
<div class="foldopen" id="foldopen00541" data-start="{" data-end="}">
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#a474694d94410652f5e014731cca92734">  541</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#a474694d94410652f5e014731cca92734">AP_IOMCU_FW::pwm_out_update</a>()</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>{</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>    memcpy(<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab5fb85fb1f85ad381a98faedf42b1a1a">reg_servo</a>.pwm, <a class="code hl_variable" href="classAP__IOMCU__FW.html#aa50c3d095bf413e4858451eb1131fcea">reg_direct_pwm</a>.pwm, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#aa50c3d095bf413e4858451eb1131fcea">reg_direct_pwm</a>));</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>    <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a9683d68d15b6e722c44e098bbb12e60a">cork</a>();</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code hl_define" href="iofirmware_8h.html#a0230bc3c5208cc29f365e182539edd17">SERVO_COUNT</a>; i++) {</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a> || (<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.ignore_safety &amp; (1U&lt;&lt;i))) {</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>            <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#ade771f122696035c1e831ccc63a33893">write</a>(i, <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab5fb85fb1f85ad381a98faedf42b1a1a">reg_servo</a>.pwm[i]);</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>            <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#ade771f122696035c1e831ccc63a33893">write</a>(i, 0);</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>        }</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>    }</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>    <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a3b81b9e1e60a7dfcfacb2430e7705b8e">push</a>();</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>}</div>
</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span> </div>
<div class="foldopen" id="foldopen00555" data-start="{" data-end="}">
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#a08a7b7d2cfa6a7e5b152a71481e23fd7">  555</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#a08a7b7d2cfa6a7e5b152a71481e23fd7">AP_IOMCU_FW::heater_update</a>()</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>{</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>    uint32_t now = <a class="code hl_variable" href="classAP__IOMCU__FW.html#a4dbb86a1eefe373da375c0beaee26106">last_ms</a>;</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__IOMCU__FW.html#a32b6b03c8197f0a0add346f4aaf02802">has_heater</a>) {</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>        <span class="comment">// use blue LED as heartbeat, run it 4x faster when override active</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>        <span class="keywordflow">if</span> (now - <a class="code hl_variable" href="classAP__IOMCU__FW.html#a6ee4f85112da6de1058bbe7d652c47a5">last_blue_led_ms</a> &gt; (<a class="code hl_variable" href="classAP__IOMCU__FW.html#a55ce8d5ede1de8675d740d592c8b9023">override_active</a>?125:500)) {</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>            <a class="code hl_define" href="iofirmware_8h.html#a8337301c0cf199b92191a4a0e22c11bd">BLUE_TOGGLE</a>();</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a6ee4f85112da6de1058bbe7d652c47a5">last_blue_led_ms</a> = now;</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>        }</div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.heater_duty_cycle == 0 || (now - <a class="code hl_variable" href="classAP__IOMCU__FW.html#a916d19242ab92817f71d9d28d1440d5d">last_heater_ms</a> &gt; 3000UL)) {</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>        <span class="comment">// turn off the heater</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>        <a class="code hl_define" href="iofirmware_8h.html#a887a0411d2f5020af91f20065d3d940d">HEATER_SET</a>(!<a class="code hl_variable" href="classAP__IOMCU__FW.html#abcc5bc0a2a54b9df32c9a7726b94ab7a">heater_pwm_polarity</a>);</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>        <span class="comment">// we use a pseudo random sequence to dither the cycling as</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>        <span class="comment">// the heater has a significant effect on the internal</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>        <span class="comment">// magnetometers. The random generator dithers this so we don&#39;t get a 1Hz cycly in the magnetometer.</span></div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>        <span class="comment">// The impact on the mags is about 25 mGauss.</span></div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>        <span class="keywordtype">bool</span> heater_on = (<a class="code hl_function" href="AP__Math_8cpp.html#a587a30a56f2ab102c7b42f89e4770530">get_random16</a>() &lt; uint32_t(<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.heater_duty_cycle) * 0xFFFFU / 100U);</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>        <a class="code hl_define" href="iofirmware_8h.html#a887a0411d2f5020af91f20065d3d940d">HEATER_SET</a>(heater_on? <a class="code hl_variable" href="classAP__IOMCU__FW.html#abcc5bc0a2a54b9df32c9a7726b94ab7a">heater_pwm_polarity</a> : !<a class="code hl_variable" href="classAP__IOMCU__FW.html#abcc5bc0a2a54b9df32c9a7726b94ab7a">heater_pwm_polarity</a>);</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    }</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>}</div>
</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span> </div>
<div class="foldopen" id="foldopen00577" data-start="{" data-end="}">
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#a1a711e065227a9bee8bee196b61b6124">  577</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#a1a711e065227a9bee8bee196b61b6124">AP_IOMCU_FW::rcin_update</a>()</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>{</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>    ((<a class="code hl_class" href="classChibiOS_1_1RCInput.html">ChibiOS::RCInput</a> *)<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a44ed5c21ed9aae558cff53d73c3714b5">rcin</a>)-&gt;_timer_tick();</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a44ed5c21ed9aae558cff53d73c3714b5">rcin</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCInput.html#aee1fade33080edef83dd7db0fad0f7da">new_input</a>()) {</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_function" href="RC__Channel_8h.html#abe35aea6177a1cdf87a22af5c263bb89">rc</a> = <a class="code hl_function" href="namespaceAP.html#ae2881dc66a7a1653b455691fbcd1a0a0">AP::RC</a>();</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a3f3b8816d2d8ffcc29572da4c07c614b">rc_input</a>.<a class="code hl_variable" href="structpage__rc__input.html#afdd5b2e6f4742c8119b7ab61fff92c59">count</a> = <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a44ed5c21ed9aae558cff53d73c3714b5">rcin</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCInput.html#ae55f959c6115c1f41783af3a2b6c4fcd">num_channels</a>();</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a3f3b8816d2d8ffcc29572da4c07c614b">rc_input</a>.<a class="code hl_variable" href="structpage__rc__input.html#a6b177138a27ca5a9a7525c79716344ef">flags_rc_ok</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a44ed5c21ed9aae558cff53d73c3714b5">rcin</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCInput.html#a078fd7e6d2e6a899009ec674a8e03498">read</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a3f3b8816d2d8ffcc29572da4c07c614b">rc_input</a>.<a class="code hl_variable" href="structpage__rc__input.html#a363a90b68fc73a506d64506b5b1c78c8">pwm</a>, <a class="code hl_define" href="ioprotocol_8h.html#a8fdf176415a905cbb9a151a8c3cda86b">IOMCU_MAX_RC_CHANNELS</a>);</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a7a273e6b4f2df8840acdc526d08d4e47">rc_last_input_ms</a> = <a class="code hl_variable" href="classAP__IOMCU__FW.html#a4dbb86a1eefe373da375c0beaee26106">last_ms</a>;</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a3f3b8816d2d8ffcc29572da4c07c614b">rc_input</a>.<a class="code hl_variable" href="structpage__rc__input.html#a8f09eb9cd84d88e5a4299894a87311c1">rc_protocol</a> = (uint16_t)<a class="code hl_function" href="RC__Channel_8h.html#abe35aea6177a1cdf87a22af5c263bb89">rc</a>.protocol_detected();</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a3f3b8816d2d8ffcc29572da4c07c614b">rc_input</a>.<a class="code hl_variable" href="structpage__rc__input.html#a7175616c3641828e00b54e9d267fc347">rssi</a> = <a class="code hl_function" href="RC__Channel_8h.html#abe35aea6177a1cdf87a22af5c263bb89">rc</a>.get_RSSI();</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a3f3b8816d2d8ffcc29572da4c07c614b">rc_input</a>.<a class="code hl_variable" href="structpage__rc__input.html#acd43d64d894561a54507f0f0dedf0912">flags_failsafe</a> = <a class="code hl_function" href="RC__Channel_8h.html#abe35aea6177a1cdf87a22af5c263bb89">rc</a>.failsafe_active();</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#a4dbb86a1eefe373da375c0beaee26106">last_ms</a> - <a class="code hl_variable" href="classAP__IOMCU__FW.html#a7a273e6b4f2df8840acdc526d08d4e47">rc_last_input_ms</a> &gt; 200U) {</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a3f3b8816d2d8ffcc29572da4c07c614b">rc_input</a>.<a class="code hl_variable" href="structpage__rc__input.html#a6b177138a27ca5a9a7525c79716344ef">flags_rc_ok</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>    }</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#ad6f963d7a986df74035569369ea2c663">update_rcout_freq</a>) {</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#ae7903398aa18e2472dd34081e626dcb7">set_freq</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.pwm_rates, <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.pwm_altrate);</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ad6f963d7a986df74035569369ea2c663">update_rcout_freq</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>    }</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#a73e6e889f83a6b426b94d804dbdb4975">update_default_rate</a>) {</div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a2318a007e93f70762ba8c09b05329104">set_default_rate</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.pwm_defaultrate);</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a73e6e889f83a6b426b94d804dbdb4975">update_default_rate</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>    }</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span> </div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>    <span class="keywordtype">bool</span> old_override = <a class="code hl_variable" href="classAP__IOMCU__FW.html#a55ce8d5ede1de8675d740d592c8b9023">override_active</a>;</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span> </div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>    <span class="comment">// check for active override channel</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#a7a4d8d2ed6e17e209ab496fb4b44aa5b">mixing</a>.<a class="code hl_variable" href="structpage__mixing.html#ad395d258572391e2a8e40b7971133e63">enabled</a> &amp;&amp;</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a7a4d8d2ed6e17e209ab496fb4b44aa5b">mixing</a>.<a class="code hl_variable" href="structpage__mixing.html#a1862808bc91583d403e33a1877f3641b">rc_chan_override</a> &gt; 0 &amp;&amp;</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a3f3b8816d2d8ffcc29572da4c07c614b">rc_input</a>.<a class="code hl_variable" href="structpage__rc__input.html#a6b177138a27ca5a9a7525c79716344ef">flags_rc_ok</a> &amp;&amp;</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a7a4d8d2ed6e17e209ab496fb4b44aa5b">mixing</a>.<a class="code hl_variable" href="structpage__mixing.html#a1862808bc91583d403e33a1877f3641b">rc_chan_override</a> &lt;= <a class="code hl_define" href="ioprotocol_8h.html#a8fdf176415a905cbb9a151a8c3cda86b">IOMCU_MAX_RC_CHANNELS</a>) {</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a55ce8d5ede1de8675d740d592c8b9023">override_active</a> = (<a class="code hl_variable" href="classAP__IOMCU__FW.html#a3f3b8816d2d8ffcc29572da4c07c614b">rc_input</a>.<a class="code hl_variable" href="structpage__rc__input.html#a363a90b68fc73a506d64506b5b1c78c8">pwm</a>[<a class="code hl_variable" href="classAP__IOMCU__FW.html#a7a4d8d2ed6e17e209ab496fb4b44aa5b">mixing</a>.<a class="code hl_variable" href="structpage__mixing.html#a1862808bc91583d403e33a1877f3641b">rc_chan_override</a>-1] &gt;= 1750);</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a55ce8d5ede1de8675d740d592c8b9023">override_active</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>    }</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>    <span class="keywordflow">if</span> (old_override != <a class="code hl_variable" href="classAP__IOMCU__FW.html#a55ce8d5ede1de8675d740d592c8b9023">override_active</a>) {</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#a55ce8d5ede1de8675d740d592c8b9023">override_active</a>) {</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>            <a class="code hl_function" href="classAP__IOMCU__FW.html#a528efc78233e1a0114c0636d1858cf7d">fill_failsafe_pwm</a>();</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>        }</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>        chEvtSignal(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a416c0720ab52a33e06e40b989ecfb39a">thread_ctx</a>, <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06af23b75144c072b1255b0274aab89ee12">IOEVENT_PWM</a>);</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>    }</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>}</div>
</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span> </div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span><span class="preprocessor">#ifdef HAL_WITH_BIDIR_DSHOT</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#a29a8366f97ed72a0cf6418025ba991bc">AP_IOMCU_FW::erpm_update</a>()</div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>{</div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>    uint32_t now_us = <a class="code hl_function" href="namespaceAP__HAL.html#a8293355e35887733b1fd151aef08a787">AP_HAL::micros</a>();</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span> </div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#ae8460cf8753716f6aa2fe1d84f9a90ff">new_erpm</a>()) {</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>        dshot_erpm.update_mask |= <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a5cf4dd2429d465f1ce74bb8204f7f02a">read_erpm</a>(dshot_erpm.erpm, <a class="code hl_define" href="ioprotocol_8h.html#afcfa41e97c4d1abb6380c1c9d699871c">IOMCU_MAX_TELEM_CHANNELS</a>);</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>        last_erpm_us = now_us;</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (now_us - last_erpm_us &gt; ESC_RPM_DATA_TIMEOUT_US) {</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>        dshot_erpm.update_mask = 0;</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    }</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>}</div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span> </div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#a22dc905a20b58d37d5fbc5261433f45a">AP_IOMCU_FW::telem_update</a>()</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>{</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>    uint32_t now_ms = <a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span> </div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; <a class="code hl_define" href="ioprotocol_8h.html#afcfa41e97c4d1abb6380c1c9d699871c">IOMCU_MAX_TELEM_CHANNELS</a>/4; i++) {</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>        <span class="keywordflow">for</span> (uint8_t j = 0; j &lt; 4; j++) {</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>            <span class="keyword">const</span> uint8_t esc_id = (i * 4 + j);</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>            <span class="keywordflow">if</span> (esc_id &gt;= <a class="code hl_define" href="ioprotocol_8h.html#afcfa41e97c4d1abb6380c1c9d699871c">IOMCU_MAX_TELEM_CHANNELS</a>) {</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>            }</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>            dshot_telem[i].error_rate[j] = uint16_t(roundf(<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#afb78a9564ae460447f2ce993a0bc0482">get_erpm_error_rate</a>(esc_id) * 100.0));</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span><span class="preprocessor">#if HAL_WITH_ESC_TELEM</span></div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>            <span class="keyword">const</span> <span class="keyword">volatile</span> AP_ESC_Telem_Backend::TelemetryData&amp; telem = esc_telem.get_telem_data(esc_id);</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>            <span class="comment">// if data is stale then set to zero to avoid phantom data appearing in mavlink</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>            <span class="keywordflow">if</span> (now_ms - telem.last_update_ms &gt; ESC_TELEM_DATA_TIMEOUT_MS) {</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>                dshot_telem[i].voltage_cvolts[j] = 0;</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>                dshot_telem[i].current_camps[j] = 0;</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>                dshot_telem[i].temperature_cdeg[j] = 0;</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>            }</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>            dshot_telem[i].voltage_cvolts[j] = uint16_t(roundf(telem.voltage * 100));</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>            dshot_telem[i].current_camps[j] = uint16_t(roundf(telem.current * 100));</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>            dshot_telem[i].temperature_cdeg[j] = telem.temperature_cdeg;</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>            dshot_telem[i].types[j] = telem.types;</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>        }</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>    }</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>}</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span> </div>
<div class="foldopen" id="foldopen00663" data-start="{" data-end="}">
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#ac14e26cad684438adbf4dc26186e1295">  663</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#ac14e26cad684438adbf4dc26186e1295">AP_IOMCU_FW::process_io_packet</a>()</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>{</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>    <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#a51a32f1d70bfecc92e2e2322c79a25a7">total_pkts</a>++;</div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span> </div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>    <span class="keywordflow">if</span> (rx_io_packet.code == <a class="code hl_enumvalue" href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7a8729461d13a7d6ceeea4ad504f51947f">CODE_NOOP</a>) {</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>        <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#ab751d54220c9d18e4f0edb5a6a41a4e5">num_errors</a>++;</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>        <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#a9e031aa30a33ff8a2c9832270375ffeb">err_bad_opcode</a>++;</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>    }</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span> </div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>    uint8_t rx_crc = rx_io_packet.crc;</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>    uint8_t calc_crc;</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>    rx_io_packet.crc = 0;</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>    uint8_t pkt_size = rx_io_packet.get_size();</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>    <span class="keywordflow">if</span> (rx_io_packet.code == <a class="code hl_enumvalue" href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7a9480eb6915fc8727181c8e13d7666460">CODE_READ</a>) {</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>        <span class="comment">// allow for more bandwidth efficient read packets</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>        calc_crc = <a class="code hl_function" href="crc_8cpp.html#a9854916652a9bd6e9db046706bc313b1">crc_crc8</a>((<span class="keyword">const</span> uint8_t *)&amp;rx_io_packet, 4);</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>        <span class="keywordflow">if</span> (calc_crc != rx_crc) {</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>            calc_crc = <a class="code hl_function" href="crc_8cpp.html#a9854916652a9bd6e9db046706bc313b1">crc_crc8</a>((<span class="keyword">const</span> uint8_t *)&amp;rx_io_packet, pkt_size);</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>        }</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>        calc_crc = <a class="code hl_function" href="crc_8cpp.html#a9854916652a9bd6e9db046706bc313b1">crc_crc8</a>((<span class="keyword">const</span> uint8_t *)&amp;rx_io_packet, pkt_size);</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>    }</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>    <span class="keywordflow">if</span> (rx_crc != calc_crc || rx_io_packet.count &gt; <a class="code hl_define" href="ioprotocol_8h.html#a0037b43d3693c0d8d3c5df6c36ccc4b8">PKT_MAX_REGS</a>) {</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a97469a4b02be0a9556d78af389fa6956">count</a> = 0;</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a5964448096d22dc869d0139b256262bd">code</a> = <a class="code hl_enumvalue" href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7a78438e41223d665561056221ef9417ca">CODE_CORRUPT</a>;</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#af856646ceb9df0f094d8a26287189fcf">crc</a> = 0;</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a93abdcba6eb1657fcb6760babb7c0d00">page</a> = 0;</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a338a71aff88023b64b73cfde6d4ca2ef">offset</a> = 0;</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#af856646ceb9df0f094d8a26287189fcf">crc</a> =  <a class="code hl_function" href="crc_8cpp.html#a9854916652a9bd6e9db046706bc313b1">crc_crc8</a>((<span class="keyword">const</span> uint8_t *)&amp;<a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>, <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_function" href="structIOPacket.html#ae4b6c1ba8ca5e98e2429c364bc1e404f">get_size</a>());</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>        <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#ab751d54220c9d18e4f0edb5a6a41a4e5">num_errors</a>++;</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>        <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#a5c12ceb4a8207e291c9260d86451390f">err_crc</a>++;</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>    }</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>    <span class="keywordflow">switch</span> (rx_io_packet.code) {</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7a9480eb6915fc8727181c8e13d7666460">CODE_READ</a>: {</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__IOMCU__FW.html#a647711495b79e5ae220664fc199e2a6a">handle_code_read</a>()) {</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a97469a4b02be0a9556d78af389fa6956">count</a> = 0;</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a5964448096d22dc869d0139b256262bd">code</a> = <a class="code hl_enumvalue" href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7afacfaacf2b3fd4e43ba95be012e217b0">CODE_ERROR</a>;</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#af856646ceb9df0f094d8a26287189fcf">crc</a> = 0;</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a93abdcba6eb1657fcb6760babb7c0d00">page</a> = 0;</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a338a71aff88023b64b73cfde6d4ca2ef">offset</a> = 0;</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#af856646ceb9df0f094d8a26287189fcf">crc</a> =  <a class="code hl_function" href="crc_8cpp.html#a9854916652a9bd6e9db046706bc313b1">crc_crc8</a>((<span class="keyword">const</span> uint8_t *)&amp;<a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>, <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_function" href="structIOPacket.html#ae4b6c1ba8ca5e98e2429c364bc1e404f">get_size</a>());</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>            <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#ab751d54220c9d18e4f0edb5a6a41a4e5">num_errors</a>++;</div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>            <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#add4c7ea747bf661c11c1e29b65ea0bb5">err_read</a>++;</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>        }</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>    }</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7aba16c302538a9dfec64f7e9d71af94fe">CODE_WRITE</a>: {</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__IOMCU__FW.html#a588a102aed1b2ef4fd7f48e4efdb7cf5">handle_code_write</a>()) {</div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a97469a4b02be0a9556d78af389fa6956">count</a> = 0;</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a5964448096d22dc869d0139b256262bd">code</a> = <a class="code hl_enumvalue" href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7afacfaacf2b3fd4e43ba95be012e217b0">CODE_ERROR</a>;</div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#af856646ceb9df0f094d8a26287189fcf">crc</a> = 0;</div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a93abdcba6eb1657fcb6760babb7c0d00">page</a> = 0;</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a338a71aff88023b64b73cfde6d4ca2ef">offset</a> = 0;</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#af856646ceb9df0f094d8a26287189fcf">crc</a> =  <a class="code hl_function" href="crc_8cpp.html#a9854916652a9bd6e9db046706bc313b1">crc_crc8</a>((<span class="keyword">const</span> uint8_t *)&amp;<a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>, <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_function" href="structIOPacket.html#ae4b6c1ba8ca5e98e2429c364bc1e404f">get_size</a>());</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>            <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#ab751d54220c9d18e4f0edb5a6a41a4e5">num_errors</a>++;</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>            <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#a15d1816ed1764006b01dc8f22d310b78">err_write</a>++;</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>        }</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>    }</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>    <span class="keywordflow">default</span>: {</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>        <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#ab751d54220c9d18e4f0edb5a6a41a4e5">num_errors</a>++;</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>        <a class="code hl_variable" href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a>.<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#a9e031aa30a33ff8a2c9832270375ffeb">err_bad_opcode</a>++;</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>        rx_io_packet.code = <a class="code hl_enumvalue" href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7a8729461d13a7d6ceeea4ad504f51947f">CODE_NOOP</a>;</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>        rx_io_packet.count = 0;</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>    }</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>    }</div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span> </div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>    <span class="comment">// prevent a spurious DMA callback from doing anything bad</span></div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>    rx_io_packet.code = <a class="code hl_enumvalue" href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7a8729461d13a7d6ceeea4ad504f51947f">CODE_NOOP</a>;</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>    rx_io_packet.count = 0;</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span> </div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>}</div>
</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span> </div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span><span class="comment">/*</span></div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span><span class="comment">  update dynamic elements of status page</span></div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00744" data-start="{" data-end="}">
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#a8e632861c976b85cbfa481f6c0297c89">  744</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#a8e632861c976b85cbfa481f6c0297c89">AP_IOMCU_FW::page_status_update</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>{</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>    <a class="code hl_function" href="analog_8cpp.html#a343698084802dc89c1669a49fbbc6497">adc_sample_channels</a>();</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span> </div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.features &amp; <a class="code hl_define" href="ioprotocol_8h.html#a37fbeb1e1fad6729b8d577ed32bcb9db">P_SETUP_FEATURES_SBUS1_OUT</a>) == 0) {</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>        <span class="comment">// we can only get VRSSI when sbus is disabled</span></div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#ad4c1789970ca3486949bb79ba20a8cd6">vrssi</a> = <a class="code hl_function" href="analog_8cpp.html#adb53fd685d9f0c9a40c39c1f9f947ac0">adc_vrssi</a>();</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#ad4c1789970ca3486949bb79ba20a8cd6">vrssi</a> = 0;</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>    }</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#a05eebadff50307510f241daa6134e5d3">vservo</a> = <a class="code hl_function" href="analog_8cpp.html#a0b40f283b04214a078664ea10271b47f">adc_vservo</a>();</div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>}</div>
</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span> </div>
<div class="foldopen" id="foldopen00757" data-start="{" data-end="}">
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#a647711495b79e5ae220664fc199e2a6a">  757</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#a647711495b79e5ae220664fc199e2a6a">AP_IOMCU_FW::handle_code_read</a>()</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>{</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>    uint16_t *values = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span><span class="preprocessor">#define COPY_PAGE(_page_name)                           \</span></div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span><span class="preprocessor">    do {                                    \</span></div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span><span class="preprocessor">        values = (uint16_t *)&amp;_page_name;               \</span></div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span><span class="preprocessor">        tx_io_packet.count = sizeof(_page_name) / sizeof(uint16_t); \</span></div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span><span class="preprocessor">    } while(0);</span></div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span> </div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>    <span class="keywordflow">switch</span> (rx_io_packet.page) {</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a208cfb65a788a2d5a0af38406f502e08">PAGE_CONFIG</a>:</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>        <a class="code hl_define" href="iofirmware_8cpp.html#a1c5fa7cd8b7aba05232c84e79c89b0a0">COPY_PAGE</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a64c64375629e44c2b59d509afefb396b">config</a>);</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81abaf8b4c2ba206eac79e7b2ab387660a2">PAGE_SETUP</a>:</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>        <a class="code hl_define" href="iofirmware_8cpp.html#a1c5fa7cd8b7aba05232c84e79c89b0a0">COPY_PAGE</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>);</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a81b63abcf0012906e4fc7d9cd5d3c7ea">PAGE_RAW_RCIN</a>:</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>        <a class="code hl_define" href="iofirmware_8cpp.html#a1c5fa7cd8b7aba05232c84e79c89b0a0">COPY_PAGE</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a3f3b8816d2d8ffcc29572da4c07c614b">rc_input</a>);</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span><span class="preprocessor">#ifdef HAL_WITH_BIDIR_DSHOT</span></div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a802a712bb7101d74230b6bd8f2b53fa5">PAGE_RAW_DSHOT_ERPM</a>:</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>        <a class="code hl_define" href="iofirmware_8cpp.html#a1c5fa7cd8b7aba05232c84e79c89b0a0">COPY_PAGE</a>(dshot_erpm);</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a2d5a0c078e6ae4cfaa486c0e546229c3">PAGE_RAW_DSHOT_TELEM_1_4</a>:</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>        <a class="code hl_define" href="iofirmware_8cpp.html#a1c5fa7cd8b7aba05232c84e79c89b0a0">COPY_PAGE</a>(dshot_telem[0]);</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span><span class="preprocessor">#if IOMCU_MAX_TELEM_CHANNELS &gt; 4</span></div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a1ce33709520b96a167db5c869915ea52">PAGE_RAW_DSHOT_TELEM_5_8</a>:</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>        <a class="code hl_define" href="iofirmware_8cpp.html#a1c5fa7cd8b7aba05232c84e79c89b0a0">COPY_PAGE</a>(dshot_telem[1]);</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81aecb2c0bf98f197bca286accccaca0493">PAGE_STATUS</a>:</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>        <a class="code hl_define" href="iofirmware_8cpp.html#a1c5fa7cd8b7aba05232c84e79c89b0a0">COPY_PAGE</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>);</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a3fe9c6b60450247d90f068b67c879087">PAGE_SERVOS</a>:</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>        <a class="code hl_define" href="iofirmware_8cpp.html#a1c5fa7cd8b7aba05232c84e79c89b0a0">COPY_PAGE</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab5fb85fb1f85ad381a98faedf42b1a1a">reg_servo</a>);</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>    }</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span> </div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>    <span class="comment">/* if the offset is at or beyond the end of the page, we have no data */</span></div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>    <span class="keywordflow">if</span> (rx_io_packet.offset + rx_io_packet.count &gt; <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a97469a4b02be0a9556d78af389fa6956">count</a>) {</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>    }</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span> </div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>    <span class="comment">/* correct the data pointer and count for the offset */</span></div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>    values += rx_io_packet.offset;</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a93abdcba6eb1657fcb6760babb7c0d00">page</a> = rx_io_packet.page;</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a338a71aff88023b64b73cfde6d4ca2ef">offset</a> = rx_io_packet.offset;</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a97469a4b02be0a9556d78af389fa6956">count</a> -= rx_io_packet.offset;</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a97469a4b02be0a9556d78af389fa6956">count</a> = <a class="code hl_define" href="monocypher_8cpp.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a97469a4b02be0a9556d78af389fa6956">count</a>, rx_io_packet.count);</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a97469a4b02be0a9556d78af389fa6956">count</a> = <a class="code hl_define" href="monocypher_8cpp.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a97469a4b02be0a9556d78af389fa6956">count</a>, <a class="code hl_define" href="ioprotocol_8h.html#a0037b43d3693c0d8d3c5df6c36ccc4b8">PKT_MAX_REGS</a>);</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a5964448096d22dc869d0139b256262bd">code</a> = <a class="code hl_enumvalue" href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7a1797aa576dd80fe8669bd29613a65a94">CODE_SUCCESS</a>;</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>    memcpy(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a4154a2062c02bf69b9f0d6ed316dede3">regs</a>, values, <span class="keyword">sizeof</span>(uint16_t)*<a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a97469a4b02be0a9556d78af389fa6956">count</a>);</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#af856646ceb9df0f094d8a26287189fcf">crc</a> = 0;</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#af856646ceb9df0f094d8a26287189fcf">crc</a> =  <a class="code hl_function" href="crc_8cpp.html#a9854916652a9bd6e9db046706bc313b1">crc_crc8</a>((<span class="keyword">const</span> uint8_t *)&amp;<a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>, <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_function" href="structIOPacket.html#ae4b6c1ba8ca5e98e2429c364bc1e404f">get_size</a>());</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span> </div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span><span class="preprocessor">#ifdef HAL_WITH_BIDIR_DSHOT</span></div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>    <span class="keywordflow">switch</span> (rx_io_packet.page) {</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a802a712bb7101d74230b6bd8f2b53fa5">PAGE_RAW_DSHOT_ERPM</a>:</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>        memset(&amp;dshot_erpm, 0, <span class="keyword">sizeof</span>(dshot_erpm));</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>    }</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>}</div>
</div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span> </div>
<div class="foldopen" id="foldopen00828" data-start="{" data-end="}">
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#a588a102aed1b2ef4fd7f48e4efdb7cf5">  828</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#a588a102aed1b2ef4fd7f48e4efdb7cf5">AP_IOMCU_FW::handle_code_write</a>()</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>{</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>    <span class="keywordflow">switch</span> (rx_io_packet.page) {</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81abaf8b4c2ba206eac79e7b2ab387660a2">PAGE_SETUP</a>:</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>        <span class="keywordflow">switch</span> (rx_io_packet.offset) {</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#a14677b26b73ba065af0282ed4202d52a">PAGE_REG_SETUP_ARMING</a>:</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.arming = rx_io_packet.regs[0];</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#abde28d29960121cab5851274d5e91d6d">PAGE_REG_SETUP_FORCE_SAFETY_OFF</a>:</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>            <span class="keywordflow">if</span> (rx_io_packet.regs[0] == <a class="code hl_define" href="ioprotocol_8h.html#afb2ac51042a1e538652ef5a5819b20de">FORCE_SAFETY_MAGIC</a>) {</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>                <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#afb075a7e5438b6f0bae228e0b6be0cc2">force_safety_off</a>();</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>                <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>            }</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#a94fffa76beed88a2d972b78bbd21c9b4">PAGE_REG_SETUP_FORCE_SAFETY_ON</a>:</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>            <span class="keywordflow">if</span> (rx_io_packet.regs[0] == <a class="code hl_define" href="ioprotocol_8h.html#afb2ac51042a1e538652ef5a5819b20de">FORCE_SAFETY_MAGIC</a>) {</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>                <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a6852e3aa22747f045dc71972e97d7de6">force_safety_on</a>();</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>                <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>            }</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#a4b4760fdfc25e4a7bbd8c21ee3329e20">PAGE_REG_SETUP_ALTRATE</a>:</div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.pwm_altrate = rx_io_packet.regs[0];</div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#ad6f963d7a986df74035569369ea2c663">update_rcout_freq</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#ac11850dc8dc259d9728f9242b45ab1be">PAGE_REG_SETUP_PWM_RATE_MASK</a>:</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.pwm_rates = rx_io_packet.regs[0];</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#ad6f963d7a986df74035569369ea2c663">update_rcout_freq</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#aaf044ffe3228efe486a8b30e03a0a77e">PAGE_REG_SETUP_DEFAULTRATE</a>:</div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>            <span class="keywordflow">if</span> (rx_io_packet.regs[0] &lt; 25 &amp;&amp; <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.pwm_altclock == 1) {</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>                rx_io_packet.regs[0] = 25;</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>            }</div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span> </div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>            <span class="keywordflow">if</span> (rx_io_packet.regs[0] &gt; 400 &amp;&amp; <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.pwm_altclock == 1) {</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>                rx_io_packet.regs[0] = 400;</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>            }</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.pwm_defaultrate = rx_io_packet.regs[0];</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a73e6e889f83a6b426b94d804dbdb4975">update_default_rate</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#ae8983f7a0c1f00d991ecf82b619e30fb">PAGE_REG_SETUP_DSHOT_PERIOD</a>:</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.dshot_period_us = rx_io_packet.regs[0];</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.dshot_rate = rx_io_packet.regs[1];</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>            <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a9a8893667260f7b889a551dabb7587a5">set_dshot_period</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.dshot_period_us, <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.dshot_rate);</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#ab89f790e229451f7429482974aa1f095">PAGE_REG_SETUP_CHANNEL_MASK</a>:</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.channel_mask = rx_io_packet.regs[0];</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#a93f785789d0018fbb502192b16387790">PAGE_REG_SETUP_SBUS_RATE</a>:</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.sbus_rate = rx_io_packet.regs[0];</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a9468ae045e671313d30ce03f8767acc9">sbus_interval_ms</a> = <a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(1000U / <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.sbus_rate,3);</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#a9a3f9e1d7ee4fd9e5bbce3ba5416aba0">PAGE_REG_SETUP_FEATURES</a>:</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.features = rx_io_packet.regs[0];</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>            <span class="comment">/* disable the conflicting options with SBUS 1 */</span></div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.features &amp; (<a class="code hl_define" href="ioprotocol_8h.html#a37fbeb1e1fad6729b8d577ed32bcb9db">P_SETUP_FEATURES_SBUS1_OUT</a>)) {</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>                <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.features &amp;= ~(<a class="code hl_define" href="ioprotocol_8h.html#a065edde84d23cd3b5c9e9b4f80ca11ca">P_SETUP_FEATURES_PWM_RSSI</a> |</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>                                        <a class="code hl_define" href="ioprotocol_8h.html#a264ac5074bb5ba28f0bcdb63f2ad769f">P_SETUP_FEATURES_ADC_RSSI</a> |</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>                                        <a class="code hl_define" href="ioprotocol_8h.html#a53b341135d05c3afa492c367b7988c04">P_SETUP_FEATURES_SBUS2_OUT</a>);</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span> </div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>                <span class="comment">// enable SBUS output at specified rate</span></div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>                <a class="code hl_variable" href="classAP__IOMCU__FW.html#a9468ae045e671313d30ce03f8767acc9">sbus_interval_ms</a> = <a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(1000U / <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.sbus_rate,3);</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span> </div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>                <span class="comment">// we need to release the JTAG reset pin to be used as a GPIO, otherwise we can&#39;t enable</span></div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>                <span class="comment">// or disable SBUS out</span></div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>                AFIO-&gt;MAPR = AFIO_MAPR_SWJ_CFG_NOJNTRST;</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span> </div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>                <a class="code hl_function" href="analog_8cpp.html#afee176cac31190f16518ba132bd049dc">adc_disable_vrssi</a>();</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>                palClearLine(HAL_GPIO_PIN_SBUS_OUT_EN);</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>                <a class="code hl_function" href="analog_8cpp.html#acde4ce7d22816d3b93ce7027448c02c5">adc_enable_vrssi</a>();</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>                palSetLine(HAL_GPIO_PIN_SBUS_OUT_EN);</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>            }</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.features &amp; <a class="code hl_define" href="ioprotocol_8h.html#aefcee0ad76e2494693a7aa98284a8827">P_SETUP_FEATURES_HEATER</a>) {</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>                <a class="code hl_variable" href="classAP__IOMCU__FW.html#a32b6b03c8197f0a0add346f4aaf02802">has_heater</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>            }</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span> </div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#a94359ab4fb1c364aa3d7304187488fb8">PAGE_REG_SETUP_OUTPUT_MODE</a>:</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a23d9879600a09725ec49640745190d8d">mask</a> = rx_io_packet.regs[0];</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a5a7162262c1b20d86cbdf77b7f7b1aeb">mode</a> = rx_io_packet.regs[1];</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a77044e6a0106c1e48321c78387335c33">bdmask</a> = rx_io_packet.regs[2];</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a1c8c78e9b974fc7b15731f65d724b8cf">esc_type</a> = rx_io_packet.regs[3];</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span> </div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#a9d7a03463267045ceb93d52610ef6fb5">PAGE_REG_SETUP_HEATER_DUTY_CYCLE</a>:</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.heater_duty_cycle = rx_io_packet.regs[0];</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#a916d19242ab92817f71d9d28d1440d5d">last_heater_ms</a> = <a class="code hl_variable" href="classAP__IOMCU__FW.html#a4dbb86a1eefe373da375c0beaee26106">last_ms</a>;</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span> </div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#a72d6383a51239aad094855a8b969b8a0">PAGE_REG_SETUP_REBOOT_BL</a>:</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a>) {</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>                <span class="comment">// don&#39;t allow reboot while armed</span></div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>            }</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span> </div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>            <span class="comment">// check the magic value</span></div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>            <span class="keywordflow">if</span> (rx_io_packet.regs[0] != <a class="code hl_define" href="ioprotocol_8h.html#a8e9b3bd5579c54a5e31c8f6b15319065">REBOOT_BL_MAGIC</a>) {</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>            }</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>            <a class="code hl_function" href="classAP__IOMCU__FW.html#a16be1570b2c5371de43becc55b7f2577">schedule_reboot</a>(100);</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span> </div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#a086ebf9793945d8265ec0690402b238a">PAGE_REG_SETUP_IGNORE_SAFETY</a>:</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.ignore_safety = rx_io_packet.regs[0];</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>            ((<a class="code hl_class" href="classChibiOS_1_1RCOutput.html">ChibiOS::RCOutput</a> *)<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>)-&gt;set_safety_mask(<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.ignore_safety);</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span> </div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#a53bff87c90194226c9592ee0a3fb7d78">PAGE_REG_SETUP_DSM_BIND</a>:</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#aed0efa98cece9e24792eb9ba3231abb6">dsm_bind_state</a> == 0) {</div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span>                <a class="code hl_variable" href="classAP__IOMCU__FW.html#aed0efa98cece9e24792eb9ba3231abb6">dsm_bind_state</a> = 1;</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>            }</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span> </div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>        <span class="keywordflow">case</span> <a class="code hl_define" href="ioprotocol_8h.html#a3d740363c257b5e0bdb37abdc879262e">PAGE_REG_SETUP_RC_PROTOCOLS</a>: {</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>            <span class="keywordflow">if</span> (rx_io_packet.count == 2) {</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>                uint32_t <a class="code hl_variable" href="Printf_8cpp.html#a48d9522e58fa05906c6dba23e5745a72">v</a>;</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>                memcpy(&amp;<a class="code hl_variable" href="Printf_8cpp.html#a48d9522e58fa05906c6dba23e5745a72">v</a>, &amp;rx_io_packet.regs[0], 4);</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>                <a class="code hl_function" href="namespaceAP.html#ae2881dc66a7a1653b455691fbcd1a0a0">AP::RC</a>().<a class="code hl_function" href="classAP__RCProtocol.html#a686283a7061209351921b6beca4a0630">set_rc_protocols</a>(<a class="code hl_variable" href="Printf_8cpp.html#a48d9522e58fa05906c6dba23e5745a72">v</a>);</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>            }</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>        }</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span> </div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>        <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>        }</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span> </div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a9507be0cdb85102c9079f7de107a6076">PAGE_DIRECT_PWM</a>: {</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#a55ce8d5ede1de8675d740d592c8b9023">override_active</a>) {</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>            <span class="comment">// no input when override is active</span></div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>        }</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>        <span class="keywordflow">if</span> (rx_io_packet.count &gt; <span class="keyword">sizeof</span>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#aa50c3d095bf413e4858451eb1131fcea">reg_direct_pwm</a>.pwm)/2) {</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>        }</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>        <span class="comment">/* copy channel data */</span></div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>        uint16_t i = 0, num_values = rx_io_packet.count;</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>        <span class="keywordflow">while</span> ((i &lt; <a class="code hl_define" href="ioprotocol_8h.html#ab25c2c63ec75a1c6299c0eabb56cc59e">IOMCU_MAX_CHANNELS</a>) &amp;&amp; (num_values &gt; 0)) {</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>            <span class="comment">/* XXX range-check value? */</span></div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>            <span class="keywordflow">if</span> (rx_io_packet.regs[i] != <a class="code hl_define" href="iofirmware_8h.html#a5f0f20688bddff38ec95bd333366508a">PWM_IGNORE_THIS_CHANNEL</a>) {</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>                <a class="code hl_variable" href="classAP__IOMCU__FW.html#aa50c3d095bf413e4858451eb1131fcea">reg_direct_pwm</a>.pwm[i] = rx_io_packet.regs[i];</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>            }</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span> </div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>            num_values--;</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>            i++;</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>        }</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab55f1d13336499eb33e65f5473fd23ae">fmu_data_received_time</a> = <a class="code hl_variable" href="classAP__IOMCU__FW.html#a4dbb86a1eefe373da375c0beaee26106">last_ms</a>;</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>        chEvtSignalI(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a416c0720ab52a33e06e40b989ecfb39a">thread_ctx</a>, <a class="code hl_enumvalue" href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06af23b75144c072b1255b0274aab89ee12">IOEVENT_PWM</a>);</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>    }</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span> </div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81abaf93c1cfe41cd6a0be2db0ad3de5403">PAGE_MIXING</a>: { <span class="comment">// multi-packet message</span></div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>        uint16_t offset = rx_io_packet.offset, num_values = rx_io_packet.count;</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>        <span class="keywordflow">if</span> (offset + num_values &gt; <span class="keyword">sizeof</span>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a7a4d8d2ed6e17e209ab496fb4b44aa5b">mixing</a>)/2) {</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>        }</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>        memcpy(((uint16_t *)&amp;<a class="code hl_variable" href="classAP__IOMCU__FW.html#a7a4d8d2ed6e17e209ab496fb4b44aa5b">mixing</a>)+offset, &amp;rx_io_packet.regs[0], num_values*2);</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>    }</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span> </div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81aa82e60755b10addd85b56e65459a5868">PAGE_FAILSAFE_PWM</a>: {</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>        <span class="keywordflow">if</span> (rx_io_packet.count != <span class="keyword">sizeof</span>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#abe81057f9fb50ad4a3f99910b95b09d8">reg_failsafe_pwm</a>.pwm)/2) {</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>        }</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>        memcpy((&amp;<a class="code hl_variable" href="classAP__IOMCU__FW.html#abe81057f9fb50ad4a3f99910b95b09d8">reg_failsafe_pwm</a>.pwm[0]), &amp;rx_io_packet.regs[0], rx_io_packet.count*2);</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>    }</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span> </div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a6c2ad84f615f56ac28f2c0cc2c51f219">PAGE_GPIO</a>:</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>        <span class="keywordflow">if</span> (rx_io_packet.count != 1) {</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>        }</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>        memcpy(&amp;<a class="code hl_class" href="classChibiOS_1_1GPIO.html">GPIO</a>, &amp;rx_io_packet.regs[0] + rx_io_packet.offset, <span class="keyword">sizeof</span>(<a class="code hl_class" href="classChibiOS_1_1GPIO.html">GPIO</a>));</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span> </div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a7e0e8ce5cbc82abd4c464f37c24a923f">PAGE_DSHOT</a>: {</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>        <span class="keywordflow">if</span> (rx_io_packet.count != <span class="keyword">sizeof</span>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a7e4acf93d45694b895fdc3a4328621d9">dshot</a>)/2) {</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>        }</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>        memcpy(((uint16_t *)&amp;<a class="code hl_variable" href="classAP__IOMCU__FW.html#a7e4acf93d45694b895fdc3a4328621d9">dshot</a>)+rx_io_packet.offset, &amp;rx_io_packet.regs[0], rx_io_packet.count*2);</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>        <span class="keywordflow">if</span>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a7e4acf93d45694b895fdc3a4328621d9">dshot</a>.<a class="code hl_variable" href="structpage__dshot.html#a5100e68c2e84df275a78e533032e3b63">telem_mask</a>) {</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>            <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#aaaf8d77396fd76a164428574cb85b736">set_telem_request_mask</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a7e4acf93d45694b895fdc3a4328621d9">dshot</a>.<a class="code hl_variable" href="structpage__dshot.html#a5100e68c2e84df275a78e533032e3b63">telem_mask</a>);</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>        }</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#a7e4acf93d45694b895fdc3a4328621d9">dshot</a>.<a class="code hl_variable" href="structpage__dshot.html#a2bfe6698880ce9480452adfe62155a4c">command</a>) {</div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>            <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a7c5b4a92bdd2491c6bcbb1403b3c8d1b">send_dshot_command</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a7e4acf93d45694b895fdc3a4328621d9">dshot</a>.<a class="code hl_variable" href="structpage__dshot.html#a2bfe6698880ce9480452adfe62155a4c">command</a>, <a class="code hl_variable" href="classAP__IOMCU__FW.html#a7e4acf93d45694b895fdc3a4328621d9">dshot</a>.<a class="code hl_variable" href="structpage__dshot.html#abbb195faf3cc81c89854f9ee365f8ae1">chan</a>, <a class="code hl_variable" href="classAP__IOMCU__FW.html#a7e4acf93d45694b895fdc3a4328621d9">dshot</a>.<a class="code hl_variable" href="structpage__dshot.html#a78c63d8bd488206f1a0ca15b4680a112">command_timeout_ms</a>, <a class="code hl_variable" href="classAP__IOMCU__FW.html#a7e4acf93d45694b895fdc3a4328621d9">dshot</a>.<a class="code hl_variable" href="structpage__dshot.html#a4cc6875e3f4f8fc07ce89b4c0336086f">repeat_count</a>, <a class="code hl_variable" href="classAP__IOMCU__FW.html#a7e4acf93d45694b895fdc3a4328621d9">dshot</a>.<a class="code hl_variable" href="structpage__dshot.html#a65772cbdf543f0785f7a9a6518b53623">priority</a>);</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>        }</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span> </div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>    }</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span> </div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>    }</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a97469a4b02be0a9556d78af389fa6956">count</a> = 0;</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a5964448096d22dc869d0139b256262bd">code</a> = <a class="code hl_enumvalue" href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7a1797aa576dd80fe8669bd29613a65a94">CODE_SUCCESS</a>;</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#af856646ceb9df0f094d8a26287189fcf">crc</a> = 0;</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a93abdcba6eb1657fcb6760babb7c0d00">page</a> = 0;</div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#a338a71aff88023b64b73cfde6d4ca2ef">offset</a> = 0;</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_variable" href="structIOPacket.html#af856646ceb9df0f094d8a26287189fcf">crc</a> =  <a class="code hl_function" href="crc_8cpp.html#a9854916652a9bd6e9db046706bc313b1">crc_crc8</a>((<span class="keyword">const</span> uint8_t *)&amp;<a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>, <a class="code hl_variable" href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">tx_io_packet</a>.<a class="code hl_function" href="structIOPacket.html#ae4b6c1ba8ca5e98e2429c364bc1e404f">get_size</a>());</div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>}</div>
</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span> </div>
<div class="foldopen" id="foldopen01034" data-start="{" data-end="}">
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#a16be1570b2c5371de43becc55b7f2577"> 1034</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#a16be1570b2c5371de43becc55b7f2577">AP_IOMCU_FW::schedule_reboot</a>(uint32_t time_ms)</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>{</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9f12c96acc2ceabc7e8531f23d3ab86">do_reboot</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8b282febfad6c55df810f4fa0fd16346">reboot_time</a> = <a class="code hl_variable" href="classAP__IOMCU__FW.html#a4dbb86a1eefe373da375c0beaee26106">last_ms</a> + time_ms;</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>}</div>
</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span> </div>
<div class="foldopen" id="foldopen01040" data-start="{" data-end="}">
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#aa791a6eba91a650216f00d837e5d8fbd"> 1040</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#aa791a6eba91a650216f00d837e5d8fbd">AP_IOMCU_FW::calculate_fw_crc</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>{</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span><span class="preprocessor">#define APP_SIZE_MAX 0xf000</span></div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span><span class="preprocessor">#define APP_LOAD_ADDRESS 0x08001000</span></div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>    <span class="comment">// compute CRC of the current firmware</span></div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>    uint32_t sum = 0;</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span> </div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> p = 0; p &lt; <a class="code hl_define" href="iofirmware_8cpp.html#aac463e9ed8001726c79f9dd09023028a">APP_SIZE_MAX</a>; p += 4) {</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>        uint32_t bytes = *(uint32_t *)(p + <a class="code hl_define" href="iofirmware_8cpp.html#afff02e2ec9814e8c8d257f3db045fcab">APP_LOAD_ADDRESS</a>);</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>        sum = <a class="code hl_function" href="crc_8cpp.html#a82435966e7a560c44a8dd32132c60557">crc32_small</a>(sum, (<span class="keyword">const</span> uint8_t *)&amp;bytes, <span class="keyword">sizeof</span>(bytes));</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>    }</div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span> </div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.crc[0] = sum &amp; 0xFFFF;</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.crc[1] = sum &gt;&gt; 16;</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>}</div>
</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span> </div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span> </div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span><span class="comment">/*</span></div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span><span class="comment">  update safety state</span></div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen01060" data-start="{" data-end="}">
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#a6a00574abc4606791259e65ec376a0a1"> 1060</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#a6a00574abc4606791259e65ec376a0a1">AP_IOMCU_FW::safety_update</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>{</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>    uint32_t now = <a class="code hl_variable" href="classAP__IOMCU__FW.html#a4dbb86a1eefe373da375c0beaee26106">last_ms</a>;</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>    <span class="keywordflow">if</span> (now - <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab57cbfeb0d58be863afbac757370da4a">safety_update_ms</a> &lt; 100) {</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>        <span class="comment">// update safety at 10Hz</span></div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>    }</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab57cbfeb0d58be863afbac757370da4a">safety_update_ms</a> = now;</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span> </div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>    <span class="keywordtype">bool</span> safety_pressed = palReadLine(HAL_GPIO_PIN_SAFETY_INPUT);</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>    <span class="keywordflow">if</span> (safety_pressed) {</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a> &amp;&amp; (<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.arming &amp; <a class="code hl_define" href="ioprotocol_8h.html#aeedcdc0cce0ab9fbf43d859670698d78">P_SETUP_ARMING_SAFETY_DISABLE_ON</a>)) {</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>            safety_pressed = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a>) &amp;&amp; (<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.arming &amp; <a class="code hl_define" href="ioprotocol_8h.html#a710177a2c3c00466a8ecc529f7756828">P_SETUP_ARMING_SAFETY_DISABLE_OFF</a>)) {</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>            safety_pressed = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span>        }</div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>    }</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>    <span class="keywordflow">if</span> (safety_pressed) {</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab0312a187b7497dfc94d47de0ce79518">safety_button_counter</a>++;</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab0312a187b7497dfc94d47de0ce79518">safety_button_counter</a> = 0;</div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>    }</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab0312a187b7497dfc94d47de0ce79518">safety_button_counter</a> == 10) {</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>        <span class="comment">// safety has been pressed for 1 second, change state</span></div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a> = !<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a>;</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a>) {</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>            <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#afb075a7e5438b6f0bae228e0b6be0cc2">force_safety_off</a>();</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>            <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a6852e3aa22747f045dc71972e97d7de6">force_safety_on</a>();</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>        }</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>    }</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span> </div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span><span class="preprocessor">#if IOMCU_ENABLE_RESET_TEST</span></div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>    {</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>        <span class="comment">// deliberate lockup of IOMCU on 5s button press, for testing</span></div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>        <span class="comment">// watchdog</span></div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>        <span class="keyword">static</span> uint32_t safety_test_counter;</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>        <span class="keyword">static</span> <span class="keywordtype">bool</span> should_lockup;</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>        <span class="keywordflow">if</span> (palReadLine(HAL_GPIO_PIN_SAFETY_INPUT)) {</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>            safety_test_counter++;</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>            safety_test_counter = 0;</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>        }</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>        <span class="keywordflow">if</span> (safety_test_counter == 50) {</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>            should_lockup = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>        }</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>        <span class="comment">// wait for lockup for safety to be released so we don&#39;t end</span></div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>        <span class="comment">// up in the bootloader</span></div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>        <span class="keywordflow">if</span> (should_lockup &amp;&amp; palReadLine(HAL_GPIO_PIN_SAFETY_INPUT) == 0) {</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span><span class="preprocessor">#if IOMCU_ENABLE_RESET_TEST == 1</span></div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>            <span class="comment">// lockup with watchdog</span></div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>            <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>                <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Scheduler.html#ab3175e2e6223ccfe82f957e41cc12b26">delay</a>(50);</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>                palToggleLine(HAL_GPIO_PIN_SAFETY_LED);</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>            }</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>            <span class="comment">// hard fault to simulate power reset or software fault</span></div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>            <span class="keywordtype">void</span> *foo = (<span class="keywordtype">void</span>*)0xE000ED38;</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>            <span class="keyword">typedef</span> void (*fptr)();</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>            fptr gptr = (fptr) (<span class="keywordtype">void</span> *) foo;</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span>            gptr();</div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>            <span class="keywordflow">while</span> (<span class="keyword">true</span>) {}</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>        }</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>    }</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span><span class="preprocessor">#endif </span><span class="comment">// IOMCU_ENABLE_RESET_TEST</span></div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span> </div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#ad7ce59291238764650a90ae35f81c8df">led_counter</a> = (<a class="code hl_variable" href="classAP__IOMCU__FW.html#ad7ce59291238764650a90ae35f81c8df">led_counter</a>+1) % 16;</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>    <span class="keyword">const</span> uint16_t led_pattern = <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a>?0xFFFF:0x5500;</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>    palWriteLine(HAL_GPIO_PIN_SAFETY_LED, (led_pattern &amp; (1U &lt;&lt; <a class="code hl_variable" href="classAP__IOMCU__FW.html#ad7ce59291238764650a90ae35f81c8df">led_counter</a>))?0:1);</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>}</div>
</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span> </div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span><span class="comment">/*</span></div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span><span class="comment">  update hal.rcout mode if needed</span></div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen01135" data-start="{" data-end="}">
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#a43030d57d47a80e97578178e5c21115e"> 1135</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#a43030d57d47a80e97578178e5c21115e">AP_IOMCU_FW::rcout_config_update</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>{</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>    <span class="comment">// channels cannot be changed from within a lock zone</span></div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>    <span class="comment">// so needs to be done here</span></div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>    <span class="keywordflow">if</span> (<a class="code hl_class" href="classChibiOS_1_1GPIO.html">GPIO</a>.channel_mask != <a class="code hl_variable" href="classAP__IOMCU__FW.html#a75b6a6e3941758c3d44d3fe53d88fe3b">last_GPIO_channel_mask</a>) {</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;8; i++) {</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>            <span class="keywordflow">if</span> ((<a class="code hl_class" href="classChibiOS_1_1GPIO.html">GPIO</a>.channel_mask &amp; (1U &lt;&lt; i)) != 0) {</div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>                <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a67119a9d68c296c189d2bb86982493b6">disable_ch</a>(i);</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>                <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">gpio</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1GPIO.html#a3dfc60214bd1aa4936d51ca72c045b95">pinMode</a>(101+i, <a class="code hl_define" href="AP__HAL_2GPIO_8h.html#a12ba3ca9b5828d7f2978da045de8d11f">HAL_GPIO_OUTPUT</a>);</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>                <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a0fc4c7ada47c531c6efda29c92257002">enable_ch</a>(i);</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span>            }</div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>        }</div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a75b6a6e3941758c3d44d3fe53d88fe3b">last_GPIO_channel_mask</a> = <a class="code hl_class" href="classChibiOS_1_1GPIO.html">GPIO</a>.channel_mask;</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>    }</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span> </div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#ac07b3fabc705bb7ce2b60e504e338dec">last_channel_mask</a> != <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.channel_mask) {</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code hl_define" href="ioprotocol_8h.html#ab25c2c63ec75a1c6299c0eabb56cc59e">IOMCU_MAX_CHANNELS</a>; i++) {</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.channel_mask &amp; 1U &lt;&lt; i) {</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>                <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a0fc4c7ada47c531c6efda29c92257002">enable_ch</a>(i);</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>                <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a67119a9d68c296c189d2bb86982493b6">disable_ch</a>(i);</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>            }</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>        }</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ac07b3fabc705bb7ce2b60e504e338dec">last_channel_mask</a> = <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.channel_mask;</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>        <span class="comment">// channel enablement will affect the reported output mode</span></div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>        uint32_t output_mask = 0;</div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#abd348f4a7f7ca4fc905a09b566115c4b">rcout_mode</a> = <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a0e848b3a28c4f514a2da1a61b3224294">get_output_mode</a>(output_mask);</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#ad15d15b3b6f1d0626f12af16fb35c437">rcout_mask</a> = uint8_t(0xFF &amp; output_mask);</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>    }</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span> </div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>    <span class="comment">// see if there is anything to do, we only support setting the mode for a particular channel once</span></div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__IOMCU__FW.html#ae4c633f721d0e76def1801f523376fd6">last_output_mode_mask</a> &amp; <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a23d9879600a09725ec49640745190d8d">mask</a>) == <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a23d9879600a09725ec49640745190d8d">mask</a></div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>        &amp;&amp; (<a class="code hl_variable" href="classAP__IOMCU__FW.html#a0a51a6871bda31fc3f789ee95571aa4c">last_output_bdmask</a> &amp; <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a77044e6a0106c1e48321c78387335c33">bdmask</a>) == <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a77044e6a0106c1e48321c78387335c33">bdmask</a></div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>        &amp;&amp; <a class="code hl_variable" href="classAP__IOMCU__FW.html#aa6a33b2121c6ced632a5abc9e0b27ddc">last_output_esc_type</a> == <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a1c8c78e9b974fc7b15731f65d724b8cf">esc_type</a>) {</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>    }</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span> </div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>    <span class="keywordflow">switch</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a5a7162262c1b20d86cbdf77b7f7b1aeb">mode</a>) {</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093ad7db50be7ff2c99ea810f30c5fef614c">AP_HAL::RCOutput::MODE_PWM_DSHOT150</a>:</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093a7be772b5075fec936dd6b34e35d60129">AP_HAL::RCOutput::MODE_PWM_DSHOT300</a>:</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span><span class="preprocessor">#if defined(STM32F103xB) || defined(STM32F103x8)</span></div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093a151001cd6113487e6da91b6c504683fc">AP_HAL::RCOutput::MODE_PWM_DSHOT600</a>:</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span><span class="preprocessor">#ifdef HAL_WITH_BIDIR_DSHOT</span></div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a21e9a5d91d7bd71532f38ac89fa4e9b5">set_bidir_dshot_mask</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a77044e6a0106c1e48321c78387335c33">bdmask</a>);</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a622e13fac840e64e722fa475180c36d5">set_dshot_esc_type</a>(<a class="code hl_enumeration" href="classAP__HAL_1_1RCOutput.html#aad58d954fb6b9141c97366b64110af97">AP_HAL::RCOutput::DshotEscType</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a1c8c78e9b974fc7b15731f65d724b8cf">esc_type</a>));</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a612e9a31b97e5774aead5f00c298ed3b">set_output_mode</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a23d9879600a09725ec49640745190d8d">mask</a>, (<a class="code hl_enumeration" href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093">AP_HAL::RCOutput::output_mode</a>)<a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a5a7162262c1b20d86cbdf77b7f7b1aeb">mode</a>);</div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>        <span class="comment">// enabling dshot changes the memory allocation</span></div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#a89e38aeb5fffc9ca586372ccd6bf037d">freemem</a> = <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a2a2e64f649d25593951054d44c0ed53b">available_memory</a>();</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ae4c633f721d0e76def1801f523376fd6">last_output_mode_mask</a> |= <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a23d9879600a09725ec49640745190d8d">mask</a>;</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#a0a51a6871bda31fc3f789ee95571aa4c">last_output_bdmask</a> |= <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a77044e6a0106c1e48321c78387335c33">bdmask</a>;</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#aa6a33b2121c6ced632a5abc9e0b27ddc">last_output_esc_type</a> = <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a1c8c78e9b974fc7b15731f65d724b8cf">esc_type</a>;</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093ab1e27b7d703bdf42b6223d9b9161d9a0">AP_HAL::RCOutput::MODE_PWM_ONESHOT</a>:</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093a1c9c7057fdd08bebe7487917c00dc17e">AP_HAL::RCOutput::MODE_PWM_ONESHOT125</a>:</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>        <span class="comment">// setup to use a 1Hz frequency, so we only get output when we trigger</span></div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#ae7903398aa18e2472dd34081e626dcb7">set_freq</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a23d9879600a09725ec49640745190d8d">mask</a>, 1);</div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a612e9a31b97e5774aead5f00c298ed3b">set_output_mode</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a23d9879600a09725ec49640745190d8d">mask</a>, (<a class="code hl_enumeration" href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093">AP_HAL::RCOutput::output_mode</a>)<a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a5a7162262c1b20d86cbdf77b7f7b1aeb">mode</a>);</div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ae4c633f721d0e76def1801f523376fd6">last_output_mode_mask</a> |= <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a23d9879600a09725ec49640745190d8d">mask</a>;</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093aca7f067a8380228e2d73594d25b17b1c">AP_HAL::RCOutput::MODE_PWM_BRUSHED</a>:</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>        <span class="comment">// default to 2kHz for all channels for brushed output</span></div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#ae7903398aa18e2472dd34081e626dcb7">set_freq</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a23d9879600a09725ec49640745190d8d">mask</a>, 2000);</div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#ac86e488f2b2a728e1a7b71ba19ff8701">set_esc_scaling</a>(1000, 2000);</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a612e9a31b97e5774aead5f00c298ed3b">set_output_mode</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a23d9879600a09725ec49640745190d8d">mask</a>, <a class="code hl_enumvalue" href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093aca7f067a8380228e2d73594d25b17b1c">AP_HAL::RCOutput::MODE_PWM_BRUSHED</a>);</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#ae7903398aa18e2472dd34081e626dcb7">set_freq</a>(<a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a23d9879600a09725ec49640745190d8d">mask</a>, <a class="code hl_variable" href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">reg_setup</a>.pwm_altrate);</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>        <a class="code hl_variable" href="classAP__IOMCU__FW.html#ae4c633f721d0e76def1801f523376fd6">last_output_mode_mask</a> |= <a class="code hl_variable" href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">mode_out</a>.<a class="code hl_variable" href="structpage__mode__out.html#a23d9879600a09725ec49640745190d8d">mask</a>;</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>    }</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span> </div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>    uint32_t output_mask = 0;</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#abd348f4a7f7ca4fc905a09b566115c4b">rcout_mode</a> = <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">rcout</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1RCOutput.html#a0e848b3a28c4f514a2da1a61b3224294">get_output_mode</a>(output_mask);</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>    <a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#ad15d15b3b6f1d0626f12af16fb35c437">rcout_mask</a> = uint8_t(0xFF &amp; output_mask);</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>}</div>
</div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span> </div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span><span class="comment">/*</span></div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span><span class="comment">  fill in failsafe PWM values</span></div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen01217" data-start="{" data-end="}">
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#a528efc78233e1a0114c0636d1858cf7d"> 1217</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#a528efc78233e1a0114c0636d1858cf7d">AP_IOMCU_FW::fill_failsafe_pwm</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>{</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code hl_define" href="ioprotocol_8h.html#ab25c2c63ec75a1c6299c0eabb56cc59e">IOMCU_MAX_CHANNELS</a>; i++) {</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">reg_status</a>.<a class="code hl_variable" href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">flag_safety_off</a>) {</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#aa50c3d095bf413e4858451eb1131fcea">reg_direct_pwm</a>.pwm[i] = <a class="code hl_variable" href="classAP__IOMCU__FW.html#abe81057f9fb50ad4a3f99910b95b09d8">reg_failsafe_pwm</a>.pwm[i];</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>            <a class="code hl_variable" href="classAP__IOMCU__FW.html#aa50c3d095bf413e4858451eb1131fcea">reg_direct_pwm</a>.pwm[i] = 0;</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>        }</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>    }</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__IOMCU__FW.html#a7a4d8d2ed6e17e209ab496fb4b44aa5b">mixing</a>.<a class="code hl_variable" href="structpage__mixing.html#ad395d258572391e2a8e40b7971133e63">enabled</a>) {</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>        <a class="code hl_function" href="classAP__IOMCU__FW.html#a720612853deb29c9265ff8445dfcd3a9">run_mixer</a>();</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>    }</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>}</div>
</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span> </div>
<div class="foldopen" id="foldopen01231" data-start="{" data-end="}">
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"><a class="line" href="classAP__IOMCU__FW.html#add72dc29f89933f29d7652038824650d"> 1231</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__IOMCU__FW.html#add72dc29f89933f29d7652038824650d">AP_IOMCU_FW::GPIO_write</a>()</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>{</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;8; i++) {</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>        <span class="keywordflow">if</span> ((<a class="code hl_class" href="classChibiOS_1_1GPIO.html">GPIO</a>.channel_mask &amp; (1U &lt;&lt; i)) != 0) {</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>            <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">gpio</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1GPIO.html#a2b0664bdab1876e3b0bbcd9064eec88e">write</a>(101+i, (<a class="code hl_class" href="classChibiOS_1_1GPIO.html">GPIO</a>.output_mask &amp; (1U &lt;&lt; i)) != 0);</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>        }</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>    }</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>}</div>
</div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span> </div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"><a class="line" href="iofirmware_8cpp.html#aa754b8f19697c092a3eb48905d6561e3"> 1240</a></span><a class="code hl_function" href="iofirmware_8cpp.html#aa754b8f19697c092a3eb48905d6561e3">AP_HAL_MAIN</a>();</div>
<div class="ttc" id="aAC__AttitudeControl_8cpp_html_a240c1a4ae2a70d1855f91e4a0b1ac938"><div class="ttname"><a href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__AK09916_8cpp_source.html#l00059">AP_Compass_AK09916.cpp:59</a></div></div>
<div class="ttc" id="aAP__HAL_2GPIO_8h_html_a12ba3ca9b5828d7f2978da045de8d11f"><div class="ttname"><a href="AP__HAL_2GPIO_8h.html#a12ba3ca9b5828d7f2978da045de8d11f">HAL_GPIO_OUTPUT</a></div><div class="ttdeci">#define HAL_GPIO_OUTPUT</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2GPIO_8h_source.html#l00008">GPIO.h:8</a></div></div>
<div class="ttc" id="aAP__HAL_8h_html"><div class="ttname"><a href="AP__HAL_8h.html">AP_HAL.h</a></div></div>
<div class="ttc" id="aAP__HAL__ChibiOS_2RCInput_8h_html"><div class="ttname"><a href="AP__HAL__ChibiOS_2RCInput_8h.html">RCInput.h</a></div></div>
<div class="ttc" id="aAP__HAL__ChibiOS_2RCOutput_8h_html"><div class="ttname"><a href="AP__HAL__ChibiOS_2RCOutput_8h.html">RCOutput.h</a></div></div>
<div class="ttc" id="aAP__HAL__ChibiOS_2RCOutput_8h_html_a0a1754fe5ac9fa4efc193420918b35e5"><div class="ttname"><a href="AP__HAL__ChibiOS_2RCOutput_8h.html#a0a1754fe5ac9fa4efc193420918b35e5">TOGGLE_PIN_DEBUG</a></div><div class="ttdeci">#define TOGGLE_PIN_DEBUG(pin)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2RCOutput_8h_source.html#l00764">RCOutput.h:764</a></div></div>
<div class="ttc" id="aAP__Math_8cpp_html_a587a30a56f2ab102c7b42f89e4770530"><div class="ttname"><a href="AP__Math_8cpp.html#a587a30a56f2ab102c7b42f89e4770530">get_random16</a></div><div class="ttdeci">uint16_t get_random16(void)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8cpp_source.html#l00332">AP_Math.cpp:332</a></div></div>
<div class="ttc" id="aAP__Math_8h_html"><div class="ttname"><a href="AP__Math_8h.html">AP_Math.h</a></div></div>
<div class="ttc" id="aPrintf_8cpp_html_a48d9522e58fa05906c6dba23e5745a72"><div class="ttname"><a href="Printf_8cpp.html#a48d9522e58fa05906c6dba23e5745a72">v</a></div><div class="ttdeci">float v</div><div class="ttdef"><b>Definition</b> <a href="Printf_8cpp_source.html#l00036">Printf.cpp:36</a></div></div>
<div class="ttc" id="aRC__Channel_8h_html_abe35aea6177a1cdf87a22af5c263bb89"><div class="ttname"><a href="RC__Channel_8h.html#abe35aea6177a1cdf87a22af5c263bb89">rc</a></div><div class="ttdeci">RC_Channels &amp; rc()</div><div class="ttdef"><b>Definition</b> <a href="RC__Channels_8cpp_source.html#l00314">RC_Channels.cpp:314</a></div></div>
<div class="ttc" id="aUART__chargen_8cpp_html_a1926594e9cf7c0679f45fe13e790b3f7"><div class="ttname"><a href="UART__chargen_8cpp.html#a1926594e9cf7c0679f45fe13e790b3f7">uart</a></div><div class="ttdeci">AP_HAL::UARTDriver * uart</div><div class="ttdef"><b>Definition</b> <a href="UART__chargen_8cpp_source.html#l00034">UART_chargen.cpp:34</a></div></div>
<div class="ttc" id="aanalog_8cpp_html_a0b40f283b04214a078664ea10271b47f"><div class="ttname"><a href="analog_8cpp.html#a0b40f283b04214a078664ea10271b47f">adc_vservo</a></div><div class="ttdeci">uint16_t adc_vservo(void)</div><div class="ttdef"><b>Definition</b> <a href="analog_8cpp_source.html#l00114">analog.cpp:114</a></div></div>
<div class="ttc" id="aanalog_8cpp_html_a2b815e6730e8723a6d1d06d9ef8f31c0"><div class="ttname"><a href="analog_8cpp.html#a2b815e6730e8723a6d1d06d9ef8f31c0">adc_init</a></div><div class="ttdeci">void adc_init(void)</div><div class="ttdef"><b>Definition</b> <a href="analog_8cpp_source.html#l00050">analog.cpp:50</a></div></div>
<div class="ttc" id="aanalog_8cpp_html_a343698084802dc89c1669a49fbbc6497"><div class="ttname"><a href="analog_8cpp.html#a343698084802dc89c1669a49fbbc6497">adc_sample_channels</a></div><div class="ttdeci">void adc_sample_channels()</div><div class="ttdef"><b>Definition</b> <a href="analog_8cpp_source.html#l00097">analog.cpp:97</a></div></div>
<div class="ttc" id="aanalog_8cpp_html_acde4ce7d22816d3b93ce7027448c02c5"><div class="ttname"><a href="analog_8cpp.html#acde4ce7d22816d3b93ce7027448c02c5">adc_enable_vrssi</a></div><div class="ttdeci">void adc_enable_vrssi(void)</div><div class="ttdef"><b>Definition</b> <a href="analog_8cpp_source.html#l00081">analog.cpp:81</a></div></div>
<div class="ttc" id="aanalog_8cpp_html_adb53fd685d9f0c9a40c39c1f9f947ac0"><div class="ttname"><a href="analog_8cpp.html#adb53fd685d9f0c9a40c39c1f9f947ac0">adc_vrssi</a></div><div class="ttdeci">uint16_t adc_vrssi(void)</div><div class="ttdef"><b>Definition</b> <a href="analog_8cpp_source.html#l00122">analog.cpp:122</a></div></div>
<div class="ttc" id="aanalog_8cpp_html_afee176cac31190f16518ba132bd049dc"><div class="ttname"><a href="analog_8cpp.html#afee176cac31190f16518ba132bd049dc">adc_disable_vrssi</a></div><div class="ttdeci">void adc_disable_vrssi(void)</div><div class="ttdef"><b>Definition</b> <a href="analog_8cpp_source.html#l00089">analog.cpp:89</a></div></div>
<div class="ttc" id="aanalog_8h_html"><div class="ttname"><a href="analog_8h.html">analog.h</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1GPIO_html_a2b0664bdab1876e3b0bbcd9064eec88e"><div class="ttname"><a href="classAP__HAL_1_1GPIO.html#a2b0664bdab1876e3b0bbcd9064eec88e">AP_HAL::GPIO::write</a></div><div class="ttdeci">virtual void write(uint8_t pin, uint8_t value)=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1GPIO_html_a3dfc60214bd1aa4936d51ca72c045b95"><div class="ttname"><a href="classAP__HAL_1_1GPIO.html#a3dfc60214bd1aa4936d51ca72c045b95">AP_HAL::GPIO::pinMode</a></div><div class="ttdeci">virtual void pinMode(uint8_t pin, uint8_t output)=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00021">HAL.h:21</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html_a13ed800ad745085097f4d6dce9070eb0"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a13ed800ad745085097f4d6dce9070eb0">AP_HAL::HAL::gpio</a></div><div class="ttdeci">AP_HAL::GPIO * gpio</div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00127">HAL.h:127</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html_a44ed5c21ed9aae558cff53d73c3714b5"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a44ed5c21ed9aae558cff53d73c3714b5">AP_HAL::HAL::rcin</a></div><div class="ttdeci">AP_HAL::RCInput * rcin</div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00128">HAL.h:128</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html_a9337a60383f4264fa96a20dbe43a4e2e"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">AP_HAL::HAL::util</a></div><div class="ttdeci">AP_HAL::Util * util</div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00131">HAL.h:131</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html_a94ab41309b1ff10b8b862b826e59c882"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">AP_HAL::HAL::scheduler</a></div><div class="ttdeci">AP_HAL::Scheduler * scheduler</div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00130">HAL.h:130</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html_aa6daf2df3dfc0b9f0f503db64a52b0cc"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#aa6daf2df3dfc0b9f0f503db64a52b0cc">AP_HAL::HAL::rcout</a></div><div class="ttdeci">AP_HAL::RCOutput * rcout</div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00129">HAL.h:129</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCInput_html_a078fd7e6d2e6a899009ec674a8e03498"><div class="ttname"><a href="classAP__HAL_1_1RCInput.html#a078fd7e6d2e6a899009ec674a8e03498">AP_HAL::RCInput::read</a></div><div class="ttdeci">virtual uint16_t read(uint8_t ch)=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCInput_html_a0eea79c26e71b819edc74bffe6c82631"><div class="ttname"><a href="classAP__HAL_1_1RCInput.html#a0eea79c26e71b819edc74bffe6c82631">AP_HAL::RCInput::init</a></div><div class="ttdeci">virtual void init()=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCInput_html_ae55f959c6115c1f41783af3a2b6c4fcd"><div class="ttname"><a href="classAP__HAL_1_1RCInput.html#ae55f959c6115c1f41783af3a2b6c4fcd">AP_HAL::RCInput::num_channels</a></div><div class="ttdeci">virtual uint8_t num_channels()=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCInput_html_aee1fade33080edef83dd7db0fad0f7da"><div class="ttname"><a href="classAP__HAL_1_1RCInput.html#aee1fade33080edef83dd7db0fad0f7da">AP_HAL::RCInput::new_input</a></div><div class="ttdeci">virtual bool new_input(void)=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a0e848b3a28c4f514a2da1a61b3224294"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a0e848b3a28c4f514a2da1a61b3224294">AP_HAL::RCOutput::get_output_mode</a></div><div class="ttdeci">virtual enum output_mode get_output_mode(uint32_t &amp;mask)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00282">RCOutput.h:282</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a0fc4c7ada47c531c6efda29c92257002"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a0fc4c7ada47c531c6efda29c92257002">AP_HAL::RCOutput::enable_ch</a></div><div class="ttdeci">virtual void enable_ch(uint8_t chan)=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a21e9a5d91d7bd71532f38ac89fa4e9b5"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a21e9a5d91d7bd71532f38ac89fa4e9b5">AP_HAL::RCOutput::set_bidir_dshot_mask</a></div><div class="ttdeci">virtual void set_bidir_dshot_mask(uint32_t mask)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00313">RCOutput.h:313</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a2318a007e93f70762ba8c09b05329104"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a2318a007e93f70762ba8c09b05329104">AP_HAL::RCOutput::set_default_rate</a></div><div class="ttdeci">virtual void set_default_rate(uint16_t rate_hz)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00301">RCOutput.h:301</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a3b81b9e1e60a7dfcfacb2430e7705b8e"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a3b81b9e1e60a7dfcfacb2430e7705b8e">AP_HAL::RCOutput::push</a></div><div class="ttdeci">virtual void push()=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a4e77bfeee3a2494cc4407a91d03e1067"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a4e77bfeee3a2494cc4407a91d03e1067">AP_HAL::RCOutput::init</a></div><div class="ttdeci">virtual void init()=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a5cf4dd2429d465f1ce74bb8204f7f02a"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a5cf4dd2429d465f1ce74bb8204f7f02a">AP_HAL::RCOutput::read_erpm</a></div><div class="ttdeci">virtual uint32_t read_erpm(uint16_t *erpm, uint8_t len)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00161">RCOutput.h:161</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a612e9a31b97e5774aead5f00c298ed3b"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a612e9a31b97e5774aead5f00c298ed3b">AP_HAL::RCOutput::set_output_mode</a></div><div class="ttdeci">virtual void set_output_mode(uint32_t mask, enum output_mode mode)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00280">RCOutput.h:280</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a622e13fac840e64e722fa475180c36d5"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a622e13fac840e64e722fa475180c36d5">AP_HAL::RCOutput::set_dshot_esc_type</a></div><div class="ttdeci">virtual void set_dshot_esc_type(DshotEscType esc_type)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00334">RCOutput.h:334</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a67119a9d68c296c189d2bb86982493b6"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a67119a9d68c296c189d2bb86982493b6">AP_HAL::RCOutput::disable_ch</a></div><div class="ttdeci">virtual void disable_ch(uint8_t chan)=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a6852e3aa22747f045dc71972e97d7de6"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a6852e3aa22747f045dc71972e97d7de6">AP_HAL::RCOutput::force_safety_on</a></div><div class="ttdeci">virtual bool force_safety_on(void)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00129">RCOutput.h:129</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a7c5b4a92bdd2491c6bcbb1403b3c8d1b"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a7c5b4a92bdd2491c6bcbb1403b3c8d1b">AP_HAL::RCOutput::send_dshot_command</a></div><div class="ttdeci">virtual void send_dshot_command(uint8_t command, uint8_t chan=ALL_CHANNELS, uint32_t command_timeout_ms=0, uint16_t repeat_count=10, bool priority=false)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00343">RCOutput.h:343</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a9683d68d15b6e722c44e098bbb12e60a"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a9683d68d15b6e722c44e098bbb12e60a">AP_HAL::RCOutput::cork</a></div><div class="ttdeci">virtual void cork()=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a9a8893667260f7b889a551dabb7587a5"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a9a8893667260f7b889a551dabb7587a5">AP_HAL::RCOutput::set_dshot_period</a></div><div class="ttdeci">virtual void set_dshot_period(uint32_t period_us, uint8_t dshot_rate)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00328">RCOutput.h:328</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_a9d89ae5e312d39c697f03d8269be933b"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#a9d89ae5e312d39c697f03d8269be933b">AP_HAL::RCOutput::timer_tick</a></div><div class="ttdeci">virtual void timer_tick(void)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00172">RCOutput.h:172</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_aaaf8d77396fd76a164428574cb85b736"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#aaaf8d77396fd76a164428574cb85b736">AP_HAL::RCOutput::set_telem_request_mask</a></div><div class="ttdeci">virtual void set_telem_request_mask(uint32_t mask)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00307">RCOutput.h:307</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_aad58d954fb6b9141c97366b64110af97"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#aad58d954fb6b9141c97366b64110af97">AP_HAL::RCOutput::DshotEscType</a></div><div class="ttdeci">DshotEscType</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00272">RCOutput.h:272</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_ac86e488f2b2a728e1a7b71ba19ff8701"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#ac86e488f2b2a728e1a7b71ba19ff8701">AP_HAL::RCOutput::set_esc_scaling</a></div><div class="ttdeci">void set_esc_scaling(uint16_t min_pwm, uint16_t max_pwm)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00142">RCOutput.h:142</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_ade771f122696035c1e831ccc63a33893"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#ade771f122696035c1e831ccc63a33893">AP_HAL::RCOutput::write</a></div><div class="ttdeci">virtual void write(uint8_t chan, uint16_t period_us)=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_ae7903398aa18e2472dd34081e626dcb7"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#ae7903398aa18e2472dd34081e626dcb7">AP_HAL::RCOutput::set_freq</a></div><div class="ttdeci">virtual void set_freq(uint32_t chmask, uint16_t freq_hz)=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_ae8460cf8753716f6aa2fe1d84f9a90ff"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#ae8460cf8753716f6aa2fe1d84f9a90ff">AP_HAL::RCOutput::new_erpm</a></div><div class="ttdeci">virtual bool new_erpm()</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00160">RCOutput.h:160</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_afabff18b963ba9ef5b605e6e7aeca093"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093">AP_HAL::RCOutput::output_mode</a></div><div class="ttdeci">output_mode</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00211">RCOutput.h:211</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_afabff18b963ba9ef5b605e6e7aeca093a151001cd6113487e6da91b6c504683fc"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093a151001cd6113487e6da91b6c504683fc">AP_HAL::RCOutput::MODE_PWM_DSHOT600</a></div><div class="ttdeci">@ MODE_PWM_DSHOT600</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00219">RCOutput.h:219</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_afabff18b963ba9ef5b605e6e7aeca093a1c9c7057fdd08bebe7487917c00dc17e"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093a1c9c7057fdd08bebe7487917c00dc17e">AP_HAL::RCOutput::MODE_PWM_ONESHOT125</a></div><div class="ttdeci">@ MODE_PWM_ONESHOT125</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00215">RCOutput.h:215</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_afabff18b963ba9ef5b605e6e7aeca093a7be772b5075fec936dd6b34e35d60129"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093a7be772b5075fec936dd6b34e35d60129">AP_HAL::RCOutput::MODE_PWM_DSHOT300</a></div><div class="ttdeci">@ MODE_PWM_DSHOT300</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00218">RCOutput.h:218</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_afabff18b963ba9ef5b605e6e7aeca093ab1e27b7d703bdf42b6223d9b9161d9a0"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093ab1e27b7d703bdf42b6223d9b9161d9a0">AP_HAL::RCOutput::MODE_PWM_ONESHOT</a></div><div class="ttdeci">@ MODE_PWM_ONESHOT</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00214">RCOutput.h:214</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_afabff18b963ba9ef5b605e6e7aeca093aca7f067a8380228e2d73594d25b17b1c"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093aca7f067a8380228e2d73594d25b17b1c">AP_HAL::RCOutput::MODE_PWM_BRUSHED</a></div><div class="ttdeci">@ MODE_PWM_BRUSHED</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00216">RCOutput.h:216</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_afabff18b963ba9ef5b605e6e7aeca093ad7db50be7ff2c99ea810f30c5fef614c"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#afabff18b963ba9ef5b605e6e7aeca093ad7db50be7ff2c99ea810f30c5fef614c">AP_HAL::RCOutput::MODE_PWM_DSHOT150</a></div><div class="ttdeci">@ MODE_PWM_DSHOT150</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00217">RCOutput.h:217</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_afb075a7e5438b6f0bae228e0b6be0cc2"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#afb075a7e5438b6f0bae228e0b6be0cc2">AP_HAL::RCOutput::force_safety_off</a></div><div class="ttdeci">virtual void force_safety_off(void)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00134">RCOutput.h:134</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1RCOutput_html_afb78a9564ae460447f2ce993a0bc0482"><div class="ttname"><a href="classAP__HAL_1_1RCOutput.html#afb78a9564ae460447f2ce993a0bc0482">AP_HAL::RCOutput::get_erpm_error_rate</a></div><div class="ttdeci">virtual float get_erpm_error_rate(uint8_t chan) const</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2RCOutput_8h_source.html#l00156">RCOutput.h:156</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Scheduler_html_a9fc1cebafebb6588842f4f0e18c7a996"><div class="ttname"><a href="classAP__HAL_1_1Scheduler.html#a9fc1cebafebb6588842f4f0e18c7a996">AP_HAL::Scheduler::reboot</a></div><div class="ttdeci">virtual void reboot(bool hold_in_bootloader)=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1Scheduler_html_ab3175e2e6223ccfe82f957e41cc12b26"><div class="ttname"><a href="classAP__HAL_1_1Scheduler.html#ab3175e2e6223ccfe82f957e41cc12b26">AP_HAL::Scheduler::delay</a></div><div class="ttdeci">virtual void delay(uint16_t ms)=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1Util_html_a2a2e64f649d25593951054d44c0ed53b"><div class="ttname"><a href="classAP__HAL_1_1Util.html#a2a2e64f649d25593951054d44c0ed53b">AP_HAL::Util::available_memory</a></div><div class="ttdeci">virtual uint32_t available_memory(void)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Util_8h_source.html#l00171">Util.h:171</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Util_html_aa33de8bfb64bde7ebdcbdb9668a24838"><div class="ttname"><a href="classAP__HAL_1_1Util.html#aa33de8bfb64bde7ebdcbdb9668a24838">AP_HAL::Util::was_watchdog_safety_off</a></div><div class="ttdeci">bool was_watchdog_safety_off() const</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Util_8h_source.html#l00027">Util.h:27</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html"><div class="ttname"><a href="classAP__IOMCU__FW.html">AP_IOMCU_FW</a></div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00020">iofirmware.h:20</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a08015b8cec98d8b18b61bfd1dd7e3ef2"><div class="ttname"><a href="classAP__IOMCU__FW.html#a08015b8cec98d8b18b61bfd1dd7e3ef2">AP_IOMCU_FW::rcin_serial_update</a></div><div class="ttdeci">void rcin_serial_update()</div><div class="ttdef"><b>Definition</b> <a href="rc_8cpp_source.html#l00105">rc.cpp:105</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a08a7b7d2cfa6a7e5b152a71481e23fd7"><div class="ttname"><a href="classAP__IOMCU__FW.html#a08a7b7d2cfa6a7e5b152a71481e23fd7">AP_IOMCU_FW::heater_update</a></div><div class="ttdeci">void heater_update()</div><div class="ttdef"><b>Definition</b> <a href="#l00555">iofirmware.cpp:555</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a0a51a6871bda31fc3f789ee95571aa4c"><div class="ttname"><a href="classAP__IOMCU__FW.html#a0a51a6871bda31fc3f789ee95571aa4c">AP_IOMCU_FW::last_output_bdmask</a></div><div class="ttdeci">uint16_t last_output_bdmask</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00121">iofirmware.h:121</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a16be1570b2c5371de43becc55b7f2577"><div class="ttname"><a href="classAP__IOMCU__FW.html#a16be1570b2c5371de43becc55b7f2577">AP_IOMCU_FW::schedule_reboot</a></div><div class="ttdeci">void schedule_reboot(uint32_t time_ms)</div><div class="ttdef"><b>Definition</b> <a href="#l01034">iofirmware.cpp:1034</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a1a711e065227a9bee8bee196b61b6124"><div class="ttname"><a href="classAP__IOMCU__FW.html#a1a711e065227a9bee8bee196b61b6124">AP_IOMCU_FW::rcin_update</a></div><div class="ttdeci">void rcin_update()</div><div class="ttdef"><b>Definition</b> <a href="#l00577">iofirmware.cpp:577</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a22dc905a20b58d37d5fbc5261433f45a"><div class="ttname"><a href="classAP__IOMCU__FW.html#a22dc905a20b58d37d5fbc5261433f45a">AP_IOMCU_FW::telem_update</a></div><div class="ttdeci">void telem_update()</div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a255cdf7fb87b22b8047e3371a57b23e4"><div class="ttname"><a href="classAP__IOMCU__FW.html#a255cdf7fb87b22b8047e3371a57b23e4">AP_IOMCU_FW::loop_counter</a></div><div class="ttdeci">uint32_t loop_counter</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00178">iofirmware.h:178</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a29a8366f97ed72a0cf6418025ba991bc"><div class="ttname"><a href="classAP__IOMCU__FW.html#a29a8366f97ed72a0cf6418025ba991bc">AP_IOMCU_FW::erpm_update</a></div><div class="ttdeci">void erpm_update()</div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a2a86cf5c4f77aba865987dfb97cbda16"><div class="ttname"><a href="classAP__IOMCU__FW.html#a2a86cf5c4f77aba865987dfb97cbda16">AP_IOMCU_FW::last_slow_loop_ms</a></div><div class="ttdeci">uint32_t last_slow_loop_ms</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00172">iofirmware.h:172</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a32b6b03c8197f0a0add346f4aaf02802"><div class="ttname"><a href="classAP__IOMCU__FW.html#a32b6b03c8197f0a0add346f4aaf02802">AP_IOMCU_FW::has_heater</a></div><div class="ttdeci">bool has_heater</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00166">iofirmware.h:166</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a3f3b8816d2d8ffcc29572da4c07c614b"><div class="ttname"><a href="classAP__IOMCU__FW.html#a3f3b8816d2d8ffcc29572da4c07c614b">AP_IOMCU_FW::rc_input</a></div><div class="ttdeci">struct page_rc_input rc_input</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00091">iofirmware.h:91</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a416c0720ab52a33e06e40b989ecfb39a"><div class="ttname"><a href="classAP__IOMCU__FW.html#a416c0720ab52a33e06e40b989ecfb39a">AP_IOMCU_FW::thread_ctx</a></div><div class="ttdeci">thread_t * thread_ctx</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00174">iofirmware.h:174</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a43030d57d47a80e97578178e5c21115e"><div class="ttname"><a href="classAP__IOMCU__FW.html#a43030d57d47a80e97578178e5c21115e">AP_IOMCU_FW::rcout_config_update</a></div><div class="ttdeci">void rcout_config_update()</div><div class="ttdef"><b>Definition</b> <a href="#l01135">iofirmware.cpp:1135</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a474694d94410652f5e014731cca92734"><div class="ttname"><a href="classAP__IOMCU__FW.html#a474694d94410652f5e014731cca92734">AP_IOMCU_FW::pwm_out_update</a></div><div class="ttdeci">void pwm_out_update()</div><div class="ttdef"><b>Definition</b> <a href="#l00541">iofirmware.cpp:541</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a480f55c9952c730512fe82c4cf1b8a89"><div class="ttname"><a href="classAP__IOMCU__FW.html#a480f55c9952c730512fe82c4cf1b8a89">AP_IOMCU_FW::tx_io_packet</a></div><div class="ttdeci">struct IOPacket rx_io_packet tx_io_packet</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00024">iofirmware.h:24</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a4914fac72fcff6f6f0bf79c64ef39460"><div class="ttname"><a href="classAP__IOMCU__FW.html#a4914fac72fcff6f6f0bf79c64ef39460">AP_IOMCU_FW::last_fast_loop_us</a></div><div class="ttdeci">uint32_t last_fast_loop_us</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00173">iofirmware.h:173</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a4b4741b7d5df86a9a790658cee42a439"><div class="ttname"><a href="classAP__IOMCU__FW.html#a4b4741b7d5df86a9a790658cee42a439">AP_IOMCU_FW::last_status_ms</a></div><div class="ttdeci">uint32_t last_status_ms</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00176">iofirmware.h:176</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a4dbb86a1eefe373da375c0beaee26106"><div class="ttname"><a href="classAP__IOMCU__FW.html#a4dbb86a1eefe373da375c0beaee26106">AP_IOMCU_FW::last_ms</a></div><div class="ttdeci">uint32_t last_ms</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00177">iofirmware.h:177</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a528efc78233e1a0114c0636d1858cf7d"><div class="ttname"><a href="classAP__IOMCU__FW.html#a528efc78233e1a0114c0636d1858cf7d">AP_IOMCU_FW::fill_failsafe_pwm</a></div><div class="ttdeci">void fill_failsafe_pwm(void)</div><div class="ttdef"><b>Definition</b> <a href="#l01217">iofirmware.cpp:1217</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a55ce8d5ede1de8675d740d592c8b9023"><div class="ttname"><a href="classAP__IOMCU__FW.html#a55ce8d5ede1de8675d740d592c8b9023">AP_IOMCU_FW::override_active</a></div><div class="ttdeci">bool override_active</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00152">iofirmware.h:152</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a588a102aed1b2ef4fd7f48e4efdb7cf5"><div class="ttname"><a href="classAP__IOMCU__FW.html#a588a102aed1b2ef4fd7f48e4efdb7cf5">AP_IOMCU_FW::handle_code_write</a></div><div class="ttdeci">bool handle_code_write()</div><div class="ttdef"><b>Definition</b> <a href="#l00828">iofirmware.cpp:828</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a647711495b79e5ae220664fc199e2a6a"><div class="ttname"><a href="classAP__IOMCU__FW.html#a647711495b79e5ae220664fc199e2a6a">AP_IOMCU_FW::handle_code_read</a></div><div class="ttdeci">bool handle_code_read()</div><div class="ttdef"><b>Definition</b> <a href="#l00757">iofirmware.cpp:757</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a64c64375629e44c2b59d509afefb396b"><div class="ttname"><a href="classAP__IOMCU__FW.html#a64c64375629e44c2b59d509afefb396b">AP_IOMCU_FW::config</a></div><div class="ttdeci">struct page_config config</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00085">iofirmware.h:85</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a6a00574abc4606791259e65ec376a0a1"><div class="ttname"><a href="classAP__IOMCU__FW.html#a6a00574abc4606791259e65ec376a0a1">AP_IOMCU_FW::safety_update</a></div><div class="ttdeci">void safety_update()</div><div class="ttdef"><b>Definition</b> <a href="#l01060">iofirmware.cpp:1060</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a6ee4f85112da6de1058bbe7d652c47a5"><div class="ttname"><a href="classAP__IOMCU__FW.html#a6ee4f85112da6de1058bbe7d652c47a5">AP_IOMCU_FW::last_blue_led_ms</a></div><div class="ttdeci">uint32_t last_blue_led_ms</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00168">iofirmware.h:168</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a720612853deb29c9265ff8445dfcd3a9"><div class="ttname"><a href="classAP__IOMCU__FW.html#a720612853deb29c9265ff8445dfcd3a9">AP_IOMCU_FW::run_mixer</a></div><div class="ttdeci">void run_mixer(void)</div><div class="ttdef"><b>Definition</b> <a href="mixer_8cpp_source.html#l00122">mixer.cpp:122</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a73e6e889f83a6b426b94d804dbdb4975"><div class="ttname"><a href="classAP__IOMCU__FW.html#a73e6e889f83a6b426b94d804dbdb4975">AP_IOMCU_FW::update_default_rate</a></div><div class="ttdeci">bool update_default_rate</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00164">iofirmware.h:164</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a75b6a6e3941758c3d44d3fe53d88fe3b"><div class="ttname"><a href="classAP__IOMCU__FW.html#a75b6a6e3941758c3d44d3fe53d88fe3b">AP_IOMCU_FW::last_GPIO_channel_mask</a></div><div class="ttdeci">uint8_t last_GPIO_channel_mask</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00129">iofirmware.h:129</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a7a273e6b4f2df8840acdc526d08d4e47"><div class="ttname"><a href="classAP__IOMCU__FW.html#a7a273e6b4f2df8840acdc526d08d4e47">AP_IOMCU_FW::rc_last_input_ms</a></div><div class="ttdeci">uint32_t rc_last_input_ms</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00092">iofirmware.h:92</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a7a4d8d2ed6e17e209ab496fb4b44aa5b"><div class="ttname"><a href="classAP__IOMCU__FW.html#a7a4d8d2ed6e17e209ab496fb4b44aa5b">AP_IOMCU_FW::mixing</a></div><div class="ttdeci">struct page_mixing mixing</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00125">iofirmware.h:125</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a7e4acf93d45694b895fdc3a4328621d9"><div class="ttname"><a href="classAP__IOMCU__FW.html#a7e4acf93d45694b895fdc3a4328621d9">AP_IOMCU_FW::dshot</a></div><div class="ttdeci">struct page_dshot dshot</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00133">iofirmware.h:133</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a81d74737c2cc12ff80d7dd17e2d76aa2"><div class="ttname"><a href="classAP__IOMCU__FW.html#a81d74737c2cc12ff80d7dd17e2d76aa2">AP_IOMCU_FW::last_failsafe_ms</a></div><div class="ttdeci">uint32_t last_failsafe_ms</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00181">iofirmware.h:181</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a8b282febfad6c55df810f4fa0fd16346"><div class="ttname"><a href="classAP__IOMCU__FW.html#a8b282febfad6c55df810f4fa0fd16346">AP_IOMCU_FW::reboot_time</a></div><div class="ttdeci">uint32_t reboot_time</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00162">iofirmware.h:162</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a8e632861c976b85cbfa481f6c0297c89"><div class="ttname"><a href="classAP__IOMCU__FW.html#a8e632861c976b85cbfa481f6c0297c89">AP_IOMCU_FW::page_status_update</a></div><div class="ttdeci">void page_status_update(void)</div><div class="ttdef"><b>Definition</b> <a href="#l00744">iofirmware.cpp:744</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a8e91dd8c9990e01fb9c0388e6230a110"><div class="ttname"><a href="classAP__IOMCU__FW.html#a8e91dd8c9990e01fb9c0388e6230a110">AP_IOMCU_FW::mode_out</a></div><div class="ttdeci">struct page_mode_out mode_out</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00118">iofirmware.h:118</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a90afbe235dd406e74193315a77caf983"><div class="ttname"><a href="classAP__IOMCU__FW.html#a90afbe235dd406e74193315a77caf983">AP_IOMCU_FW::last_safety_off</a></div><div class="ttdeci">bool last_safety_off</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00175">iofirmware.h:175</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a916d19242ab92817f71d9d28d1440d5d"><div class="ttname"><a href="classAP__IOMCU__FW.html#a916d19242ab92817f71d9d28d1440d5d">AP_IOMCU_FW::last_heater_ms</a></div><div class="ttdeci">uint32_t last_heater_ms</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00161">iofirmware.h:161</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_a9468ae045e671313d30ce03f8767acc9"><div class="ttname"><a href="classAP__IOMCU__FW.html#a9468ae045e671313d30ce03f8767acc9">AP_IOMCU_FW::sbus_interval_ms</a></div><div class="ttdeci">uint32_t sbus_interval_ms</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00156">iofirmware.h:156</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_aa50c3d095bf413e4858451eb1131fcea"><div class="ttname"><a href="classAP__IOMCU__FW.html#aa50c3d095bf413e4858451eb1131fcea">AP_IOMCU_FW::reg_direct_pwm</a></div><div class="ttdeci">struct AP_IOMCU_FW::@90 reg_direct_pwm</div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_aa6a33b2121c6ced632a5abc9e0b27ddc"><div class="ttname"><a href="classAP__IOMCU__FW.html#aa6a33b2121c6ced632a5abc9e0b27ddc">AP_IOMCU_FW::last_output_esc_type</a></div><div class="ttdeci">uint16_t last_output_esc_type</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00122">iofirmware.h:122</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_aa6e97452785d6ade70465f15a87978f4"><div class="ttname"><a href="classAP__IOMCU__FW.html#aa6e97452785d6ade70465f15a87978f4">AP_IOMCU_FW::update</a></div><div class="ttdeci">void update()</div><div class="ttdef"><b>Definition</b> <a href="#l00416">iofirmware.cpp:416</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_aa791a6eba91a650216f00d837e5d8fbd"><div class="ttname"><a href="classAP__IOMCU__FW.html#aa791a6eba91a650216f00d837e5d8fbd">AP_IOMCU_FW::calculate_fw_crc</a></div><div class="ttdeci">void calculate_fw_crc(void)</div><div class="ttdef"><b>Definition</b> <a href="#l01040">iofirmware.cpp:1040</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_aab861b3ef551e27c3738f2e7e9648ec4"><div class="ttname"><a href="classAP__IOMCU__FW.html#aab861b3ef551e27c3738f2e7e9648ec4">AP_IOMCU_FW::rcin_serial_init</a></div><div class="ttdeci">void rcin_serial_init()</div><div class="ttdef"><b>Definition</b> <a href="rc_8cpp_source.html#l00073">rc.cpp:73</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_ab0312a187b7497dfc94d47de0ce79518"><div class="ttname"><a href="classAP__IOMCU__FW.html#ab0312a187b7497dfc94d47de0ce79518">AP_IOMCU_FW::safety_button_counter</a></div><div class="ttdeci">uint32_t safety_button_counter</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00170">iofirmware.h:170</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_ab55f1d13336499eb33e65f5473fd23ae"><div class="ttname"><a href="classAP__IOMCU__FW.html#ab55f1d13336499eb33e65f5473fd23ae">AP_IOMCU_FW::fmu_data_received_time</a></div><div class="ttdeci">uint32_t fmu_data_received_time</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00158">iofirmware.h:158</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_ab57cbfeb0d58be863afbac757370da4a"><div class="ttname"><a href="classAP__IOMCU__FW.html#ab57cbfeb0d58be863afbac757370da4a">AP_IOMCU_FW::safety_update_ms</a></div><div class="ttdeci">uint32_t safety_update_ms</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00169">iofirmware.h:169</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_ab5fb85fb1f85ad381a98faedf42b1a1a"><div class="ttname"><a href="classAP__IOMCU__FW.html#ab5fb85fb1f85ad381a98faedf42b1a1a">AP_IOMCU_FW::reg_servo</a></div><div class="ttdeci">struct AP_IOMCU_FW::@89 reg_servo</div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_ab9592ef9fff47b56c58782b94b78a497"><div class="ttname"><a href="classAP__IOMCU__FW.html#ab9592ef9fff47b56c58782b94b78a497">AP_IOMCU_FW::reg_status</a></div><div class="ttdeci">struct page_reg_status reg_status</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00088">iofirmware.h:88</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_ab9f12c96acc2ceabc7e8531f23d3ab86"><div class="ttname"><a href="classAP__IOMCU__FW.html#ab9f12c96acc2ceabc7e8531f23d3ab86">AP_IOMCU_FW::do_reboot</a></div><div class="ttdeci">bool do_reboot</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00163">iofirmware.h:163</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_abcc5bc0a2a54b9df32c9a7726b94ab7a"><div class="ttname"><a href="classAP__IOMCU__FW.html#abcc5bc0a2a54b9df32c9a7726b94ab7a">AP_IOMCU_FW::heater_pwm_polarity</a></div><div class="ttdeci">const bool heater_pwm_polarity</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00167">iofirmware.h:167</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_abe81057f9fb50ad4a3f99910b95b09d8"><div class="ttname"><a href="classAP__IOMCU__FW.html#abe81057f9fb50ad4a3f99910b95b09d8">AP_IOMCU_FW::reg_failsafe_pwm</a></div><div class="ttdeci">struct AP_IOMCU_FW::@91 reg_failsafe_pwm</div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_ac07b3fabc705bb7ce2b60e504e338dec"><div class="ttname"><a href="classAP__IOMCU__FW.html#ac07b3fabc705bb7ce2b60e504e338dec">AP_IOMCU_FW::last_channel_mask</a></div><div class="ttdeci">uint16_t last_channel_mask</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00082">iofirmware.h:82</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_ac14e26cad684438adbf4dc26186e1295"><div class="ttname"><a href="classAP__IOMCU__FW.html#ac14e26cad684438adbf4dc26186e1295">AP_IOMCU_FW::process_io_packet</a></div><div class="ttdeci">void process_io_packet()</div><div class="ttdef"><b>Definition</b> <a href="#l00663">iofirmware.cpp:663</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_ac44fd3950057730a5a93041166c4529f"><div class="ttname"><a href="classAP__IOMCU__FW.html#ac44fd3950057730a5a93041166c4529f">AP_IOMCU_FW::init</a></div><div class="ttdeci">void init()</div><div class="ttdef"><b>Definition</b> <a href="#l00288">iofirmware.cpp:288</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_acd406f3690ad6a35fcb606542347645f"><div class="ttname"><a href="classAP__IOMCU__FW.html#acd406f3690ad6a35fcb606542347645f">AP_IOMCU_FW::reg_setup</a></div><div class="ttdeci">struct AP_IOMCU_FW::@88 reg_setup</div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_ad52ea909c69b2dc1bc01a47a3a3255b9"><div class="ttname"><a href="classAP__IOMCU__FW.html#ad52ea909c69b2dc1bc01a47a3a3255b9">AP_IOMCU_FW::dsm_bind_step</a></div><div class="ttdeci">void dsm_bind_step(void)</div><div class="ttdef"><b>Definition</b> <a href="rc_8cpp_source.html#l00184">rc.cpp:184</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_ad6f963d7a986df74035569369ea2c663"><div class="ttname"><a href="classAP__IOMCU__FW.html#ad6f963d7a986df74035569369ea2c663">AP_IOMCU_FW::update_rcout_freq</a></div><div class="ttdeci">bool update_rcout_freq</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00165">iofirmware.h:165</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_ad7ce59291238764650a90ae35f81c8df"><div class="ttname"><a href="classAP__IOMCU__FW.html#ad7ce59291238764650a90ae35f81c8df">AP_IOMCU_FW::led_counter</a></div><div class="ttdeci">uint8_t led_counter</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00171">iofirmware.h:171</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_add72dc29f89933f29d7652038824650d"><div class="ttname"><a href="classAP__IOMCU__FW.html#add72dc29f89933f29d7652038824650d">AP_IOMCU_FW::GPIO_write</a></div><div class="ttdeci">void GPIO_write()</div><div class="ttdef"><b>Definition</b> <a href="#l01231">iofirmware.cpp:1231</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_ae4c633f721d0e76def1801f523376fd6"><div class="ttname"><a href="classAP__IOMCU__FW.html#ae4c633f721d0e76def1801f523376fd6">AP_IOMCU_FW::last_output_mode_mask</a></div><div class="ttdeci">uint16_t last_output_mode_mask</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00120">iofirmware.h:120</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_aed0efa98cece9e24792eb9ba3231abb6"><div class="ttname"><a href="classAP__IOMCU__FW.html#aed0efa98cece9e24792eb9ba3231abb6">AP_IOMCU_FW::dsm_bind_state</a></div><div class="ttdeci">uint8_t dsm_bind_state</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00179">iofirmware.h:179</a></div></div>
<div class="ttc" id="aclassAP__IOMCU__FW_html_aef04d668a1a738b37338ed0bad80ee7a"><div class="ttname"><a href="classAP__IOMCU__FW.html#aef04d668a1a738b37338ed0bad80ee7a">AP_IOMCU_FW::sbus_last_ms</a></div><div class="ttdeci">uint32_t sbus_last_ms</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00155">iofirmware.h:155</a></div></div>
<div class="ttc" id="aclassAP__RCProtocol_html_a686283a7061209351921b6beca4a0630"><div class="ttname"><a href="classAP__RCProtocol.html#a686283a7061209351921b6beca4a0630">AP_RCProtocol::set_rc_protocols</a></div><div class="ttdeci">void set_rc_protocols(uint32_t mask)</div><div class="ttdef"><b>Definition</b> <a href="AP__RCProtocol_8h_source.html#l00189">AP_RCProtocol.h:189</a></div></div>
<div class="ttc" id="aclassChibiOS_1_1GPIO_html"><div class="ttname"><a href="classChibiOS_1_1GPIO.html">ChibiOS::GPIO</a></div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2GPIO_8h_source.html#l00041">GPIO.h:41</a></div></div>
<div class="ttc" id="aclassChibiOS_1_1RCInput_html"><div class="ttname"><a href="classChibiOS_1_1RCInput.html">ChibiOS::RCInput</a></div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2RCInput_8h_source.html#l00040">RCInput.h:40</a></div></div>
<div class="ttc" id="aclassChibiOS_1_1RCOutput_html"><div class="ttname"><a href="classChibiOS_1_1RCOutput.html">ChibiOS::RCOutput</a></div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2RCOutput_8h_source.html#l00051">RCOutput.h:55</a></div></div>
<div class="ttc" id="acrc_8cpp_html_a82435966e7a560c44a8dd32132c60557"><div class="ttname"><a href="crc_8cpp.html#a82435966e7a560c44a8dd32132c60557">crc32_small</a></div><div class="ttdeci">uint32_t crc32_small(uint32_t crc, const uint8_t *buf, uint32_t size)</div><div class="ttdef"><b>Definition</b> <a href="crc_8cpp_source.html#l00318">crc.cpp:318</a></div></div>
<div class="ttc" id="acrc_8cpp_html_a9854916652a9bd6e9db046706bc313b1"><div class="ttname"><a href="crc_8cpp.html#a9854916652a9bd6e9db046706bc313b1">crc_crc8</a></div><div class="ttdeci">uint8_t crc_crc8(const uint8_t *p, uint8_t len)</div><div class="ttdef"><b>Definition</b> <a href="crc_8cpp_source.html#l00083">crc.cpp:83</a></div></div>
<div class="ttc" id="acrc_8h_html"><div class="ttname"><a href="crc_8h.html">crc.h</a></div></div>
<div class="ttc" id="afunctor_8h_html_a00e5874203cecc310017f9166f2c0e36"><div class="ttname"><a href="functor_8h.html#a00e5874203cecc310017f9166f2c0e36">FUNCTOR_BIND_MEMBER</a></div><div class="ttdeci">#define FUNCTOR_BIND_MEMBER(func, rettype,...)</div><div class="ttdef"><b>Definition</b> <a href="functor_8h_source.html#l00031">functor.h:31</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_a08502f422ced5354942473a0f282e3cc"><div class="ttname"><a href="iofirmware_8cpp.html#a08502f422ced5354942473a0f282e3cc">setup_rx_dma</a></div><div class="ttdeci">static void setup_rx_dma(hal_uart_driver *uart)</div><div class="ttdef"><b>Definition</b> <a href="#l00070">iofirmware.cpp:70</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_a1858bdf23f3647731d31c02115adc060"><div class="ttname"><a href="iofirmware_8cpp.html#a1858bdf23f3647731d31c02115adc060">iomcu</a></div><div class="ttdeci">static AP_IOMCU_FW iomcu</div><div class="ttdef"><b>Definition</b> <a href="#l00036">iofirmware.cpp:36</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_a1c5fa7cd8b7aba05232c84e79c89b0a0"><div class="ttname"><a href="iofirmware_8cpp.html#a1c5fa7cd8b7aba05232c84e79c89b0a0">COPY_PAGE</a></div><div class="ttdeci">#define COPY_PAGE(_page_name)</div></div>
<div class="ttc" id="aiofirmware_8cpp_html_a4fc01d736fe50cf5b977f755b675f11d"><div class="ttname"><a href="iofirmware_8cpp.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a></div><div class="ttdeci">void setup()</div><div class="ttdef"><b>Definition</b> <a href="#l00264">iofirmware.cpp:264</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_a5998fd7b0693b6b515eedb50a7440b06"><div class="ttname"><a href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06">ioevents</a></div><div class="ttdeci">ioevents</div><div class="ttdef"><b>Definition</b> <a href="#l00062">iofirmware.cpp:62</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_a5998fd7b0693b6b515eedb50a7440b06a566cc3b837181645b59574fc6af58910"><div class="ttname"><a href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a566cc3b837181645b59574fc6af58910">IOEVENT_TX_BEGIN</a></div><div class="ttdeci">@ IOEVENT_TX_BEGIN</div><div class="ttdef"><b>Definition</b> <a href="#l00064">iofirmware.cpp:64</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_a5998fd7b0693b6b515eedb50a7440b06a8186f067e8f3343c8a798b4bbe833547"><div class="ttname"><a href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06a8186f067e8f3343c8a798b4bbe833547">IOEVENT_TX_END</a></div><div class="ttdeci">@ IOEVENT_TX_END</div><div class="ttdef"><b>Definition</b> <a href="#l00065">iofirmware.cpp:65</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_a5998fd7b0693b6b515eedb50a7440b06af23b75144c072b1255b0274aab89ee12"><div class="ttname"><a href="iofirmware_8cpp.html#a5998fd7b0693b6b515eedb50a7440b06af23b75144c072b1255b0274aab89ee12">IOEVENT_PWM</a></div><div class="ttdeci">@ IOEVENT_PWM</div><div class="ttdef"><b>Definition</b> <a href="#l00063">iofirmware.cpp:63</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_a653ccb1f7a547130f836735ae7d1af53"><div class="ttname"><a href="iofirmware_8cpp.html#a653ccb1f7a547130f836735ae7d1af53">setup_tx_dma</a></div><div class="ttdeci">static void setup_tx_dma(hal_uart_driver *uart)</div><div class="ttdef"><b>Definition</b> <a href="#l00083">iofirmware.cpp:83</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_a762f9f47c54b061a9024d4575a0b34ee"><div class="ttname"><a href="iofirmware_8cpp.html#a762f9f47c54b061a9024d4575a0b34ee">dma_rx_end_cb</a></div><div class="ttdeci">static void dma_rx_end_cb(hal_uart_driver *uart)</div><div class="ttdef"><b>Definition</b> <a href="#l00102">iofirmware.cpp:102</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_a99a6124b5472520c8491a1516afb32ae"><div class="ttname"><a href="iofirmware_8cpp.html#a99a6124b5472520c8491a1516afb32ae">dma_tx_end_cb</a></div><div class="ttdeci">static void dma_tx_end_cb(hal_uart_driver *uart)</div><div class="ttdef"><b>Definition</b> <a href="#l00127">iofirmware.cpp:127</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_aa1d515f6e94ee0ec97697af7ecca27d3"><div class="ttname"><a href="iofirmware_8cpp.html#aa1d515f6e94ee0ec97697af7ecca27d3">uart_cfg</a></div><div class="ttdeci">static UARTConfig uart_cfg</div><div class="ttdef"><b>Definition</b> <a href="#l00250">iofirmware.cpp:250</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_aa754b8f19697c092a3eb48905d6561e3"><div class="ttname"><a href="iofirmware_8cpp.html#aa754b8f19697c092a3eb48905d6561e3">AP_HAL_MAIN</a></div><div class="ttdeci">AP_HAL_MAIN()</div></div>
<div class="ttc" id="aiofirmware_8cpp_html_aac463e9ed8001726c79f9dd09023028a"><div class="ttname"><a href="iofirmware_8cpp.html#aac463e9ed8001726c79f9dd09023028a">APP_SIZE_MAX</a></div><div class="ttdeci">#define APP_SIZE_MAX</div></div>
<div class="ttc" id="aiofirmware_8cpp_html_abbc0f2f755b4172f1c3680c20a02f0dc"><div class="ttname"><a href="iofirmware_8cpp.html#abbc0f2f755b4172f1c3680c20a02f0dc">idle_rx_handler</a></div><div class="ttdeci">static void idle_rx_handler(hal_uart_driver *uart)</div><div class="ttdef"><b>Definition</b> <a href="#l00148">iofirmware.cpp:148</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="iofirmware_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition</b> <a href="#l00044">iofirmware.cpp:44</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_ae604357e19347d62bbfc958f65c2dd5a"><div class="ttname"><a href="iofirmware_8cpp.html#ae604357e19347d62bbfc958f65c2dd5a">stackCheck</a></div><div class="ttdeci">static void stackCheck(uint16_t &amp;mstack, uint16_t &amp;pstack)</div><div class="ttdef"><b>Definition</b> <a href="#l00343">iofirmware.cpp:343</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_afe461d27b9c48d5921c00d521181f12f"><div class="ttname"><a href="iofirmware_8cpp.html#afe461d27b9c48d5921c00d521181f12f">loop</a></div><div class="ttdeci">void loop()</div><div class="ttdef"><b>Definition</b> <a href="#l00283">iofirmware.cpp:283</a></div></div>
<div class="ttc" id="aiofirmware_8cpp_html_afff02e2ec9814e8c8d257f3db045fcab"><div class="ttname"><a href="iofirmware_8cpp.html#afff02e2ec9814e8c8d257f3db045fcab">APP_LOAD_ADDRESS</a></div><div class="ttdeci">#define APP_LOAD_ADDRESS</div></div>
<div class="ttc" id="aiofirmware_8h_html"><div class="ttname"><a href="iofirmware_8h.html">iofirmware.h</a></div></div>
<div class="ttc" id="aiofirmware_8h_html_a0230bc3c5208cc29f365e182539edd17"><div class="ttname"><a href="iofirmware_8h.html#a0230bc3c5208cc29f365e182539edd17">SERVO_COUNT</a></div><div class="ttdeci">#define SERVO_COUNT</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00018">iofirmware.h:18</a></div></div>
<div class="ttc" id="aiofirmware_8h_html_a5f0f20688bddff38ec95bd333366508a"><div class="ttname"><a href="iofirmware_8h.html#a5f0f20688bddff38ec95bd333366508a">PWM_IGNORE_THIS_CHANNEL</a></div><div class="ttdeci">#define PWM_IGNORE_THIS_CHANNEL</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00017">iofirmware.h:17</a></div></div>
<div class="ttc" id="aiofirmware_8h_html_a8337301c0cf199b92191a4a0e22c11bd"><div class="ttname"><a href="iofirmware_8h.html#a8337301c0cf199b92191a4a0e22c11bd">BLUE_TOGGLE</a></div><div class="ttdeci">#define BLUE_TOGGLE()</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00186">iofirmware.h:186</a></div></div>
<div class="ttc" id="aiofirmware_8h_html_a887a0411d2f5020af91f20065d3d940d"><div class="ttname"><a href="iofirmware_8h.html#a887a0411d2f5020af91f20065d3d940d">HEATER_SET</a></div><div class="ttdeci">#define HEATER_SET(on)</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00185">iofirmware.h:185</a></div></div>
<div class="ttc" id="aiofirmware_8h_html_aa99daddb196278a70d757ae3838ef4fa"><div class="ttname"><a href="iofirmware_8h.html#aa99daddb196278a70d757ae3838ef4fa">AMBER_SET</a></div><div class="ttdeci">#define AMBER_SET(on)</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00187">iofirmware.h:187</a></div></div>
<div class="ttc" id="aiofirmware_8h_html_af2d65b8aa3958b959290f64f8a01833f"><div class="ttname"><a href="iofirmware_8h.html#af2d65b8aa3958b959290f64f8a01833f">SPEKTRUM_POWER</a></div><div class="ttdeci">#define SPEKTRUM_POWER(on)</div><div class="ttdef"><b>Definition</b> <a href="iofirmware_8h_source.html#l00188">iofirmware.h:188</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a0037b43d3693c0d8d3c5df6c36ccc4b8"><div class="ttname"><a href="ioprotocol_8h.html#a0037b43d3693c0d8d3c5df6c36ccc4b8">PKT_MAX_REGS</a></div><div class="ttdeci">#define PKT_MAX_REGS</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00011">ioprotocol.h:11</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a065edde84d23cd3b5c9e9b4f80ca11ca"><div class="ttname"><a href="ioprotocol_8h.html#a065edde84d23cd3b5c9e9b4f80ca11ca">P_SETUP_FEATURES_PWM_RSSI</a></div><div class="ttdeci">#define P_SETUP_FEATURES_PWM_RSSI</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00075">ioprotocol.h:75</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a086ebf9793945d8265ec0690402b238a"><div class="ttname"><a href="ioprotocol_8h.html#a086ebf9793945d8265ec0690402b238a">PAGE_REG_SETUP_IGNORE_SAFETY</a></div><div class="ttdeci">#define PAGE_REG_SETUP_IGNORE_SAFETY</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00095">ioprotocol.h:95</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a14677b26b73ba065af0282ed4202d52a"><div class="ttname"><a href="ioprotocol_8h.html#a14677b26b73ba065af0282ed4202d52a">PAGE_REG_SETUP_ARMING</a></div><div class="ttdeci">#define PAGE_REG_SETUP_ARMING</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00081">ioprotocol.h:81</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a264ac5074bb5ba28f0bcdb63f2ad769f"><div class="ttname"><a href="ioprotocol_8h.html#a264ac5074bb5ba28f0bcdb63f2ad769f">P_SETUP_FEATURES_ADC_RSSI</a></div><div class="ttdeci">#define P_SETUP_FEATURES_ADC_RSSI</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00076">ioprotocol.h:76</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a37fbeb1e1fad6729b8d577ed32bcb9db"><div class="ttname"><a href="ioprotocol_8h.html#a37fbeb1e1fad6729b8d577ed32bcb9db">P_SETUP_FEATURES_SBUS1_OUT</a></div><div class="ttdeci">#define P_SETUP_FEATURES_SBUS1_OUT</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00073">ioprotocol.h:73</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a3d740363c257b5e0bdb37abdc879262e"><div class="ttname"><a href="ioprotocol_8h.html#a3d740363c257b5e0bdb37abdc879262e">PAGE_REG_SETUP_RC_PROTOCOLS</a></div><div class="ttdeci">#define PAGE_REG_SETUP_RC_PROTOCOLS</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00098">ioprotocol.h:98</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a415586269d0c66332bc59f7a3ec1d1f7a1797aa576dd80fe8669bd29613a65a94"><div class="ttname"><a href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7a1797aa576dd80fe8669bd29613a65a94">CODE_SUCCESS</a></div><div class="ttdeci">@ CODE_SUCCESS</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00043">ioprotocol.h:43</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a415586269d0c66332bc59f7a3ec1d1f7a78438e41223d665561056221ef9417ca"><div class="ttname"><a href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7a78438e41223d665561056221ef9417ca">CODE_CORRUPT</a></div><div class="ttdeci">@ CODE_CORRUPT</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00044">ioprotocol.h:44</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a415586269d0c66332bc59f7a3ec1d1f7a8729461d13a7d6ceeea4ad504f51947f"><div class="ttname"><a href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7a8729461d13a7d6ceeea4ad504f51947f">CODE_NOOP</a></div><div class="ttdeci">@ CODE_NOOP</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00040">ioprotocol.h:40</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a415586269d0c66332bc59f7a3ec1d1f7a9480eb6915fc8727181c8e13d7666460"><div class="ttname"><a href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7a9480eb6915fc8727181c8e13d7666460">CODE_READ</a></div><div class="ttdeci">@ CODE_READ</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00038">ioprotocol.h:38</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a415586269d0c66332bc59f7a3ec1d1f7aba16c302538a9dfec64f7e9d71af94fe"><div class="ttname"><a href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7aba16c302538a9dfec64f7e9d71af94fe">CODE_WRITE</a></div><div class="ttdeci">@ CODE_WRITE</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00039">ioprotocol.h:39</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a415586269d0c66332bc59f7a3ec1d1f7afacfaacf2b3fd4e43ba95be012e217b0"><div class="ttname"><a href="ioprotocol_8h.html#a415586269d0c66332bc59f7a3ec1d1f7afacfaacf2b3fd4e43ba95be012e217b0">CODE_ERROR</a></div><div class="ttdeci">@ CODE_ERROR</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00046">ioprotocol.h:45</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a4b4760fdfc25e4a7bbd8c21ee3329e20"><div class="ttname"><a href="ioprotocol_8h.html#a4b4760fdfc25e4a7bbd8c21ee3329e20">PAGE_REG_SETUP_ALTRATE</a></div><div class="ttdeci">#define PAGE_REG_SETUP_ALTRATE</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00090">ioprotocol.h:90</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a53b341135d05c3afa492c367b7988c04"><div class="ttname"><a href="ioprotocol_8h.html#a53b341135d05c3afa492c367b7988c04">P_SETUP_FEATURES_SBUS2_OUT</a></div><div class="ttdeci">#define P_SETUP_FEATURES_SBUS2_OUT</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00074">ioprotocol.h:74</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a53bff87c90194226c9592ee0a3fb7d78"><div class="ttname"><a href="ioprotocol_8h.html#a53bff87c90194226c9592ee0a3fb7d78">PAGE_REG_SETUP_DSM_BIND</a></div><div class="ttdeci">#define PAGE_REG_SETUP_DSM_BIND</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00097">ioprotocol.h:97</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a710177a2c3c00466a8ecc529f7756828"><div class="ttname"><a href="ioprotocol_8h.html#a710177a2c3c00466a8ecc529f7756828">P_SETUP_ARMING_SAFETY_DISABLE_OFF</a></div><div class="ttdeci">#define P_SETUP_ARMING_SAFETY_DISABLE_OFF</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00086">ioprotocol.h:86</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a72d6383a51239aad094855a8b969b8a0"><div class="ttname"><a href="ioprotocol_8h.html#a72d6383a51239aad094855a8b969b8a0">PAGE_REG_SETUP_REBOOT_BL</a></div><div class="ttdeci">#define PAGE_REG_SETUP_REBOOT_BL</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00092">ioprotocol.h:92</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a8e9b3bd5579c54a5e31c8f6b15319065"><div class="ttname"><a href="ioprotocol_8h.html#a8e9b3bd5579c54a5e31c8f6b15319065">REBOOT_BL_MAGIC</a></div><div class="ttdeci">#define REBOOT_BL_MAGIC</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00109">ioprotocol.h:109</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a8fdf176415a905cbb9a151a8c3cda86b"><div class="ttname"><a href="ioprotocol_8h.html#a8fdf176415a905cbb9a151a8c3cda86b">IOMCU_MAX_RC_CHANNELS</a></div><div class="ttdeci">#define IOMCU_MAX_RC_CHANNELS</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00012">ioprotocol.h:12</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a93f785789d0018fbb502192b16387790"><div class="ttname"><a href="ioprotocol_8h.html#a93f785789d0018fbb502192b16387790">PAGE_REG_SETUP_SBUS_RATE</a></div><div class="ttdeci">#define PAGE_REG_SETUP_SBUS_RATE</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00094">ioprotocol.h:94</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a94359ab4fb1c364aa3d7304187488fb8"><div class="ttname"><a href="ioprotocol_8h.html#a94359ab4fb1c364aa3d7304187488fb8">PAGE_REG_SETUP_OUTPUT_MODE</a></div><div class="ttdeci">#define PAGE_REG_SETUP_OUTPUT_MODE</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00091">ioprotocol.h:91</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a94fffa76beed88a2d972b78bbd21c9b4"><div class="ttname"><a href="ioprotocol_8h.html#a94fffa76beed88a2d972b78bbd21c9b4">PAGE_REG_SETUP_FORCE_SAFETY_ON</a></div><div class="ttdeci">#define PAGE_REG_SETUP_FORCE_SAFETY_ON</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00112">ioprotocol.h:112</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a9a3f9e1d7ee4fd9e5bbce3ba5416aba0"><div class="ttname"><a href="ioprotocol_8h.html#a9a3f9e1d7ee4fd9e5bbce3ba5416aba0">PAGE_REG_SETUP_FEATURES</a></div><div class="ttdeci">#define PAGE_REG_SETUP_FEATURES</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00072">ioprotocol.h:72</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_a9d7a03463267045ceb93d52610ef6fb5"><div class="ttname"><a href="ioprotocol_8h.html#a9d7a03463267045ceb93d52610ef6fb5">PAGE_REG_SETUP_HEATER_DUTY_CYCLE</a></div><div class="ttdeci">#define PAGE_REG_SETUP_HEATER_DUTY_CYCLE</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00096">ioprotocol.h:96</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_aaf044ffe3228efe486a8b30e03a0a77e"><div class="ttname"><a href="ioprotocol_8h.html#aaf044ffe3228efe486a8b30e03a0a77e">PAGE_REG_SETUP_DEFAULTRATE</a></div><div class="ttdeci">#define PAGE_REG_SETUP_DEFAULTRATE</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00089">ioprotocol.h:89</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab25c2c63ec75a1c6299c0eabb56cc59e"><div class="ttname"><a href="ioprotocol_8h.html#ab25c2c63ec75a1c6299c0eabb56cc59e">IOMCU_MAX_CHANNELS</a></div><div class="ttdeci">#define IOMCU_MAX_CHANNELS</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00013">ioprotocol.h:13</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab28b63126d2120799fd9d79423233a5d"><div class="ttname"><a href="ioprotocol_8h.html#ab28b63126d2120799fd9d79423233a5d">IOMCU_PROTOCOL_VERSION2</a></div><div class="ttdeci">#define IOMCU_PROTOCOL_VERSION2</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00106">ioprotocol.h:106</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab6936d0c88a308873bc417fa40f8aa81a1ce33709520b96a167db5c869915ea52"><div class="ttname"><a href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a1ce33709520b96a167db5c869915ea52">PAGE_RAW_DSHOT_TELEM_5_8</a></div><div class="ttdeci">@ PAGE_RAW_DSHOT_TELEM_5_8</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00066">ioprotocol.h:66</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab6936d0c88a308873bc417fa40f8aa81a208cfb65a788a2d5a0af38406f502e08"><div class="ttname"><a href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a208cfb65a788a2d5a0af38406f502e08">PAGE_CONFIG</a></div><div class="ttdeci">@ PAGE_CONFIG</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00050">ioprotocol.h:50</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab6936d0c88a308873bc417fa40f8aa81a2d5a0c078e6ae4cfaa486c0e546229c3"><div class="ttname"><a href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a2d5a0c078e6ae4cfaa486c0e546229c3">PAGE_RAW_DSHOT_TELEM_1_4</a></div><div class="ttdeci">@ PAGE_RAW_DSHOT_TELEM_1_4</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00065">ioprotocol.h:65</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab6936d0c88a308873bc417fa40f8aa81a3fe9c6b60450247d90f068b67c879087"><div class="ttname"><a href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a3fe9c6b60450247d90f068b67c879087">PAGE_SERVOS</a></div><div class="ttdeci">@ PAGE_SERVOS</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00053">ioprotocol.h:53</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab6936d0c88a308873bc417fa40f8aa81a6c2ad84f615f56ac28f2c0cc2c51f219"><div class="ttname"><a href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a6c2ad84f615f56ac28f2c0cc2c51f219">PAGE_GPIO</a></div><div class="ttdeci">@ PAGE_GPIO</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00062">ioprotocol.h:62</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab6936d0c88a308873bc417fa40f8aa81a7e0e8ce5cbc82abd4c464f37c24a923f"><div class="ttname"><a href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a7e0e8ce5cbc82abd4c464f37c24a923f">PAGE_DSHOT</a></div><div class="ttdeci">@ PAGE_DSHOT</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00063">ioprotocol.h:63</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab6936d0c88a308873bc417fa40f8aa81a802a712bb7101d74230b6bd8f2b53fa5"><div class="ttname"><a href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a802a712bb7101d74230b6bd8f2b53fa5">PAGE_RAW_DSHOT_ERPM</a></div><div class="ttdeci">@ PAGE_RAW_DSHOT_ERPM</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00064">ioprotocol.h:64</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab6936d0c88a308873bc417fa40f8aa81a81b63abcf0012906e4fc7d9cd5d3c7ea"><div class="ttname"><a href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a81b63abcf0012906e4fc7d9cd5d3c7ea">PAGE_RAW_RCIN</a></div><div class="ttdeci">@ PAGE_RAW_RCIN</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00054">ioprotocol.h:54</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab6936d0c88a308873bc417fa40f8aa81a9507be0cdb85102c9079f7de107a6076"><div class="ttname"><a href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81a9507be0cdb85102c9079f7de107a6076">PAGE_DIRECT_PWM</a></div><div class="ttdeci">@ PAGE_DIRECT_PWM</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00059">ioprotocol.h:59</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab6936d0c88a308873bc417fa40f8aa81aa82e60755b10addd85b56e65459a5868"><div class="ttname"><a href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81aa82e60755b10addd85b56e65459a5868">PAGE_FAILSAFE_PWM</a></div><div class="ttdeci">@ PAGE_FAILSAFE_PWM</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00060">ioprotocol.h:60</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab6936d0c88a308873bc417fa40f8aa81abaf8b4c2ba206eac79e7b2ab387660a2"><div class="ttname"><a href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81abaf8b4c2ba206eac79e7b2ab387660a2">PAGE_SETUP</a></div><div class="ttdeci">@ PAGE_SETUP</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00058">ioprotocol.h:58</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab6936d0c88a308873bc417fa40f8aa81abaf93c1cfe41cd6a0be2db0ad3de5403"><div class="ttname"><a href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81abaf93c1cfe41cd6a0be2db0ad3de5403">PAGE_MIXING</a></div><div class="ttdeci">@ PAGE_MIXING</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00061">ioprotocol.h:61</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab6936d0c88a308873bc417fa40f8aa81aecb2c0bf98f197bca286accccaca0493"><div class="ttname"><a href="ioprotocol_8h.html#ab6936d0c88a308873bc417fa40f8aa81aecb2c0bf98f197bca286accccaca0493">PAGE_STATUS</a></div><div class="ttdeci">@ PAGE_STATUS</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00051">ioprotocol.h:51</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab6a43f107bb611895b832f73d73f7e0a"><div class="ttname"><a href="ioprotocol_8h.html#ab6a43f107bb611895b832f73d73f7e0a">IOMCU_PROTOCOL_VERSION</a></div><div class="ttdeci">#define IOMCU_PROTOCOL_VERSION</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00105">ioprotocol.h:105</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ab89f790e229451f7429482974aa1f095"><div class="ttname"><a href="ioprotocol_8h.html#ab89f790e229451f7429482974aa1f095">PAGE_REG_SETUP_CHANNEL_MASK</a></div><div class="ttdeci">#define PAGE_REG_SETUP_CHANNEL_MASK</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00100">ioprotocol.h:100</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_abde28d29960121cab5851274d5e91d6d"><div class="ttname"><a href="ioprotocol_8h.html#abde28d29960121cab5851274d5e91d6d">PAGE_REG_SETUP_FORCE_SAFETY_OFF</a></div><div class="ttdeci">#define PAGE_REG_SETUP_FORCE_SAFETY_OFF</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00111">ioprotocol.h:111</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ac11850dc8dc259d9728f9242b45ab1be"><div class="ttname"><a href="ioprotocol_8h.html#ac11850dc8dc259d9728f9242b45ab1be">PAGE_REG_SETUP_PWM_RATE_MASK</a></div><div class="ttdeci">#define PAGE_REG_SETUP_PWM_RATE_MASK</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00088">ioprotocol.h:88</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_ae8983f7a0c1f00d991ecf82b619e30fb"><div class="ttname"><a href="ioprotocol_8h.html#ae8983f7a0c1f00d991ecf82b619e30fb">PAGE_REG_SETUP_DSHOT_PERIOD</a></div><div class="ttdeci">#define PAGE_REG_SETUP_DSHOT_PERIOD</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00099">ioprotocol.h:99</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_aeedcdc0cce0ab9fbf43d859670698d78"><div class="ttname"><a href="ioprotocol_8h.html#aeedcdc0cce0ab9fbf43d859670698d78">P_SETUP_ARMING_SAFETY_DISABLE_ON</a></div><div class="ttdeci">#define P_SETUP_ARMING_SAFETY_DISABLE_ON</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00085">ioprotocol.h:85</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_aefcee0ad76e2494693a7aa98284a8827"><div class="ttname"><a href="ioprotocol_8h.html#aefcee0ad76e2494693a7aa98284a8827">P_SETUP_FEATURES_HEATER</a></div><div class="ttdeci">#define P_SETUP_FEATURES_HEATER</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00079">ioprotocol.h:79</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_afb2ac51042a1e538652ef5a5819b20de"><div class="ttname"><a href="ioprotocol_8h.html#afb2ac51042a1e538652ef5a5819b20de">FORCE_SAFETY_MAGIC</a></div><div class="ttdeci">#define FORCE_SAFETY_MAGIC</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00113">ioprotocol.h:113</a></div></div>
<div class="ttc" id="aioprotocol_8h_html_afcfa41e97c4d1abb6380c1c9d699871c"><div class="ttname"><a href="ioprotocol_8h.html#afcfa41e97c4d1abb6380c1c9d699871c">IOMCU_MAX_TELEM_CHANNELS</a></div><div class="ttdeci">#define IOMCU_MAX_TELEM_CHANNELS</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00014">ioprotocol.h:14</a></div></div>
<div class="ttc" id="amalloc_8c_html_afbedc913aa4651b3c3b4b3aecd9b4711"><div class="ttname"><a href="malloc_8c.html#afbedc913aa4651b3c3b4b3aecd9b4711">free</a></div><div class="ttdeci">void free(void *ptr)</div><div class="ttdef"><b>Definition</b> <a href="malloc_8c_source.html#l00413">malloc.c:413</a></div></div>
<div class="ttc" id="amonocypher_8cpp_html_a3acffbd305ee72dcd4593c0d8af64a4f"><div class="ttname"><a href="monocypher_8cpp.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a></div><div class="ttdeci">#define MIN(a, b)</div><div class="ttdef"><b>Definition</b> <a href="monocypher_8cpp_source.html#l00071">monocypher.cpp:71</a></div></div>
<div class="ttc" id="amonocypher_8cpp_html_afa99ec4acc4ecb2dc3c2d05da15d0e3f"><div class="ttname"><a href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a></div><div class="ttdeci">#define MAX(a, b)</div><div class="ttdef"><b>Definition</b> <a href="monocypher_8cpp_source.html#l00072">monocypher.cpp:72</a></div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a478ddf5b4f7ab239ea980838c36e1bb1"><div class="ttname"><a href="namespaceAP__HAL.html#a478ddf5b4f7ab239ea980838c36e1bb1">AP_HAL::get_HAL</a></div><div class="ttdeci">const HAL &amp; get_HAL()</div><div class="ttdef"><b>Definition</b> <a href="HAL__ChibiOS__Class_8cpp_source.html#l00355">HAL_ChibiOS_Class.cpp:355</a></div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a77dffbb18891996280308e21316ec186"><div class="ttname"><a href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a></div><div class="ttdeci">uint32_t millis()</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2system_8cpp_source.html#l00377">system.cpp:377</a></div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a8293355e35887733b1fd151aef08a787"><div class="ttname"><a href="namespaceAP__HAL.html#a8293355e35887733b1fd151aef08a787">AP_HAL::micros</a></div><div class="ttdeci">uint32_t micros()</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2system_8cpp_source.html#l00352">system.cpp:352</a></div></div>
<div class="ttc" id="anamespaceAP_html_ae2881dc66a7a1653b455691fbcd1a0a0"><div class="ttname"><a href="namespaceAP.html#ae2881dc66a7a1653b455691fbcd1a0a0">AP::RC</a></div><div class="ttdeci">AP_RCProtocol &amp; RC()</div><div class="ttdef"><b>Definition</b> <a href="AP__RCProtocol_8cpp_source.html#l00593">AP_RCProtocol.cpp:593</a></div></div>
<div class="ttc" id="anamespaceChibiOS_html"><div class="ttname"><a href="namespaceChibiOS.html">ChibiOS</a></div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS__Namespace_8h_source.html#l00003">AP_HAL_ChibiOS_Namespace.h:3</a></div></div>
<div class="ttc" id="arc_8cpp_html_ac546ed0d264ed9fd5199b63c3fa70272"><div class="ttname"><a href="rc_8cpp.html#ac546ed0d264ed9fd5199b63c3fa70272">sbus_out_write</a></div><div class="ttdeci">void sbus_out_write(uint16_t *channels, uint8_t nchannels)</div><div class="ttdef"><b>Definition</b> <a href="rc_8cpp_source.html#l00045">rc.cpp:45</a></div></div>
<div class="ttc" id="arc_8h_html"><div class="ttname"><a href="rc_8h.html">rc.h</a></div></div>
<div class="ttc" id="ashared__dma_8h_html_a90dbf2b4ba7f8a63571807363926226c"><div class="ttname"><a href="shared__dma_8h.html#a90dbf2b4ba7f8a63571807363926226c">SHARED_DMA_NONE</a></div><div class="ttdeci">#define SHARED_DMA_NONE</div><div class="ttdef"><b>Definition</b> <a href="shared__dma_8h_source.html#l00024">shared_dma.h:24</a></div></div>
<div class="ttc" id="astm32__util_8h_html_a0d9fbf860357a191810118fbe30be6b1"><div class="ttname"><a href="stm32__util_8h.html#a0d9fbf860357a191810118fbe30be6b1">__main_thread_stack_end__</a></div><div class="ttdeci">stkalign_t __main_thread_stack_end__</div></div>
<div class="ttc" id="astm32__util_8h_html_a68d2969cdd4c714b4ae13df76d767a53"><div class="ttname"><a href="stm32__util_8h.html#a68d2969cdd4c714b4ae13df76d767a53">__main_stack_base__</a></div><div class="ttdeci">stkalign_t __main_stack_base__</div></div>
<div class="ttc" id="astm32__util_8h_html_ae92115e7706564de8765ed65cb8f45bd"><div class="ttname"><a href="stm32__util_8h.html#ae92115e7706564de8765ed65cb8f45bd">__main_thread_stack_base__</a></div><div class="ttdeci">stkalign_t __main_thread_stack_base__</div></div>
<div class="ttc" id="astm32__util_8h_html_af74d38f8c713c1d45d7065083a06278e"><div class="ttname"><a href="stm32__util_8h.html#af74d38f8c713c1d45d7065083a06278e">__main_stack_end__</a></div><div class="ttdeci">stkalign_t __main_stack_end__</div></div>
<div class="ttc" id="astm32f1__mcuconf_8h_html_ad1d292d78abf8f0b5a9e210d217a1cfe"><div class="ttname"><a href="stm32f1__mcuconf_8h.html#ad1d292d78abf8f0b5a9e210d217a1cfe">STM32_UART_USART2_IRQ_PRIORITY</a></div><div class="ttdeci">#define STM32_UART_USART2_IRQ_PRIORITY</div><div class="ttdef"><b>Definition</b> <a href="stm32f1__mcuconf_8h_source.html#l00185">stm32f1_mcuconf.h:185</a></div></div>
<div class="ttc" id="astructIOPacket_html_a338a71aff88023b64b73cfde6d4ca2ef"><div class="ttname"><a href="structIOPacket.html#a338a71aff88023b64b73cfde6d4ca2ef">IOPacket::offset</a></div><div class="ttdeci">uint8_t offset</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00023">ioprotocol.h:23</a></div></div>
<div class="ttc" id="astructIOPacket_html_a4154a2062c02bf69b9f0d6ed316dede3"><div class="ttname"><a href="structIOPacket.html#a4154a2062c02bf69b9f0d6ed316dede3">IOPacket::regs</a></div><div class="ttdeci">uint16_t regs[PKT_MAX_REGS]</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00024">ioprotocol.h:24</a></div></div>
<div class="ttc" id="astructIOPacket_html_a5964448096d22dc869d0139b256262bd"><div class="ttname"><a href="structIOPacket.html#a5964448096d22dc869d0139b256262bd">IOPacket::code</a></div><div class="ttdeci">uint8_t code</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00020">ioprotocol.h:20</a></div></div>
<div class="ttc" id="astructIOPacket_html_a93abdcba6eb1657fcb6760babb7c0d00"><div class="ttname"><a href="structIOPacket.html#a93abdcba6eb1657fcb6760babb7c0d00">IOPacket::page</a></div><div class="ttdeci">uint8_t page</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00022">ioprotocol.h:22</a></div></div>
<div class="ttc" id="astructIOPacket_html_a97469a4b02be0a9556d78af389fa6956"><div class="ttname"><a href="structIOPacket.html#a97469a4b02be0a9556d78af389fa6956">IOPacket::count</a></div><div class="ttdeci">uint8_t count</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00019">ioprotocol.h:19</a></div></div>
<div class="ttc" id="astructIOPacket_html_ae4b6c1ba8ca5e98e2429c364bc1e404f"><div class="ttname"><a href="structIOPacket.html#ae4b6c1ba8ca5e98e2429c364bc1e404f">IOPacket::get_size</a></div><div class="ttdeci">uint8_t get_size(void) const</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00027">ioprotocol.h:27</a></div></div>
<div class="ttc" id="astructIOPacket_html_af856646ceb9df0f094d8a26287189fcf"><div class="ttname"><a href="structIOPacket.html#af856646ceb9df0f094d8a26287189fcf">IOPacket::crc</a></div><div class="ttdeci">uint8_t crc</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00021">ioprotocol.h:21</a></div></div>
<div class="ttc" id="astructpage__config_html_a01e1ee64f325beb637fc02493cf58180"><div class="ttname"><a href="structpage__config.html#a01e1ee64f325beb637fc02493cf58180">page_config::protocol_version2</a></div><div class="ttdeci">uint16_t protocol_version2</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00117">ioprotocol.h:117</a></div></div>
<div class="ttc" id="astructpage__config_html_a56a0d12ab164b29b3779a60e1186c2f0"><div class="ttname"><a href="structpage__config.html#a56a0d12ab164b29b3779a60e1186c2f0">page_config::protocol_version</a></div><div class="ttdeci">uint16_t protocol_version</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00116">ioprotocol.h:116</a></div></div>
<div class="ttc" id="astructpage__config_html_a918b5ac1d39e462a210c71bdf61e7f84"><div class="ttname"><a href="structpage__config.html#a918b5ac1d39e462a210c71bdf61e7f84">page_config::cpuid</a></div><div class="ttdeci">uint32_t cpuid</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00119">ioprotocol.h:119</a></div></div>
<div class="ttc" id="astructpage__config_html_a990912c76079dc5245132dc97b0f9a31"><div class="ttname"><a href="structpage__config.html#a990912c76079dc5245132dc97b0f9a31">page_config::mcuid</a></div><div class="ttdeci">uint32_t mcuid</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00118">ioprotocol.h:118</a></div></div>
<div class="ttc" id="astructpage__dshot_html_a2bfe6698880ce9480452adfe62155a4c"><div class="ttname"><a href="structpage__dshot.html#a2bfe6698880ce9480452adfe62155a4c">page_dshot::command</a></div><div class="ttdeci">uint8_t command</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00205">ioprotocol.h:205</a></div></div>
<div class="ttc" id="astructpage__dshot_html_a4cc6875e3f4f8fc07ce89b4c0336086f"><div class="ttname"><a href="structpage__dshot.html#a4cc6875e3f4f8fc07ce89b4c0336086f">page_dshot::repeat_count</a></div><div class="ttdeci">uint8_t repeat_count</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00208">ioprotocol.h:208</a></div></div>
<div class="ttc" id="astructpage__dshot_html_a5100e68c2e84df275a78e533032e3b63"><div class="ttname"><a href="structpage__dshot.html#a5100e68c2e84df275a78e533032e3b63">page_dshot::telem_mask</a></div><div class="ttdeci">uint16_t telem_mask</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00204">ioprotocol.h:204</a></div></div>
<div class="ttc" id="astructpage__dshot_html_a65772cbdf543f0785f7a9a6518b53623"><div class="ttname"><a href="structpage__dshot.html#a65772cbdf543f0785f7a9a6518b53623">page_dshot::priority</a></div><div class="ttdeci">uint8_t priority</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00209">ioprotocol.h:209</a></div></div>
<div class="ttc" id="astructpage__dshot_html_a78c63d8bd488206f1a0ca15b4680a112"><div class="ttname"><a href="structpage__dshot.html#a78c63d8bd488206f1a0ca15b4680a112">page_dshot::command_timeout_ms</a></div><div class="ttdeci">uint32_t command_timeout_ms</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00207">ioprotocol.h:207</a></div></div>
<div class="ttc" id="astructpage__dshot_html_abbb195faf3cc81c89854f9ee365f8ae1"><div class="ttname"><a href="structpage__dshot.html#abbb195faf3cc81c89854f9ee365f8ae1">page_dshot::chan</a></div><div class="ttdeci">uint8_t chan</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00206">ioprotocol.h:206</a></div></div>
<div class="ttc" id="astructpage__mixing_html_a1862808bc91583d403e33a1877f3641b"><div class="ttname"><a href="structpage__mixing.html#a1862808bc91583d403e33a1877f3641b">page_mixing::rc_chan_override</a></div><div class="ttdeci">int8_t rc_chan_override</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00175">ioprotocol.h:175</a></div></div>
<div class="ttc" id="astructpage__mixing_html_ad395d258572391e2a8e40b7971133e63"><div class="ttname"><a href="structpage__mixing.html#ad395d258572391e2a8e40b7971133e63">page_mixing::enabled</a></div><div class="ttdeci">uint8_t enabled</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00184">ioprotocol.h:184</a></div></div>
<div class="ttc" id="astructpage__mode__out_html_a1c8c78e9b974fc7b15731f65d724b8cf"><div class="ttname"><a href="structpage__mode__out.html#a1c8c78e9b974fc7b15731f65d724b8cf">page_mode_out::esc_type</a></div><div class="ttdeci">uint16_t esc_type</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00200">ioprotocol.h:200</a></div></div>
<div class="ttc" id="astructpage__mode__out_html_a23d9879600a09725ec49640745190d8d"><div class="ttname"><a href="structpage__mode__out.html#a23d9879600a09725ec49640745190d8d">page_mode_out::mask</a></div><div class="ttdeci">uint16_t mask</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00197">ioprotocol.h:197</a></div></div>
<div class="ttc" id="astructpage__mode__out_html_a5a7162262c1b20d86cbdf77b7f7b1aeb"><div class="ttname"><a href="structpage__mode__out.html#a5a7162262c1b20d86cbdf77b7f7b1aeb">page_mode_out::mode</a></div><div class="ttdeci">uint16_t mode</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00198">ioprotocol.h:198</a></div></div>
<div class="ttc" id="astructpage__mode__out_html_a77044e6a0106c1e48321c78387335c33"><div class="ttname"><a href="structpage__mode__out.html#a77044e6a0106c1e48321c78387335c33">page_mode_out::bdmask</a></div><div class="ttdeci">uint16_t bdmask</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00199">ioprotocol.h:199</a></div></div>
<div class="ttc" id="astructpage__rc__input_html_a363a90b68fc73a506d64506b5b1c78c8"><div class="ttname"><a href="structpage__rc__input.html#a363a90b68fc73a506d64506b5b1c78c8">page_rc_input::pwm</a></div><div class="ttdeci">uint16_t pwm[IOMCU_MAX_RC_CHANNELS]</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00150">ioprotocol.h:150</a></div></div>
<div class="ttc" id="astructpage__rc__input_html_a6b177138a27ca5a9a7525c79716344ef"><div class="ttname"><a href="structpage__rc__input.html#a6b177138a27ca5a9a7525c79716344ef">page_rc_input::flags_rc_ok</a></div><div class="ttdeci">uint8_t flags_rc_ok</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00148">ioprotocol.h:148</a></div></div>
<div class="ttc" id="astructpage__rc__input_html_a7175616c3641828e00b54e9d267fc347"><div class="ttname"><a href="structpage__rc__input.html#a7175616c3641828e00b54e9d267fc347">page_rc_input::rssi</a></div><div class="ttdeci">int16_t rssi</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00151">ioprotocol.h:151</a></div></div>
<div class="ttc" id="astructpage__rc__input_html_a8f09eb9cd84d88e5a4299894a87311c1"><div class="ttname"><a href="structpage__rc__input.html#a8f09eb9cd84d88e5a4299894a87311c1">page_rc_input::rc_protocol</a></div><div class="ttdeci">uint8_t rc_protocol</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00149">ioprotocol.h:149</a></div></div>
<div class="ttc" id="astructpage__rc__input_html_acd43d64d894561a54507f0f0dedf0912"><div class="ttname"><a href="structpage__rc__input.html#acd43d64d894561a54507f0f0dedf0912">page_rc_input::flags_failsafe</a></div><div class="ttdeci">uint8_t flags_failsafe</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00147">ioprotocol.h:147</a></div></div>
<div class="ttc" id="astructpage__rc__input_html_afdd5b2e6f4742c8119b7ab61fff92c59"><div class="ttname"><a href="structpage__rc__input.html#afdd5b2e6f4742c8119b7ab61fff92c59">page_rc_input::count</a></div><div class="ttdeci">uint8_t count</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00146">ioprotocol.h:146</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_a05eebadff50307510f241daa6134e5d3"><div class="ttname"><a href="structpage__reg__status.html#a05eebadff50307510f241daa6134e5d3">page_reg_status::vservo</a></div><div class="ttdeci">uint16_t vservo</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00127">ioprotocol.h:127</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_a0d087b3c82d398e8af2cb4b275f52c71"><div class="ttname"><a href="structpage__reg__status.html#a0d087b3c82d398e8af2cb4b275f52c71">page_reg_status::timestamp_ms</a></div><div class="ttdeci">uint32_t timestamp_ms</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00126">ioprotocol.h:126</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_a15d1816ed1764006b01dc8f22d310b78"><div class="ttname"><a href="structpage__reg__status.html#a15d1816ed1764006b01dc8f22d310b78">page_reg_status::err_write</a></div><div class="ttdeci">uint8_t err_write</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00139">ioprotocol.h:139</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_a1ee477f812b7b4beb2c3964e715ad9bc"><div class="ttname"><a href="structpage__reg__status.html#a1ee477f812b7b4beb2c3964e715ad9bc">page_reg_status::total_ticks</a></div><div class="ttdeci">uint32_t total_ticks</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00131">ioprotocol.h:131</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_a2d8d52b8440e318e100513ef6ca0e856"><div class="ttname"><a href="structpage__reg__status.html#a2d8d52b8440e318e100513ef6ca0e856">page_reg_status::err_uart</a></div><div class="ttdeci">uint8_t err_uart</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00140">ioprotocol.h:140</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_a51a32f1d70bfecc92e2e2322c79a25a7"><div class="ttname"><a href="structpage__reg__status.html#a51a32f1d70bfecc92e2e2322c79a25a7">page_reg_status::total_pkts</a></div><div class="ttdeci">uint32_t total_pkts</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00130">ioprotocol.h:130</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_a565f2c9c72e450ab0874a829c4d75902"><div class="ttname"><a href="structpage__reg__status.html#a565f2c9c72e450ab0874a829c4d75902">page_reg_status::total_events</a></div><div class="ttdeci">uint32_t total_events</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00132">ioprotocol.h:132</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_a5c12ceb4a8207e291c9260d86451390f"><div class="ttname"><a href="structpage__reg__status.html#a5c12ceb4a8207e291c9260d86451390f">page_reg_status::err_crc</a></div><div class="ttdeci">uint8_t err_crc</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00136">ioprotocol.h:136</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_a610d89ed9e8d5ef57b6a50b5f06bd2dd"><div class="ttname"><a href="structpage__reg__status.html#a610d89ed9e8d5ef57b6a50b5f06bd2dd">page_reg_status::freepstack</a></div><div class="ttdeci">uint16_t freepstack</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00125">ioprotocol.h:125</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_a8772412872d631bd7cf45fd977313067"><div class="ttname"><a href="structpage__reg__status.html#a8772412872d631bd7cf45fd977313067">page_reg_status::err_lock</a></div><div class="ttdeci">uint8_t err_lock</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00141">ioprotocol.h:141</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_a89e38aeb5fffc9ca586372ccd6bf037d"><div class="ttname"><a href="structpage__reg__status.html#a89e38aeb5fffc9ca586372ccd6bf037d">page_reg_status::freemem</a></div><div class="ttdeci">uint16_t freemem</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00123">ioprotocol.h:123</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_a9e031aa30a33ff8a2c9832270375ffeb"><div class="ttname"><a href="structpage__reg__status.html#a9e031aa30a33ff8a2c9832270375ffeb">page_reg_status::err_bad_opcode</a></div><div class="ttdeci">uint8_t err_bad_opcode</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00137">ioprotocol.h:137</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_ab751d54220c9d18e4f0edb5a6a41a4e5"><div class="ttname"><a href="structpage__reg__status.html#ab751d54220c9d18e4f0edb5a6a41a4e5">page_reg_status::num_errors</a></div><div class="ttdeci">uint32_t num_errors</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00129">ioprotocol.h:129</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_abd348f4a7f7ca4fc905a09b566115c4b"><div class="ttname"><a href="structpage__reg__status.html#abd348f4a7f7ca4fc905a09b566115c4b">page_reg_status::rcout_mode</a></div><div class="ttdeci">uint8_t rcout_mode</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00135">ioprotocol.h:135</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_ad15d15b3b6f1d0626f12af16fb35c437"><div class="ttname"><a href="structpage__reg__status.html#ad15d15b3b6f1d0626f12af16fb35c437">page_reg_status::rcout_mask</a></div><div class="ttdeci">uint8_t rcout_mask</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00134">ioprotocol.h:134</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_ad289a2cbbb52a251dc7151e41cbc379b"><div class="ttname"><a href="structpage__reg__status.html#ad289a2cbbb52a251dc7151e41cbc379b">page_reg_status::freemstack</a></div><div class="ttdeci">uint16_t freemstack</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00124">ioprotocol.h:124</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_ad4c1789970ca3486949bb79ba20a8cd6"><div class="ttname"><a href="structpage__reg__status.html#ad4c1789970ca3486949bb79ba20a8cd6">page_reg_status::vrssi</a></div><div class="ttdeci">uint16_t vrssi</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00128">ioprotocol.h:128</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_add4c7ea747bf661c11c1e29b65ea0bb5"><div class="ttname"><a href="structpage__reg__status.html#add4c7ea747bf661c11c1e29b65ea0bb5">page_reg_status::err_read</a></div><div class="ttdeci">uint8_t err_read</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00138">ioprotocol.h:138</a></div></div>
<div class="ttc" id="astructpage__reg__status_html_af8c9a1c1ba718021e4dee5895c43ca29"><div class="ttname"><a href="structpage__reg__status.html#af8c9a1c1ba718021e4dee5895c43ca29">page_reg_status::flag_safety_off</a></div><div class="ttdeci">uint8_t flag_safety_off</div><div class="ttdef"><b>Definition</b> <a href="ioprotocol_8h_source.html#l00133">ioprotocol.h:133</a></div></div>
<div class="ttc" id="awatchdog_8h_html"><div class="ttname"><a href="watchdog_8h.html">watchdog.h</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 22 2024 16:14:14 for APM:Libraries by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
