<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APM:Libraries: libraries/AP_L1_Control/AP_L1_Control.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_996afca1045a8e10427e3ac1dce1c154.html">AP_L1_Control</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">AP_L1_Control.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="AP__L1__Control_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="preprocessor">#include &lt;<a class="code" href="AP__HAL_8h.html">AP_HAL/AP_HAL.h</a>&gt;</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="preprocessor">#include &quot;<a class="code" href="AP__L1__Control_8h.html">AP_L1_Control.h</a>&quot;</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span> </div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="keyword">extern</span> <span class="keyword">const</span> <a class="code hl_class" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code hl_variable" href="AP__L1__Control_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span> </div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">// table of user settable parameters</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="keyword">const</span> <a class="code hl_struct" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code hl_variable" href="classAP__L1__Control.html#aa80fb1f9f7ca34cd3da895ab4e9b4436">AP_L1_Control::var_info</a>[] = {</div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span>    <span class="comment">// @Param: PERIOD</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span>    <span class="comment">// @DisplayName: L1 control period</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span>    <span class="comment">// @Description: Period in seconds of L1 tracking loop. This parameter is the primary control for agressiveness of turns in auto mode. This needs to be larger for less responsive airframes. The default of 20 is quite conservative, but for most RC aircraft will lead to reasonable flight. For smaller more agile aircraft a value closer to 15 is appropriate, or even as low as 10 for some very agile aircraft. When tuning, change this value in small increments, as a value that is much too small (say 5 or 10 below the right value) can lead to very radical turns, and a risk of stalling.</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span>    <span class="comment">// @Units: s</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span>    <span class="comment">// @Range: 1 60</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PERIOD&quot;</span>,    0, <a class="code hl_class" href="classAP__L1__Control.html">AP_L1_Control</a>, _L1_period, 17),</div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span>    <span class="comment">// @Param: DAMPING</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span>    <span class="comment">// @DisplayName: L1 control damping ratio</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span>    <span class="comment">// @Description: Damping ratio for L1 control. Increase this in increments of 0.05 if you are getting overshoot in path tracking. You should not need a value below 0.7 or above 0.85.</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span>    <span class="comment">// @Range: 0.6 1.0</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>    <span class="comment">// @Increment: 0.05</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DAMPING&quot;</span>,   1, <a class="code hl_class" href="classAP__L1__Control.html">AP_L1_Control</a>, _L1_damping, 0.75f),</div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span> </div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>    <span class="comment">// @Param: XTRACK_I</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>    <span class="comment">// @DisplayName: L1 control crosstrack integrator gain</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>    <span class="comment">// @Description: Crosstrack error integrator gain. This gain is applied to the crosstrack error to ensure it converges to zero. Set to zero to disable. Smaller values converge slower, higher values will cause crosstrack error oscillation.</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span>    <span class="comment">// @Range: 0 0.1</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>    <span class="comment">// @Increment: 0.01</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;XTRACK_I&quot;</span>,   2, <a class="code hl_class" href="classAP__L1__Control.html">AP_L1_Control</a>, _L1_xtrack_i_gain, 0.02),</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span> </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>    <span class="comment">// @Param: LIM_BANK</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>    <span class="comment">// @DisplayName: Loiter Radius Bank Angle Limit</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>    <span class="comment">// @Description: The sealevel bank angle limit for a continous loiter. (Used to calculate airframe loading limits at higher altitudes). Setting to 0, will instead just scale the loiter radius directly</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>    <span class="comment">// @Units: deg</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>    <span class="comment">// @Range: 0 89</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LIM_BANK&quot;</span>,   3, <a class="code hl_class" href="classAP__L1__Control.html">AP_L1_Control</a>, _loiter_bank_limit, 0.0f),</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    <a class="code hl_define" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>};</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span> </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="comment">//Bank angle command based on angle between aircraft velocity vector and reference vector to path.</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="comment">//S. Park, J. Deyst, and J. P. How, &quot;A New Nonlinear Guidance Logic for Trajectory Tracking,&quot;</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="comment">//Proceedings of the AIAA Guidance, Navigation and Control</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="comment">//Conference, Aug 2004. AIAA-2004-4900.</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span><span class="comment">//Modified to use PD control for circle tracking to enable loiter radius less than L1 length</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="comment">//Modified to enable period and damping of guidance loop to be set explicitly</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span><span class="comment">//Modified to provide explicit control over capture angle</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span> </div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="comment">/*</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="comment">  Wrap AHRS yaw if in reverse - radians</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00056" data-start="{" data-end="}">
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#a16c75c040fec7cc33e803aa49e8e632f">   56</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classAP__L1__Control.html#a16c75c040fec7cc33e803aa49e8e632f">AP_L1_Control::get_yaw</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__L1__Control.html#a9290bef1192d5649fa929e1feefe21da">_reverse</a>) {</div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="AP__Math_8cpp.html#ae77517d032abb1e1b525d2b43ff9a27d">wrap_PI</a>(<a class="code hl_define" href="definitions_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a> + <a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a5d84cbacfad4577e8de788aeba05f49c">get_yaw</a>());</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    }</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a5d84cbacfad4577e8de788aeba05f49c">get_yaw</a>();</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>}</div>
</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span> </div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span><span class="comment">/*</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span><span class="comment">  Wrap AHRS yaw sensor if in reverse - centi-degress</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00067" data-start="{" data-end="}">
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#ad21403826bfd0deab208ae5560feaa7c">   67</a></span>int32_t <a class="code hl_function" href="classAP__L1__Control.html#ad21403826bfd0deab208ae5560feaa7c">AP_L1_Control::get_yaw_sensor</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__L1__Control.html#a9290bef1192d5649fa929e1feefe21da">_reverse</a>) {</div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="AP__Math_8cpp.html#a49de5d20e28222d3d8ac555a0a0a017d">wrap_180_cd</a>(18000 + <a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_variable" href="classAP__AHRS.html#a8a160130dd99016a19abab9d85917261">yaw_sensor</a>);</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    }</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_variable" href="classAP__AHRS.html#a8a160130dd99016a19abab9d85917261">yaw_sensor</a>;</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>}</div>
</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span> </div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span><span class="comment">/*</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span><span class="comment">  return the bank angle needed to achieve tracking from the last</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span><span class="comment">  update_*() operation</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00079" data-start="{" data-end="}">
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#a452628329b2b1c6fd9db864997c71e62">   79</a></span>int32_t <a class="code hl_function" href="classAP__L1__Control.html#a452628329b2b1c6fd9db864997c71e62">AP_L1_Control::nav_roll_cd</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    <span class="keywordtype">float</span> ret;</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span><span class="comment">        formula can be obtained through equations of balanced spiral:</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span><span class="comment">        liftForce * cos(roll) = gravityForce * cos(pitch);</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span><span class="comment">        liftForce * sin(roll) = gravityForce * lateralAcceleration / gravityAcceleration; // as mass = gravityForce/gravityAcceleration</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span><span class="comment">        see issue 24319 [https://github.com/ArduPilot/ardupilot/issues/24319]</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span><span class="comment">        Multiplier 100.0f is for converting degrees to centidegrees</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span><span class="comment">        Made changes to avoid zero division as proposed by Andrew Tridgell: https://github.com/ArduPilot/ardupilot/pull/24331#discussion_r1267798397         </span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span><span class="comment">    */</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <span class="keywordtype">float</span> pitchLimL1 = <a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>(60); <span class="comment">// Suggestion: constraint may be modified to pitch limits if their absolute values are less than 90 degree and more than 60 degrees.</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="keywordtype">float</span> pitchL1 = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a992a48fcef2892301f1a41b795d2e8c2">get_pitch</a>(),-pitchLimL1,pitchLimL1);</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    ret = <a class="code hl_define" href="moduletest_8c.html#a903c4797a4c2860e3b9a6a978f98a44d">degrees</a>(atanf(<a class="code hl_variable" href="classAP__L1__Control.html#a62654b078823ca555139cf64403b5442">_latAccDem</a> * (1.0f/(<a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a> * cosf(pitchL1))))) * 100.0f;</div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    ret = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(ret, -9000, 9000);</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>}</div>
</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span> </div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span><span class="comment">/*</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span><span class="comment">  return the lateral acceleration needed to achieve tracking from the last</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span><span class="comment">  update_*() operation</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00101" data-start="{" data-end="}">
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#a34f586604201ae335fe7e3d06f5a1fc4">  101</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classAP__L1__Control.html#a34f586604201ae335fe7e3d06f5a1fc4">AP_L1_Control::lateral_acceleration</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__L1__Control.html#a62654b078823ca555139cf64403b5442">_latAccDem</a>;</div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>}</div>
</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span> </div>
<div class="foldopen" id="foldopen00106" data-start="{" data-end="}">
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#a763a962db3c7a199ee9d3fcd7f42e1ff">  106</a></span>int32_t <a class="code hl_function" href="classAP__L1__Control.html#a763a962db3c7a199ee9d3fcd7f42e1ff">AP_L1_Control::nav_bearing_cd</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="AP__Math_8cpp.html#a49de5d20e28222d3d8ac555a0a0a017d">wrap_180_cd</a>(<a class="code hl_define" href="definitions_8h.html#a96799f9de58a211f6b3bdc96c6e10669">RadiansToCentiDegrees</a>(<a class="code hl_variable" href="classAP__L1__Control.html#a97f55d73419c935ac0d63c29e288070f">_nav_bearing</a>));</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>}</div>
</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span> </div>
<div class="foldopen" id="foldopen00111" data-start="{" data-end="}">
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#a41a8ab916024b77959ed059dd12469a1">  111</a></span>int32_t <a class="code hl_function" href="classAP__L1__Control.html#a41a8ab916024b77959ed059dd12469a1">AP_L1_Control::bearing_error_cd</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="definitions_8h.html#a96799f9de58a211f6b3bdc96c6e10669">RadiansToCentiDegrees</a>(<a class="code hl_variable" href="classAP__L1__Control.html#a2f25d6cea6e98aaec7d7a191537da195">_bearing_error</a>);</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>}</div>
</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span> </div>
<div class="foldopen" id="foldopen00116" data-start="{" data-end="}">
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#a0c6970cc071d4843f0fe983003cc1410">  116</a></span>int32_t <a class="code hl_function" href="classAP__L1__Control.html#a0c6970cc071d4843f0fe983003cc1410">AP_L1_Control::target_bearing_cd</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="AP__Math_8cpp.html#a49de5d20e28222d3d8ac555a0a0a017d">wrap_180_cd</a>(<a class="code hl_variable" href="classAP__L1__Control.html#aebee3748e799d62f42ab2fbe8afadb9e">_target_bearing_cd</a>);</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>}</div>
</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="comment">/*</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span><span class="comment">  this is the turn distance assuming a 90 degree turn</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00124" data-start="{" data-end="}">
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#ab99bfec3eb21aa7b9dc1edef4cc60fc0">  124</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classAP__L1__Control.html#ab99bfec3eb21aa7b9dc1edef4cc60fc0">AP_L1_Control::turn_distance</a>(<span class="keywordtype">float</span> wp_radius)<span class="keyword"> const</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    wp_radius *= <a class="code hl_function" href="AP__Math_8h.html#a34f41fcf2bc527b1728ae04423dfba46">sq</a>(<a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a64786b58a1607ee420ed4f0696c755b6">get_EAS2TAS</a>());</div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="monocypher_8cpp.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(wp_radius, <a class="code hl_variable" href="classAP__L1__Control.html#a63005fc8c6746ac5282521d393cbb7f2">_L1_dist</a>);</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>}</div>
</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span> </div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span><span class="comment">/*</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span><span class="comment">  this approximates the turn distance for a given turn angle. If the</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span><span class="comment">  turn_angle is &gt; 90 then a 90 degree turn distance is used, otherwise</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span><span class="comment">  the turn distance is reduced linearly.</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span><span class="comment">  This function allows straight ahead mission legs to avoid thinking</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span><span class="comment">  they have reached the waypoint early, which makes things like camera</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span><span class="comment">  trigger and ball drop at exact positions under mission control much easier</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00138" data-start="{" data-end="}">
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#a82b5fb67863a95fc5de9451994e68ee0">  138</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classAP__L1__Control.html#ab99bfec3eb21aa7b9dc1edef4cc60fc0">AP_L1_Control::turn_distance</a>(<span class="keywordtype">float</span> wp_radius, <span class="keywordtype">float</span> turn_angle)<span class="keyword"> const</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="keywordtype">float</span> distance_90 = <a class="code hl_function" href="classAP__L1__Control.html#ab99bfec3eb21aa7b9dc1edef4cc60fc0">turn_distance</a>(wp_radius);</div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    turn_angle = fabsf(turn_angle);</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <span class="keywordflow">if</span> (turn_angle &gt;= 90) {</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>        <span class="keywordflow">return</span> distance_90;</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    }</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    <span class="keywordflow">return</span> distance_90 * turn_angle / 90.0f;</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>}</div>
</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span> </div>
<div class="foldopen" id="foldopen00148" data-start="{" data-end="}">
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#a2f30082f502f02b94d754c6bb735f70b">  148</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classAP__L1__Control.html#a2f30082f502f02b94d754c6bb735f70b">AP_L1_Control::loiter_radius</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> radius)<span class="keyword"> const</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    <span class="comment">// prevent an insane loiter bank limit</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    <span class="keywordtype">float</span> sanitized_bank_limit = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__L1__Control.html#a694095425105d37dd52aeb275925f6d7">_loiter_bank_limit</a>, 0.0f, 89.0f);</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <span class="keywordtype">float</span> lateral_accel_sea_level = tanf(<a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>(sanitized_bank_limit)) * <a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span> </div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <span class="keywordtype">float</span> nominal_velocity_sea_level = 0.0f;</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="classAP__L1__Control.html#a77d954f029e11939addead7ba4db982f">_tecs</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>        nominal_velocity_sea_level =  <a class="code hl_variable" href="classAP__L1__Control.html#a77d954f029e11939addead7ba4db982f">_tecs</a>-&gt;<a class="code hl_function" href="classAP__TECS.html#a22e88eb1a109a7b6e8ca2897556c184e">get_target_airspeed</a>();</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    }</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    <span class="keywordtype">float</span> eas2tas_sq = <a class="code hl_function" href="AP__Math_8h.html#a34f41fcf2bc527b1728ae04423dfba46">sq</a>(<a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a64786b58a1607ee420ed4f0696c755b6">get_EAS2TAS</a>());</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span> </div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(sanitized_bank_limit) || <a class="code hl_function" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(nominal_velocity_sea_level) ||</div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>        <a class="code hl_function" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(lateral_accel_sea_level)) {</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>        <span class="comment">// Missing a sane input for calculating the limit, or the user has</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>        <span class="comment">// requested a straight scaling with altitude. This will always vary</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>        <span class="comment">// with the current altitude, but will at least protect the airframe</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        <span class="keywordflow">return</span> radius * eas2tas_sq;</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>        <span class="keywordtype">float</span> sea_level_radius = <a class="code hl_function" href="AP__Math_8h.html#a34f41fcf2bc527b1728ae04423dfba46">sq</a>(nominal_velocity_sea_level) / lateral_accel_sea_level;</div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>        <span class="keywordflow">if</span> (sea_level_radius &gt; radius) {</div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>            <span class="comment">// If we&#39;ve told the plane that its sea level radius is unachievable fallback to</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>            <span class="comment">// straight altitude scaling</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>            <span class="keywordflow">return</span> radius * eas2tas_sq;</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>            <span class="comment">// select the requested radius, or the required altitude scale, whichever is safer</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>            <span class="keywordflow">return</span> <a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(sea_level_radius * eas2tas_sq, radius);</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>        }</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    }</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>}</div>
</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span> </div>
<div class="foldopen" id="foldopen00180" data-start="{" data-end="}">
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#a960b675b15f9850e1ba8d9c878e972bc">  180</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__L1__Control.html#a960b675b15f9850e1ba8d9c878e972bc">AP_L1_Control::reached_loiter_target</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>{</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__L1__Control.html#a39ccead440555e0e4abc52ab71e9fac8">_WPcircle</a>;</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>}</div>
</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span> </div>
<div class="foldopen" id="foldopen00190" data-start="{" data-end="}">
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#aaa154ba9c5957f90785c34ee554eca1c">  190</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__L1__Control.html#aaa154ba9c5957f90785c34ee554eca1c">AP_L1_Control::_prevent_indecision</a>(<span class="keywordtype">float</span> &amp;Nu)</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>{</div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> Nu_limit = 0.9f*<a class="code hl_define" href="definitions_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <span class="keywordflow">if</span> (fabsf(Nu) &gt; Nu_limit &amp;&amp;</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>        fabsf(<a class="code hl_variable" href="classAP__L1__Control.html#a67c543ed97304d5d11433f83d4f53280">_last_Nu</a>) &gt; Nu_limit &amp;&amp;</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>        labs(<a class="code hl_function" href="AP__Math_8cpp.html#a49de5d20e28222d3d8ac555a0a0a017d">wrap_180_cd</a>(<a class="code hl_variable" href="classAP__L1__Control.html#aebee3748e799d62f42ab2fbe8afadb9e">_target_bearing_cd</a> - <a class="code hl_function" href="classAP__L1__Control.html#ad21403826bfd0deab208ae5560feaa7c">get_yaw_sensor</a>())) &gt; 12000 &amp;&amp;</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        Nu * <a class="code hl_variable" href="classAP__L1__Control.html#a67c543ed97304d5d11433f83d4f53280">_last_Nu</a> &lt; 0.0f) {</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>        <span class="comment">// we are moving away from the target waypoint and pointing</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>        <span class="comment">// away from the waypoint (not flying backwards). The sign</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>        <span class="comment">// of Nu has also changed, which means we are</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>        <span class="comment">// oscillating in our decision about which way to go</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>        Nu = <a class="code hl_variable" href="classAP__L1__Control.html#a67c543ed97304d5d11433f83d4f53280">_last_Nu</a>;</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    }</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>}</div>
</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span><span class="comment">// update L1 control for waypoint navigation</span></div>
<div class="foldopen" id="foldopen00206" data-start="{" data-end="}">
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#ac7d3691acff577042e18f45c6cbba40b">  206</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__L1__Control.html#ac7d3691acff577042e18f45c6cbba40b">AP_L1_Control::update_waypoint</a>(<span class="keyword">const</span> <a class="code hl_class" href="classLocation.html">Location</a> &amp;prev_WP, <span class="keyword">const</span> <a class="code hl_class" href="classLocation.html">Location</a> &amp;next_WP, <span class="keywordtype">float</span> dist_min)</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>{</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span> </div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    <a class="code hl_class" href="classLocation.html">Location</a> _current_loc;</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>    <span class="keywordtype">float</span> Nu;</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <span class="keywordtype">float</span> xtrackVel;</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    <span class="keywordtype">float</span> ltrackVel;</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span> </div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    uint32_t now = <a class="code hl_function" href="namespaceAP__HAL.html#a8293355e35887733b1fd151aef08a787">AP_HAL::micros</a>();</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    <span class="keywordtype">float</span> dt = (now - <a class="code hl_variable" href="classAP__L1__Control.html#a79bf5c44d2e7cd540ff846870593307f">_last_update_waypoint_us</a>) * 1.0e-6f;</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    <span class="keywordflow">if</span> (dt &gt; 1) {</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>        <span class="comment">// controller hasn&#39;t been called for an extended period of</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>        <span class="comment">// time.  Reinitialise it.</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>        <a class="code hl_variable" href="classAP__L1__Control.html#a74021d6b9cf1c7df17624b0a28ae0d7c">_L1_xtrack_i</a> = 0.0f;</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    }</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <span class="keywordflow">if</span> (dt &gt; 0.1) {</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>        dt = 0.1;</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    }</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a79bf5c44d2e7cd540ff846870593307f">_last_update_waypoint_us</a> = now;</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span> </div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>    <span class="comment">// Calculate L1 gain required for specified damping</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    <span class="keywordtype">float</span> K_L1 = 4.0f * <a class="code hl_variable" href="classAP__L1__Control.html#a5f64f08c05c9152ff92202150b9ce05e">_L1_damping</a> * <a class="code hl_variable" href="classAP__L1__Control.html#a5f64f08c05c9152ff92202150b9ce05e">_L1_damping</a>;</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span> </div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    <span class="comment">// Get current position and velocity</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a0b6672c6f1c6303a804bc0a5e02ec1af">get_location</a>(_current_loc) == <span class="keyword">false</span>) {</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>        <span class="comment">// if no GPS loc available, maintain last nav/target_bearing</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>        <a class="code hl_variable" href="classAP__L1__Control.html#a961307861e61bcbef3147295ccba450b">_data_is_stale</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    }</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span> </div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    <a class="code hl_class" href="structVector2.html">Vector2f</a> _groundspeed_vector = <a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a6a5554b1eadd5417a4d1c60c5f0cc6a5">groundspeed_vector</a>();</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span> </div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    <span class="comment">// update _target_bearing_cd</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    <a class="code hl_variable" href="classAP__L1__Control.html#aebee3748e799d62f42ab2fbe8afadb9e">_target_bearing_cd</a> = _current_loc.<a class="code hl_function" href="classLocation.html#a2e43145b0552a97551481c473d491a8a">get_bearing_to</a>(next_WP);</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <span class="comment">//Calculate groundspeed</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    <span class="keywordtype">float</span> groundSpeed = _groundspeed_vector.<a class="code hl_function" href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">length</a>();</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span> </div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    <span class="comment">// check if we are moving in the direction of the front of the vehicle</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> moving_forwards = fabsf(<a class="code hl_function" href="AP__Math_8cpp.html#ae77517d032abb1e1b525d2b43ff9a27d">wrap_PI</a>(_groundspeed_vector.<a class="code hl_function" href="structVector2.html#aa5b16091858399424b79f7a580e4284e">angle</a>() - <a class="code hl_function" href="classAP__L1__Control.html#a16c75c040fec7cc33e803aa49e8e632f">get_yaw</a>())) &lt; <a class="code hl_define" href="definitions_8h.html#a958e4508ed28ee5cc04249144312c15f">M_PI_2</a>;</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span> </div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>    <span class="keywordflow">if</span> (groundSpeed &lt; 0.1f || !moving_forwards) {</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>        <span class="comment">// use a small ground speed vector in the right direction,</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>        <span class="comment">// allowing us to use the compass heading at zero GPS velocity</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>        groundSpeed = 0.1f;</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>        _groundspeed_vector = <a class="code hl_typedef" href="vector2_8h.html#a9f3739462b0605dcb64299fa289b6afe">Vector2f</a>(cosf(<a class="code hl_function" href="classAP__L1__Control.html#a16c75c040fec7cc33e803aa49e8e632f">get_yaw</a>()), sinf(<a class="code hl_function" href="classAP__L1__Control.html#a16c75c040fec7cc33e803aa49e8e632f">get_yaw</a>())) * groundSpeed;</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>    }</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <span class="comment">// Calculate time varying control parameters</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    <span class="comment">// Calculate the L1 length required for specified period</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    <span class="comment">// 0.3183099 = 1/1/pipi</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a63005fc8c6746ac5282521d393cbb7f2">_L1_dist</a> = <a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(0.3183099f * <a class="code hl_variable" href="classAP__L1__Control.html#a5f64f08c05c9152ff92202150b9ce05e">_L1_damping</a> * <a class="code hl_variable" href="classAP__L1__Control.html#a56dece11a108acd6b733efb497a614f5">_L1_period</a> * groundSpeed, dist_min);</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    <span class="comment">// Calculate the NE position of WP B relative to WP A</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    <a class="code hl_class" href="structVector2.html">Vector2f</a> AB = prev_WP.<a class="code hl_function" href="classLocation.html#af597420e2ec20fc794ca3d5447fd36ba">get_distance_NE</a>(next_WP);</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <span class="keywordtype">float</span> AB_length = AB.<a class="code hl_function" href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">length</a>();</div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span> </div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    <span class="comment">// Check for AB zero length and track directly to the destination</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    <span class="comment">// if too small</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>    <span class="keywordflow">if</span> (AB.<a class="code hl_function" href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">length</a>() &lt; 1.0e-6f) {</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>        AB = _current_loc.<a class="code hl_function" href="classLocation.html#af597420e2ec20fc794ca3d5447fd36ba">get_distance_NE</a>(next_WP);</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>        <span class="keywordflow">if</span> (AB.<a class="code hl_function" href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">length</a>() &lt; 1.0e-6f) {</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>            AB = <a class="code hl_typedef" href="vector2_8h.html#a9f3739462b0605dcb64299fa289b6afe">Vector2f</a>(cosf(<a class="code hl_function" href="classAP__L1__Control.html#a16c75c040fec7cc33e803aa49e8e632f">get_yaw</a>()), sinf(<a class="code hl_function" href="classAP__L1__Control.html#a16c75c040fec7cc33e803aa49e8e632f">get_yaw</a>()));</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>        }</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    }</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    AB.<a class="code hl_function" href="structVector2.html#ace2a626eaa79412e2946216e9c3e63c6">normalize</a>();</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span> </div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    <span class="comment">// Calculate the NE position of the aircraft relative to WP A</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    <span class="keyword">const</span> <a class="code hl_class" href="structVector2.html">Vector2f</a> A_air = prev_WP.<a class="code hl_function" href="classLocation.html#af597420e2ec20fc794ca3d5447fd36ba">get_distance_NE</a>(_current_loc);</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span> </div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    <span class="comment">// calculate distance to target track, for reporting</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a077f59318a8244068f1ba9a19831225a">_crosstrack_error</a> = A_air % AB;</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span> </div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    <span class="comment">//Determine if the aircraft is behind a +-135 degree degree arc centred on WP A</span></div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>    <span class="comment">//and further than L1 distance from WP A. Then use WP A as the L1 reference point</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>    <span class="comment">//Otherwise do normal L1 guidance</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>    <span class="keywordtype">float</span> WP_A_dist = A_air.<a class="code hl_function" href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">length</a>();</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    <span class="keywordtype">float</span> alongTrackDist = A_air * AB;</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>    <span class="keywordflow">if</span> (WP_A_dist &gt; <a class="code hl_variable" href="classAP__L1__Control.html#a63005fc8c6746ac5282521d393cbb7f2">_L1_dist</a> &amp;&amp; alongTrackDist/<a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(WP_A_dist, 1.0f) &lt; -0.7071f)</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    {</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>        <span class="comment">//Calc Nu to fly To WP A</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>        <a class="code hl_class" href="structVector2.html">Vector2f</a> A_air_unit = (A_air).normalized(); <span class="comment">// Unit vector from WP A to aircraft</span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>        xtrackVel = _groundspeed_vector % (-A_air_unit); <span class="comment">// Velocity across line</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>        ltrackVel = _groundspeed_vector * (-A_air_unit); <span class="comment">// Velocity along line</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>        Nu = atan2f(xtrackVel,ltrackVel);</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>        <a class="code hl_variable" href="classAP__L1__Control.html#a97f55d73419c935ac0d63c29e288070f">_nav_bearing</a> = atan2f(-A_air_unit.<a class="code hl_variable" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> , -A_air_unit.<a class="code hl_variable" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>); <span class="comment">// bearing (radians) from AC to L1 point</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (alongTrackDist &gt; AB_length + groundSpeed*3) {</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>        <span class="comment">// we have passed point B by 3 seconds. Head towards B</span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>        <span class="comment">// Calc Nu to fly To WP B</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>        <span class="keyword">const</span> <a class="code hl_class" href="structVector2.html">Vector2f</a> B_air = next_WP.<a class="code hl_function" href="classLocation.html#af597420e2ec20fc794ca3d5447fd36ba">get_distance_NE</a>(_current_loc);</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>        <a class="code hl_class" href="structVector2.html">Vector2f</a> B_air_unit = (B_air).normalized(); <span class="comment">// Unit vector from WP B to aircraft</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>        xtrackVel = _groundspeed_vector % (-B_air_unit); <span class="comment">// Velocity across line</span></div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>        ltrackVel = _groundspeed_vector * (-B_air_unit); <span class="comment">// Velocity along line</span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>        Nu = atan2f(xtrackVel,ltrackVel);</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>        <a class="code hl_variable" href="classAP__L1__Control.html#a97f55d73419c935ac0d63c29e288070f">_nav_bearing</a> = atan2f(-B_air_unit.<a class="code hl_variable" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> , -B_air_unit.<a class="code hl_variable" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>); <span class="comment">// bearing (radians) from AC to L1 point</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>    } <span class="keywordflow">else</span> { <span class="comment">//Calc Nu to fly along AB line</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span> </div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>        <span class="comment">//Calculate Nu2 angle (angle of velocity vector relative to line connecting waypoints)</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>        xtrackVel = _groundspeed_vector % AB; <span class="comment">// Velocity cross track</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>        ltrackVel = _groundspeed_vector * AB; <span class="comment">// Velocity along track</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>        <span class="keywordtype">float</span> Nu2 = atan2f(xtrackVel,ltrackVel);</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>        <span class="comment">//Calculate Nu1 angle (Angle to L1 reference point)</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>        <span class="keywordtype">float</span> sine_Nu1 = <a class="code hl_variable" href="classAP__L1__Control.html#a077f59318a8244068f1ba9a19831225a">_crosstrack_error</a>/<a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code hl_variable" href="classAP__L1__Control.html#a63005fc8c6746ac5282521d393cbb7f2">_L1_dist</a>, 0.1f);</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>        <span class="comment">//Limit sine of Nu1 to provide a controlled track capture angle of 45 deg</span></div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>        sine_Nu1 = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(sine_Nu1, -0.7071f, 0.7071f);</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>        <span class="keywordtype">float</span> Nu1 = asinf(sine_Nu1);</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span> </div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>        <span class="comment">// compute integral error component to converge to a crosstrack of zero when traveling</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>        <span class="comment">// straight but reset it when disabled or if it changes. That allows for much easier</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>        <span class="comment">// tuning by having it re-converge each time it changes.</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__L1__Control.html#a45e259577f46c8cdfe5f52bece257019">_L1_xtrack_i_gain</a> &lt;= 0 || !<a class="code hl_function" href="AP__Math_8cpp.html#a74db690fa0d764d7e0900a9c97f629b2">is_equal</a>(<a class="code hl_variable" href="classAP__L1__Control.html#a45e259577f46c8cdfe5f52bece257019">_L1_xtrack_i_gain</a>.get(), <a class="code hl_variable" href="classAP__L1__Control.html#a725b90895d4de350044edbe07ed38613">_L1_xtrack_i_gain_prev</a>)) {</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>            <a class="code hl_variable" href="classAP__L1__Control.html#a74021d6b9cf1c7df17624b0a28ae0d7c">_L1_xtrack_i</a> = 0;</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>            <a class="code hl_variable" href="classAP__L1__Control.html#a725b90895d4de350044edbe07ed38613">_L1_xtrack_i_gain_prev</a> = <a class="code hl_variable" href="classAP__L1__Control.html#a45e259577f46c8cdfe5f52bece257019">_L1_xtrack_i_gain</a>;</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fabsf(Nu1) &lt; <a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>(5)) {</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>            <a class="code hl_variable" href="classAP__L1__Control.html#a74021d6b9cf1c7df17624b0a28ae0d7c">_L1_xtrack_i</a> += Nu1 * <a class="code hl_variable" href="classAP__L1__Control.html#a45e259577f46c8cdfe5f52bece257019">_L1_xtrack_i_gain</a> * dt;</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span> </div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>            <span class="comment">// an AHRS_TRIM_X=0.1 will drift to about 0.08 so 0.1 is a good worst-case to clip at</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>            <a class="code hl_variable" href="classAP__L1__Control.html#a74021d6b9cf1c7df17624b0a28ae0d7c">_L1_xtrack_i</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__L1__Control.html#a74021d6b9cf1c7df17624b0a28ae0d7c">_L1_xtrack_i</a>, -0.1f, 0.1f);</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>        }</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span> </div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>        <span class="comment">// to converge to zero we must push Nu1 harder</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>        Nu1 += <a class="code hl_variable" href="classAP__L1__Control.html#a74021d6b9cf1c7df17624b0a28ae0d7c">_L1_xtrack_i</a>;</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span> </div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>        Nu = Nu1 + Nu2;</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>        <a class="code hl_variable" href="classAP__L1__Control.html#a97f55d73419c935ac0d63c29e288070f">_nav_bearing</a> = <a class="code hl_function" href="AP__Math_8cpp.html#ae77517d032abb1e1b525d2b43ff9a27d">wrap_PI</a>(atan2f(AB.y, AB.x) + Nu1);   <span class="comment">// bearing (radians) from AC to L1 point</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    }</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span> </div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    <a class="code hl_function" href="classAP__L1__Control.html#aaa154ba9c5957f90785c34ee554eca1c">_prevent_indecision</a>(Nu);</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a67c543ed97304d5d11433f83d4f53280">_last_Nu</a> = Nu;</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span> </div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>    <span class="comment">//Limit Nu to +-(pi/2)</span></div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>    Nu = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(Nu, -1.5708f, +1.5708f);</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a62654b078823ca555139cf64403b5442">_latAccDem</a> = K_L1 * groundSpeed * groundSpeed / <a class="code hl_variable" href="classAP__L1__Control.html#a63005fc8c6746ac5282521d393cbb7f2">_L1_dist</a> * sinf(Nu);</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span> </div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>    <span class="comment">// Waypoint capture status is always false during waypoint following</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a39ccead440555e0e4abc52ab71e9fac8">_WPcircle</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span> </div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a2f25d6cea6e98aaec7d7a191537da195">_bearing_error</a> = Nu; <span class="comment">// bearing error angle (radians), +ve to left of track</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span> </div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a961307861e61bcbef3147295ccba450b">_data_is_stale</a> = <span class="keyword">false</span>; <span class="comment">// status are correctly updated with current waypoint data</span></div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>}</div>
</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span> </div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span><span class="comment">// update L1 control for loitering</span></div>
<div class="foldopen" id="foldopen00349" data-start="{" data-end="}">
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#a1f7ce18571ea0277edde860cd646779b">  349</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__L1__Control.html#a1f7ce18571ea0277edde860cd646779b">AP_L1_Control::update_loiter</a>(<span class="keyword">const</span> <a class="code hl_class" href="classLocation.html">Location</a> &amp;center_WP, <span class="keywordtype">float</span> radius, int8_t loiter_direction)</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>{</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>    <a class="code hl_class" href="classLocation.html">Location</a> _current_loc;</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span> </div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    <span class="comment">// scale loiter radius with square of EAS2TAS to allow us to stay</span></div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    <span class="comment">// stable at high altitude</span></div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    radius = <a class="code hl_function" href="classAP__L1__Control.html#a2f30082f502f02b94d754c6bb735f70b">loiter_radius</a>(fabsf(radius));</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span> </div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    <span class="comment">// Calculate guidance gains used by PD loop (used during circle tracking)</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>    <span class="keywordtype">float</span> omega = (6.2832f / <a class="code hl_variable" href="classAP__L1__Control.html#a56dece11a108acd6b733efb497a614f5">_L1_period</a>);</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    <span class="keywordtype">float</span> Kx = omega * omega;</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>    <span class="keywordtype">float</span> Kv = 2.0f * <a class="code hl_variable" href="classAP__L1__Control.html#a5f64f08c05c9152ff92202150b9ce05e">_L1_damping</a> * omega;</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span> </div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    <span class="comment">// Calculate L1 gain required for specified damping (used during waypoint capture)</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>    <span class="keywordtype">float</span> K_L1 = 4.0f * <a class="code hl_variable" href="classAP__L1__Control.html#a5f64f08c05c9152ff92202150b9ce05e">_L1_damping</a> * <a class="code hl_variable" href="classAP__L1__Control.html#a5f64f08c05c9152ff92202150b9ce05e">_L1_damping</a>;</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span> </div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    <span class="comment">//Get current position and velocity</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a0b6672c6f1c6303a804bc0a5e02ec1af">get_location</a>(_current_loc) == <span class="keyword">false</span>) {</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>        <span class="comment">// if no GPS loc available, maintain last nav/target_bearing</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>        <a class="code hl_variable" href="classAP__L1__Control.html#a961307861e61bcbef3147295ccba450b">_data_is_stale</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>    }</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span> </div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>    <a class="code hl_class" href="structVector2.html">Vector2f</a> _groundspeed_vector = <a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a6a5554b1eadd5417a4d1c60c5f0cc6a5">groundspeed_vector</a>();</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span> </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>    <span class="comment">//Calculate groundspeed</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>    <span class="keywordtype">float</span> groundSpeed = <a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(_groundspeed_vector.<a class="code hl_function" href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">length</a>() , 1.0f);</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span> </div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span> </div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>    <span class="comment">// update _target_bearing_cd</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>    <a class="code hl_variable" href="classAP__L1__Control.html#aebee3748e799d62f42ab2fbe8afadb9e">_target_bearing_cd</a> = _current_loc.<a class="code hl_function" href="classLocation.html#a2e43145b0552a97551481c473d491a8a">get_bearing_to</a>(center_WP);</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span> </div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span> </div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>    <span class="comment">// Calculate time varying control parameters</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    <span class="comment">// Calculate the L1 length required for specified period</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    <span class="comment">// 0.3183099 = 1/pi</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a63005fc8c6746ac5282521d393cbb7f2">_L1_dist</a> = 0.3183099f * <a class="code hl_variable" href="classAP__L1__Control.html#a5f64f08c05c9152ff92202150b9ce05e">_L1_damping</a> * <a class="code hl_variable" href="classAP__L1__Control.html#a56dece11a108acd6b733efb497a614f5">_L1_period</a> * groundSpeed;</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span> </div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <span class="comment">//Calculate the NE position of the aircraft relative to WP A</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    <span class="keyword">const</span> <a class="code hl_class" href="structVector2.html">Vector2f</a> A_air = center_WP.<a class="code hl_function" href="classLocation.html#af597420e2ec20fc794ca3d5447fd36ba">get_distance_NE</a>(_current_loc);</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span> </div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <span class="comment">// Calculate the unit vector from WP A to aircraft</span></div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    <span class="comment">// protect against being on the waypoint and having zero velocity</span></div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>    <span class="comment">// if too close to the waypoint, use the velocity vector</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    <span class="comment">// if the velocity vector is too small, use the heading vector</span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>    <a class="code hl_class" href="structVector2.html">Vector2f</a> A_air_unit;</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    <span class="keywordflow">if</span> (A_air.<a class="code hl_function" href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">length</a>() &gt; 0.1f) {</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>        A_air_unit = A_air.<a class="code hl_function" href="structVector2.html#aa78ff4778f55bf9c1ba9a10830fc0b89">normalized</a>();</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>        <span class="keywordflow">if</span> (_groundspeed_vector.<a class="code hl_function" href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">length</a>() &lt; 0.1f) {</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>            A_air_unit = <a class="code hl_typedef" href="vector2_8h.html#a9f3739462b0605dcb64299fa289b6afe">Vector2f</a>(cosf(<a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a5d84cbacfad4577e8de788aeba05f49c">get_yaw</a>()), sinf(<a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a5d84cbacfad4577e8de788aeba05f49c">get_yaw</a>()));</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>            A_air_unit = _groundspeed_vector.<a class="code hl_function" href="structVector2.html#aa78ff4778f55bf9c1ba9a10830fc0b89">normalized</a>();</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>        }</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>    }</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span> </div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    <span class="comment">//Calculate Nu to capture center_WP</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    <span class="keywordtype">float</span> xtrackVelCap = A_air_unit % _groundspeed_vector; <span class="comment">// Velocity across line - perpendicular to radial inbound to WP</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    <span class="keywordtype">float</span> ltrackVelCap = - (_groundspeed_vector * A_air_unit); <span class="comment">// Velocity along line - radial inbound to WP</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>    <span class="keywordtype">float</span> Nu = atan2f(xtrackVelCap,ltrackVelCap);</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span> </div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>    <a class="code hl_function" href="classAP__L1__Control.html#aaa154ba9c5957f90785c34ee554eca1c">_prevent_indecision</a>(Nu);</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a67c543ed97304d5d11433f83d4f53280">_last_Nu</a> = Nu;</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span> </div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    Nu = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(Nu, -<a class="code hl_define" href="definitions_8h.html#a958e4508ed28ee5cc04249144312c15f">M_PI_2</a>, <a class="code hl_define" href="definitions_8h.html#a958e4508ed28ee5cc04249144312c15f">M_PI_2</a>); <span class="comment">//Limit Nu to +- Pi/2</span></div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span> </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    <span class="comment">//Calculate lat accln demand to capture center_WP (use L1 guidance law)</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>    <span class="keywordtype">float</span> latAccDemCap = K_L1 * groundSpeed * groundSpeed / <a class="code hl_variable" href="classAP__L1__Control.html#a63005fc8c6746ac5282521d393cbb7f2">_L1_dist</a> * sinf(Nu);</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span> </div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>    <span class="comment">//Calculate radial position and velocity errors</span></div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>    <span class="keywordtype">float</span> xtrackVelCirc = -ltrackVelCap; <span class="comment">// Radial outbound velocity - reuse previous radial inbound velocity</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>    <span class="keywordtype">float</span> xtrackErrCirc = A_air.<a class="code hl_function" href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">length</a>() - radius; <span class="comment">// Radial distance from the loiter circle</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span> </div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>    <span class="comment">// keep crosstrack error for reporting</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a077f59318a8244068f1ba9a19831225a">_crosstrack_error</a> = xtrackErrCirc;</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span> </div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    <span class="comment">//Calculate PD control correction to circle waypoint_ahrs.roll</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    <span class="keywordtype">float</span> latAccDemCircPD = (xtrackErrCirc * Kx + xtrackVelCirc * Kv);</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span> </div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>    <span class="comment">//Calculate tangential velocity</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>    <span class="keywordtype">float</span> velTangent = xtrackVelCap * float(loiter_direction);</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span> </div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>    <span class="comment">//Prevent PD demand from turning the wrong way by limiting the command when flying the wrong way</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>    <span class="keywordflow">if</span> (ltrackVelCap &lt; 0.0f &amp;&amp; velTangent &lt; 0.0f) {</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>        latAccDemCircPD =  <a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(latAccDemCircPD, 0.0f);</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    }</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span> </div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>    <span class="comment">// Calculate centripetal acceleration demand</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>    <span class="keywordtype">float</span> latAccDemCircCtr = velTangent * velTangent / <a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>((0.5f * radius), (radius + xtrackErrCirc));</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span> </div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>    <span class="comment">//Sum PD control and centripetal acceleration to calculate lateral manoeuvre demand</span></div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>    <span class="keywordtype">float</span> latAccDemCirc = loiter_direction * (latAccDemCircPD + latAccDemCircCtr);</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span> </div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    <span class="comment">// Perform switchover between &#39;capture&#39; and &#39;circle&#39; modes at the</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    <span class="comment">// point where the commands cross over to achieve a seamless transfer</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>    <span class="comment">// Only fly &#39;capture&#39; mode if outside the circle</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>    <span class="keywordflow">if</span> (xtrackErrCirc &gt; 0.0f &amp;&amp; loiter_direction * latAccDemCap &lt; loiter_direction * latAccDemCirc) {</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>        <a class="code hl_variable" href="classAP__L1__Control.html#a62654b078823ca555139cf64403b5442">_latAccDem</a> = latAccDemCap;</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>        <a class="code hl_variable" href="classAP__L1__Control.html#a39ccead440555e0e4abc52ab71e9fac8">_WPcircle</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>        <a class="code hl_variable" href="classAP__L1__Control.html#a2f25d6cea6e98aaec7d7a191537da195">_bearing_error</a> = Nu; <span class="comment">// angle between demanded and achieved velocity vector, +ve to left of track</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>        <a class="code hl_variable" href="classAP__L1__Control.html#a97f55d73419c935ac0d63c29e288070f">_nav_bearing</a> = atan2f(-A_air_unit.<a class="code hl_variable" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> , -A_air_unit.<a class="code hl_variable" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>); <span class="comment">// bearing (radians) from AC to L1 point</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>        <a class="code hl_variable" href="classAP__L1__Control.html#a62654b078823ca555139cf64403b5442">_latAccDem</a> = latAccDemCirc;</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>        <a class="code hl_variable" href="classAP__L1__Control.html#a39ccead440555e0e4abc52ab71e9fac8">_WPcircle</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>        <a class="code hl_variable" href="classAP__L1__Control.html#a2f25d6cea6e98aaec7d7a191537da195">_bearing_error</a> = 0.0f; <span class="comment">// bearing error (radians), +ve to left of track</span></div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>        <a class="code hl_variable" href="classAP__L1__Control.html#a97f55d73419c935ac0d63c29e288070f">_nav_bearing</a> = atan2f(-A_air_unit.<a class="code hl_variable" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a> , -A_air_unit.<a class="code hl_variable" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>); <span class="comment">// bearing (radians)from AC to L1 point</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>    }</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span> </div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a961307861e61bcbef3147295ccba450b">_data_is_stale</a> = <span class="keyword">false</span>; <span class="comment">// status are correctly updated with current waypoint data</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>}</div>
</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span> </div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span> </div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span><span class="comment">// update L1 control for heading hold navigation</span></div>
<div class="foldopen" id="foldopen00462" data-start="{" data-end="}">
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#a1a7687ed13c74f535087c984968a92a3">  462</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__L1__Control.html#a1a7687ed13c74f535087c984968a92a3">AP_L1_Control::update_heading_hold</a>(int32_t navigation_heading_cd)</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>{</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>    <span class="comment">// Calculate normalised frequency for tracking loop</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> omegaA = 4.4428f/<a class="code hl_variable" href="classAP__L1__Control.html#a56dece11a108acd6b733efb497a614f5">_L1_period</a>; <span class="comment">// sqrt(2)*pi/period</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>    <span class="comment">// Calculate additional damping gain</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span> </div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>    int32_t Nu_cd;</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>    <span class="keywordtype">float</span> Nu;</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span> </div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>    <span class="comment">// copy to _target_bearing_cd and _nav_bearing</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>    <a class="code hl_variable" href="classAP__L1__Control.html#aebee3748e799d62f42ab2fbe8afadb9e">_target_bearing_cd</a> = <a class="code hl_function" href="AP__Math_8cpp.html#a49de5d20e28222d3d8ac555a0a0a017d">wrap_180_cd</a>(navigation_heading_cd);</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a97f55d73419c935ac0d63c29e288070f">_nav_bearing</a> = <a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>(navigation_heading_cd * 0.01f);</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span> </div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>    Nu_cd = <a class="code hl_variable" href="classAP__L1__Control.html#aebee3748e799d62f42ab2fbe8afadb9e">_target_bearing_cd</a> - <a class="code hl_function" href="AP__Math_8cpp.html#a49de5d20e28222d3d8ac555a0a0a017d">wrap_180_cd</a>(<a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_variable" href="classAP__AHRS.html#a8a160130dd99016a19abab9d85917261">yaw_sensor</a>);</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>    Nu_cd = <a class="code hl_function" href="AP__Math_8cpp.html#a49de5d20e28222d3d8ac555a0a0a017d">wrap_180_cd</a>(Nu_cd);</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>    Nu = <a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>(Nu_cd * 0.01f);</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span> </div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>    <a class="code hl_class" href="structVector2.html">Vector2f</a> _groundspeed_vector = <a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a6a5554b1eadd5417a4d1c60c5f0cc6a5">groundspeed_vector</a>();</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span> </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    <span class="comment">//Calculate groundspeed</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    <span class="keywordtype">float</span> groundSpeed = _groundspeed_vector.<a class="code hl_function" href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">length</a>();</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span> </div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>    <span class="comment">// Calculate time varying control parameters</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a63005fc8c6746ac5282521d393cbb7f2">_L1_dist</a> = groundSpeed / omegaA; <span class="comment">// L1 distance is adjusted to maintain a constant tracking loop frequency</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>    <span class="keywordtype">float</span> VomegaA = groundSpeed * omegaA;</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span> </div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    <span class="comment">// Waypoint capture status is always false during heading hold</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a39ccead440555e0e4abc52ab71e9fac8">_WPcircle</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span> </div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a077f59318a8244068f1ba9a19831225a">_crosstrack_error</a> = 0;</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span> </div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a2f25d6cea6e98aaec7d7a191537da195">_bearing_error</a> = Nu; <span class="comment">// bearing error angle (radians), +ve to left of track</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span> </div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>    <span class="comment">// Limit Nu to +-pi</span></div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>    Nu = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(Nu, -<a class="code hl_define" href="definitions_8h.html#a958e4508ed28ee5cc04249144312c15f">M_PI_2</a>, <a class="code hl_define" href="definitions_8h.html#a958e4508ed28ee5cc04249144312c15f">M_PI_2</a>);</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a62654b078823ca555139cf64403b5442">_latAccDem</a> = 2.0f*sinf(Nu)*VomegaA;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span> </div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a961307861e61bcbef3147295ccba450b">_data_is_stale</a> = <span class="keyword">false</span>; <span class="comment">// status are correctly updated with current waypoint data</span></div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>}</div>
</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span> </div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span><span class="comment">// update L1 control for level flight on current heading</span></div>
<div class="foldopen" id="foldopen00503" data-start="{" data-end="}">
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno"><a class="line" href="classAP__L1__Control.html#a5cacc55705a0a4e353f8599e6a0d1910">  503</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__L1__Control.html#a5cacc55705a0a4e353f8599e6a0d1910">AP_L1_Control::update_level_flight</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>{</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>    <span class="comment">// copy to _target_bearing_cd and _nav_bearing</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>    <a class="code hl_variable" href="classAP__L1__Control.html#aebee3748e799d62f42ab2fbe8afadb9e">_target_bearing_cd</a> = <a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_variable" href="classAP__AHRS.html#a8a160130dd99016a19abab9d85917261">yaw_sensor</a>;</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a97f55d73419c935ac0d63c29e288070f">_nav_bearing</a> = <a class="code hl_variable" href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a5d84cbacfad4577e8de788aeba05f49c">get_yaw</a>();</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a2f25d6cea6e98aaec7d7a191537da195">_bearing_error</a> = 0;</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a077f59318a8244068f1ba9a19831225a">_crosstrack_error</a> = 0;</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>    <span class="comment">// Waypoint capture status is always false during heading hold</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a39ccead440555e0e4abc52ab71e9fac8">_WPcircle</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span> </div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a62654b078823ca555139cf64403b5442">_latAccDem</a> = 0;</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span> </div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>    <a class="code hl_variable" href="classAP__L1__Control.html#a961307861e61bcbef3147295ccba450b">_data_is_stale</a> = <span class="keyword">false</span>; <span class="comment">// status are correctly updated with current waypoint data</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>}</div>
</div>
<div class="ttc" id="aAP__HAL_8h_html"><div class="ttname"><a href="AP__HAL_8h.html">AP_HAL.h</a></div></div>
<div class="ttc" id="aAP__L1__Control_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="AP__L1__Control_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition</b> <a href="AC__PID__test_8cpp_source.html#l00021">AC_PID_test.cpp:21</a></div></div>
<div class="ttc" id="aAP__L1__Control_8h_html"><div class="ttname"><a href="AP__L1__Control_8h.html">AP_L1_Control.h</a></div><div class="ttdoc">L1 Control algorithm. This is a instance of an AP_Navigation class.</div></div>
<div class="ttc" id="aAP__Math_8cpp_html_a49de5d20e28222d3d8ac555a0a0a017d"><div class="ttname"><a href="AP__Math_8cpp.html#a49de5d20e28222d3d8ac555a0a0a017d">wrap_180_cd</a></div><div class="ttdeci">T wrap_180_cd(const T angle)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8cpp_source.html#l00157">AP_Math.cpp:157</a></div></div>
<div class="ttc" id="aAP__Math_8cpp_html_a74db690fa0d764d7e0900a9c97f629b2"><div class="ttname"><a href="AP__Math_8cpp.html#a74db690fa0d764d7e0900a9c97f629b2">is_equal</a></div><div class="ttdeci">std::enable_if&lt; std::is_integral&lt; typenamestd::common_type&lt; Arithmetic1, Arithmetic2 &gt;::type &gt;::value, bool &gt;::type is_equal(const Arithmetic1 v_1, const Arithmetic2 v_2)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8cpp_source.html#l00014">AP_Math.cpp:14</a></div></div>
<div class="ttc" id="aAP__Math_8cpp_html_ae77517d032abb1e1b525d2b43ff9a27d"><div class="ttname"><a href="AP__Math_8cpp.html#ae77517d032abb1e1b525d2b43ff9a27d">wrap_PI</a></div><div class="ttdeci">ftype wrap_PI(const ftype radian)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8cpp_source.html#l00248">AP_Math.cpp:248</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a2a12cce483e9b870da70d30406d82c60"><div class="ttname"><a href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a></div><div class="ttdeci">bool is_zero(const T fVal1)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00053">AP_Math.h:53</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a34f41fcf2bc527b1728ae04423dfba46"><div class="ttname"><a href="AP__Math_8h.html#a34f41fcf2bc527b1728ae04423dfba46">sq</a></div><div class="ttdeci">ftype sq(const T val)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00225">AP_Math.h:225</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a49ad7fa2fa2e3d8aa75e8e0ec3f83b99"><div class="ttname"><a href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a></div><div class="ttdeci">static constexpr ftype radians(ftype deg)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00213">AP_Math.h:213</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a5256308fd38a7098b8f95607aa56888f"><div class="ttname"><a href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a></div><div class="ttdeci">#define constrain_float(amt, low, high)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00174">AP_Math.h:174</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00163">AP_Param.h:163</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a78a408c84f2a1bafde256ac650142e4d"><div class="ttname"><a href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, clazz, element, def)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00145">AP_Param.h:145</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a0b6672c6f1c6303a804bc0a5e02ec1af"><div class="ttname"><a href="classAP__AHRS.html#a0b6672c6f1c6303a804bc0a5e02ec1af">AP_AHRS::get_location</a></div><div class="ttdeci">bool get_location(Location &amp;loc) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8cpp_source.html#l03460">AP_AHRS.cpp:3460</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a5d84cbacfad4577e8de788aeba05f49c"><div class="ttname"><a href="classAP__AHRS.html#a5d84cbacfad4577e8de788aeba05f49c">AP_AHRS::get_yaw</a></div><div class="ttdeci">float get_yaw() const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00554">AP_AHRS.h:554</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a64786b58a1607ee420ed4f0696c755b6"><div class="ttname"><a href="classAP__AHRS.html#a64786b58a1607ee420ed4f0696c755b6">AP_AHRS::get_EAS2TAS</a></div><div class="ttdeci">float get_EAS2TAS(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00144">AP_AHRS.h:144</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a6a5554b1eadd5417a4d1c60c5f0cc6a5"><div class="ttname"><a href="classAP__AHRS.html#a6a5554b1eadd5417a4d1c60c5f0cc6a5">AP_AHRS::groundspeed_vector</a></div><div class="ttdeci">const Vector2f &amp; groundspeed_vector() const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00222">AP_AHRS.h:222</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a8a160130dd99016a19abab9d85917261"><div class="ttname"><a href="classAP__AHRS.html#a8a160130dd99016a19abab9d85917261">AP_AHRS::yaw_sensor</a></div><div class="ttdeci">int32_t yaw_sensor</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00579">AP_AHRS.h:579</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a992a48fcef2892301f1a41b795d2e8c2"><div class="ttname"><a href="classAP__AHRS.html#a992a48fcef2892301f1a41b795d2e8c2">AP_AHRS::get_pitch</a></div><div class="ttdeci">float get_pitch() const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00553">AP_AHRS.h:553</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00021">HAL.h:21</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html"><div class="ttname"><a href="classAP__L1__Control.html">AP_L1_Control</a></div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00023">AP_L1_Control.h:23</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a077f59318a8244068f1ba9a19831225a"><div class="ttname"><a href="classAP__L1__Control.html#a077f59318a8244068f1ba9a19831225a">AP_L1_Control::_crosstrack_error</a></div><div class="ttdeci">float _crosstrack_error</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00102">AP_L1_Control.h:102</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a0c6970cc071d4843f0fe983003cc1410"><div class="ttname"><a href="classAP__L1__Control.html#a0c6970cc071d4843f0fe983003cc1410">AP_L1_Control::target_bearing_cd</a></div><div class="ttdeci">int32_t target_bearing_cd(void) const override</div><div class="ttdef"><b>Definition</b> <a href="#l00116">AP_L1_Control.cpp:116</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a0c79e0485a59960ebe5980e121374b0d"><div class="ttname"><a href="classAP__L1__Control.html#a0c79e0485a59960ebe5980e121374b0d">AP_L1_Control::_ahrs</a></div><div class="ttdeci">AP_AHRS &amp; _ahrs</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00080">AP_L1_Control.h:80</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a16c75c040fec7cc33e803aa49e8e632f"><div class="ttname"><a href="classAP__L1__Control.html#a16c75c040fec7cc33e803aa49e8e632f">AP_L1_Control::get_yaw</a></div><div class="ttdeci">float get_yaw() const</div><div class="ttdef"><b>Definition</b> <a href="#l00056">AP_L1_Control.cpp:56</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a1a7687ed13c74f535087c984968a92a3"><div class="ttname"><a href="classAP__L1__Control.html#a1a7687ed13c74f535087c984968a92a3">AP_L1_Control::update_heading_hold</a></div><div class="ttdeci">void update_heading_hold(int32_t navigation_heading_cd) override</div><div class="ttdef"><b>Definition</b> <a href="#l00462">AP_L1_Control.cpp:462</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a1f7ce18571ea0277edde860cd646779b"><div class="ttname"><a href="classAP__L1__Control.html#a1f7ce18571ea0277edde860cd646779b">AP_L1_Control::update_loiter</a></div><div class="ttdeci">void update_loiter(const class Location &amp;center_WP, float radius, int8_t loiter_direction) override</div><div class="ttdef"><b>Definition</b> <a href="#l00349">AP_L1_Control.cpp:349</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a2f25d6cea6e98aaec7d7a191537da195"><div class="ttname"><a href="classAP__L1__Control.html#a2f25d6cea6e98aaec7d7a191537da195">AP_L1_Control::_bearing_error</a></div><div class="ttdeci">float _bearing_error</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00099">AP_L1_Control.h:99</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a2f30082f502f02b94d754c6bb735f70b"><div class="ttname"><a href="classAP__L1__Control.html#a2f30082f502f02b94d754c6bb735f70b">AP_L1_Control::loiter_radius</a></div><div class="ttdeci">float loiter_radius(const float loiter_radius) const override</div><div class="ttdef"><b>Definition</b> <a href="#l00148">AP_L1_Control.cpp:148</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a34f586604201ae335fe7e3d06f5a1fc4"><div class="ttname"><a href="classAP__L1__Control.html#a34f586604201ae335fe7e3d06f5a1fc4">AP_L1_Control::lateral_acceleration</a></div><div class="ttdeci">float lateral_acceleration(void) const override</div><div class="ttdef"><b>Definition</b> <a href="#l00101">AP_L1_Control.cpp:101</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a39ccead440555e0e4abc52ab71e9fac8"><div class="ttname"><a href="classAP__L1__Control.html#a39ccead440555e0e4abc52ab71e9fac8">AP_L1_Control::_WPcircle</a></div><div class="ttdeci">bool _WPcircle</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00093">AP_L1_Control.h:93</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a41a8ab916024b77959ed059dd12469a1"><div class="ttname"><a href="classAP__L1__Control.html#a41a8ab916024b77959ed059dd12469a1">AP_L1_Control::bearing_error_cd</a></div><div class="ttdeci">int32_t bearing_error_cd(void) const override</div><div class="ttdef"><b>Definition</b> <a href="#l00111">AP_L1_Control.cpp:111</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a452628329b2b1c6fd9db864997c71e62"><div class="ttname"><a href="classAP__L1__Control.html#a452628329b2b1c6fd9db864997c71e62">AP_L1_Control::nav_roll_cd</a></div><div class="ttdeci">int32_t nav_roll_cd(void) const override</div><div class="ttdef"><b>Definition</b> <a href="#l00079">AP_L1_Control.cpp:79</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a45e259577f46c8cdfe5f52bece257019"><div class="ttname"><a href="classAP__L1__Control.html#a45e259577f46c8cdfe5f52bece257019">AP_L1_Control::_L1_xtrack_i_gain</a></div><div class="ttdeci">AP_Float _L1_xtrack_i_gain</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00121">AP_L1_Control.h:121</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a56dece11a108acd6b733efb497a614f5"><div class="ttname"><a href="classAP__L1__Control.html#a56dece11a108acd6b733efb497a614f5">AP_L1_Control::_L1_period</a></div><div class="ttdeci">AP_Float _L1_period</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00108">AP_L1_Control.h:108</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a5cacc55705a0a4e353f8599e6a0d1910"><div class="ttname"><a href="classAP__L1__Control.html#a5cacc55705a0a4e353f8599e6a0d1910">AP_L1_Control::update_level_flight</a></div><div class="ttdeci">void update_level_flight(void) override</div><div class="ttdef"><b>Definition</b> <a href="#l00503">AP_L1_Control.cpp:503</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a5f64f08c05c9152ff92202150b9ce05e"><div class="ttname"><a href="classAP__L1__Control.html#a5f64f08c05c9152ff92202150b9ce05e">AP_L1_Control::_L1_damping</a></div><div class="ttdeci">AP_Float _L1_damping</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00110">AP_L1_Control.h:110</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a62654b078823ca555139cf64403b5442"><div class="ttname"><a href="classAP__L1__Control.html#a62654b078823ca555139cf64403b5442">AP_L1_Control::_latAccDem</a></div><div class="ttdeci">float _latAccDem</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00087">AP_L1_Control.h:87</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a63005fc8c6746ac5282521d393cbb7f2"><div class="ttname"><a href="classAP__L1__Control.html#a63005fc8c6746ac5282521d393cbb7f2">AP_L1_Control::_L1_dist</a></div><div class="ttdeci">float _L1_dist</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00090">AP_L1_Control.h:90</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a67c543ed97304d5d11433f83d4f53280"><div class="ttname"><a href="classAP__L1__Control.html#a67c543ed97304d5d11433f83d4f53280">AP_L1_Control::_last_Nu</a></div><div class="ttdeci">float _last_Nu</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00113">AP_L1_Control.h:113</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a694095425105d37dd52aeb275925f6d7"><div class="ttname"><a href="classAP__L1__Control.html#a694095425105d37dd52aeb275925f6d7">AP_L1_Control::_loiter_bank_limit</a></div><div class="ttdeci">AP_Float _loiter_bank_limit</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00126">AP_L1_Control.h:126</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a725b90895d4de350044edbe07ed38613"><div class="ttname"><a href="classAP__L1__Control.html#a725b90895d4de350044edbe07ed38613">AP_L1_Control::_L1_xtrack_i_gain_prev</a></div><div class="ttdeci">float _L1_xtrack_i_gain_prev</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00122">AP_L1_Control.h:122</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a74021d6b9cf1c7df17624b0a28ae0d7c"><div class="ttname"><a href="classAP__L1__Control.html#a74021d6b9cf1c7df17624b0a28ae0d7c">AP_L1_Control::_L1_xtrack_i</a></div><div class="ttdeci">float _L1_xtrack_i</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00120">AP_L1_Control.h:120</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a763a962db3c7a199ee9d3fcd7f42e1ff"><div class="ttname"><a href="classAP__L1__Control.html#a763a962db3c7a199ee9d3fcd7f42e1ff">AP_L1_Control::nav_bearing_cd</a></div><div class="ttdeci">int32_t nav_bearing_cd(void) const override</div><div class="ttdef"><b>Definition</b> <a href="#l00106">AP_L1_Control.cpp:106</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a77d954f029e11939addead7ba4db982f"><div class="ttname"><a href="classAP__L1__Control.html#a77d954f029e11939addead7ba4db982f">AP_L1_Control::_tecs</a></div><div class="ttdeci">const AP_TECS * _tecs</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00083">AP_L1_Control.h:83</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a79bf5c44d2e7cd540ff846870593307f"><div class="ttname"><a href="classAP__L1__Control.html#a79bf5c44d2e7cd540ff846870593307f">AP_L1_Control::_last_update_waypoint_us</a></div><div class="ttdeci">uint32_t _last_update_waypoint_us</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00123">AP_L1_Control.h:123</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a9290bef1192d5649fa929e1feefe21da"><div class="ttname"><a href="classAP__L1__Control.html#a9290bef1192d5649fa929e1feefe21da">AP_L1_Control::_reverse</a></div><div class="ttdeci">bool _reverse</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00128">AP_L1_Control.h:128</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a960b675b15f9850e1ba8d9c878e972bc"><div class="ttname"><a href="classAP__L1__Control.html#a960b675b15f9850e1ba8d9c878e972bc">AP_L1_Control::reached_loiter_target</a></div><div class="ttdeci">bool reached_loiter_target(void) override</div><div class="ttdef"><b>Definition</b> <a href="#l00180">AP_L1_Control.cpp:180</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a961307861e61bcbef3147295ccba450b"><div class="ttname"><a href="classAP__L1__Control.html#a961307861e61bcbef3147295ccba450b">AP_L1_Control::_data_is_stale</a></div><div class="ttdeci">bool _data_is_stale</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00124">AP_L1_Control.h:124</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_a97f55d73419c935ac0d63c29e288070f"><div class="ttname"><a href="classAP__L1__Control.html#a97f55d73419c935ac0d63c29e288070f">AP_L1_Control::_nav_bearing</a></div><div class="ttdeci">float _nav_bearing</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00096">AP_L1_Control.h:96</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_aa80fb1f9f7ca34cd3da895ab4e9b4436"><div class="ttname"><a href="classAP__L1__Control.html#aa80fb1f9f7ca34cd3da895ab4e9b4436">AP_L1_Control::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00007">AP_L1_Control.h:7</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_aaa154ba9c5957f90785c34ee554eca1c"><div class="ttname"><a href="classAP__L1__Control.html#aaa154ba9c5957f90785c34ee554eca1c">AP_L1_Control::_prevent_indecision</a></div><div class="ttdeci">void _prevent_indecision(float &amp;Nu)</div><div class="ttdef"><b>Definition</b> <a href="#l00190">AP_L1_Control.cpp:190</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_ab99bfec3eb21aa7b9dc1edef4cc60fc0"><div class="ttname"><a href="classAP__L1__Control.html#ab99bfec3eb21aa7b9dc1edef4cc60fc0">AP_L1_Control::turn_distance</a></div><div class="ttdeci">float turn_distance(float wp_radius) const override</div><div class="ttdef"><b>Definition</b> <a href="#l00124">AP_L1_Control.cpp:124</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_ac7d3691acff577042e18f45c6cbba40b"><div class="ttname"><a href="classAP__L1__Control.html#ac7d3691acff577042e18f45c6cbba40b">AP_L1_Control::update_waypoint</a></div><div class="ttdeci">void update_waypoint(const class Location &amp;prev_WP, const class Location &amp;next_WP, float dist_min=0.0f) override</div><div class="ttdef"><b>Definition</b> <a href="#l00206">AP_L1_Control.cpp:206</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_ad21403826bfd0deab208ae5560feaa7c"><div class="ttname"><a href="classAP__L1__Control.html#ad21403826bfd0deab208ae5560feaa7c">AP_L1_Control::get_yaw_sensor</a></div><div class="ttdeci">int32_t get_yaw_sensor() const</div><div class="ttdef"><b>Definition</b> <a href="#l00067">AP_L1_Control.cpp:67</a></div></div>
<div class="ttc" id="aclassAP__L1__Control_html_aebee3748e799d62f42ab2fbe8afadb9e"><div class="ttname"><a href="classAP__L1__Control.html#aebee3748e799d62f42ab2fbe8afadb9e">AP_L1_Control::_target_bearing_cd</a></div><div class="ttdeci">int32_t _target_bearing_cd</div><div class="ttdef"><b>Definition</b> <a href="AP__L1__Control_8h_source.html#l00105">AP_L1_Control.h:105</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a22e88eb1a109a7b6e8ca2897556c184e"><div class="ttname"><a href="classAP__TECS.html#a22e88eb1a109a7b6e8ca2897556c184e">AP_TECS::get_target_airspeed</a></div><div class="ttdeci">float get_target_airspeed(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00076">AP_TECS.h:76</a></div></div>
<div class="ttc" id="aclassLocation_html"><div class="ttname"><a href="classLocation.html">Location</a></div><div class="ttdef"><b>Definition</b> <a href="Location_8h_source.html#l00007">Location.h:8</a></div></div>
<div class="ttc" id="aclassLocation_html_a2e43145b0552a97551481c473d491a8a"><div class="ttname"><a href="classLocation.html#a2e43145b0552a97551481c473d491a8a">Location::get_bearing_to</a></div><div class="ttdeci">int32_t get_bearing_to(const Location &amp;loc2) const</div><div class="ttdef"><b>Definition</b> <a href="Location_8h_source.html#l00106">Location.h:106</a></div></div>
<div class="ttc" id="aclassLocation_html_af597420e2ec20fc794ca3d5447fd36ba"><div class="ttname"><a href="classLocation.html#af597420e2ec20fc794ca3d5447fd36ba">Location::get_distance_NE</a></div><div class="ttdeci">Vector2f get_distance_NE(const Location &amp;loc2) const</div><div class="ttdef"><b>Definition</b> <a href="Location_8cpp_source.html#l00266">Location.cpp:266</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a958e4508ed28ee5cc04249144312c15f"><div class="ttname"><a href="definitions_8h.html#a958e4508ed28ee5cc04249144312c15f">M_PI_2</a></div><div class="ttdeci">#define M_PI_2</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00015">definitions.h:15</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a96799f9de58a211f6b3bdc96c6e10669"><div class="ttname"><a href="definitions_8h.html#a96799f9de58a211f6b3bdc96c6e10669">RadiansToCentiDegrees</a></div><div class="ttdeci">#define RadiansToCentiDegrees(x)</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00044">definitions.h:44</a></div></div>
<div class="ttc" id="adefinitions_8h_html_ae71449b1cc6e6250b91f539153a7a0d3"><div class="ttname"><a href="definitions_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a></div><div class="ttdeci">#define M_PI</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00010">definitions.h:10</a></div></div>
<div class="ttc" id="adefinitions_8h_html_aea8758bf61b23b46507902b46060ebfd"><div class="ttname"><a href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a></div><div class="ttdeci">#define GRAVITY_MSS</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00047">definitions.h:47</a></div></div>
<div class="ttc" id="amoduletest_8c_html_a903c4797a4c2860e3b9a6a978f98a44d"><div class="ttname"><a href="moduletest_8c.html#a903c4797a4c2860e3b9a6a978f98a44d">degrees</a></div><div class="ttdeci">#define degrees(x)</div><div class="ttdef"><b>Definition</b> <a href="moduletest_8c_source.html#l00023">moduletest.c:23</a></div></div>
<div class="ttc" id="amonocypher_8cpp_html_a3acffbd305ee72dcd4593c0d8af64a4f"><div class="ttname"><a href="monocypher_8cpp.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a></div><div class="ttdeci">#define MIN(a, b)</div><div class="ttdef"><b>Definition</b> <a href="monocypher_8cpp_source.html#l00071">monocypher.cpp:71</a></div></div>
<div class="ttc" id="amonocypher_8cpp_html_afa99ec4acc4ecb2dc3c2d05da15d0e3f"><div class="ttname"><a href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a></div><div class="ttdeci">#define MAX(a, b)</div><div class="ttdef"><b>Definition</b> <a href="monocypher_8cpp_source.html#l00072">monocypher.cpp:72</a></div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a8293355e35887733b1fd151aef08a787"><div class="ttname"><a href="namespaceAP__HAL.html#a8293355e35887733b1fd151aef08a787">AP_HAL::micros</a></div><div class="ttdeci">uint32_t micros()</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2system_8cpp_source.html#l00352">system.cpp:352</a></div></div>
<div class="ttc" id="astructAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00199">AP_Param.h:199</a></div></div>
<div class="ttc" id="astructVector2_html"><div class="ttname"><a href="structVector2.html">Vector2&lt; float &gt;</a></div></div>
<div class="ttc" id="astructVector2_html_a6cfed8355591aa269f4dba43bd806ef9"><div class="ttname"><a href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">Vector2::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition</b> <a href="vector2_8h_source.html#l00044">vector2.h:44</a></div></div>
<div class="ttc" id="astructVector2_html_a78fa1f2ed5e261c7fbeb8f3536a1ee34"><div class="ttname"><a href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">Vector2::x</a></div><div class="ttdeci">T x</div><div class="ttdef"><b>Definition</b> <a href="vector2_8h_source.html#l00044">vector2.h:44</a></div></div>
<div class="ttc" id="astructVector2_html_aa5b16091858399424b79f7a580e4284e"><div class="ttname"><a href="structVector2.html#aa5b16091858399424b79f7a580e4284e">Vector2::angle</a></div><div class="ttdeci">T angle(const Vector2&lt; T &gt; &amp;v2) const</div><div class="ttdef"><b>Definition</b> <a href="vector2_8cpp_source.html#l00145">vector2.cpp:145</a></div></div>
<div class="ttc" id="astructVector2_html_aa78ff4778f55bf9c1ba9a10830fc0b89"><div class="ttname"><a href="structVector2.html#aa78ff4778f55bf9c1ba9a10830fc0b89">Vector2::normalized</a></div><div class="ttdeci">Vector2&lt; T &gt; normalized() const</div><div class="ttdef"><b>Definition</b> <a href="vector2_8cpp_source.html#l00275">vector2.cpp:275</a></div></div>
<div class="ttc" id="astructVector2_html_ace2a626eaa79412e2946216e9c3e63c6"><div class="ttname"><a href="structVector2.html#ace2a626eaa79412e2946216e9c3e63c6">Vector2::normalize</a></div><div class="ttdeci">void normalize()</div><div class="ttdef"><b>Definition</b> <a href="vector2_8cpp_source.html#l00268">vector2.cpp:268</a></div></div>
<div class="ttc" id="astructVector2_html_aed3cf4803ee803dc1447985ca323178f"><div class="ttname"><a href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">Vector2::length</a></div><div class="ttdeci">T length(void) const</div><div class="ttdef"><b>Definition</b> <a href="vector2_8cpp_source.html#l00030">vector2.cpp:30</a></div></div>
<div class="ttc" id="avector2_8h_html_a9f3739462b0605dcb64299fa289b6afe"><div class="ttname"><a href="vector2_8h.html#a9f3739462b0605dcb64299fa289b6afe">Vector2f</a></div><div class="ttdeci">Vector2&lt; float &gt; Vector2f</div><div class="ttdef"><b>Definition</b> <a href="vector2_8h_source.html#l00297">vector2.h:297</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 22 2024 16:14:14 for APM:Libraries by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
