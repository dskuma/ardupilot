<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APM:Libraries: libraries/AP_Compass/AP_Compass.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_65717d02e6482fd400ba81c154f53df4.html">AP_Compass</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">AP_Compass.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="AP__Compass_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__config_8h.html">AP_Compass_config.h</a>&quot;</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span> </div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="preprocessor">#if AP_COMPASS_ENABLED</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#include &lt;<a class="code" href="AP__HAL_8h.html">AP_HAL/AP_HAL.h</a>&gt;</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="preprocessor">#if CONFIG_HAL_BOARD == HAL_BOARD_LINUX</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="preprocessor">#include &lt;<a class="code" href="AP__HAL__Linux_2I2CDevice_8h.html">AP_HAL_Linux/I2CDevice.h</a>&gt;</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Vehicle__Type_8h.html">AP_Vehicle/AP_Vehicle_Type.h</a>&gt;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &lt;<a class="code" href="AP__BoardConfig_8h.html">AP_BoardConfig/AP_BoardConfig.h</a>&gt;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Logger_8h.html">AP_Logger/AP_Logger.h</a>&gt;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Vehicle__Type_8h.html">AP_Vehicle/AP_Vehicle_Type.h</a>&gt;</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#include &lt;<a class="code" href="AP__ExternalAHRS_8h.html">AP_ExternalAHRS/AP_ExternalAHRS.h</a>&gt;</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &lt;<a class="code" href="AP__CustomRotations_8h.html">AP_CustomRotations/AP_CustomRotations.h</a>&gt;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#include &lt;<a class="code" href="GCS_8h.html">GCS_MAVLink/GCS.h</a>&gt;</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span> </div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__config_8h.html">AP_Compass_config.h</a>&quot;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span> </div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__SITL_8h.html">AP_Compass_SITL.h</a>&quot;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__AK8963_8h.html">AP_Compass_AK8963.h</a>&quot;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__Backend_8h.html">AP_Compass_Backend.h</a>&quot;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__BMM150_8h.html">AP_Compass_BMM150.h</a>&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__HMC5843_8h.html">AP_Compass_HMC5843.h</a>&quot;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__IST8308_8h.html">AP_Compass_IST8308.h</a>&quot;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__IST8310_8h.html">AP_Compass_IST8310.h</a>&quot;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__LSM303D_8h.html">AP_Compass_LSM303D.h</a>&quot;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__LSM9DS1_8h.html">AP_Compass_LSM9DS1.h</a>&quot;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__LIS3MDL_8h.html">AP_Compass_LIS3MDL.h</a>&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__AK09916_8h.html">AP_Compass_AK09916.h</a>&quot;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__QMC5883L_8h.html">AP_Compass_QMC5883L.h</a>&quot;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#if AP_COMPASS_DRONECAN_ENABLED</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__DroneCAN_8h.html">AP_Compass_DroneCAN.h</a>&quot;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__QMC5883P_8h.html">AP_Compass_QMC5883P.h</a>&quot;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__MMC3416_8h.html">AP_Compass_MMC3416.h</a>&quot;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__MMC5xx3_8h.html">AP_Compass_MMC5xx3.h</a>&quot;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__MAG3110_8h.html">AP_Compass_MAG3110.h</a>&quot;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__RM3100_8h.html">AP_Compass_RM3100.h</a>&quot;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#if AP_COMPASS_MSP_ENABLED</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__MSP_8h.html">AP_Compass_MSP.h</a>&quot;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#if AP_COMPASS_EXTERNALAHRS_ENABLED</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass__ExternalAHRS_8h.html">AP_Compass_ExternalAHRS.h</a>&quot;</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Compass_8h.html">AP_Compass.h</a>&quot;</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span><span class="preprocessor">#include &quot;<a class="code" href="Compass__learn_8h.html">Compass_learn.h</a>&quot;</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span><span class="preprocessor">#include &lt;<a class="code" href="stdio_8h.html">stdio.h</a>&gt;</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span> </div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="keyword">extern</span> <span class="keyword">const</span> <a class="code hl_class" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code hl_variable" href="AP__Compass_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span> </div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="preprocessor">#ifndef AP_COMPASS_ENABLE_DEFAULT</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno"><a class="line" href="AP__Compass_8cpp.html#aee5d048c798959cb31261517f64bdfbb">   52</a></span><span class="preprocessor"> #define AP_COMPASS_ENABLE_DEFAULT 1</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span> </div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span><span class="preprocessor">#ifndef COMPASS_LEARN_DEFAULT</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno"><a class="line" href="AP__Compass_8cpp.html#abbd00be969534e4587e3479da3759384">   56</a></span><span class="preprocessor">#define COMPASS_LEARN_DEFAULT Compass::LEARN_NONE</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span> </div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="preprocessor">#ifndef AP_COMPASS_OFFSETS_MAX_DEFAULT</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno"><a class="line" href="AP__Compass_8cpp.html#a6db3df6d28073ae8f6bb62bd31c7ca54">   60</a></span><span class="preprocessor">#define AP_COMPASS_OFFSETS_MAX_DEFAULT 1800</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span> </div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="preprocessor">#ifndef HAL_COMPASS_FILTER_DEFAULT</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno"><a class="line" href="AP__Compass_8cpp.html#aced1819bbf63ee14663aa60cca76fa80">   64</a></span><span class="preprocessor">#define HAL_COMPASS_FILTER_DEFAULT 0 </span><span class="comment">// turned off by default</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span> </div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span><span class="preprocessor">#ifndef HAL_COMPASS_AUTO_ROT_DEFAULT</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno"><a class="line" href="AP__Compass_8cpp.html#abd241224760f1a380278880c2908a112">   68</a></span><span class="preprocessor">#define HAL_COMPASS_AUTO_ROT_DEFAULT 2</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span> </div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span><span class="keyword">const</span> <a class="code hl_struct" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code hl_variable" href="classCompass.html#a93d4187acb991b33c5c25f9e16b3b0ce">Compass::var_info</a>[] = {</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    <span class="comment">// index 0 was used for the old orientation matrix</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span> </div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="preprocessor">#ifndef HAL_BUILD_AP_PERIPH</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    <span class="comment">// @Param: OFS_X</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    <span class="comment">// @DisplayName: Compass offsets in milligauss on the X axis</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    <span class="comment">// @Description: Offset to be added to the compass x-axis values to compensate for metal in the frame</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    <span class="comment">// @Range: -400 400</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    <span class="comment">// @Units: mGauss</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span> </div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    <span class="comment">// @Param: OFS_Y</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    <span class="comment">// @DisplayName: Compass offsets in milligauss on the Y axis</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    <span class="comment">// @Description: Offset to be added to the compass y-axis values to compensate for metal in the frame</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    <span class="comment">// @Range: -400 400</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    <span class="comment">// @Units: mGauss</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span> </div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <span class="comment">// @Param: OFS_Z</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    <span class="comment">// @DisplayName: Compass offsets in milligauss on the Z axis</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <span class="comment">// @Description: Offset to be added to the compass z-axis values to compensate for metal in the frame</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    <span class="comment">// @Range: -400 400</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    <span class="comment">// @Units: mGauss</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;OFS&quot;</span>,    1, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[0].offset, 0),</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span> </div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    <span class="comment">// @Param: DEC</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    <span class="comment">// @DisplayName: Compass declination</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    <span class="comment">// @Description: An angle to compensate between the true north and magnetic north</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    <span class="comment">// @Range: -3.142 3.142</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>    <span class="comment">// @Units: rad</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>    <span class="comment">// @Increment: 0.01</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DEC&quot;</span>,    2, <a class="code hl_class" href="classCompass.html">Compass</a>, _declination, 0),</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span><span class="preprocessor">#endif </span><span class="comment">// HAL_BUILD_AP_PERIPH</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span> </div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span><span class="preprocessor">#if COMPASS_LEARN_ENABLED</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    <span class="comment">// @Param: LEARN</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    <span class="comment">// @DisplayName: Learn compass offsets automatically</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    <span class="comment">// @Description: Enable or disable the automatic learning of compass offsets. You can enable learning either using a compass-only method that is suitable only for fixed wing aircraft or using the offsets learnt by the active EKF state estimator. If this option is enabled then the learnt offsets are saved when you disarm the vehicle. If InFlight learning is enabled then the compass with automatically start learning once a flight starts (must be armed). While InFlight learning is running you cannot use position control modes.</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <span class="comment">// @Values: 0:Disabled,1:Internal-Learning,2:EKF-Learning,3:InFlight-Learning</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LEARN&quot;</span>,  3, <a class="code hl_class" href="classCompass.html">Compass</a>, _learn, <a class="code hl_define" href="AP__Compass_8cpp.html#abbd00be969534e4587e3479da3759384">COMPASS_LEARN_DEFAULT</a>),</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span> </div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="preprocessor">#ifndef HAL_BUILD_AP_PERIPH</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <span class="comment">// @Param: USE</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    <span class="comment">// @DisplayName: Use compass for yaw</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    <span class="comment">// @Description: Enable or disable the use of the compass (instead of the GPS) for determining heading</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    <span class="comment">// @Values: 0:Disabled,1:Enabled</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;USE&quot;</span>,    4, <a class="code hl_class" href="classCompass.html">Compass</a>, _use_for_yaw._priv_instance[0], 1), <span class="comment">// true if used for DCM yaw</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span> </div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    <span class="comment">// @Param: AUTODEC</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    <span class="comment">// @DisplayName: Auto Declination</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <span class="comment">// @Description: Enable or disable the automatic calculation of the declination based on gps location</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <span class="comment">// @Values: 0:Disabled,1:Enabled</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;AUTODEC&quot;</span>,5, <a class="code hl_class" href="classCompass.html">Compass</a>, _auto_declination, 1),</div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span> </div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span><span class="preprocessor">#if COMPASS_MOT_ENABLED</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    <span class="comment">// @Param: MOTCT</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <span class="comment">// @DisplayName: Motor interference compensation type</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="comment">// @Description: Set motor interference compensation type to disabled, throttle or current.  Do not change manually.</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    <span class="comment">// @Values: 0:Disabled,1:Use Throttle,2:Use Current</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MOTCT&quot;</span>,    6, <a class="code hl_class" href="classCompass.html">Compass</a>, _motor_comp_type, <a class="code hl_define" href="AP__Compass_8h.html#aea476312c9a32f19ab3a0d62f4027869">AP_COMPASS_MOT_COMP_DISABLED</a>),</div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span> </div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    <span class="comment">// @Param: MOT_X</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    <span class="comment">// @DisplayName: Motor interference compensation for body frame X axis</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    <span class="comment">// @Description: Multiplied by the current throttle and added to the compass&#39;s x-axis values to compensate for motor interference (Offset per Amp or at Full Throttle)</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    <span class="comment">// @Range: -1000 1000</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    <span class="comment">// @Units: mGauss/A</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span> </div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    <span class="comment">// @Param: MOT_Y</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    <span class="comment">// @DisplayName: Motor interference compensation for body frame Y axis</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    <span class="comment">// @Description: Multiplied by the current throttle and added to the compass&#39;s y-axis values to compensate for motor interference (Offset per Amp or at Full Throttle)</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    <span class="comment">// @Range: -1000 1000</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    <span class="comment">// @Units: mGauss/A</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span> </div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    <span class="comment">// @Param: MOT_Z</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    <span class="comment">// @DisplayName: Motor interference compensation for body frame Z axis</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    <span class="comment">// @Description: Multiplied by the current throttle and added to the compass&#39;s z-axis values to compensate for motor interference (Offset per Amp or at Full Throttle)</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    <span class="comment">// @Range: -1000 1000</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    <span class="comment">// @Units: mGauss/A</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MOT&quot;</span>,    7, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[0].motor_compensation, 0),</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span> </div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span><span class="preprocessor">#ifndef HAL_BUILD_AP_PERIPH</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    <span class="comment">// @Param: ORIENT</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    <span class="comment">// @DisplayName: Compass orientation</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    <span class="comment">// @Description: The orientation of the first external compass relative to the vehicle frame. This value will be ignored unless this compass is set as an external compass. When set correctly in the northern hemisphere, pointing the nose and right side down should increase the MagX and MagY values respectively. Rolling the vehicle upside down should decrease the MagZ value. For southern hemisphere, switch increase and decrease. NOTE: For internal compasses, AHRS_ORIENT is used. The label for each option is specified in the order of rotations for that orientation. Firmware versions 4.2 and prior can use a CUSTOM (100) rotation to set the COMPASS_CUS_ROLL/PIT/YAW angles for Compass orientation. Later versions provide two general custom rotations which can be used, Custom 1 and Custom 2, with CUST_1_ROLL/PIT/YAW or CUST_2_ROLL/PIT/YAW angles.</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    <span class="comment">// @Values: 0:None,1:Yaw45,2:Yaw90,3:Yaw135,4:Yaw180,5:Yaw225,6:Yaw270,7:Yaw315,8:Roll180,9:Yaw45Roll180,10:Yaw90Roll180,11:Yaw135Roll180,12:Pitch180,13:Yaw225Roll180,14:Yaw270Roll180,15:Yaw315Roll180,16:Roll90,17:Yaw45Roll90,18:Yaw90Roll90,19:Yaw135Roll90,20:Roll270,21:Yaw45Roll270,22:Yaw90Roll270,23:Yaw135Roll270,24:Pitch90,25:Pitch270,26:Yaw90Pitch180,27:Yaw270Pitch180,28:Pitch90Roll90,29:Pitch90Roll180,30:Pitch90Roll270,31:Pitch180Roll90,32:Pitch180Roll270,33:Pitch270Roll90,34:Pitch270Roll180,35:Pitch270Roll270,36:Yaw90Pitch180Roll90,37:Yaw270Roll90,38:Yaw293Pitch68Roll180,39:Pitch315,40:Pitch315Roll90,42:Roll45,43:Roll315,100:Custom 4.1 and older,101:Custom 1,102:Custom 2</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ORIENT&quot;</span>, 8, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[0].orientation, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>),</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <span class="comment">// @Param: EXTERNAL</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    <span class="comment">// @DisplayName: Compass is attached via an external cable</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <span class="comment">// @Description: Configure compass so it is attached externally. This is auto-detected on most boards. Set to 1 if the compass is externally connected. When externally connected the COMPASS_ORIENT option operates independently of the AHRS_ORIENTATION board orientation option. If set to 0 or 1 then auto-detection by bus connection can override the value. If set to 2 then auto-detection will be disabled.</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    <span class="comment">// @Values: 0:Internal,1:External,2:ForcedExternal</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;EXTERNAL&quot;</span>, 9, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[0].external, 0),</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span> </div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    <span class="comment">// @Param: OFS2_X</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    <span class="comment">// @DisplayName: Compass2 offsets in milligauss on the X axis</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <span class="comment">// @Description: Offset to be added to compass2&#39;s x-axis values to compensate for metal in the frame</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    <span class="comment">// @Range: -400 400</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    <span class="comment">// @Units: mGauss</span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span> </div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>    <span class="comment">// @Param: OFS2_Y</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    <span class="comment">// @DisplayName: Compass2 offsets in milligauss on the Y axis</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    <span class="comment">// @Description: Offset to be added to compass2&#39;s y-axis values to compensate for metal in the frame</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    <span class="comment">// @Range: -400 400</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    <span class="comment">// @Units: mGauss</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span> </div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    <span class="comment">// @Param: OFS2_Z</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>    <span class="comment">// @DisplayName: Compass2 offsets in milligauss on the Z axis</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <span class="comment">// @Description: Offset to be added to compass2&#39;s z-axis values to compensate for metal in the frame</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    <span class="comment">// @Range: -400 400</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    <span class="comment">// @Units: mGauss</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;OFS2&quot;</span>,    10, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[1].offset, 0),</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span> </div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    <span class="comment">// @Param: MOT2_X</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    <span class="comment">// @DisplayName: Motor interference compensation to compass2 for body frame X axis</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    <span class="comment">// @Description: Multiplied by the current throttle and added to compass2&#39;s x-axis values to compensate for motor interference (Offset per Amp or at Full Throttle)</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <span class="comment">// @Range: -1000 1000</span></div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    <span class="comment">// @Units: mGauss/A</span></div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span> </div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    <span class="comment">// @Param: MOT2_Y</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    <span class="comment">// @DisplayName: Motor interference compensation to compass2 for body frame Y axis</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    <span class="comment">// @Description: Multiplied by the current throttle and added to compass2&#39;s y-axis values to compensate for motor interference (Offset per Amp or at Full Throttle)</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>    <span class="comment">// @Range: -1000 1000</span></div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    <span class="comment">// @Units: mGauss/A</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span> </div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    <span class="comment">// @Param: MOT2_Z</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    <span class="comment">// @DisplayName: Motor interference compensation to compass2 for body frame Z axis</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    <span class="comment">// @Description: Multiplied by the current throttle and added to compass2&#39;s z-axis values to compensate for motor interference (Offset per Amp or at Full Throttle)</span></div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    <span class="comment">// @Range: -1000 1000</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>    <span class="comment">// @Units: mGauss/A</span></div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MOT2&quot;</span>,    11, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[1].motor_compensation, 0),</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span> </div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_INSTANCES</span></div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span> </div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 2</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>    <span class="comment">// @Param: OFS3_X</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>    <span class="comment">// @DisplayName: Compass3 offsets in milligauss on the X axis</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    <span class="comment">// @Description: Offset to be added to compass3&#39;s x-axis values to compensate for metal in the frame</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    <span class="comment">// @Range: -400 400</span></div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>    <span class="comment">// @Units: mGauss</span></div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span> </div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    <span class="comment">// @Param: OFS3_Y</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    <span class="comment">// @DisplayName: Compass3 offsets in milligauss on the Y axis</span></div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    <span class="comment">// @Description: Offset to be added to compass3&#39;s y-axis values to compensate for metal in the frame</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    <span class="comment">// @Range: -400 400</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <span class="comment">// @Units: mGauss</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span> </div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>    <span class="comment">// @Param: OFS3_Z</span></div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    <span class="comment">// @DisplayName: Compass3 offsets in milligauss on the Z axis</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>    <span class="comment">// @Description: Offset to be added to compass3&#39;s z-axis values to compensate for metal in the frame</span></div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    <span class="comment">// @Range: -400 400</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    <span class="comment">// @Units: mGauss</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;OFS3&quot;</span>,    13, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[2].offset, 0),</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span> </div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>    <span class="comment">// @Param: MOT3_X</span></div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    <span class="comment">// @DisplayName: Motor interference compensation to compass3 for body frame X axis</span></div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    <span class="comment">// @Description: Multiplied by the current throttle and added to compass3&#39;s x-axis values to compensate for motor interference (Offset per Amp or at Full Throttle)</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>    <span class="comment">// @Range: -1000 1000</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    <span class="comment">// @Units: mGauss/A</span></div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span> </div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>    <span class="comment">// @Param: MOT3_Y</span></div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    <span class="comment">// @DisplayName: Motor interference compensation to compass3 for body frame Y axis</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    <span class="comment">// @Description: Multiplied by the current throttle and added to compass3&#39;s y-axis values to compensate for motor interference (Offset per Amp or at Full Throttle)</span></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>    <span class="comment">// @Range: -1000 1000</span></div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>    <span class="comment">// @Units: mGauss/A</span></div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span> </div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>    <span class="comment">// @Param: MOT3_Z</span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>    <span class="comment">// @DisplayName: Motor interference compensation to compass3 for body frame Z axis</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>    <span class="comment">// @Description: Multiplied by the current throttle and added to compass3&#39;s z-axis values to compensate for motor interference (Offset per Amp or at Full Throttle)</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>    <span class="comment">// @Range: -1000 1000</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    <span class="comment">// @Units: mGauss/A</span></div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;MOT3&quot;</span>,    14, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[2].motor_compensation, 0),</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_INSTANCES</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span> </div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    <span class="comment">// @Param: DEV_ID</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>    <span class="comment">// @DisplayName: Compass device id</span></div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    <span class="comment">// @Description: Compass device id.  Automatically detected, do not set manually</span></div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    <span class="comment">// @ReadOnly: True</span></div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DEV_ID&quot;</span>,  15, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[0].dev_id, 0),</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span> </div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>    <span class="comment">// @Param: DEV_ID2</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    <span class="comment">// @DisplayName: Compass2 device id</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>    <span class="comment">// @Description: Second compass&#39;s device id.  Automatically detected, do not set manually</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span>    <span class="comment">// @ReadOnly: True</span></div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DEV_ID2&quot;</span>, 16, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[1].dev_id, 0),</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_INSTANCES</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span> </div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 2</span></div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    <span class="comment">// @Param: DEV_ID3</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>    <span class="comment">// @DisplayName: Compass3 device id</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>    <span class="comment">// @Description: Third compass&#39;s device id.  Automatically detected, do not set manually</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    <span class="comment">// @ReadOnly: True</span></div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DEV_ID3&quot;</span>, 17, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[2].dev_id, 0),</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_INSTANCES</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span> </div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>    <span class="comment">// @Param: USE2</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    <span class="comment">// @DisplayName: Compass2 used for yaw</span></div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    <span class="comment">// @Description: Enable or disable the secondary compass for determining heading.</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>    <span class="comment">// @Values: 0:Disabled,1:Enabled</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;USE2&quot;</span>,    18, <a class="code hl_class" href="classCompass.html">Compass</a>, _use_for_yaw._priv_instance[1], 1),</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span> </div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>    <span class="comment">// @Param: ORIENT2</span></div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>    <span class="comment">// @DisplayName: Compass2 orientation</span></div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    <span class="comment">// @Description: The orientation of a second external compass relative to the vehicle frame. This value will be ignored unless this compass is set as an external compass. When set correctly in the northern hemisphere, pointing the nose and right side down should increase the MagX and MagY values respectively. Rolling the vehicle upside down should decrease the MagZ value. For southern hemisphere, switch increase and decrease. NOTE: For internal compasses, AHRS_ORIENT is used. The label for each option is specified in the order of rotations for that orientation. Firmware versions 4.2 and prior can use a CUSTOM (100) rotation to set the COMPASS_CUS_ROLL/PIT/YAW angles for Compass orientation. Later versions provide two general custom rotations which can be used, Custom 1 and Custom 2, with CUST_1_ROLL/PIT/YAW or CUST_2_ROLL/PIT/YAW angles.</span></div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>    <span class="comment">// @Values: 0:None,1:Yaw45,2:Yaw90,3:Yaw135,4:Yaw180,5:Yaw225,6:Yaw270,7:Yaw315,8:Roll180,9:Yaw45Roll180,10:Yaw90Roll180,11:Yaw135Roll180,12:Pitch180,13:Yaw225Roll180,14:Yaw270Roll180,15:Yaw315Roll180,16:Roll90,17:Yaw45Roll90,18:Yaw90Roll90,19:Yaw135Roll90,20:Roll270,21:Yaw45Roll270,22:Yaw90Roll270,23:Yaw135Roll270,24:Pitch90,25:Pitch270,26:Yaw90Pitch180,27:Yaw270Pitch180,28:Pitch90Roll90,29:Pitch90Roll180,30:Pitch90Roll270,31:Pitch180Roll90,32:Pitch180Roll270,33:Pitch270Roll90,34:Pitch270Roll180,35:Pitch270Roll270,36:Yaw90Pitch180Roll90,37:Yaw270Roll90,38:Yaw293Pitch68Roll180,39:Pitch315,40:Pitch315Roll90,42:Roll45,43:Roll315,100:Custom 4.1 and older,101:Custom 1,102:Custom 2</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ORIENT2&quot;</span>, 19, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[1].orientation, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>),</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span> </div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>    <span class="comment">// @Param: EXTERN2</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    <span class="comment">// @DisplayName: Compass2 is attached via an external cable</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    <span class="comment">// @Description: Configure second compass so it is attached externally. This is auto-detected on most boards. If set to 0 or 1 then auto-detection by bus connection can override the value. If set to 2 then auto-detection will be disabled.</span></div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    <span class="comment">// @Values: 0:Internal,1:External,2:ForcedExternal</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;EXTERN2&quot;</span>,20, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[1].external, 0),</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_INSTANCES</span></div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span> </div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 2</span></div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>    <span class="comment">// @Param: USE3</span></div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    <span class="comment">// @DisplayName: Compass3 used for yaw</span></div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    <span class="comment">// @Description: Enable or disable the tertiary compass for determining heading.</span></div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    <span class="comment">// @Values: 0:Disabled,1:Enabled</span></div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;USE3&quot;</span>,    21, <a class="code hl_class" href="classCompass.html">Compass</a>, _use_for_yaw._priv_instance[2], 1),</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span> </div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    <span class="comment">// @Param: ORIENT3</span></div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>    <span class="comment">// @DisplayName: Compass3 orientation</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>    <span class="comment">// @Description: The orientation of a third external compass relative to the vehicle frame. This value will be ignored unless this compass is set as an external compass. When set correctly in the northern hemisphere, pointing the nose and right side down should increase the MagX and MagY values respectively. Rolling the vehicle upside down should decrease the MagZ value. For southern hemisphere, switch increase and decrease. NOTE: For internal compasses, AHRS_ORIENT is used. The label for each option is specified in the order of rotations for that orientation. Firmware versions 4.2 and prior can use a CUSTOM (100) rotation to set the COMPASS_CUS_ROLL/PIT/YAW angles for Compass orientation. Later versions provide two general custom rotations which can be used, Custom 1 and Custom 2, with CUST_1_ROLL/PIT/YAW or CUST_2_ROLL/PIT/YAW angles.</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    <span class="comment">// @Values: 0:None,1:Yaw45,2:Yaw90,3:Yaw135,4:Yaw180,5:Yaw225,6:Yaw270,7:Yaw315,8:Roll180,9:Yaw45Roll180,10:Yaw90Roll180,11:Yaw135Roll180,12:Pitch180,13:Yaw225Roll180,14:Yaw270Roll180,15:Yaw315Roll180,16:Roll90,17:Yaw45Roll90,18:Yaw90Roll90,19:Yaw135Roll90,20:Roll270,21:Yaw45Roll270,22:Yaw90Roll270,23:Yaw135Roll270,24:Pitch90,25:Pitch270,26:Yaw90Pitch180,27:Yaw270Pitch180,28:Pitch90Roll90,29:Pitch90Roll180,30:Pitch90Roll270,31:Pitch180Roll90,32:Pitch180Roll270,33:Pitch270Roll90,34:Pitch270Roll180,35:Pitch270Roll270,36:Yaw90Pitch180Roll90,37:Yaw270Roll90,38:Yaw293Pitch68Roll180,39:Pitch315,40:Pitch315Roll90,42:Roll45,43:Roll315,100:Custom 4.1 and older,101:Custom 1,102:Custom 2</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ORIENT3&quot;</span>, 22, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[2].orientation, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>),</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span> </div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    <span class="comment">// @Param: EXTERN3</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>    <span class="comment">// @DisplayName: Compass3 is attached via an external cable</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    <span class="comment">// @Description: Configure third compass so it is attached externally. This is auto-detected on most boards. If set to 0 or 1 then auto-detection by bus connection can override the value. If set to 2 then auto-detection will be disabled.</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>    <span class="comment">// @Values: 0:Internal,1:External,2:ForcedExternal</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;EXTERN3&quot;</span>,23, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[2].external, 0),</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_INSTANCES</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span> </div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span><span class="preprocessor">#if AP_COMPASS_DIAGONALS_ENABLED</span></div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>    <span class="comment">// @Param: DIA_X</span></div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>    <span class="comment">// @DisplayName: Compass soft-iron diagonal X component</span></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    <span class="comment">// @Description: DIA_X in the compass soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span> </div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>    <span class="comment">// @Param: DIA_Y</span></div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>    <span class="comment">// @DisplayName: Compass soft-iron diagonal Y component</span></div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    <span class="comment">// @Description: DIA_Y in the compass soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span> </div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <span class="comment">// @Param: DIA_Z</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>    <span class="comment">// @DisplayName: Compass soft-iron diagonal Z component</span></div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    <span class="comment">// @Description: DIA_Z in the compass soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DIA&quot;</span>,    24, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[0].diagonals, 1.0),</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span> </div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    <span class="comment">// @Param: ODI_X</span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>    <span class="comment">// @DisplayName: Compass soft-iron off-diagonal X component</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    <span class="comment">// @Description: ODI_X in the compass soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span> </div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>    <span class="comment">// @Param: ODI_Y</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>    <span class="comment">// @DisplayName: Compass soft-iron off-diagonal Y component</span></div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>    <span class="comment">// @Description: ODI_Y in the compass soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span> </div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>    <span class="comment">// @Param: ODI_Z</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    <span class="comment">// @DisplayName: Compass soft-iron off-diagonal Z component</span></div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    <span class="comment">// @Description: ODI_Z in the compass soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ODI&quot;</span>,    25, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[0].offdiagonals, 0),</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span> </div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>    <span class="comment">// @Param: DIA2_X</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    <span class="comment">// @DisplayName: Compass2 soft-iron diagonal X component</span></div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>    <span class="comment">// @Description: DIA_X in the compass2 soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span> </div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>    <span class="comment">// @Param: DIA2_Y</span></div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>    <span class="comment">// @DisplayName: Compass2 soft-iron diagonal Y component</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>    <span class="comment">// @Description: DIA_Y in the compass2 soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span> </div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>    <span class="comment">// @Param: DIA2_Z</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    <span class="comment">// @DisplayName: Compass2 soft-iron diagonal Z component</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    <span class="comment">// @Description: DIA_Z in the compass2 soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DIA2&quot;</span>,    26, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[1].diagonals, 1.0),</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span> </div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>    <span class="comment">// @Param: ODI2_X</span></div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>    <span class="comment">// @DisplayName: Compass2 soft-iron off-diagonal X component</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>    <span class="comment">// @Description: ODI_X in the compass2 soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span> </div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>    <span class="comment">// @Param: ODI2_Y</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>    <span class="comment">// @DisplayName: Compass2 soft-iron off-diagonal Y component</span></div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>    <span class="comment">// @Description: ODI_Y in the compass2 soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span> </div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    <span class="comment">// @Param: ODI2_Z</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    <span class="comment">// @DisplayName: Compass2 soft-iron off-diagonal Z component</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>    <span class="comment">// @Description: ODI_Z in the compass2 soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ODI2&quot;</span>,    27, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[1].offdiagonals, 0),</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_INSTANCES</span></div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span> </div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 2</span></div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>    <span class="comment">// @Param: DIA3_X</span></div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>    <span class="comment">// @DisplayName: Compass3 soft-iron diagonal X component</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>    <span class="comment">// @Description: DIA_X in the compass3 soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span> </div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>    <span class="comment">// @Param: DIA3_Y</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>    <span class="comment">// @DisplayName: Compass3 soft-iron diagonal Y component</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>    <span class="comment">// @Description: DIA_Y in the compass3 soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span> </div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>    <span class="comment">// @Param: DIA3_Z</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>    <span class="comment">// @DisplayName: Compass3 soft-iron diagonal Z component</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>    <span class="comment">// @Description: DIA_Z in the compass3 soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DIA3&quot;</span>,    28, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[2].diagonals, 1.0),</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span> </div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>    <span class="comment">// @Param: ODI3_X</span></div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>    <span class="comment">// @DisplayName: Compass3 soft-iron off-diagonal X component</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>    <span class="comment">// @Description: ODI_X in the compass3 soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span> </div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>    <span class="comment">// @Param: ODI3_Y</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>    <span class="comment">// @DisplayName: Compass3 soft-iron off-diagonal Y component</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>    <span class="comment">// @Description: ODI_Y in the compass3 soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>    <span class="comment">// @Calibration: 1</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span> </div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>    <span class="comment">// @Param: ODI3_Z</span></div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    <span class="comment">// @DisplayName: Compass3 soft-iron off-diagonal Z component</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    <span class="comment">// @Description: ODI_Z in the compass3 soft-iron calibration matrix: [[DIA_X, ODI_X, ODI_Y], [ODI_X, DIA_Y, ODI_Z], [ODI_Y, ODI_Z, DIA_Z]]</span></div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ODI3&quot;</span>,    29, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[2].offdiagonals, 0),</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_INSTANCES</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span><span class="preprocessor">#endif </span><span class="comment">// AP_COMPASS_DIAGONALS_ENABLED</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span> </div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span><span class="preprocessor">#if COMPASS_CAL_ENABLED</span></div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    <span class="comment">// @Param: CAL_FIT</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    <span class="comment">// @DisplayName: Compass calibration fitness</span></div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    <span class="comment">// @Description: This controls the fitness level required for a successful compass calibration. A lower value makes for a stricter fit (less likely to pass). This is the value used for the primary magnetometer. Other magnetometers get double the value.</span></div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span>    <span class="comment">// @Range: 4 32</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>    <span class="comment">// @Values: 4:Very Strict,8:Strict,16:Default,32:Relaxed</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;CAL_FIT&quot;</span>, 30, <a class="code hl_class" href="classCompass.html">Compass</a>, _calibration_threshold, <a class="code hl_define" href="AP__Compass_8h.html#af4b14d20a1ad32e0d381181e1d92a7ca">AP_COMPASS_CALIBRATION_FITNESS_DEFAULT</a>),</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span> </div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span><span class="preprocessor">#ifndef HAL_BUILD_AP_PERIPH</span></div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    <span class="comment">// @Param: OFFS_MAX</span></div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>    <span class="comment">// @DisplayName: Compass maximum offset</span></div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    <span class="comment">// @Description: This sets the maximum allowed compass offset in calibration and arming checks</span></div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>    <span class="comment">// @Range: 500 3000</span></div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;OFFS_MAX&quot;</span>, 31, <a class="code hl_class" href="classCompass.html">Compass</a>, _offset_max, <a class="code hl_define" href="AP__Compass_8cpp.html#a6db3df6d28073ae8f6bb62bd31c7ca54">AP_COMPASS_OFFSETS_MAX_DEFAULT</a>),</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span> </div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span><span class="preprocessor">#if COMPASS_MOT_ENABLED</span></div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>    <span class="comment">// @Group: PMOT</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>    <span class="comment">// @Path: Compass_PerMotor.cpp</span></div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>    <a class="code hl_define" href="AP__Param_8h.html#a16c360358c5d6a08d34f60921fd916a9">AP_SUBGROUPINFO</a>(_per_motor, <span class="stringliteral">&quot;PMOT&quot;</span>, 32, <a class="code hl_class" href="classCompass.html">Compass</a>, <a class="code hl_class" href="classCompass__PerMotor.html">Compass_PerMotor</a>),</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span> </div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>    <span class="comment">// @Param: DISBLMSK</span></div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>    <span class="comment">// @DisplayName: Compass disable driver type mask</span></div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>    <span class="comment">// @Description: This is a bitmask of driver types to disable. If a driver type is set in this mask then that driver will not try to find a sensor at startup</span></div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>    <span class="comment">// @Bitmask: 0:HMC5883,1:LSM303D,2:AK8963,3:BMM150,4:LSM9DS1,5:LIS3MDL,6:AK09916,7:IST8310,8:ICM20948,9:MMC3416,11:DroneCAN,12:QMC5883,14:MAG3110,15:IST8308,16:RM3100,17:MSP,18:ExternalAHRS</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DISBLMSK&quot;</span>, 33, <a class="code hl_class" href="classCompass.html">Compass</a>, _driver_type_mask, 0),</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span> </div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>    <span class="comment">// @Param: FLTR_RNG</span></div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>    <span class="comment">// @DisplayName: Range in which sample is accepted</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>    <span class="comment">// @Description: This sets the range around the average value that new samples must be within to be accepted. This can help reduce the impact of noise on sensors that are on long I2C cables. The value is a percentage from the average value. A value of zero disables this filter.</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>    <span class="comment">// @Units: %</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>    <span class="comment">// @Range: 0 100</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;FLTR_RNG&quot;</span>, 34, <a class="code hl_class" href="classCompass.html">Compass</a>, _filter_range, <a class="code hl_define" href="AP__Compass_8cpp.html#aced1819bbf63ee14663aa60cca76fa80">HAL_COMPASS_FILTER_DEFAULT</a>),</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span> </div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span><span class="preprocessor">#if COMPASS_CAL_ENABLED</span></div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>    <span class="comment">// @Param: AUTO_ROT</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>    <span class="comment">// @DisplayName: Automatically check orientation</span></div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>    <span class="comment">// @Description: When enabled this will automatically check the orientation of compasses on successful completion of compass calibration. If set to 2 then external compasses will have their orientation automatically corrected.</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>    <span class="comment">// @Values: 0:Disabled,1:CheckOnly,2:CheckAndFix,3:use same tolerance to auto rotate 45 deg rotations</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;AUTO_ROT&quot;</span>, 35, <a class="code hl_class" href="classCompass.html">Compass</a>, _rotate_auto, <a class="code hl_define" href="AP__Compass_8cpp.html#abd241224760f1a380278880c2908a112">HAL_COMPASS_AUTO_ROT_DEFAULT</a>),</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span> </div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>    <span class="comment">// @Param: PRIO1_ID</span></div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>    <span class="comment">// @DisplayName: Compass device id with 1st order priority</span></div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>    <span class="comment">// @Description: Compass device id with 1st order priority, set automatically if 0. Reboot required after change.</span></div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>    <span class="comment">// @RebootRequired: True</span></div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PRIO1_ID&quot;</span>,  36, <a class="code hl_class" href="classCompass.html">Compass</a>, _priority_did_stored_list._priv_instance[0], 0),</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span> </div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>    <span class="comment">// @Param: PRIO2_ID</span></div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>    <span class="comment">// @DisplayName: Compass device id with 2nd order priority</span></div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>    <span class="comment">// @Description: Compass device id with 2nd order priority, set automatically if 0. Reboot required after change.</span></div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>    <span class="comment">// @RebootRequired: True</span></div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PRIO2_ID&quot;</span>, 37, <a class="code hl_class" href="classCompass.html">Compass</a>, _priority_did_stored_list._priv_instance[1], 0),</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_INSTANCES</span></div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span> </div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 2</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>    <span class="comment">// @Param: PRIO3_ID</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>    <span class="comment">// @DisplayName: Compass device id with 3rd order priority</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>    <span class="comment">// @Description: Compass device id with 3rd order priority, set automatically if 0. Reboot required after change.</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>    <span class="comment">// @RebootRequired: True</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PRIO3_ID&quot;</span>, 38, <a class="code hl_class" href="classCompass.html">Compass</a>, _priority_did_stored_list._priv_instance[2], 0),</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_INSTANCES</span></div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span> </div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>    <span class="comment">// @Param: ENABLE</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>    <span class="comment">// @DisplayName: Enable Compass</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>    <span class="comment">// @Description: Setting this to Enabled(1) will enable the compass. Setting this to Disabled(0) will disable the compass. Note that this is separate from COMPASS_USE. This will enable the low level senor, and will enable logging of magnetometer data. To use the compass for navigation you must also set COMPASS_USE to 1.</span></div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>    <span class="comment">// @RebootRequired: True</span></div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>    <span class="comment">// @Values: 0:Disabled,1:Enabled</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ENABLE&quot;</span>, 39, <a class="code hl_class" href="classCompass.html">Compass</a>, _enabled, <a class="code hl_define" href="AP__Compass_8cpp.html#aee5d048c798959cb31261517f64bdfbb">AP_COMPASS_ENABLE_DEFAULT</a>),</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span> </div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span><span class="preprocessor">#ifndef HAL_BUILD_AP_PERIPH</span></div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>    <span class="comment">// @Param: SCALE</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>    <span class="comment">// @DisplayName: Compass1 scale factor</span></div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    <span class="comment">// @Description: Scaling factor for first compass to compensate for sensor scaling errors. If this is 0 then no scaling is done</span></div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>    <span class="comment">// @Range: 0 1.3</span></div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SCALE&quot;</span>, 40, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[0].scale_factor, 0),</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span> </div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>    <span class="comment">// @Param: SCALE2</span></div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>    <span class="comment">// @DisplayName: Compass2 scale factor</span></div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>    <span class="comment">// @Description: Scaling factor for 2nd compass to compensate for sensor scaling errors. If this is 0 then no scaling is done</span></div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>    <span class="comment">// @Range: 0 1.3</span></div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SCALE2&quot;</span>, 41, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[1].scale_factor, 0),</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span> </div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 2</span></div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>    <span class="comment">// @Param: SCALE3</span></div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>    <span class="comment">// @DisplayName: Compass3 scale factor</span></div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>    <span class="comment">// @Description: Scaling factor for 3rd compass to compensate for sensor scaling errors. If this is 0 then no scaling is done</span></div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>    <span class="comment">// @Range: 0 1.3</span></div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SCALE3&quot;</span>, 42, <a class="code hl_class" href="classCompass.html">Compass</a>, _state._priv_instance[2].scale_factor, 0),</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span><span class="preprocessor">#endif </span><span class="comment">// HAL_BUILD_AP_PERIPH</span></div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span> </div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span><span class="preprocessor">#ifndef HAL_BUILD_AP_PERIPH</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>    <span class="comment">// @Param: OPTIONS</span></div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>    <span class="comment">// @DisplayName: Compass options</span></div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>    <span class="comment">// @Description: This sets options to change the behaviour of the compass</span></div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>    <span class="comment">// @Bitmask: 0:CalRequireGPS</span></div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>    <span class="comment">// @Bitmask: 1: Allow missing DroneCAN compasses to be automaticaly replaced (calibration still required)</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;OPTIONS&quot;</span>, 43, <a class="code hl_class" href="classCompass.html">Compass</a>, _options, 0),</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span> </div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span><span class="preprocessor">#if COMPASS_MAX_UNREG_DEV &gt; 0</span></div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>    <span class="comment">// @Param: DEV_ID4</span></div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>    <span class="comment">// @DisplayName: Compass4 device id</span></div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>    <span class="comment">// @Description: Extra 4th compass&#39;s device id.  Automatically detected, do not set manually</span></div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>    <span class="comment">// @ReadOnly: True</span></div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DEV_ID4&quot;</span>, 44, <a class="code hl_class" href="classCompass.html">Compass</a>, extra_dev_id[0], 0),</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_UNREG_DEV</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span> </div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span><span class="preprocessor">#if COMPASS_MAX_UNREG_DEV &gt; 1</span></div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>    <span class="comment">// @Param: DEV_ID5</span></div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>    <span class="comment">// @DisplayName: Compass5 device id</span></div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>    <span class="comment">// @Description: Extra 5th compass&#39;s device id.  Automatically detected, do not set manually</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>    <span class="comment">// @ReadOnly: True</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DEV_ID5&quot;</span>, 45, <a class="code hl_class" href="classCompass.html">Compass</a>, extra_dev_id[1], 0),</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_UNREG_DEV</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span> </div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span><span class="preprocessor">#if COMPASS_MAX_UNREG_DEV &gt; 2</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>    <span class="comment">// @Param: DEV_ID6</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>    <span class="comment">// @DisplayName: Compass6 device id</span></div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>    <span class="comment">// @Description: Extra 6th compass&#39;s device id.  Automatically detected, do not set manually</span></div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    <span class="comment">// @ReadOnly: True</span></div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DEV_ID6&quot;</span>, 46, <a class="code hl_class" href="classCompass.html">Compass</a>, extra_dev_id[2], 0),</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_UNREG_DEV</span></div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span> </div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span><span class="preprocessor">#if COMPASS_MAX_UNREG_DEV &gt; 3</span></div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>    <span class="comment">// @Param: DEV_ID7</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>    <span class="comment">// @DisplayName: Compass7 device id</span></div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>    <span class="comment">// @Description: Extra 7th compass&#39;s device id.  Automatically detected, do not set manually</span></div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>    <span class="comment">// @ReadOnly: True</span></div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DEV_ID7&quot;</span>, 47, <a class="code hl_class" href="classCompass.html">Compass</a>, extra_dev_id[3], 0),</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_UNREG_DEV</span></div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span> </div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span><span class="preprocessor">#if COMPASS_MAX_UNREG_DEV &gt; 4</span></div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>    <span class="comment">// @Param: DEV_ID8</span></div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>    <span class="comment">// @DisplayName: Compass8 device id</span></div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>    <span class="comment">// @Description: Extra 8th compass&#39;s device id.  Automatically detected, do not set manually</span></div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>    <span class="comment">// @ReadOnly: True</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DEV_ID8&quot;</span>, 48, <a class="code hl_class" href="classCompass.html">Compass</a>, extra_dev_id[4], 0),</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_UNREG_DEV</span></div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span> </div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>    <span class="comment">// @Param: CUS_ROLL</span></div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>    <span class="comment">// @DisplayName: Custom orientation roll offset</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>    <span class="comment">// @Description: Compass mounting position roll offset. Positive values = roll right, negative values = roll left. This parameter is only used when COMPASS_ORIENT/2/3 is set to CUSTOM.</span></div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>    <span class="comment">// @Range: -180 180</span></div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>    <span class="comment">// @Units: deg</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>    <span class="comment">// @RebootRequired: True</span></div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span> </div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>    <span class="comment">// index 49</span></div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span> </div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>    <span class="comment">// @Param: CUS_PIT</span></div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>    <span class="comment">// @DisplayName: Custom orientation pitch offset</span></div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>    <span class="comment">// @Description: Compass mounting position pitch offset. Positive values = pitch up, negative values = pitch down. This parameter is only used when COMPASS_ORIENT/2/3 is set to CUSTOM.</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>    <span class="comment">// @Range: -180 180</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>    <span class="comment">// @Units: deg</span></div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>    <span class="comment">// @RebootRequired: True</span></div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span> </div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>    <span class="comment">// index 50</span></div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span> </div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>    <span class="comment">// @Param: CUS_YAW</span></div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>    <span class="comment">// @DisplayName: Custom orientation yaw offset</span></div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>    <span class="comment">// @Description: Compass mounting position yaw offset. Positive values = yaw right, negative values = yaw left. This parameter is only used when COMPASS_ORIENT/2/3 is set to CUSTOM.</span></div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>    <span class="comment">// @Range: -180 180</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>    <span class="comment">// @Units: deg</span></div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>    <span class="comment">// @RebootRequired: True</span></div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span> </div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>    <span class="comment">// index 51</span></div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span> </div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>    <a class="code hl_define" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>};</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span> </div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span><span class="comment">// Default constructor.</span></div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span><span class="comment">// Note that the Vector/Matrix constructors already implicitly zero</span></div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span><span class="comment">// their values.</span></div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span><span class="comment">//</span></div>
<div class="foldopen" id="foldopen00693" data-start="{" data-end="}">
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno"><a class="line" href="classCompass.html#a68bd2a073cc0d461b2b46529aae04765">  693</a></span><a class="code hl_function" href="classCompass.html#a68bd2a073cc0d461b2b46529aae04765">Compass::Compass</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>{</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#aa3e1ccaef661d5ff5d2e51cd7742c6ba">_singleton</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span><span class="preprocessor">#if CONFIG_HAL_BOARD == HAL_BOARD_SITL</span></div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>        <a class="code hl_function" href="namespaceAP__HAL.html#a52edeef7d5ffaa365e1229b87c170307">AP_HAL::panic</a>(<span class="stringliteral">&quot;Compass must be singleton&quot;</span>);</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>    }</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>    <a class="code hl_variable" href="classCompass.html#aa3e1ccaef661d5ff5d2e51cd7742c6ba">_singleton</a> = <span class="keyword">this</span>;</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span>    <a class="code hl_function" href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a>(<span class="keyword">this</span>, var_info);</div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span>}</div>
</div>
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno">  704</span> </div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span><span class="comment">// Default init method</span></div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span><span class="comment">//</span></div>
<div class="foldopen" id="foldopen00707" data-start="{" data-end="}">
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno"><a class="line" href="classCompass.html#a79db6bfd3fe309c6258d783f126326c6">  707</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classCompass.html#a79db6bfd3fe309c6258d783f126326c6">Compass::init</a>()</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>{</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classCompass.html#ab315b6dc2d05ea4649d5cf8f1a2b511a">_enabled</a>) {</div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>    }</div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span> </div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span><span class="comment">      on init() if any devid is set then we set suppress_devid_save to</span></div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span><span class="comment">      false. This is used to determine if we save device ids during</span></div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span><span class="comment">      the init process.</span></div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span><span class="comment">     */</span></div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span>    <a class="code hl_variable" href="classCompass.html#a9921f864c9ba926d0b5ad318f3ba66f6">suppress_devid_save</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>._priv_instance[i].dev_id != 0) {</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>            <a class="code hl_variable" href="classCompass.html#a9921f864c9ba926d0b5ad318f3ba66f6">suppress_devid_save</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>        }</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>.<a class="code hl_variable" href="classRestrictIDTypeArray.html#a0b10d9276b019b22ce10901178da2827">_priv_instance</a>[i] != 0) {</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>            <a class="code hl_variable" href="classCompass.html#a9921f864c9ba926d0b5ad318f3ba66f6">suppress_devid_save</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>        }</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>    }</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span> </div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span>    <span class="comment">// convert to new custom rotation method</span></div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>    <span class="comment">// PARAMETER_CONVERSION - Added: Nov-2021</span></div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span><span class="preprocessor">#if AP_CUSTOMROTATIONS_ENABLED</span></div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>    <span class="keywordflow">for</span> (StateIndex i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].orientation != <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681ae7d6d0015028e041def96e2ba339bba7">ROTATION_CUSTOM_OLD</a>) {</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>        }</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].orientation.set_and_save(<a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681ad5347a011def1f02c6a2a7bf2b1fb780">ROTATION_CUSTOM_2</a>);</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>        <a class="code hl_struct" href="structAP__Param_1_1ConversionInfo.html">AP_Param::ConversionInfo</a> info;</div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__Param.html#a97a7b5f898c84c99cb57c76d4ddc870c">AP_Param::find_top_level_key_by_pointer</a>(<span class="keyword">this</span>, info.<a class="code hl_variable" href="structAP__Param_1_1ConversionInfo.html#a75ff5c9be71f27763a405bb41e0c0aff">old_key</a>)) {</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>            info.<a class="code hl_variable" href="structAP__Param_1_1ConversionInfo.html#aefe1f37268bb6e4cdb0920db26127a7f">type</a> = <a class="code hl_enumvalue" href="AP__Param_8h.html#ad9ca22a1e508dceea20feda89a344f9aa6b298bc938d9667ff3d25c0e8b94c349">AP_PARAM_FLOAT</a>;</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>            <span class="keywordtype">float</span> rpy[3] = {};</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>            AP_Float rpy_param;</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>            <span class="keywordflow">for</span> (info.<a class="code hl_variable" href="structAP__Param_1_1ConversionInfo.html#ac734a9afbd723a353dd23e05006c8f90">old_group_element</a>=49; info.<a class="code hl_variable" href="structAP__Param_1_1ConversionInfo.html#ac734a9afbd723a353dd23e05006c8f90">old_group_element</a>&lt;=51; info.<a class="code hl_variable" href="structAP__Param_1_1ConversionInfo.html#ac734a9afbd723a353dd23e05006c8f90">old_group_element</a>++) {</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__Param.html#a857c14c819b6d550957d0f9c56c379d0">AP_Param::find_old_parameter</a>(&amp;info, &amp;rpy_param)) {</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>                    rpy[info.<a class="code hl_variable" href="structAP__Param_1_1ConversionInfo.html#ac734a9afbd723a353dd23e05006c8f90">old_group_element</a>-49] = rpy_param.get();</div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>                }</div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>            }</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>            <a class="code hl_function" href="namespaceAP.html#a1a3d63c4a3dd8a0bd9a17a0e500ead31">AP::custom_rotations</a>().<a class="code hl_function" href="classAP__CustomRotations.html#a55d430e886478ffd871f38686b216c5d">convert</a>(<a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681ad5347a011def1f02c6a2a7bf2b1fb780">ROTATION_CUSTOM_2</a>, rpy[0], rpy[1], rpy[2]);</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>        }</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>    }</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span><span class="preprocessor">#endif  </span><span class="comment">// AP_CUSTOMROTATIONS_ENABLED</span></div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span> </div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>    <span class="comment">// Look if there was a primary compass setup in previous version</span></div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>    <span class="comment">// if so and the primary compass is not set in current setup</span></div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>    <span class="comment">// make the devid as primary.</span></div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[Priority(0)] == 0) {</div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>        uint16_t k_param_compass;</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__Param.html#a97a7b5f898c84c99cb57c76d4ddc870c">AP_Param::find_top_level_key_by_pointer</a>(<span class="keyword">this</span>, k_param_compass)) {</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>            <span class="keyword">const</span> <a class="code hl_struct" href="structAP__Param_1_1ConversionInfo.html">AP_Param::ConversionInfo</a> primary_compass_old_param = {k_param_compass, 12, <a class="code hl_enumvalue" href="AP__Param_8h.html#ad9ca22a1e508dceea20feda89a344f9aae846a3e359a88214fe754f3862bc9347">AP_PARAM_INT8</a>, <span class="stringliteral">&quot;&quot;</span>};</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>            AP_Int8 <a class="code hl_typedef" href="AP__JSON_8cpp.html#a37700c57263ada4716d7dbbc43089a24">value</a>;</div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>            <a class="code hl_class" href="classAP__JSON_1_1value.html">value</a>.<a class="code hl_function" href="classAP__JSON_1_1value.html#aabbfc0b8e550ba2be749158f4312f6a8">set</a>(0);</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>            <span class="keywordtype">bool</span> primary_param_exists = <a class="code hl_function" href="classAP__Param.html#a857c14c819b6d550957d0f9c56c379d0">AP_Param::find_old_parameter</a>(&amp;primary_compass_old_param, &amp;<a class="code hl_class" href="classAP__JSON_1_1value.html">value</a>);</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>            int8_t oldvalue = <a class="code hl_class" href="classAP__JSON_1_1value.html">value</a>.<a class="code hl_function" href="classAP__JSON_1_1value.html#a32a893be19e12a7e7e439c1eda273b7d">get</a>();</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>            <span class="keywordflow">if</span> ((oldvalue!=0) &amp;&amp; (oldvalue&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) &amp;&amp; primary_param_exists) {</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>                <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[Priority(0)].set_and_save_ifchanged(<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[StateIndex(oldvalue)].dev_id);</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>            }</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>        }</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>    }</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span> </div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>    <span class="comment">// Load priority list from storage, the changes to priority list</span></div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>    <span class="comment">// by user only take effect post reboot, after this</span></div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classCompass.html#a9921f864c9ba926d0b5ad318f3ba66f6">suppress_devid_save</a>) {</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>        <span class="keywordflow">for</span> (Priority i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[i] != 0) {</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>                <a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[i] = <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[i];</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>                <span class="comment">// Maintain a list without gaps and duplicates</span></div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span>                <span class="keywordflow">for</span> (Priority j(i+1); j&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; j++) {</div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>                    int32_t temp;</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[j] == <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[i]) {</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>                        <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[j].set_and_save_ifchanged(0);</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>                    }</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>                    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[j] == 0) {</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>                    }</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>                    temp = <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[j];</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>                    <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[j].set_and_save_ifchanged(0);</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>                    <a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[i] = temp;</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>                    <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[i].set_and_save_ifchanged(temp);</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>                    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span>                }</div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>            }</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>        }</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>    }</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span><span class="preprocessor">#endif </span><span class="comment">// COMPASS_MAX_INSTANCES</span></div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span> </div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span>    <span class="comment">// cache expected dev ids for use during runtime detection</span></div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>    <span class="keywordflow">for</span> (StateIndex i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].expected_dev_id = <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].dev_id;</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>    }</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span> </div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span><span class="preprocessor">#if COMPASS_MAX_UNREG_DEV</span></div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>    <span class="comment">// set the dev_id to 0 for undetected compasses. extra_dev_id is just an</span></div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>    <span class="comment">// interface for users to see unreg compasses, we actually never store it</span></div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>    <span class="comment">// in storage.</span></div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>    <span class="keywordflow">for</span> (uint8_t i=<a class="code hl_variable" href="classCompass.html#a26f0faff382edb23410e1beb8e9a18e5">_unreg_compass_count</a>; i&lt;<a class="code hl_define" href="AP__Compass_8h.html#ac01ecc2c9da354c12911bb0ecfa5b7e6">COMPASS_MAX_UNREG_DEV</a>; i++) {</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>        <span class="comment">// cache the extra devices detected in last boot</span></div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>        <span class="comment">// for detecting replacement mag</span></div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>        <a class="code hl_variable" href="classCompass.html#ad15f118665655ffc5e9791abf7737c29">_previously_unreg_mag</a>[i] = <a class="code hl_variable" href="classCompass.html#a86a6d63e7b398dd8b0098371d53c0ea3">extra_dev_id</a>[i];</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>        <a class="code hl_variable" href="classCompass.html#a86a6d63e7b398dd8b0098371d53c0ea3">extra_dev_id</a>[i].set(0);</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>    }</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span> </div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>    <span class="comment">// This method calls set_and_save_ifchanged on parameters</span></div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>    <span class="comment">// which are set() but not saved() during normal runtime,</span></div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>    <span class="comment">// do not move this call without ensuring that is not happening</span></div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>    <span class="comment">// read comments under set_and_save_ifchanged for details</span></div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classCompass.html#a9921f864c9ba926d0b5ad318f3ba66f6">suppress_devid_save</a>) {</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>        <a class="code hl_function" href="classCompass.html#a7af9628dd3e3b814a11241d91996562b">_reorder_compass_params</a>();</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>    }</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span> </div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#afd52e3b95b4813b56a79742c0d98e6e4">_compass_count</a> == 0) {</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>        <span class="comment">// detect available backends. Only called once</span></div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>        <a class="code hl_function" href="classCompass.html#a1c48170d8c8966b22fb150b1634443ec">_detect_backends</a>();</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>    }</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span> </div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#afd52e3b95b4813b56a79742c0d98e6e4">_compass_count</a> != 0) {</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>        <span class="comment">// get initial health status</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Scheduler.html#ab3175e2e6223ccfe82f957e41cc12b26">delay</a>(100);</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>        <a class="code hl_function" href="classCompass.html#a2593e947a6c8a4937dccd2d367158b74">read</a>();</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>    }</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>    <span class="comment">// set the dev_id to 0 for undetected compasses, to make it easier</span></div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>    <span class="comment">// for users to see how many compasses are detected. We don&#39;t do a</span></div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>    <span class="comment">// set_and_save() as the user may have temporarily removed the</span></div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>    <span class="comment">// compass, and we don&#39;t want to force a re-cal if they plug it</span></div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>    <span class="comment">// back in again</span></div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>    <span class="keywordflow">for</span> (StateIndex i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].registered) {</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>            <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].dev_id.set(0);</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>        }</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>    }</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span> </div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span><span class="preprocessor">#ifndef HAL_BUILD_AP_PERIPH</span></div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>    <span class="comment">// updating the AHRS orientation updates our own orientation:</span></div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>    <a class="code hl_function" href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a>().<a class="code hl_function" href="classAP__AHRS.html#a7284d5e65c5863f5678b4d93000b116e">update_orientation</a>();</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span> </div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span>    <a class="code hl_variable" href="classCompass.html#a72dcc2b111d806635ebde2700e70a33c">init_done</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span>    <a class="code hl_variable" href="classCompass.html#a9921f864c9ba926d0b5ad318f3ba66f6">suppress_devid_save</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno">  856</span>}</div>
</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span> </div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1 || COMPASS_MAX_UNREG_DEV</span></div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span><span class="comment">// Update Priority List for Mags, by default, we just</span></div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span><span class="comment">// load them as they come up the first time</span></div>
<div class="foldopen" id="foldopen00861" data-start="{" data-end="}">
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno"><a class="line" href="classCompass.html#a24c1845620411cd3e169d4a04ecc66dd">  861</a></span>Compass::Priority <a class="code hl_function" href="classCompass.html#a24c1845620411cd3e169d4a04ecc66dd">Compass::_update_priority_list</a>(int32_t dev_id)</div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>{</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>    <span class="comment">// Check if already in priority list</span></div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>    <span class="keywordflow">for</span> (Priority i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[i] == dev_id) {</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>            <span class="keywordflow">if</span> (i &gt;= <a class="code hl_variable" href="classCompass.html#afd52e3b95b4813b56a79742c0d98e6e4">_compass_count</a>) {</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>                <a class="code hl_variable" href="classCompass.html#afd52e3b95b4813b56a79742c0d98e6e4">_compass_count</a> = uint8_t(i)+1;</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>            }</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>            <span class="keywordflow">return</span> i;</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>        }</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>    }</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span> </div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>    <span class="comment">// We are not in priority list, let&#39;s add at first empty</span></div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>    <span class="keywordflow">for</span> (Priority i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[i] == 0) {</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a9921f864c9ba926d0b5ad318f3ba66f6">suppress_devid_save</a>) {</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>                <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[i].set(dev_id);</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>                <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[i].set_and_save(dev_id);</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>            }</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>            <a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[i] = dev_id;</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>            <span class="keywordflow">if</span> (i &gt;= <a class="code hl_variable" href="classCompass.html#afd52e3b95b4813b56a79742c0d98e6e4">_compass_count</a>) {</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>                <a class="code hl_variable" href="classCompass.html#afd52e3b95b4813b56a79742c0d98e6e4">_compass_count</a> = uint8_t(i)+1;</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>            }</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>            <span class="keywordflow">return</span> i;</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>        }</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>    }</div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>    <span class="keywordflow">return</span> Priority(<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>);</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>}</div>
</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span> </div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span> </div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span><span class="comment">// This method reorganises devid list to match</span></div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span><span class="comment">// priority list, only call before detection at boot</span></div>
<div class="foldopen" id="foldopen00896" data-start="{" data-end="}">
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno"><a class="line" href="classCompass.html#a7af9628dd3e3b814a11241d91996562b">  896</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classCompass.html#a7af9628dd3e3b814a11241d91996562b">Compass::_reorder_compass_params</a>()</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>{</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>    <a class="code hl_struct" href="structCompass_1_1mag__state.html">mag_state</a> swap_state;</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>    StateIndex curr_state_id;</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>    <span class="keywordflow">for</span> (Priority i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[i] == 0) {</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>        }</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>        curr_state_id = <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>;</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>        <span class="keywordflow">for</span> (StateIndex j(0); j&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; j++) {</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[i] == <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[j].dev_id) {</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>                curr_state_id = j;</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>            }</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>        }</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>        <span class="keywordflow">if</span> (curr_state_id != <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a> &amp;&amp; uint8_t(curr_state_id) != uint8_t(i)) {</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>            <span class="comment">//let&#39;s swap</span></div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>            swap_state.<a class="code hl_function" href="structCompass_1_1mag__state.html#a5302e4e3e39eba5731acaf5185155287">copy_from</a>(<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[curr_state_id]);</div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>            <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[curr_state_id].copy_from(<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[StateIndex(uint8_t(i))]);</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>            <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[StateIndex(uint8_t(i))].copy_from(swap_state);</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>        }</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>    }</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>}</div>
</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span> </div>
<div class="foldopen" id="foldopen00921" data-start="{" data-end="}">
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno"><a class="line" href="structCompass_1_1mag__state.html#a5302e4e3e39eba5731acaf5185155287">  921</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="structCompass_1_1mag__state.html#a5302e4e3e39eba5731acaf5185155287">Compass::mag_state::copy_from</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structCompass_1_1mag__state.html">Compass::mag_state</a>&amp; <a class="code hl_variable" href="AP__Scripting_2generator_2src_2main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a>)</div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>{</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>    <a class="code hl_variable" href="structCompass_1_1mag__state.html#a6e1b66a2e77ea4c79a545bf1951e85a3">external</a>.set_and_save_ifchanged(<a class="code hl_variable" href="AP__Scripting_2generator_2src_2main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a>.external);</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>    <a class="code hl_variable" href="structCompass_1_1mag__state.html#a037376c09d0116a149c11cceac015c6a">orientation</a>.set_and_save_ifchanged(<a class="code hl_variable" href="AP__Scripting_2generator_2src_2main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a>.orientation);</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>    <a class="code hl_variable" href="structCompass_1_1mag__state.html#a3e2ff88eb37ae470b4c1b4b3c232305e">offset</a>.set_and_save_ifchanged(<a class="code hl_variable" href="AP__Scripting_2generator_2src_2main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a>.offset);</div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span><span class="preprocessor">#if AP_COMPASS_DIAGONALS_ENABLED</span></div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>    <a class="code hl_variable" href="structCompass_1_1mag__state.html#a50dc445d1c9b8ed874a7a7d7054737d2">diagonals</a>.set_and_save_ifchanged(<a class="code hl_variable" href="AP__Scripting_2generator_2src_2main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a>.diagonals);</div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>    <a class="code hl_variable" href="structCompass_1_1mag__state.html#a4ac6e96bb0e028b4bad4faba7ecdb8c1">offdiagonals</a>.set_and_save_ifchanged(<a class="code hl_variable" href="AP__Scripting_2generator_2src_2main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a>.offdiagonals);</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>    <a class="code hl_variable" href="structCompass_1_1mag__state.html#a36f869627ba5bb5d3060aa8816e98f13">scale_factor</a>.set_and_save_ifchanged(<a class="code hl_variable" href="AP__Scripting_2generator_2src_2main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a>.scale_factor);</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>    <a class="code hl_variable" href="structCompass_1_1mag__state.html#afe6deabcf507751cd66c36639bb9dde0">dev_id</a>.set_and_save_ifchanged(<a class="code hl_variable" href="AP__Scripting_2generator_2src_2main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a>.dev_id);</div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>    <a class="code hl_variable" href="structCompass_1_1mag__state.html#a90887b7c30ed529dc3fecfb36729f9d7">motor_compensation</a>.set_and_save_ifchanged(<a class="code hl_variable" href="AP__Scripting_2generator_2src_2main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a>.motor_compensation);</div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>    <a class="code hl_variable" href="structCompass_1_1mag__state.html#ab31c41328588f72210c09ffee6e1e7bd">expected_dev_id</a> = <a class="code hl_variable" href="AP__Scripting_2generator_2src_2main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a>.expected_dev_id;</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>    <a class="code hl_variable" href="structCompass_1_1mag__state.html#ae481124101db4d2104091b1ddc0f4085">detected_dev_id</a> = <a class="code hl_variable" href="AP__Scripting_2generator_2src_2main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a>.detected_dev_id;</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>}</div>
</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span><span class="comment">//  Register a new compass instance</span></div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span><span class="comment">//</span></div>
<div class="foldopen" id="foldopen00938" data-start="{" data-end="}">
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno"><a class="line" href="classCompass.html#a1c33938b408e23179770f88aec029f57">  938</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classCompass.html#a1c33938b408e23179770f88aec029f57">Compass::register_compass</a>(int32_t dev_id, uint8_t&amp; <a class="code hl_variable" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a>)</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>{</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span> </div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES == 1 &amp;&amp; !COMPASS_MAX_UNREG_DEV</span></div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>    <span class="comment">// simple single compass setup for AP_Periph</span></div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>    Priority <a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a>(0);</div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>    StateIndex i(0);</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].registered) {</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>    }</div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>    <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].registered = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>    <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].priority = <a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a>;</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>    <a class="code hl_variable" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> = uint8_t(i);</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>    <a class="code hl_variable" href="classCompass.html#afd52e3b95b4813b56a79742c0d98e6e4">_compass_count</a> = 1;</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>    Priority <a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a>;</div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>    <span class="comment">// Check if we already have this dev_id registered</span></div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>    <span class="keywordflow">for</span> (StateIndex i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>        <a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a> = <a class="code hl_function" href="classCompass.html#a24c1845620411cd3e169d4a04ecc66dd">_update_priority_list</a>(dev_id);</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].expected_dev_id == dev_id &amp;&amp; <a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a> &lt; <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) {</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>            <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].registered = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>            <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].priority = <a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a>;</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>            <a class="code hl_variable" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> = uint8_t(i);</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>        }</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>    }</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span> </div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>    <span class="comment">// This is an unregistered compass, check if any free slot is available</span></div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>    <span class="keywordflow">for</span> (StateIndex i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>        <a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a> = <a class="code hl_function" href="classCompass.html#a24c1845620411cd3e169d4a04ecc66dd">_update_priority_list</a>(dev_id);</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].dev_id == 0 &amp;&amp; <a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a> &lt; <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) {</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>            <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].registered = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>            <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].priority = <a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a>;</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>            <a class="code hl_variable" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> = uint8_t(i);</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>        }</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>    }</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span> </div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>    <span class="comment">// This might be a replacement compass module, find any unregistered compass</span></div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>    <span class="comment">// instance and replace that</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>    <span class="keywordflow">for</span> (StateIndex i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>        <a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a> = <a class="code hl_function" href="classCompass.html#a24c1845620411cd3e169d4a04ecc66dd">_update_priority_list</a>(dev_id);</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].registered &amp;&amp; <a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a> &lt; <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) {</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>            <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].registered = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>            <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].priority = <a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a>;</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>            <a class="code hl_variable" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> = uint8_t(i);</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>        }</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>    }</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span> </div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span><span class="preprocessor">#if COMPASS_MAX_UNREG_DEV</span></div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>    <span class="comment">// Set extra dev id</span></div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a26f0faff382edb23410e1beb8e9a18e5">_unreg_compass_count</a> &gt;= <a class="code hl_define" href="AP__Compass_8h.html#ac01ecc2c9da354c12911bb0ecfa5b7e6">COMPASS_MAX_UNREG_DEV</a>) {</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>        <a class="code hl_function" href="namespaceAP__HAL.html#a52edeef7d5ffaa365e1229b87c170307">AP_HAL::panic</a>(<span class="stringliteral">&quot;Too many compass instances&quot;</span>);</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span>    }</div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span> </div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code hl_define" href="AP__Compass_8h.html#ac01ecc2c9da354c12911bb0ecfa5b7e6">COMPASS_MAX_UNREG_DEV</a>; i++) {</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a86a6d63e7b398dd8b0098371d53c0ea3">extra_dev_id</a>[i] == dev_id) {</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>            <span class="keywordflow">if</span> (i &gt;= <a class="code hl_variable" href="classCompass.html#a26f0faff382edb23410e1beb8e9a18e5">_unreg_compass_count</a>) {</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>                <a class="code hl_variable" href="classCompass.html#a26f0faff382edb23410e1beb8e9a18e5">_unreg_compass_count</a> = i+1;</div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>            }</div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>            <a class="code hl_variable" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> = i+<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>;</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a86a6d63e7b398dd8b0098371d53c0ea3">extra_dev_id</a>[i] == 0) {</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>            <a class="code hl_variable" href="classCompass.html#a86a6d63e7b398dd8b0098371d53c0ea3">extra_dev_id</a>[<a class="code hl_variable" href="classCompass.html#a26f0faff382edb23410e1beb8e9a18e5">_unreg_compass_count</a>++].set(dev_id);</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>            <a class="code hl_variable" href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a> = i+<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>;</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>        }</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>    }</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>    <a class="code hl_function" href="namespaceAP__HAL.html#a52edeef7d5ffaa365e1229b87c170307">AP_HAL::panic</a>(<span class="stringliteral">&quot;Too many compass instances&quot;</span>);</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span> </div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>}</div>
</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span> </div>
<div class="foldopen" id="foldopen01016" data-start="{" data-end="}">
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"><a class="line" href="classCompass.html#a5b6bd29bfc993d353ed2f8b03b387de4"> 1016</a></span>Compass::StateIndex <a class="code hl_function" href="classCompass.html#a5b6bd29bfc993d353ed2f8b03b387de4">Compass::_get_state_id</a>(Compass::Priority <a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[<a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a>] == 0) {</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>        <span class="keywordflow">return</span> StateIndex(<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>);</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>    }</div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>    <span class="keywordflow">for</span> (StateIndex i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[<a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a>] == <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].detected_dev_id) {</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>            <span class="keywordflow">return</span> i;</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>        }</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>    }</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>    <span class="keywordflow">return</span> StateIndex(<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>);</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>    <span class="keywordflow">return</span> StateIndex(0);</div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>}</div>
</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span> </div>
<div class="foldopen" id="foldopen01033" data-start="{" data-end="}">
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"><a class="line" href="classCompass.html#a23dca9254efb3dedb9dcd565c829d707"> 1033</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classCompass.html#a23dca9254efb3dedb9dcd565c829d707">Compass::_add_backend</a>(<a class="code hl_class" href="classAP__Compass__Backend.html">AP_Compass_Backend</a> *backend)</div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>{</div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>    <span class="keywordflow">if</span> (!backend) {</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>    }</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span> </div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#ac3bf8f6ab108927b2ea704b3dcba1355">_backend_count</a> == <a class="code hl_define" href="AP__Compass_8h.html#a5ae256887a80a65f39d06f1cb2cbfacb">COMPASS_MAX_BACKEND</a>) {</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>    }</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span> </div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>    <a class="code hl_variable" href="classCompass.html#af46d67cb8eb4bc4c51bb12be6813cfdd">_backends</a>[<a class="code hl_variable" href="classCompass.html#ac3bf8f6ab108927b2ea704b3dcba1355">_backend_count</a>++] = backend;</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span> </div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>}</div>
</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span> </div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span><span class="comment">/*</span></div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span><span class="comment">  return true if a driver type is enabled</span></div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen01051" data-start="{" data-end="}">
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"><a class="line" href="classCompass.html#a678ad037acc44e46598012b7ad17b2a6"> 1051</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classCompass.html#a678ad037acc44e46598012b7ad17b2a6">Compass::_driver_enabled</a>(<span class="keyword">enum</span> <a class="code hl_enumeration" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19">DriverType</a> driver_type)</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>{</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>    uint32_t mask = (1U&lt;&lt;uint8_t(driver_type));</div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>    <span class="keywordflow">return</span> (mask &amp; uint32_t(<a class="code hl_variable" href="classCompass.html#aa2db70e5e7eb6b25d70550322849b862">_driver_type_mask</a>.get())) == 0;</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>}</div>
</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span> </div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span><span class="comment">/*</span></div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span><span class="comment">  wrapper around hal.i2c_mgr-&gt;get_device() that prevents duplicate devices being opened</span></div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen01060" data-start="{" data-end="}">
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"><a class="line" href="classCompass.html#a32fb8b55b7ee1c439e7c42ce2c02f5eb"> 1060</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classCompass.html#a32fb8b55b7ee1c439e7c42ce2c02f5eb">Compass::_have_i2c_driver</a>(uint8_t bus, uint8_t address)<span class="keyword"> const</span></div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>    <span class="keywordflow">for</span> (StateIndex i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].registered) {</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>        }</div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__HAL_1_1Device.html#ad75f42859a61892f9de8273c514dd360">AP_HAL::Device::make_bus_id</a>(<a class="code hl_enumvalue" href="classAP__HAL_1_1Device.html#abdd5c39f57e7022979565e92b6578ba1a3cba5573df48b0d7c5c9e7e307f09da9">AP_HAL::Device::BUS_TYPE_I2C</a>, bus, address, 0) ==</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span>            <a class="code hl_function" href="classAP__HAL_1_1Device.html#ac6d1c8dc3010b5531b896f1c265fb232">AP_HAL::Device::change_bus_id</a>(uint32_t(<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].dev_id.get()), 0)) {</div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>            <span class="comment">// we are already using this device</span></div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>        }</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>    }</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>}</div>
</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span> </div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span><span class="preprocessor">#if COMPASS_MAX_UNREG_DEV &gt; 0</span></div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"><a class="line" href="AP__Compass_8cpp.html#ad644760d1cab90de3f8ad72b11a7c2a7"> 1076</a></span><span class="preprocessor">#define CHECK_UNREG_LIMIT_RETURN  if (_unreg_compass_count == COMPASS_MAX_UNREG_DEV) return</span></div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span><span class="preprocessor">#define CHECK_UNREG_LIMIT_RETURN</span></div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span> </div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span><span class="comment">/*</span></div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span><span class="comment">  macro to add a backend with check for too many backends or compass</span></div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span><span class="comment">  instances. We don&#39;t try to start more than the maximum allowed</span></div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen01085" data-start="" data-end="">
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"><a class="line" href="AP__Compass_8cpp.html#abb423de10259a16fffedfcb56781ab4c"> 1085</a></span><span class="preprocessor">#define ADD_BACKEND(driver_type, backend)   \</span></div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span><span class="preprocessor">    do { if (_driver_enabled(driver_type)) { _add_backend(backend); } \</span></div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span><span class="preprocessor">        CHECK_UNREG_LIMIT_RETURN; \</span></div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span><span class="preprocessor">    } while (0)</span></div>
</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span> </div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"><a class="line" href="AP__Compass_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02"> 1090</a></span><span class="preprocessor">#define GET_I2C_DEVICE(bus, address) _have_i2c_driver(bus, address)?nullptr:hal.i2c_mgr-&gt;get_device(bus, address)</span></div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span> </div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span><span class="comment">/*</span></div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span><span class="comment">  look for compasses on external i2c buses</span></div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen01095" data-start="{" data-end="}">
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"><a class="line" href="classCompass.html#a766d77e1b78dc08be50ba76994c8b4ab"> 1095</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classCompass.html#a766d77e1b78dc08be50ba76994c8b4ab">Compass::_probe_external_i2c_compasses</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>{</div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span><span class="preprocessor">#if !defined(HAL_SKIP_AUTO_INTERNAL_I2C_PROBE)</span></div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>    <span class="keywordtype">bool</span> all_external = (<a class="code hl_function" href="classAP__BoardConfig.html#a8a3185c191ab40fd95ceeadd8a5b0cf9">AP_BoardConfig::get_board_type</a>() == <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ad387380811280b3f995f8387ab50264e">AP_BoardConfig::PX4_BOARD_PIXHAWK2</a>);</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>    (void)all_external;  <span class="comment">// in case all backends using this are compiled out</span></div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span><span class="preprocessor">#if AP_COMPASS_HMC5843_ENABLED</span></div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>    <span class="comment">// external i2c bus</span></div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#a09f11b4bf995e11cb0b54264fa1b831c">FOREACH_I2C_EXTERNAL</a>(i) {</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a217078085d95a700a86b76f0446e6909">DRIVER_HMC5843</a>, <a class="code hl_function" href="classAP__Compass__HMC5843.html#a09a02590425dc0fd9470cfef5d820af6">AP_Compass_HMC5843::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__HMC5843_8h.html#a51869742d3196f59f9e5e323f9d6c11b">HAL_COMPASS_HMC5843_I2C_ADDR</a>),</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>                    <span class="keyword">true</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681aeb81d9199def1f929a5e5798d37c49c5">ROTATION_ROLL_180</a>));</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>    }</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span> </div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span><span class="preprocessor">#if !defined(HAL_SKIP_AUTO_INTERNAL_I2C_PROBE)</span></div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__BoardConfig.html#a8a3185c191ab40fd95ceeadd8a5b0cf9">AP_BoardConfig::get_board_type</a>() != <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a6aaf12ce90b5b9586d350af949ab84a0">AP_BoardConfig::PX4_BOARD_MINDPXV2</a> &amp;&amp;</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>        <a class="code hl_function" href="classAP__BoardConfig.html#a8a3185c191ab40fd95ceeadd8a5b0cf9">AP_BoardConfig::get_board_type</a>() != <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a97426996f59ed4a7534cfd7bb6a3174a">AP_BoardConfig::PX4_BOARD_AEROFC</a>) {</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>        <span class="comment">// internal i2c bus</span></div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>        <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#ad421e4346d33acf4c95a34a807dc531b">FOREACH_I2C_INTERNAL</a>(i) {</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>            <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a217078085d95a700a86b76f0446e6909">DRIVER_HMC5843</a>, <a class="code hl_function" href="classAP__Compass__HMC5843.html#a09a02590425dc0fd9470cfef5d820af6">AP_Compass_HMC5843::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__HMC5843_8h.html#a51869742d3196f59f9e5e323f9d6c11b">HAL_COMPASS_HMC5843_I2C_ADDR</a>),</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>                        all_external, all_external?<a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681aeb81d9199def1f929a5e5798d37c49c5">ROTATION_ROLL_180</a>:<a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294">ROTATION_YAW_270</a>));</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>        }</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>    }</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span><span class="preprocessor">#endif  </span><span class="comment">// !defined(HAL_SKIP_AUTO_INTERNAL_I2C_PROBE)</span></div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_HMC5843_ENABLED</span></div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span> </div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span><span class="preprocessor">#if AP_COMPASS_QMC5883L_ENABLED</span></div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>    <span class="comment">//external i2c bus</span></div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#a09f11b4bf995e11cb0b54264fa1b831c">FOREACH_I2C_EXTERNAL</a>(i) {</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19ac271f3a78ee820edc8a9c95f64dac68e">DRIVER_QMC5883L</a>, <a class="code hl_function" href="classAP__Compass__QMC5883L.html#a7c1440740e30ff68a714061f0e5be310">AP_Compass_QMC5883L::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__QMC5883L_8h.html#a3f1e879cd41b64877257c513fbf11467">HAL_COMPASS_QMC5883L_I2C_ADDR</a>),</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>                    <span class="keyword">true</span>, <a class="code hl_define" href="AP__Compass__QMC5883L_8h.html#a53ec2f60b031c276dc75bb835a27ba5a">HAL_COMPASS_QMC5883L_ORIENTATION_EXTERNAL</a>));</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>    }</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span> </div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>    <span class="comment">// internal i2c bus</span></div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span><span class="preprocessor">#if !defined(HAL_SKIP_AUTO_INTERNAL_I2C_PROBE)</span></div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>    <span class="keywordflow">if</span> (all_external) {</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>        <span class="comment">// only probe QMC5883L on internal if we are treating internals as externals</span></div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>        <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#ad421e4346d33acf4c95a34a807dc531b">FOREACH_I2C_INTERNAL</a>(i) {</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>            <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19ac271f3a78ee820edc8a9c95f64dac68e">DRIVER_QMC5883L</a>, <a class="code hl_function" href="classAP__Compass__QMC5883L.html#a7c1440740e30ff68a714061f0e5be310">AP_Compass_QMC5883L::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__QMC5883L_8h.html#a3f1e879cd41b64877257c513fbf11467">HAL_COMPASS_QMC5883L_I2C_ADDR</a>),</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>                        all_external,</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>                        all_external?<a class="code hl_define" href="AP__Compass__QMC5883L_8h.html#a53ec2f60b031c276dc75bb835a27ba5a">HAL_COMPASS_QMC5883L_ORIENTATION_EXTERNAL</a>:<a class="code hl_define" href="AP__Compass__QMC5883L_8h.html#a620cedda01ad03d53443edb4a0131d88">HAL_COMPASS_QMC5883L_ORIENTATION_INTERNAL</a>));</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>        }</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>    }</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_QMC5883L_ENABLED</span></div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span> </div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span><span class="preprocessor">#if AP_COMPASS_QMC5883P_ENABLED</span></div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>    <span class="comment">//external i2c bus</span></div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#a09f11b4bf995e11cb0b54264fa1b831c">FOREACH_I2C_EXTERNAL</a>(i) {</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(DRIVER_QMC5883P, <a class="code hl_function" href="classAP__Compass__QMC5883P.html#a630ee718676deb68bf47693ab8ef2196">AP_Compass_QMC5883P::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__QMC5883P_8h.html#a22916e51e76a7db0c07365d0a73ecf2b">HAL_COMPASS_QMC5883P_I2C_ADDR</a>),</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>                    <span class="keyword">true</span>, <a class="code hl_define" href="AP__Compass__QMC5883P_8h.html#a4a40c58b0e747eeb4d29f2e719054ce4">HAL_COMPASS_QMC5883P_ORIENTATION_EXTERNAL</a>));</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>    }</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span> </div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>    <span class="comment">// internal i2c bus</span></div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span><span class="preprocessor">#if !defined(HAL_SKIP_AUTO_INTERNAL_I2C_PROBE)</span></div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>    <span class="keywordflow">if</span> (all_external) {</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>        <span class="comment">// only probe QMC5883P on internal if we are treating internals as externals</span></div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>        <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#ad421e4346d33acf4c95a34a807dc531b">FOREACH_I2C_INTERNAL</a>(i) {</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>            <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(DRIVER_QMC5883P, <a class="code hl_function" href="classAP__Compass__QMC5883P.html#a630ee718676deb68bf47693ab8ef2196">AP_Compass_QMC5883P::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__QMC5883P_8h.html#a22916e51e76a7db0c07365d0a73ecf2b">HAL_COMPASS_QMC5883P_I2C_ADDR</a>),</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>                        all_external,</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>                        all_external?<a class="code hl_define" href="AP__Compass__QMC5883P_8h.html#a4a40c58b0e747eeb4d29f2e719054ce4">HAL_COMPASS_QMC5883P_ORIENTATION_EXTERNAL</a>:<a class="code hl_define" href="AP__Compass__QMC5883P_8h.html#a077ad934e55886ac292928650bba27e9">HAL_COMPASS_QMC5883P_ORIENTATION_INTERNAL</a>));</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span>        }</div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>    }</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_QMC5883P_ENABLED</span></div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span> </div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span><span class="preprocessor">#ifndef HAL_BUILD_AP_PERIPH</span></div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span>    <span class="comment">// AK09916 on ICM20948</span></div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span><span class="preprocessor">#if AP_COMPASS_AK09916_ENABLED &amp;&amp; AP_COMPASS_ICM20948_ENABLED</span></div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#a09f11b4bf995e11cb0b54264fa1b831c">FOREACH_I2C_EXTERNAL</a>(i) {</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a51912f7ed58536a787c5b7f165dc61e9">DRIVER_ICM20948</a>, <a class="code hl_function" href="classAP__Compass__AK09916.html#acf28ed980c21a6fd6c15111a10e33cb3">AP_Compass_AK09916::probe_ICM20948</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__AK09916_8h.html#a6848bf4867620c224db61628e399feec">HAL_COMPASS_AK09916_I2C_ADDR</a>),</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>                    <a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__AK09916_8h.html#abfe14523e6aac1631ce4430716b927db">HAL_COMPASS_ICM20948_I2C_ADDR</a>),</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>                    <span class="keyword">true</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a869e0e4a85746c9248e03bb2f1ad0229">ROTATION_PITCH_180_YAW_90</a>));</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a51912f7ed58536a787c5b7f165dc61e9">DRIVER_ICM20948</a>, <a class="code hl_function" href="classAP__Compass__AK09916.html#acf28ed980c21a6fd6c15111a10e33cb3">AP_Compass_AK09916::probe_ICM20948</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__AK09916_8h.html#a6848bf4867620c224db61628e399feec">HAL_COMPASS_AK09916_I2C_ADDR</a>),</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>                    <a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__AK09916_8h.html#a386455d25827367b386dc62db68c772a">HAL_COMPASS_ICM20948_I2C_ADDR2</a>),</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>                    <span class="keyword">true</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a869e0e4a85746c9248e03bb2f1ad0229">ROTATION_PITCH_180_YAW_90</a>));</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>    }</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span> </div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span><span class="preprocessor">#if !defined(HAL_SKIP_AUTO_INTERNAL_I2C_PROBE)</span></div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#ad421e4346d33acf4c95a34a807dc531b">FOREACH_I2C_INTERNAL</a>(i) {</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a51912f7ed58536a787c5b7f165dc61e9">DRIVER_ICM20948</a>, <a class="code hl_function" href="classAP__Compass__AK09916.html#acf28ed980c21a6fd6c15111a10e33cb3">AP_Compass_AK09916::probe_ICM20948</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__AK09916_8h.html#a6848bf4867620c224db61628e399feec">HAL_COMPASS_AK09916_I2C_ADDR</a>),</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>                    <a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__AK09916_8h.html#abfe14523e6aac1631ce4430716b927db">HAL_COMPASS_ICM20948_I2C_ADDR</a>),</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span>                    all_external, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a869e0e4a85746c9248e03bb2f1ad0229">ROTATION_PITCH_180_YAW_90</a>));</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a51912f7ed58536a787c5b7f165dc61e9">DRIVER_ICM20948</a>, <a class="code hl_function" href="classAP__Compass__AK09916.html#acf28ed980c21a6fd6c15111a10e33cb3">AP_Compass_AK09916::probe_ICM20948</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__AK09916_8h.html#a6848bf4867620c224db61628e399feec">HAL_COMPASS_AK09916_I2C_ADDR</a>),</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>                    <a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__AK09916_8h.html#a386455d25827367b386dc62db68c772a">HAL_COMPASS_ICM20948_I2C_ADDR2</a>),</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>                    all_external, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a869e0e4a85746c9248e03bb2f1ad0229">ROTATION_PITCH_180_YAW_90</a>));</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>    }</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_AK09916_ENABLED &amp;&amp; AP_COMPASS_ICM20948_ENABLED</span></div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span><span class="preprocessor">#endif </span><span class="comment">// HAL_BUILD_AP_PERIPH</span></div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span> </div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span><span class="preprocessor">#if AP_COMPASS_LIS3MDL_ENABLED</span></div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>    <span class="comment">// lis3mdl on bus 0 with default address</span></div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span><span class="preprocessor">#if !defined(HAL_SKIP_AUTO_INTERNAL_I2C_PROBE)</span></div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#ad421e4346d33acf4c95a34a807dc531b">FOREACH_I2C_INTERNAL</a>(i) {</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a03a77be7424a941a21861931eed0dded">DRIVER_LIS3MDL</a>, <a class="code hl_function" href="classAP__Compass__LIS3MDL.html#a4c2b4001b3b9f479be154c9127665328">AP_Compass_LIS3MDL::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__LIS3MDL_8h.html#ac10cbbe8e0464aff5b30a33809111cef">HAL_COMPASS_LIS3MDL_I2C_ADDR</a>),</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>                    all_external, all_external?<a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba">ROTATION_YAW_90</a>:<a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>    }</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span> </div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>    <span class="comment">// lis3mdl on bus 0 with alternate address</span></div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#ad421e4346d33acf4c95a34a807dc531b">FOREACH_I2C_INTERNAL</a>(i) {</div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a03a77be7424a941a21861931eed0dded">DRIVER_LIS3MDL</a>, <a class="code hl_function" href="classAP__Compass__LIS3MDL.html#a4c2b4001b3b9f479be154c9127665328">AP_Compass_LIS3MDL::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__LIS3MDL_8h.html#a094c5397594967479d9a2af852999e9a">HAL_COMPASS_LIS3MDL_I2C_ADDR2</a>),</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>                    all_external, all_external?<a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba">ROTATION_YAW_90</a>:<a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>    }</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span>    <span class="comment">// external lis3mdl on bus 1 with default address</span></div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#a09f11b4bf995e11cb0b54264fa1b831c">FOREACH_I2C_EXTERNAL</a>(i) {</div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a03a77be7424a941a21861931eed0dded">DRIVER_LIS3MDL</a>, <a class="code hl_function" href="classAP__Compass__LIS3MDL.html#a4c2b4001b3b9f479be154c9127665328">AP_Compass_LIS3MDL::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__LIS3MDL_8h.html#ac10cbbe8e0464aff5b30a33809111cef">HAL_COMPASS_LIS3MDL_I2C_ADDR</a>),</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>                    <span class="keyword">true</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba">ROTATION_YAW_90</a>));</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>    }</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span> </div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>    <span class="comment">// external lis3mdl on bus 1 with alternate address</span></div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#a09f11b4bf995e11cb0b54264fa1b831c">FOREACH_I2C_EXTERNAL</a>(i) {</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a03a77be7424a941a21861931eed0dded">DRIVER_LIS3MDL</a>, <a class="code hl_function" href="classAP__Compass__LIS3MDL.html#a4c2b4001b3b9f479be154c9127665328">AP_Compass_LIS3MDL::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__LIS3MDL_8h.html#a094c5397594967479d9a2af852999e9a">HAL_COMPASS_LIS3MDL_I2C_ADDR2</a>),</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>                    <span class="keyword">true</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba">ROTATION_YAW_90</a>));</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>    }</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_LIS3MDL_ENABLED</span></div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span> </div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span><span class="preprocessor">#if AP_COMPASS_AK09916_ENABLED</span></div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>    <span class="comment">// AK09916. This can be found twice, due to the ICM20948 i2c bus pass-thru, so we need to be careful to avoid that</span></div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#a09f11b4bf995e11cb0b54264fa1b831c">FOREACH_I2C_EXTERNAL</a>(i) {</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19afd40b80be9d564b799206268c73199c4">DRIVER_AK09916</a>, <a class="code hl_function" href="classAP__Compass__AK09916.html#a0b9b0bead6ea1cc7ab03df4e95f14820">AP_Compass_AK09916::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__AK09916_8h.html#a6848bf4867620c224db61628e399feec">HAL_COMPASS_AK09916_I2C_ADDR</a>),</div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>                    <span class="keyword">true</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294">ROTATION_YAW_270</a>));</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>    }</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span><span class="preprocessor">#if !defined(HAL_SKIP_AUTO_INTERNAL_I2C_PROBE)</span></div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#ad421e4346d33acf4c95a34a807dc531b">FOREACH_I2C_INTERNAL</a>(i) {</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19afd40b80be9d564b799206268c73199c4">DRIVER_AK09916</a>, <a class="code hl_function" href="classAP__Compass__AK09916.html#a0b9b0bead6ea1cc7ab03df4e95f14820">AP_Compass_AK09916::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__AK09916_8h.html#a6848bf4867620c224db61628e399feec">HAL_COMPASS_AK09916_I2C_ADDR</a>),</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span>                    all_external, all_external?<a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294">ROTATION_YAW_270</a>:<a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>    }</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_AK09916_ENABLED</span></div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span> </div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span><span class="preprocessor">#if AP_COMPASS_IST8310_ENABLED</span></div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>    <span class="comment">// IST8310 on external and internal bus</span></div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__BoardConfig.html#a8a3185c191ab40fd95ceeadd8a5b0cf9">AP_BoardConfig::get_board_type</a>() != <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a6f39405e261af307e647f079d8a6ec56">AP_BoardConfig::PX4_BOARD_FMUV5</a> &amp;&amp;</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>        <a class="code hl_function" href="classAP__BoardConfig.html#a8a3185c191ab40fd95ceeadd8a5b0cf9">AP_BoardConfig::get_board_type</a>() != <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ae3bc20831e04c6038b9ad40680003eda">AP_BoardConfig::PX4_BOARD_FMUV6</a>) {</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>        <span class="keyword">enum</span> <a class="code hl_enumeration" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681">Rotation</a> default_rotation = <a class="code hl_define" href="AP__Compass__IST8310_8h.html#a4452854bc90a4defb2f8be8c205b02db">AP_COMPASS_IST8310_DEFAULT_ROTATION</a>;</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span> </div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__BoardConfig.html#a8a3185c191ab40fd95ceeadd8a5b0cf9">AP_BoardConfig::get_board_type</a>() == <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a97426996f59ed4a7534cfd7bb6a3174a">AP_BoardConfig::PX4_BOARD_AEROFC</a>) {</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>            default_rotation = <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a869e0e4a85746c9248e03bb2f1ad0229">ROTATION_PITCH_180_YAW_90</a>;</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>        }</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>        <span class="comment">// probe all 4 possible addresses</span></div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>        <span class="keyword">const</span> uint8_t ist8310_addr[] = { 0x0C, 0x0D, 0x0E, 0x0F };</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span> </div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>        <span class="keywordflow">for</span> (uint8_t a=0; a&lt;<a class="code hl_define" href="AP__Common_8h.html#a121caf32c5b5d704ef3453f0885a9ea5">ARRAY_SIZE</a>(ist8310_addr); a++) {</div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>            <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#a09f11b4bf995e11cb0b54264fa1b831c">FOREACH_I2C_EXTERNAL</a>(i) {</div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>                <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19acc5d43bb11e0e4733807bc8fbc37bd76">DRIVER_IST8310</a>, <a class="code hl_function" href="classAP__Compass__IST8310.html#a05a1edca31561bd2de4ca9b22dc18ce4">AP_Compass_IST8310::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, ist8310_addr[a]),</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>                            <span class="keyword">true</span>, default_rotation));</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>            }</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span><span class="preprocessor">#if !defined(HAL_COMPASS_DISABLE_IST8310_INTERNAL_PROBE) &amp;&amp; !defined(HAL_SKIP_AUTO_INTERNAL_I2C_PROBE)</span></div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>            <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#ad421e4346d33acf4c95a34a807dc531b">FOREACH_I2C_INTERNAL</a>(i) {</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>                <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19acc5d43bb11e0e4733807bc8fbc37bd76">DRIVER_IST8310</a>, <a class="code hl_function" href="classAP__Compass__IST8310.html#a05a1edca31561bd2de4ca9b22dc18ce4">AP_Compass_IST8310::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, ist8310_addr[a]),</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>                            all_external, default_rotation));</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>            }</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>        }</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>    }</div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_IST8310_ENABLED</span></div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span> </div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span><span class="preprocessor">#if AP_COMPASS_IST8308_ENABLED</span></div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>    <span class="comment">// external i2c bus</span></div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#a09f11b4bf995e11cb0b54264fa1b831c">FOREACH_I2C_EXTERNAL</a>(i) {</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19aefd4c56c784bb6ccfcaea5a6f8cbcda1">DRIVER_IST8308</a>, <a class="code hl_function" href="classAP__Compass__IST8308.html#a173673c5186c86ef17579f7e93528562">AP_Compass_IST8308::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__IST8308_8h.html#a3ceac9a4a67efd3aa707dce7a6d55281">HAL_COMPASS_IST8308_I2C_ADDR</a>),</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>                    <span class="keyword">true</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span>    }</div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span><span class="preprocessor">#if !defined(HAL_SKIP_AUTO_INTERNAL_I2C_PROBE)</span></div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#ad421e4346d33acf4c95a34a807dc531b">FOREACH_I2C_INTERNAL</a>(i) {</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19aefd4c56c784bb6ccfcaea5a6f8cbcda1">DRIVER_IST8308</a>, <a class="code hl_function" href="classAP__Compass__IST8308.html#a173673c5186c86ef17579f7e93528562">AP_Compass_IST8308::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__IST8308_8h.html#a3ceac9a4a67efd3aa707dce7a6d55281">HAL_COMPASS_IST8308_I2C_ADDR</a>),</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>                    all_external, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>    }</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_IST8308_ENABLED</span></div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span> </div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span><span class="preprocessor">#if AP_COMPASS_MMC3416_ENABLED</span></div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>    <span class="comment">// external i2c bus</span></div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#a09f11b4bf995e11cb0b54264fa1b831c">FOREACH_I2C_EXTERNAL</a>(i) {</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a92f9ce72391607b31b0bbcfae036f536">DRIVER_MMC3416</a>, <a class="code hl_function" href="classAP__Compass__MMC3416.html#ae5c6a57de1262158fcd2d28ae3920122">AP_Compass_MMC3416::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__MMC3416_8h.html#ad5d0ccbdb55e9d937b5dd3e76b08a30c">HAL_COMPASS_MMC3416_I2C_ADDR</a>),</div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>                    <span class="keyword">true</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>    }</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span><span class="preprocessor">#if !defined(HAL_SKIP_AUTO_INTERNAL_I2C_PROBE)</span></div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#ad421e4346d33acf4c95a34a807dc531b">FOREACH_I2C_INTERNAL</a>(i) {</div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a92f9ce72391607b31b0bbcfae036f536">DRIVER_MMC3416</a>, <a class="code hl_function" href="classAP__Compass__MMC3416.html#ae5c6a57de1262158fcd2d28ae3920122">AP_Compass_MMC3416::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__MMC3416_8h.html#ad5d0ccbdb55e9d937b5dd3e76b08a30c">HAL_COMPASS_MMC3416_I2C_ADDR</a>),</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>                    all_external, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>    }</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_MMC3416_ENABLED</span></div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span> </div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span><span class="preprocessor">#if AP_COMPASS_RM3100_ENABLED</span></div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span><span class="preprocessor">#ifdef HAL_COMPASS_RM3100_I2C_ADDR</span></div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>    <span class="keyword">const</span> uint8_t rm3100_addresses[] = { HAL_COMPASS_RM3100_I2C_ADDR };</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>    <span class="comment">// RM3100 can be on 4 different addresses</span></div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>    <span class="keyword">const</span> uint8_t rm3100_addresses[] = { <a class="code hl_define" href="AP__Compass__RM3100_8h.html#a8b9229141dbaf6d2ca85bfd7b5ca245b">HAL_COMPASS_RM3100_I2C_ADDR1</a>,</div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>                                         <a class="code hl_define" href="AP__Compass__RM3100_8h.html#a186d62a551025147dcc1cf86a65d0b9f">HAL_COMPASS_RM3100_I2C_ADDR2</a>,</div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>                                         <a class="code hl_define" href="AP__Compass__RM3100_8h.html#ac57fee850eb20c3991552df3a7b13c39">HAL_COMPASS_RM3100_I2C_ADDR3</a>,</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>                                         <a class="code hl_define" href="AP__Compass__RM3100_8h.html#a2eb7b355c85809717aea927690022a20">HAL_COMPASS_RM3100_I2C_ADDR4</a> };</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>    <span class="comment">// external i2c bus</span></div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#a09f11b4bf995e11cb0b54264fa1b831c">FOREACH_I2C_EXTERNAL</a>(i) {</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>        <span class="keywordflow">for</span> (uint8_t j=0; j&lt;<a class="code hl_define" href="AP__Common_8h.html#a121caf32c5b5d704ef3453f0885a9ea5">ARRAY_SIZE</a>(rm3100_addresses); j++) {</div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span>            <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19ac351a800221e67444411df60735a92ff">DRIVER_RM3100</a>, <a class="code hl_function" href="classAP__Compass__RM3100.html#a3ff201ee861339587a3c2bd23f02aaca">AP_Compass_RM3100::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, rm3100_addresses[j]), <span class="keyword">true</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>        }</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>    }</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span> </div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span><span class="preprocessor">#if !defined(HAL_SKIP_AUTO_INTERNAL_I2C_PROBE)</span></div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#ad421e4346d33acf4c95a34a807dc531b">FOREACH_I2C_INTERNAL</a>(i) {</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>        <span class="keywordflow">for</span> (uint8_t j=0; j&lt;<a class="code hl_define" href="AP__Common_8h.html#a121caf32c5b5d704ef3453f0885a9ea5">ARRAY_SIZE</a>(rm3100_addresses); j++) {</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>            <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19ac351a800221e67444411df60735a92ff">DRIVER_RM3100</a>, <a class="code hl_function" href="classAP__Compass__RM3100.html#a3ff201ee861339587a3c2bd23f02aaca">AP_Compass_RM3100::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, rm3100_addresses[j]), all_external, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>        }</div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>    }</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_RM3100_ENABLED</span></div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span> </div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span><span class="preprocessor">#if AP_COMPASS_BMM150_DETECT_BACKENDS_ENABLED</span></div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>    <span class="comment">// BMM150 on I2C</span></div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>    <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#a09f11b4bf995e11cb0b54264fa1b831c">FOREACH_I2C_EXTERNAL</a>(i) {</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>        <span class="keywordflow">for</span> (uint8_t addr=<a class="code hl_define" href="AP__Compass__BMM150_8h.html#a55e65fcfc75d2234201d5d7beccab96f">BMM150_I2C_ADDR_MIN</a>; addr &lt;= <a class="code hl_define" href="AP__Compass__BMM150_8h.html#a5aec83ecfcba3cd9d9f869edf9c8614d">BMM150_I2C_ADDR_MAX</a>; addr++) {</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span>            <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19ad0a33febf127c0dccbe03f0709f94122">DRIVER_BMM150</a>,</div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>                        <a class="code hl_function" href="classAP__Compass__BMM150.html#a4b88fda01e1d04414a1c11f1f63f8862">AP_Compass_BMM150::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, addr), <span class="keyword">true</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>        }</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>    }</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span><span class="preprocessor">#endif </span><span class="comment">// AP_COMPASS_BMM150_ENABLED</span></div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>}</div>
</div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span> </div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span><span class="comment">/*</span></div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span><span class="comment">  detect available backends for this board</span></div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen01321" data-start="{" data-end="}">
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"><a class="line" href="classCompass.html#a1c48170d8c8966b22fb150b1634443ec"> 1321</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classCompass.html#a1c48170d8c8966b22fb150b1634443ec">Compass::_detect_backends</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>{</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span><span class="preprocessor">#if AP_COMPASS_EXTERNALAHRS_ENABLED</span></div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>    <span class="keyword">const</span> int8_t serial_port = AP::externalAHRS().get_port(AP_ExternalAHRS::AvailableSensor::COMPASS);</div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>    <span class="keywordflow">if</span> (serial_port &gt;= 0) {</div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(DRIVER_EXTERNALAHRS, <span class="keyword">new</span> AP_Compass_ExternalAHRS(serial_port));</div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>    }</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>    </div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span><span class="preprocessor">#if AP_FEATURE_BOARD_DETECT</span></div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__BoardConfig.html#a8a3185c191ab40fd95ceeadd8a5b0cf9">AP_BoardConfig::get_board_type</a>() == <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ad387380811280b3f995f8387ab50264e">AP_BoardConfig::PX4_BOARD_PIXHAWK2</a>) {</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>        <span class="comment">// default to disabling LIS3MDL on pixhawk2 due to hardware issue</span></div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span><span class="preprocessor">#if AP_COMPASS_LIS3MDL_ENABLED</span></div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>    <a class="code hl_variable" href="classCompass.html#aa2db70e5e7eb6b25d70550322849b862">_driver_type_mask</a>.set_default(1U&lt;&lt;<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a03a77be7424a941a21861931eed0dded">DRIVER_LIS3MDL</a>);</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span>    }</div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span> </div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span><span class="preprocessor">#if AP_COMPASS_SITL_ENABLED &amp;&amp; !AP_TEST_DRONECAN_DRIVERS</span></div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>    <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(DRIVER_SITL, <span class="keyword">new</span> AP_Compass_SITL());</div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span> </div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span><span class="preprocessor">#if AP_COMPASS_DRONECAN_ENABLED</span></div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span>    <span class="comment">// probe DroneCAN before I2C and SPI so that DroneCAN compasses</span></div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>    <span class="comment">// default to first in the list for a new board</span></div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>    probe_dronecan_compasses();</div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>    <a class="code hl_define" href="AP__Compass_8cpp.html#ad644760d1cab90de3f8ad72b11a7c2a7">CHECK_UNREG_LIMIT_RETURN</a>;</div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span> </div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span><span class="preprocessor">#ifdef HAL_PROBE_EXTERNAL_I2C_COMPASSES</span></div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span>    <span class="comment">// allow boards to ask for external probing of all i2c compass types in hwdef.dat</span></div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>    <a class="code hl_function" href="classCompass.html#a766d77e1b78dc08be50ba76994c8b4ab">_probe_external_i2c_compasses</a>();</div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span>    <a class="code hl_define" href="AP__Compass_8cpp.html#ad644760d1cab90de3f8ad72b11a7c2a7">CHECK_UNREG_LIMIT_RETURN</a>;</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span> </div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span><span class="preprocessor">#if AP_COMPASS_MSP_ENABLED</span></div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;8; i++) {</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>        <span class="keywordflow">if</span> (msp_instance_mask &amp; (1U&lt;&lt;i)) {</div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>            <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(DRIVER_MSP, <span class="keyword">new</span> AP_Compass_MSP(i));</div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span>        }</div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>    }</div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span> </div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>    <span class="comment">// finally look for i2c and spi compasses not found yet</span></div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>    <a class="code hl_define" href="AP__Compass_8cpp.html#ad644760d1cab90de3f8ad72b11a7c2a7">CHECK_UNREG_LIMIT_RETURN</a>;</div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span>    <a class="code hl_function" href="classCompass.html#a0f869a4e64bfe1c9b86265c71b73e0e8">probe_i2c_spi_compasses</a>();</div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span> </div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#ac3bf8f6ab108927b2ea704b3dcba1355">_backend_count</a> == 0 ||</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>        <a class="code hl_variable" href="classCompass.html#afd52e3b95b4813b56a79742c0d98e6e4">_compass_count</a> == 0) {</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>        <a class="code hl_define" href="HAL_8h.html#a9d530d34abf7afeae6b7da9363551282">DEV_PRINTF</a>(<span class="stringliteral">&quot;No Compass backends available\n&quot;</span>);</div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>    }</div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>}</div>
</div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span> </div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span><span class="comment">/*</span></div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span><span class="comment">  probe i2c and SPI compasses</span></div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen01377" data-start="{" data-end="}">
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"><a class="line" href="classCompass.html#a0f869a4e64bfe1c9b86265c71b73e0e8"> 1377</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classCompass.html#a0f869a4e64bfe1c9b86265c71b73e0e8">Compass::probe_i2c_spi_compasses</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>{</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span><span class="preprocessor">#if defined(HAL_MAG_PROBE_LIST)</span></div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>    <span class="comment">// driver probes defined by COMPASS lines in hwdef.dat</span></div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>    <a class="code hl_define" href="esp32diy_8h.html#a0af4e497b206c0129814f492962f28f1">HAL_MAG_PROBE_LIST</a>;</div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span><span class="preprocessor">#elif AP_FEATURE_BOARD_DETECT</span></div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__BoardConfig.html#a8a3185c191ab40fd95ceeadd8a5b0cf9">AP_BoardConfig::get_board_type</a>()) {</div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983acf567833f77e46ce320a961f68611bff">AP_BoardConfig::PX4_BOARD_PX4V1</a>:</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983aa765b43df6cbdb15f9720f993d79ceb3">AP_BoardConfig::PX4_BOARD_PIXHAWK</a>:</div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983aa4b366ff17e0c44076231ae8c51edd42">AP_BoardConfig::PX4_BOARD_PHMINI</a>:</div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a922eeb71ccd9862923f68246f86bb667">AP_BoardConfig::PX4_BOARD_AUAV21</a>:</div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a78f917fc079eb5acb3e9623f0bbe0ff9">AP_BoardConfig::PX4_BOARD_PH2SLIM</a>:</div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ad387380811280b3f995f8387ab50264e">AP_BoardConfig::PX4_BOARD_PIXHAWK2</a>:</div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a6aaf12ce90b5b9586d350af949ab84a0">AP_BoardConfig::PX4_BOARD_MINDPXV2</a>:</div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a6f39405e261af307e647f079d8a6ec56">AP_BoardConfig::PX4_BOARD_FMUV5</a>:</div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ae3bc20831e04c6038b9ad40680003eda">AP_BoardConfig::PX4_BOARD_FMUV6</a>:</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a05ec778f42256d22fbdf58c458707b38">AP_BoardConfig::PX4_BOARD_PIXHAWK_PRO</a>:</div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a97426996f59ed4a7534cfd7bb6a3174a">AP_BoardConfig::PX4_BOARD_AEROFC</a>:</div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>        <a class="code hl_function" href="classCompass.html#a766d77e1b78dc08be50ba76994c8b4ab">_probe_external_i2c_compasses</a>();</div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>        <a class="code hl_define" href="AP__Compass_8cpp.html#ad644760d1cab90de3f8ad72b11a7c2a7">CHECK_UNREG_LIMIT_RETURN</a>;</div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span> </div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ac37e0c90b91e19c9b6945baa8b05b278">AP_BoardConfig::PX4_BOARD_PCNC1</a>:</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span><span class="preprocessor">#if AP_COMPASS_BMM150_ENABLED</span></div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19ad0a33febf127c0dccbe03f0709f94122">DRIVER_BMM150</a>,</div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>                    <a class="code hl_function" href="classAP__Compass__BMM150.html#a4b88fda01e1d04414a1c11f1f63f8862">AP_Compass_BMM150::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(0, 0x10), <span class="keyword">false</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a3c5386db31b5c706894441bb6279eefc">AP_BoardConfig::VRX_BOARD_BRAIN54</a>:</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a212c2ff8c6c4ada3668b927ac6728a87">AP_BoardConfig::VRX_BOARD_BRAIN51</a>: {</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span><span class="preprocessor">#if AP_COMPASS_HMC5843_ENABLED</span></div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>        <span class="comment">// external i2c bus</span></div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a217078085d95a700a86b76f0446e6909">DRIVER_HMC5843</a>, <a class="code hl_function" href="classAP__Compass__HMC5843.html#a09a02590425dc0fd9470cfef5d820af6">AP_Compass_HMC5843::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(1, <a class="code hl_define" href="AP__Compass__HMC5843_8h.html#a51869742d3196f59f9e5e323f9d6c11b">HAL_COMPASS_HMC5843_I2C_ADDR</a>),</div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>                    <span class="keyword">true</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681aeb81d9199def1f929a5e5798d37c49c5">ROTATION_ROLL_180</a>));</div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span> </div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>        <span class="comment">// internal i2c bus</span></div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a217078085d95a700a86b76f0446e6909">DRIVER_HMC5843</a>, <a class="code hl_function" href="classAP__Compass__HMC5843.html#a09a02590425dc0fd9470cfef5d820af6">AP_Compass_HMC5843::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(0, <a class="code hl_define" href="AP__Compass__HMC5843_8h.html#a51869742d3196f59f9e5e323f9d6c11b">HAL_COMPASS_HMC5843_I2C_ADDR</a>),</div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>                    <span class="keyword">false</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294">ROTATION_YAW_270</a>));</div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_HMC5843_ENABLED</span></div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>    }</div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span>    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span> </div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a939e3484a227aa39019088ac96a9cfd3">AP_BoardConfig::VRX_BOARD_BRAIN52</a>:</div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983aedbfaade4bc5663cfd73a8652235bb30">AP_BoardConfig::VRX_BOARD_BRAIN52E</a>:</div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a2f0a5b6527161d6a622728dfe8fd4023">AP_BoardConfig::VRX_BOARD_CORE10</a>:</div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a53e500f8c050e0ae471194b0fca121cb">AP_BoardConfig::VRX_BOARD_UBRAIN51</a>:</div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a122ab74c52fd603b79d0b2c0b5651ed5">AP_BoardConfig::VRX_BOARD_UBRAIN52</a>: {</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span><span class="preprocessor">#if AP_COMPASS_HMC5843_ENABLED</span></div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>        <span class="comment">// external i2c bus</span></div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a217078085d95a700a86b76f0446e6909">DRIVER_HMC5843</a>, <a class="code hl_function" href="classAP__Compass__HMC5843.html#a09a02590425dc0fd9470cfef5d820af6">AP_Compass_HMC5843::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(1, <a class="code hl_define" href="AP__Compass__HMC5843_8h.html#a51869742d3196f59f9e5e323f9d6c11b">HAL_COMPASS_HMC5843_I2C_ADDR</a>),</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>                    <span class="keyword">true</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681aeb81d9199def1f929a5e5798d37c49c5">ROTATION_ROLL_180</a>));</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_HMC5843_ENABLED</span></div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>    }</div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>    <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span> </div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>    }</div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__BoardConfig.html#a8a3185c191ab40fd95ceeadd8a5b0cf9">AP_BoardConfig::get_board_type</a>()) {</div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983aa765b43df6cbdb15f9720f993d79ceb3">AP_BoardConfig::PX4_BOARD_PIXHAWK</a>:</div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span><span class="preprocessor">#if AP_COMPASS_HMC5843_ENABLED</span></div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a217078085d95a700a86b76f0446e6909">DRIVER_HMC5843</a>, <a class="code hl_function" href="classAP__Compass__HMC5843.html#a09a02590425dc0fd9470cfef5d820af6">AP_Compass_HMC5843::probe</a>(<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1SPIDeviceManager.html#af75a266dd7de8f0ee072dd667461d2ab">get_device</a>(<a class="code hl_define" href="chibios_8h.html#a4a4d9b4dac87e452c5ee78083fbe7949">HAL_COMPASS_HMC5843_NAME</a>),</div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>                    <span class="keyword">false</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a16e7696bfbca8f804e76718d5cfa5bef">ROTATION_PITCH_180</a>));</div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span><span class="preprocessor">#if AP_COMPASS_LSM303D_ENABLED</span></div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19ad69cd8acf903e732a7c58992df756cd7">DRIVER_LSM303D</a>, <a class="code hl_function" href="classAP__Compass__LSM303D.html#a1326916718eb1f574158cecd6904cac5">AP_Compass_LSM303D::probe</a>(<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1SPIDeviceManager.html#af75a266dd7de8f0ee072dd667461d2ab">get_device</a>(<a class="code hl_define" href="chibios_8h.html#a2c59d23ab6be2e59b18f06e2431e5dbb">HAL_INS_LSM9DS0_A_NAME</a>), <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span> </div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ad387380811280b3f995f8387ab50264e">AP_BoardConfig::PX4_BOARD_PIXHAWK2</a>:</div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span><span class="preprocessor">#if AP_COMPASS_LSM303D_ENABLED</span></div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19ad69cd8acf903e732a7c58992df756cd7">DRIVER_LSM303D</a>, <a class="code hl_function" href="classAP__Compass__LSM303D.html#a1326916718eb1f574158cecd6904cac5">AP_Compass_LSM303D::probe</a>(<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1SPIDeviceManager.html#af75a266dd7de8f0ee072dd667461d2ab">get_device</a>(<a class="code hl_define" href="chibios_8h.html#ae30b37f1f4cd685cec0014ac3a5e00ad">HAL_INS_LSM9DS0_EXT_A_NAME</a>), <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294">ROTATION_YAW_270</a>));</div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span><span class="preprocessor">#if AP_COMPASS_AK8963_ENABLED</span></div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span>        <span class="comment">// we run the AK8963 only on the 2nd MPU9250, which leaves the</span></div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>        <span class="comment">// first MPU9250 to run without disturbance at high rate</span></div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a102db3d1e1b2b4fe5c8fffd7de522664">DRIVER_AK8963</a>, <a class="code hl_function" href="classAP__Compass__AK8963.html#af51ed96aa80a37fc89cd7856bf588b5c">AP_Compass_AK8963::probe_mpu9250</a>(1, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294">ROTATION_YAW_270</a>));</div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span><span class="preprocessor">#if AP_COMPASS_AK09916_ENABLED &amp;&amp; AP_COMPASS_ICM20948_ENABLED</span></div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19afd40b80be9d564b799206268c73199c4">DRIVER_AK09916</a>, <a class="code hl_function" href="classAP__Compass__AK09916.html#acf28ed980c21a6fd6c15111a10e33cb3">AP_Compass_AK09916::probe_ICM20948</a>(0, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a>));</div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"> 1459</span> </div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a6f39405e261af307e647f079d8a6ec56">AP_BoardConfig::PX4_BOARD_FMUV5</a>:</div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ae3bc20831e04c6038b9ad40680003eda">AP_BoardConfig::PX4_BOARD_FMUV6</a>:</div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span><span class="preprocessor">#if AP_COMPASS_IST8310_ENABLED</span></div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span>        <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#a09f11b4bf995e11cb0b54264fa1b831c">FOREACH_I2C_EXTERNAL</a>(i) {</div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>            <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19acc5d43bb11e0e4733807bc8fbc37bd76">DRIVER_IST8310</a>, <a class="code hl_function" href="classAP__Compass__IST8310.html#a05a1edca31561bd2de4ca9b22dc18ce4">AP_Compass_IST8310::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__IST8310_8h.html#a008c10b66a4077acc3a610c41291773b">HAL_COMPASS_IST8310_I2C_ADDR</a>),</div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>                        <span class="keyword">true</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a>));</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span>        }</div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span>        <a class="code hl_define" href="AP__HAL_2I2CDevice_8h.html#ad421e4346d33acf4c95a34a807dc531b">FOREACH_I2C_INTERNAL</a>(i) {</div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span>            <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19acc5d43bb11e0e4733807bc8fbc37bd76">DRIVER_IST8310</a>, <a class="code hl_function" href="classAP__Compass__IST8310.html#a05a1edca31561bd2de4ca9b22dc18ce4">AP_Compass_IST8310::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(i, <a class="code hl_define" href="AP__Compass__IST8310_8h.html#a008c10b66a4077acc3a610c41291773b">HAL_COMPASS_IST8310_I2C_ADDR</a>),</div>
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"> 1469</span>                        <span class="keyword">false</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a>));</div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span>        }</div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_IST8310_ENABLED</span></div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span> </div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a2548b608826699e872a2de7f4e1ff877">AP_BoardConfig::PX4_BOARD_SP01</a>:</div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span><span class="preprocessor">#if AP_COMPASS_AK8963_ENABLED</span></div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a102db3d1e1b2b4fe5c8fffd7de522664">DRIVER_AK8963</a>, <a class="code hl_function" href="classAP__Compass__AK8963.html#af51ed96aa80a37fc89cd7856bf588b5c">AP_Compass_AK8963::probe_mpu9250</a>(1, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span> </div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a05ec778f42256d22fbdf58c458707b38">AP_BoardConfig::PX4_BOARD_PIXHAWK_PRO</a>:</div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span><span class="preprocessor">#if AP_COMPASS_AK8963_ENABLED</span></div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a102db3d1e1b2b4fe5c8fffd7de522664">DRIVER_AK8963</a>, <a class="code hl_function" href="classAP__Compass__AK8963.html#af51ed96aa80a37fc89cd7856bf588b5c">AP_Compass_AK8963::probe_mpu9250</a>(0, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a>));</div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span><span class="preprocessor">#if AP_COMPASS_LIS3MDL_ENABLED</span></div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a03a77be7424a941a21861931eed0dded">DRIVER_LIS3MDL</a>, <a class="code hl_function" href="classAP__Compass__LIS3MDL.html#a4c2b4001b3b9f479be154c9127665328">AP_Compass_LIS3MDL::probe</a>(<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1SPIDeviceManager.html#af75a266dd7de8f0ee072dd667461d2ab">get_device</a>(<a class="code hl_define" href="chibios_8h.html#af93f1bddafc9785287d1f3e638125dbc">HAL_COMPASS_LIS3MDL_NAME</a>),</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span>                    <span class="keyword">false</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a>));</div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_LIS3MDL_ENABLED</span></div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span> </div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983aa4b366ff17e0c44076231ae8c51edd42">AP_BoardConfig::PX4_BOARD_PHMINI</a>:</div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span><span class="preprocessor">#if AP_COMPASS_AK8963_ENABLED</span></div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a102db3d1e1b2b4fe5c8fffd7de522664">DRIVER_AK8963</a>, <a class="code hl_function" href="classAP__Compass__AK8963.html#af51ed96aa80a37fc89cd7856bf588b5c">AP_Compass_AK8963::probe_mpu9250</a>(0, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681aeb81d9199def1f929a5e5798d37c49c5">ROTATION_ROLL_180</a>));</div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span> </div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a922eeb71ccd9862923f68246f86bb667">AP_BoardConfig::PX4_BOARD_AUAV21</a>:</div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span><span class="preprocessor">#if AP_COMPASS_AK8963_ENABLED</span></div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a102db3d1e1b2b4fe5c8fffd7de522664">DRIVER_AK8963</a>, <a class="code hl_function" href="classAP__Compass__AK8963.html#af51ed96aa80a37fc89cd7856bf588b5c">AP_Compass_AK8963::probe_mpu9250</a>(0, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a>));</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span> </div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a78f917fc079eb5acb3e9623f0bbe0ff9">AP_BoardConfig::PX4_BOARD_PH2SLIM</a>:</div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span><span class="preprocessor">#if AP_COMPASS_AK8963_ENABLED</span></div>
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"> 1504</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a102db3d1e1b2b4fe5c8fffd7de522664">DRIVER_AK8963</a>, <a class="code hl_function" href="classAP__Compass__AK8963.html#af51ed96aa80a37fc89cd7856bf588b5c">AP_Compass_AK8963::probe_mpu9250</a>(0, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294">ROTATION_YAW_270</a>));</div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span> </div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a6aaf12ce90b5b9586d350af949ab84a0">AP_BoardConfig::PX4_BOARD_MINDPXV2</a>:</div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span><span class="preprocessor">#if AP_COMPASS_HMC5843_ENABLED</span></div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a217078085d95a700a86b76f0446e6909">DRIVER_HMC5843</a>, <a class="code hl_function" href="classAP__Compass__HMC5843.html#a09a02590425dc0fd9470cfef5d820af6">AP_Compass_HMC5843::probe</a>(<a class="code hl_define" href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a>(0, <a class="code hl_define" href="AP__Compass__HMC5843_8h.html#a51869742d3196f59f9e5e323f9d6c11b">HAL_COMPASS_HMC5843_I2C_ADDR</a>),</div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span>                    <span class="keyword">false</span>, <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba">ROTATION_YAW_90</a>));</div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span><span class="preprocessor">#if AP_COMPASS_LSM303D_ENABLED</span></div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>        <a class="code hl_define" href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a>(<a class="code hl_enumvalue" href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19ad69cd8acf903e732a7c58992df756cd7">DRIVER_LSM303D</a>, <a class="code hl_function" href="classAP__Compass__LSM303D.html#a1326916718eb1f574158cecd6904cac5">AP_Compass_LSM303D::probe</a>(<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">spi</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1SPIDeviceManager.html#af75a266dd7de8f0ee072dd667461d2ab">get_device</a>(<a class="code hl_define" href="chibios_8h.html#a2c59d23ab6be2e59b18f06e2431e5dbb">HAL_INS_LSM9DS0_A_NAME</a>), <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a90f75701d0b21bcb9d12826ac8cb4ef6">ROTATION_PITCH_180_YAW_270</a>));</div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span> </div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span>    <span class="keywordflow">default</span>:</div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span>    }</div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span>}</div>
</div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span> </div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span><span class="preprocessor">#if AP_COMPASS_DRONECAN_ENABLED</span></div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span><span class="comment">/*</span></div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span><span class="comment">  look for DroneCAN compasses</span></div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span><span class="comment"> */</span></div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span><span class="keywordtype">void</span> Compass::probe_dronecan_compasses(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>{</div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classCompass.html#a678ad037acc44e46598012b7ad17b2a6">_driver_enabled</a>(DRIVER_UAVCAN)) {</div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>    }</div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a5ae256887a80a65f39d06f1cb2cbfacb">COMPASS_MAX_BACKEND</a>; i++) {</div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span>        <a class="code hl_class" href="classAP__Compass__Backend.html">AP_Compass_Backend</a>* _uavcan_backend = AP_Compass_DroneCAN::probe(i);</div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span>        <span class="keywordflow">if</span> (_uavcan_backend) {</div>
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"> 1536</span>            <a class="code hl_function" href="classCompass.html#a23dca9254efb3dedb9dcd565c829d707">_add_backend</a>(_uavcan_backend);</div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span>        }</div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span><span class="preprocessor">#if COMPASS_MAX_UNREG_DEV &gt; 0</span></div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a26f0faff382edb23410e1beb8e9a18e5">_unreg_compass_count</a> == <a class="code hl_define" href="AP__Compass_8h.html#ac01ecc2c9da354c12911bb0ecfa5b7e6">COMPASS_MAX_UNREG_DEV</a>)  {</div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>        }</div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span>    }</div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span> </div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span><span class="preprocessor">#if COMPASS_MAX_UNREG_DEV &gt; 0</span></div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classCompass.html#a4e19069e5c7edee20fe8eb2c02aae3e2">option_set</a>(<a class="code hl_enumvalue" href="classCompass.html#ab22c1f0bf0495f27855c24f7d3d58117ae3162512b851187b768bfb71354dad04">Option::ALLOW_DRONECAN_AUTO_REPLACEMENT</a>) &amp;&amp; !<a class="code hl_variable" href="classCompass.html#a9921f864c9ba926d0b5ad318f3ba66f6">suppress_devid_save</a>) {</div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span>        <span class="comment">// check if there&#39;s any uavcan compass in prio slot that&#39;s not found</span></div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span>        <span class="comment">// and replace it if there&#39;s a replacement compass</span></div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span>        <span class="keywordflow">for</span> (Priority i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__HAL_1_1Device.html#aa66dae71b7f46e115e94cc8302a83c1e">AP_HAL::Device::devid_get_bus_type</a>(<a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[i]) != <a class="code hl_enumvalue" href="classAP__HAL_1_1Device.html#abdd5c39f57e7022979565e92b6578ba1a5f4d64573ea0feed48cd2d29691cd45c">AP_HAL::Device::BUS_TYPE_UAVCAN</a></div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span>                || <a class="code hl_function" href="classCompass.html#acea3a6c15669b5b88b5b077179dd82ac">_get_state</a>(i).registered) {</div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>                <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span>            }</div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span>            <span class="comment">// There&#39;s a UAVCAN compass missing</span></div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span>            <span class="comment">// Let&#39;s check if there&#39;s a replacement</span></div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>            <span class="keywordflow">for</span> (uint8_t j=0; j&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; j++) {</div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>                uint32_t detected_devid = AP_Compass_DroneCAN::get_detected_devid(j);</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span>                <span class="comment">// Check if this is a potential replacement mag</span></div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span>                <span class="keywordflow">if</span> (!<a class="code hl_function" href="classCompass.html#a625a1c702621a199c1bc52f89e970038">is_replacement_mag</a>(detected_devid)) {</div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span>                }</div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span>                <span class="comment">// We have found a replacement mag, let&#39;s replace the existing one</span></div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>                <span class="comment">// with this by setting the priority to zero and calling uavcan probe</span></div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>                <a class="code hl_function" href="GCS_8h.html#ab53f292b698f9a6a3f029dfdbd5a43de">gcs</a>().<a class="code hl_function" href="classGCS.html#a2f099d18721b0874af08fde3f6aae6b6">send_text</a>(MAV_SEVERITY_ALERT, <span class="stringliteral">&quot;Mag: Compass #%d with DEVID %lu replaced&quot;</span>, uint8_t(i), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[i]);</div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>                <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[i].set_and_save(0);</div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>                <a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[i] = 0;</div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span> </div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span>                <a class="code hl_class" href="classAP__Compass__Backend.html">AP_Compass_Backend</a>* _uavcan_backend = AP_Compass_DroneCAN::probe(j);</div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span>                <span class="keywordflow">if</span> (_uavcan_backend) {</div>
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"> 1570</span>                    <a class="code hl_function" href="classCompass.html#a23dca9254efb3dedb9dcd565c829d707">_add_backend</a>(_uavcan_backend);</div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span>                    <span class="comment">// we also need to remove the id from unreg list</span></div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>                    <a class="code hl_function" href="classCompass.html#aef26ec454da865f61012aa9033cf3358">remove_unreg_dev_id</a>(detected_devid);</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>                    <span class="comment">// the mag has already been allocated,</span></div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>                    <span class="comment">// let&#39;s begin the replacement</span></div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span>                    <span class="keywordtype">bool</span> found_replacement = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span>                    <span class="keywordflow">for</span> (StateIndex k(0); k&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; k++) {</div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span>                        <span class="keywordflow">if</span> ((uint32_t)<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[k].dev_id == detected_devid) {</div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>                            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[k].<a class="code hl_variable" href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a> &lt;= uint8_t(i)) {</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span>                                <span class="comment">// we are already on higher priority</span></div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>                                <span class="comment">// nothing to do</span></div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span>                                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span>                            }</div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span>                            found_replacement = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>                            <span class="comment">// reset old priority of replacement mag</span></div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span>                            <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[k].priority].set_and_save(0);</div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>                            <a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[k].priority] = 0;</div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span>                            <span class="comment">// update new priority</span></div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span>                            <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[k].priority = i;</div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span>                        }</div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>                    }</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>                    <span class="keywordflow">if</span> (!found_replacement) {</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span>                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span>                    }</div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>                    <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[i].set_and_save(detected_devid);</div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>                    <a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[i] = detected_devid;</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span>                }</div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>            }</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>        }</div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>    }</div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span><span class="preprocessor">#endif  </span><span class="comment">// #if COMPASS_MAX_UNREG_DEV &gt; 0</span></div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span>}</div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_DRONECAN_ENABLED</span></div>
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"> 1604</span> </div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span> </div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span><span class="comment">// Check if the devid is a potential replacement compass</span></div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span><span class="comment">// Following are the checks done to ensure the compass is a replacement</span></div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span><span class="comment">// * The compass is an UAVCAN compass</span></div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span><span class="comment">// * The compass wasn&#39;t seen before this boot as additional unreg mag</span></div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span><span class="comment">// * The compass might have been seen before but never setup</span></div>
<div class="foldopen" id="foldopen01611" data-start="{" data-end="}">
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"><a class="line" href="classCompass.html#a625a1c702621a199c1bc52f89e970038"> 1611</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classCompass.html#a625a1c702621a199c1bc52f89e970038">Compass::is_replacement_mag</a>(uint32_t devid) {</div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>    <span class="comment">// We only do this for UAVCAN mag</span></div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span>    <span class="keywordflow">if</span> (devid == 0 || (<a class="code hl_function" href="classAP__HAL_1_1Device.html#aa66dae71b7f46e115e94cc8302a83c1e">AP_HAL::Device::devid_get_bus_type</a>(devid) != <a class="code hl_enumvalue" href="classAP__HAL_1_1Device.html#abdd5c39f57e7022979565e92b6578ba1a5f4d64573ea0feed48cd2d29691cd45c">AP_HAL::Device::BUS_TYPE_UAVCAN</a>)) {</div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span>    }</div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span> </div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span><span class="preprocessor">#if COMPASS_MAX_UNREG_DEV &gt; 0</span></div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span>    <span class="comment">// Check that its not an unused additional mag</span></div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span>    <span class="keywordflow">for</span> (uint8_t i = 0; i&lt;<a class="code hl_define" href="AP__Compass_8h.html#ac01ecc2c9da354c12911bb0ecfa5b7e6">COMPASS_MAX_UNREG_DEV</a>; i++) {</div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#ad15f118665655ffc5e9791abf7737c29">_previously_unreg_mag</a>[i] == devid) {</div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>        }</div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span>    }</div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span> </div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span>    <span class="comment">// Check that its not previously setup mag</span></div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span>    <span class="keywordflow">for</span> (StateIndex i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span>        <span class="keywordflow">if</span> ((uint32_t)<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].expected_dev_id == devid) {</div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>        }</div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span>    }</div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span>}</div>
</div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span> </div>
<div class="foldopen" id="foldopen01637" data-start="{" data-end="}">
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"><a class="line" href="classCompass.html#aef26ec454da865f61012aa9033cf3358"> 1637</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classCompass.html#aef26ec454da865f61012aa9033cf3358">Compass::remove_unreg_dev_id</a>(uint32_t devid)</div>
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"> 1638</span>{</div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span>    <span class="comment">// We only do this for UAVCAN mag</span></div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span>    <span class="keywordflow">if</span> (devid == 0 || (<a class="code hl_function" href="classAP__HAL_1_1Device.html#aa66dae71b7f46e115e94cc8302a83c1e">AP_HAL::Device::devid_get_bus_type</a>(devid) != <a class="code hl_enumvalue" href="classAP__HAL_1_1Device.html#abdd5c39f57e7022979565e92b6578ba1a5f4d64573ea0feed48cd2d29691cd45c">AP_HAL::Device::BUS_TYPE_UAVCAN</a>)) {</div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>    }</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span> </div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span><span class="preprocessor">#if COMPASS_MAX_UNREG_DEV &gt; 0</span></div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span>    <span class="keywordflow">for</span> (uint8_t i = 0; i&lt;<a class="code hl_define" href="AP__Compass_8h.html#ac01ecc2c9da354c12911bb0ecfa5b7e6">COMPASS_MAX_UNREG_DEV</a>; i++) {</div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>        <span class="keywordflow">if</span> ((uint32_t)<a class="code hl_variable" href="classCompass.html#a86a6d63e7b398dd8b0098371d53c0ea3">extra_dev_id</a>[i] == devid) {</div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>            <a class="code hl_variable" href="classCompass.html#a86a6d63e7b398dd8b0098371d53c0ea3">extra_dev_id</a>[i].set(0);</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>        }</div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>    }</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span>}</div>
</div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span> </div>
<div class="foldopen" id="foldopen01656" data-start="{" data-end="}">
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"><a class="line" href="classCompass.html#a433e7a61c3b4f0432d12067bdd2c4045"> 1656</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classCompass.html#a433e7a61c3b4f0432d12067bdd2c4045">Compass::_reset_compass_id</a>()</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span>{</div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span>    <span class="comment">// Check if any of the registered devs are not registered</span></div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span>    <span class="keywordflow">for</span> (Priority i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[i] != <a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[i] ||</div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>            <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[i] == 0) {</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>            <span class="comment">//We don&#39;t touch priorities that might have been touched by the user</span></div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>        }</div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="classCompass.html#acea3a6c15669b5b88b5b077179dd82ac">_get_state</a>(i).registered) {</div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>            <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[i].set_and_save(0);</div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>            <a class="code hl_define" href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a>(MAV_SEVERITY_ALERT, <span class="stringliteral">&quot;Mag: Compass #%d with DEVID %lu removed&quot;</span>, uint8_t(i), (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>)<a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[i]);</div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>        }</div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>    }</div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span> </div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span>    <span class="comment">// Check if any of the old registered devs are not registered</span></div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span>    <span class="comment">// and hence can be removed</span></div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span>    <span class="keywordflow">for</span> (StateIndex i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].dev_id == 0 &amp;&amp; <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].expected_dev_id != 0) {</div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>            <span class="comment">// also hard reset dev_ids that are not detected</span></div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span>            <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].dev_id.save();</div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span>        }</div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span>    }</div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>}</div>
</div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span> </div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span><span class="comment">// Look for devices beyond initialisation</span></div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01685" data-start="{" data-end="}">
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"><a class="line" href="classCompass.html#acf324ab18d365c3ed1969fd888f314b2"> 1685</a></span><a class="code hl_function" href="classCompass.html#acf324ab18d365c3ed1969fd888f314b2">Compass::_detect_runtime</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span>{</div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span><span class="preprocessor">#if AP_COMPASS_DRONECAN_ENABLED</span></div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classCompass.html#a90413f928c630414d9e3d06894cb30ad">available</a>()) {</div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span>    }</div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span> </div>
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"> 1692</span>    <span class="comment">//Don&#39;t try to add device while armed</span></div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">get_soft_armed</a>()) {</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>    }</div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>    <span class="keyword">static</span> uint32_t last_try;</div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>    <span class="comment">//Try once every second</span></div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>    <span class="keywordflow">if</span> ((<a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>() - last_try) &lt; 1000) {</div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>    }</div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span>    last_try = <a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classCompass.html#a678ad037acc44e46598012b7ad17b2a6">_driver_enabled</a>(DRIVER_UAVCAN)) {</div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span>        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a5ae256887a80a65f39d06f1cb2cbfacb">COMPASS_MAX_BACKEND</a>; i++) {</div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span>            <a class="code hl_class" href="classAP__Compass__Backend.html">AP_Compass_Backend</a>* _uavcan_backend = AP_Compass_DroneCAN::probe(i);</div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span>            <span class="keywordflow">if</span> (_uavcan_backend) {</div>
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"> 1706</span>                <a class="code hl_function" href="classCompass.html#a23dca9254efb3dedb9dcd565c829d707">_add_backend</a>(_uavcan_backend);</div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span>            }</div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>            <a class="code hl_define" href="AP__Compass_8cpp.html#ad644760d1cab90de3f8ad72b11a7c2a7">CHECK_UNREG_LIMIT_RETURN</a>;</div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span>        }</div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>    }</div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_DRONECAN_ENABLED</span></div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span>}</div>
</div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span> </div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01715" data-start="{" data-end="}">
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"><a class="line" href="classCompass.html#a2593e947a6c8a4937dccd2d367158b74"> 1715</a></span><a class="code hl_function" href="classCompass.html#a2593e947a6c8a4937dccd2d367158b74">Compass::read</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"> 1716</span>{</div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classCompass.html#a90413f928c630414d9e3d06894cb30ad">available</a>()) {</div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span>    }</div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span> </div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span><span class="preprocessor">#if HAL_LOGGING_ENABLED</span></div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> old_healthy = <a class="code hl_function" href="classCompass.html#a76b5ecbd5bd613d28b1172834d3a8db9">healthy</a>();</div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span> </div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span><span class="preprocessor">#ifndef HAL_BUILD_AP_PERIPH</span></div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classCompass.html#ac51b3cd4741176f62eb120617bd9f43b">_initial_location_set</a>) {</div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span>        <a class="code hl_function" href="classCompass.html#a9fcdb386c14b2879dba2080374b2179f">try_set_initial_location</a>();</div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span>    }</div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span> </div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span>    <a class="code hl_function" href="classCompass.html#acf324ab18d365c3ed1969fd888f314b2">_detect_runtime</a>();</div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span> </div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span>    <span class="keywordflow">for</span> (uint8_t i=0; i&lt; <a class="code hl_variable" href="classCompass.html#ac3bf8f6ab108927b2ea704b3dcba1355">_backend_count</a>; i++) {</div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span>        <span class="comment">// call read on each of the backend. This call updates field[i]</span></div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span>        <a class="code hl_variable" href="classCompass.html#af46d67cb8eb4bc4c51bb12be6813cfdd">_backends</a>[i]-&gt;<a class="code hl_function" href="classAP__Compass__Backend.html#a4ad0e616103be3703829b829ab590a53">read</a>();</div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span>    }</div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span>    uint32_t time = <a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>    <span class="keywordtype">bool</span> any_healthy = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>    <span class="keywordflow">for</span> (StateIndex i(0); i &lt; <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].healthy = (time - <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].last_update_ms &lt; 500);</div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span>        any_healthy |= <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].healthy;</div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span>    }</div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span><span class="preprocessor">#if COMPASS_LEARN_ENABLED</span></div>
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"> 1744</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a9a5653285eb6768ddfe8b7529ba12c03">_learn</a> == <a class="code hl_enumvalue" href="classCompass.html#a5ed931ce45b6449a63d57bb01fe5a0c9ac67e46a1613956b81acf80a37742c288">LEARN_INFLIGHT</a> &amp;&amp; !<a class="code hl_variable" href="classCompass.html#a75aaff7b480627c038a0810862606bf9">learn_allocated</a>) {</div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span>        <a class="code hl_variable" href="classCompass.html#a75aaff7b480627c038a0810862606bf9">learn_allocated</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>        <a class="code hl_variable" href="classCompass.html#a5a838bd25f13f41d428c10a8c44e965a">learn</a> = <span class="keyword">new</span> <a class="code hl_friend" href="classCompass.html#a80e369bd0d6a5d30b78d933b219d327e">CompassLearn</a>(*<span class="keyword">this</span>);</div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>    }</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a9a5653285eb6768ddfe8b7529ba12c03">_learn</a> == <a class="code hl_enumvalue" href="classCompass.html#a5ed931ce45b6449a63d57bb01fe5a0c9ac67e46a1613956b81acf80a37742c288">LEARN_INFLIGHT</a> &amp;&amp; <a class="code hl_variable" href="classCompass.html#a5a838bd25f13f41d428c10a8c44e965a">learn</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span>        <a class="code hl_variable" href="classCompass.html#a5a838bd25f13f41d428c10a8c44e965a">learn</a>-&gt;<a class="code hl_function" href="classCompassLearn.html#ac8ff1a868c253b5ae8bd434be2bc7e3d">update</a>();</div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>    }</div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span><span class="preprocessor">#if HAL_LOGGING_ENABLED</span></div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span>    <span class="keywordflow">if</span> (any_healthy &amp;&amp; <a class="code hl_variable" href="classCompass.html#a068308f9242c606086b60416142e437b">_log_bit</a> != (uint32_t)-1 &amp;&amp; <a class="code hl_function" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().should_log(<a class="code hl_variable" href="classCompass.html#a068308f9242c606086b60416142e437b">_log_bit</a>)) {</div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span>        <a class="code hl_function" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().<a class="code hl_function" href="classAP__Logger.html#aa24dd7890759f0d20d05fedbd5b474dc">Write_Compass</a>();</div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span>    }</div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span> </div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span>    <span class="comment">// Set _first_usable parameter</span></div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span>    <span class="keywordflow">for</span> (Priority i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#afa8ec003900ff5b9727aa5f3a8372935">_use_for_yaw</a>[i]) {</div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span>            <a class="code hl_variable" href="classCompass.html#a7cb1f23f85ae4861803c2bd6cacf678f">_first_usable</a> = uint8_t(i);</div>
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"> 1762</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span>        }</div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>    }</div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> new_healthy = <a class="code hl_function" href="classCompass.html#a76b5ecbd5bd613d28b1172834d3a8db9">healthy</a>();</div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span> </div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span><span class="preprocessor">#if HAL_LOGGING_ENABLED</span></div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span> </div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span><span class="preprocessor">    #define MASK_LOG_ANY                    0xFFFF</span></div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span> </div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span>    <span class="keywordflow">if</span> (new_healthy != old_healthy) {</div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().should_log(MASK_LOG_ANY)) {</div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span>            <span class="keyword">const</span> <a class="code hl_enumeration" href="AP__Logger_8h.html#a90bd604ad2616a0bd3da3a8c055d33c9">LogErrorCode</a> code = new_healthy ? <a class="code hl_enumvalue" href="AP__Logger_8h.html#a90bd604ad2616a0bd3da3a8c055d33c9a7ae9e07d0c1fad47a312c844704c5abc">LogErrorCode::ERROR_RESOLVED</a> : <a class="code hl_enumvalue" href="AP__Logger_8h.html#a90bd604ad2616a0bd3da3a8c055d33c9a7438a7e4e4f36f04fda32fa100121e47">LogErrorCode::UNHEALTHY</a>;</div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span>            <a class="code hl_function" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().<a class="code hl_function" href="classAP__Logger.html#a5f47086952bb5e841d979491e6dd562f">Write_Error</a>(<a class="code hl_enumvalue" href="AP__Logger_8h.html#a88b4cdb83aeee0d38a55b8194381057fab513c44a4d8c00922c7155d8a90dfde5">LogErrorSubsystem::COMPASS</a>, code);</div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span>        }</div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span>    }</div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span> </div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span>    <span class="keywordflow">return</span> new_healthy;</div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>}</div>
</div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span> </div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span>uint8_t</div>
<div class="foldopen" id="foldopen01783" data-start="{" data-end="}">
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"><a class="line" href="classCompass.html#a049567dd39f99577797beb087e41f13a"> 1783</a></span><a class="code hl_function" href="classCompass.html#a049567dd39f99577797beb087e41f13a">Compass::get_healthy_mask</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>    uint8_t healthy_mask = 0;</div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span>    <span class="keywordflow">for</span> (Priority i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classCompass.html#a76b5ecbd5bd613d28b1172834d3a8db9">healthy</a>(uint8_t(i))) {</div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span>            healthy_mask |= 1 &lt;&lt; uint8_t(i);</div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span>        }</div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span>    }</div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span>    <span class="keywordflow">return</span> healthy_mask;</div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>}</div>
</div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span> </div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01795" data-start="{" data-end="}">
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"><a class="line" href="classCompass.html#a18ec405430e055e4a01912a8ca73cbc3"> 1795</a></span><a class="code hl_function" href="classCompass.html#a18ec405430e055e4a01912a8ca73cbc3">Compass::set_offsets</a>(uint8_t i, <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;offsets)</div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span>{</div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span>    <span class="comment">// sanity check compass instance provided</span></div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span>    StateIndex <span class="keywordtype">id</span> = <a class="code hl_function" href="classCompass.html#a5b6bd29bfc993d353ed2f8b03b387de4">_get_state_id</a>(Priority(i));</div>
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"> 1799</span>    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &lt; <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) {</div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[id].offset.set(offsets);</div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>    }</div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span>}</div>
</div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span> </div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01805" data-start="{" data-end="}">
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"><a class="line" href="classCompass.html#afeac6bcfad2650762cccda72dbce3e69"> 1805</a></span><a class="code hl_function" href="classCompass.html#afeac6bcfad2650762cccda72dbce3e69">Compass::set_and_save_offsets</a>(uint8_t i, <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;offsets)</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>{</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span>    <span class="comment">// sanity check compass instance provided</span></div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>    StateIndex <span class="keywordtype">id</span> = <a class="code hl_function" href="classCompass.html#a5b6bd29bfc993d353ed2f8b03b387de4">_get_state_id</a>(Priority(i));</div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &lt; <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) {</div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[id].offset.set(offsets);</div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span>        <a class="code hl_function" href="classCompass.html#abfc394b43272d5a6e97001232e201b7f">save_offsets</a>(i);</div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span>    }</div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span>}</div>
</div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span> </div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span><span class="preprocessor">#if AP_COMPASS_DIAGONALS_ENABLED</span></div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01817" data-start="{" data-end="}">
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"><a class="line" href="classCompass.html#ae581710aa79ddf7abce3b3893bb08ea5"> 1817</a></span><a class="code hl_function" href="classCompass.html#ae581710aa79ddf7abce3b3893bb08ea5">Compass::set_and_save_diagonals</a>(uint8_t i, <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;diagonals)</div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span>{</div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span>    <span class="comment">// sanity check compass instance provided</span></div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span>    StateIndex <span class="keywordtype">id</span> = <a class="code hl_function" href="classCompass.html#a5b6bd29bfc993d353ed2f8b03b387de4">_get_state_id</a>(Priority(i));</div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span>    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &lt; <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) {</div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[id].diagonals.set_and_save(diagonals);</div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span>    }</div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span>}</div>
</div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span> </div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01827" data-start="{" data-end="}">
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"><a class="line" href="classCompass.html#a6728a7129a64d973461b9d5eb95dc81a"> 1827</a></span><a class="code hl_function" href="classCompass.html#a6728a7129a64d973461b9d5eb95dc81a">Compass::set_and_save_offdiagonals</a>(uint8_t i, <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;offdiagonals)</div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span>{</div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span>    <span class="comment">// sanity check compass instance provided</span></div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span>    StateIndex <span class="keywordtype">id</span> = <a class="code hl_function" href="classCompass.html#a5b6bd29bfc993d353ed2f8b03b387de4">_get_state_id</a>(Priority(i));</div>
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"> 1831</span>    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &lt; <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) {</div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[id].offdiagonals.set_and_save(offdiagonals);</div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span>    }</div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span>}</div>
</div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span><span class="preprocessor">#endif </span><span class="comment">// AP_COMPASS_DIAGONALS_ENABLED</span></div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span> </div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01838" data-start="{" data-end="}">
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"><a class="line" href="classCompass.html#af6329b7b824c203c368278e6f2c4a6c4"> 1838</a></span><a class="code hl_function" href="classCompass.html#af6329b7b824c203c368278e6f2c4a6c4">Compass::set_and_save_scale_factor</a>(uint8_t i, <span class="keywordtype">float</span> scale_factor)</div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span>{</div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span>    StateIndex <span class="keywordtype">id</span> = <a class="code hl_function" href="classCompass.html#a5b6bd29bfc993d353ed2f8b03b387de4">_get_state_id</a>(Priority(i));</div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span>    <span class="keywordflow">if</span> (i &lt; <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) {</div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[id].scale_factor.set_and_save(scale_factor);</div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span>    }</div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>}</div>
</div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span> </div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01847" data-start="{" data-end="}">
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"><a class="line" href="classCompass.html#a95f3b4686f214914703c321c9c8e9df2"> 1847</a></span><a class="code hl_function" href="classCompass.html#abfc394b43272d5a6e97001232e201b7f">Compass::save_offsets</a>(uint8_t i)</div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span>{</div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span>    StateIndex <span class="keywordtype">id</span> = <a class="code hl_function" href="classCompass.html#a5b6bd29bfc993d353ed2f8b03b387de4">_get_state_id</a>(Priority(i));</div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span>    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &lt; <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) {</div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[id].offset.save();  <span class="comment">// save offsets</span></div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[id].dev_id.set_and_save(<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[<span class="keywordtype">id</span>].detected_dev_id);</div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span>    }</div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span>}</div>
</div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span> </div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01857" data-start="{" data-end="}">
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"><a class="line" href="classCompass.html#a1976764e3dd9aa75441275f8d3a0a78e"> 1857</a></span><a class="code hl_function" href="classCompass.html#a1976764e3dd9aa75441275f8d3a0a78e">Compass::set_and_save_orientation</a>(uint8_t i, <a class="code hl_enumeration" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681">Rotation</a> orientation)</div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span>{</div>
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"> 1859</span>    StateIndex <span class="keywordtype">id</span> = <a class="code hl_function" href="classCompass.html#a5b6bd29bfc993d353ed2f8b03b387de4">_get_state_id</a>(Priority(i));</div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"> 1860</span>    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &lt; <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) {</div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[id].orientation.set_and_save_ifchanged(orientation);</div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span>    }</div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span>}</div>
</div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span> </div>
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"> 1865</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01866" data-start="{" data-end="}">
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"><a class="line" href="classCompass.html#abfc394b43272d5a6e97001232e201b7f"> 1866</a></span><a class="code hl_function" href="classCompass.html#abfc394b43272d5a6e97001232e201b7f">Compass::save_offsets</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span>{</div>
<div class="line"><a id="l01868" name="l01868"></a><span class="lineno"> 1868</span>    <span class="keywordflow">for</span> (Priority i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l01869" name="l01869"></a><span class="lineno"> 1869</span>        <a class="code hl_function" href="classCompass.html#abfc394b43272d5a6e97001232e201b7f">save_offsets</a>(uint8_t(i));</div>
<div class="line"><a id="l01870" name="l01870"></a><span class="lineno"> 1870</span>    }</div>
<div class="line"><a id="l01871" name="l01871"></a><span class="lineno"> 1871</span>}</div>
</div>
<div class="line"><a id="l01872" name="l01872"></a><span class="lineno"> 1872</span> </div>
<div class="line"><a id="l01873" name="l01873"></a><span class="lineno"> 1873</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01874" data-start="{" data-end="}">
<div class="line"><a id="l01874" name="l01874"></a><span class="lineno"><a class="line" href="classCompass.html#a307ba851d14fd2ac3b655227812f6b4d"> 1874</a></span><a class="code hl_function" href="classCompass.html#a307ba851d14fd2ac3b655227812f6b4d">Compass::set_motor_compensation</a>(uint8_t i, <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;motor_comp_factor)</div>
<div class="line"><a id="l01875" name="l01875"></a><span class="lineno"> 1875</span>{</div>
<div class="line"><a id="l01876" name="l01876"></a><span class="lineno"> 1876</span>    StateIndex <span class="keywordtype">id</span> = <a class="code hl_function" href="classCompass.html#a5b6bd29bfc993d353ed2f8b03b387de4">_get_state_id</a>(Priority(i));</div>
<div class="line"><a id="l01877" name="l01877"></a><span class="lineno"> 1877</span>    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &lt; <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) {</div>
<div class="line"><a id="l01878" name="l01878"></a><span class="lineno"> 1878</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[id].motor_compensation.set(motor_comp_factor);</div>
<div class="line"><a id="l01879" name="l01879"></a><span class="lineno"> 1879</span>    }</div>
<div class="line"><a id="l01880" name="l01880"></a><span class="lineno"> 1880</span>}</div>
</div>
<div class="line"><a id="l01881" name="l01881"></a><span class="lineno"> 1881</span> </div>
<div class="line"><a id="l01882" name="l01882"></a><span class="lineno"> 1882</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01883" data-start="{" data-end="}">
<div class="line"><a id="l01883" name="l01883"></a><span class="lineno"><a class="line" href="classCompass.html#adeefda110ce0a02edfb3d344d632777a"> 1883</a></span><a class="code hl_function" href="classCompass.html#adeefda110ce0a02edfb3d344d632777a">Compass::save_motor_compensation</a>()</div>
<div class="line"><a id="l01884" name="l01884"></a><span class="lineno"> 1884</span>{</div>
<div class="line"><a id="l01885" name="l01885"></a><span class="lineno"> 1885</span>    StateIndex id;</div>
<div class="line"><a id="l01886" name="l01886"></a><span class="lineno"> 1886</span>    <a class="code hl_variable" href="classCompass.html#a53de8105fdd000b28afe20ced1b85d5a">_motor_comp_type</a>.save();</div>
<div class="line"><a id="l01887" name="l01887"></a><span class="lineno"> 1887</span>    <span class="keywordflow">for</span> (Priority k(0); k&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; k++) {</div>
<div class="line"><a id="l01888" name="l01888"></a><span class="lineno"> 1888</span>        <span class="keywordtype">id</span> = <a class="code hl_function" href="classCompass.html#a5b6bd29bfc993d353ed2f8b03b387de4">_get_state_id</a>(k);</div>
<div class="line"><a id="l01889" name="l01889"></a><span class="lineno"> 1889</span>        <span class="keywordflow">if</span> (<span class="keywordtype">id</span>&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) {</div>
<div class="line"><a id="l01890" name="l01890"></a><span class="lineno"> 1890</span>            <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[id].motor_compensation.save();</div>
<div class="line"><a id="l01891" name="l01891"></a><span class="lineno"> 1891</span>        }</div>
<div class="line"><a id="l01892" name="l01892"></a><span class="lineno"> 1892</span>    }</div>
<div class="line"><a id="l01893" name="l01893"></a><span class="lineno"> 1893</span>}</div>
</div>
<div class="line"><a id="l01894" name="l01894"></a><span class="lineno"> 1894</span> </div>
<div class="foldopen" id="foldopen01895" data-start="{" data-end="}">
<div class="line"><a id="l01895" name="l01895"></a><span class="lineno"><a class="line" href="classCompass.html#a9fcdb386c14b2879dba2080374b2179f"> 1895</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classCompass.html#a9fcdb386c14b2879dba2080374b2179f">Compass::try_set_initial_location</a>()</div>
<div class="line"><a id="l01896" name="l01896"></a><span class="lineno"> 1896</span>{</div>
<div class="line"><a id="l01897" name="l01897"></a><span class="lineno"> 1897</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classCompass.html#a92a1e23d7ff2ade9024f2145e4e8d0a2">_auto_declination</a>) {</div>
<div class="line"><a id="l01898" name="l01898"></a><span class="lineno"> 1898</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01899" name="l01899"></a><span class="lineno"> 1899</span>    }</div>
<div class="line"><a id="l01900" name="l01900"></a><span class="lineno"> 1900</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classCompass.html#ab315b6dc2d05ea4649d5cf8f1a2b511a">_enabled</a>) {</div>
<div class="line"><a id="l01901" name="l01901"></a><span class="lineno"> 1901</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01902" name="l01902"></a><span class="lineno"> 1902</span>    }</div>
<div class="line"><a id="l01903" name="l01903"></a><span class="lineno"> 1903</span> </div>
<div class="line"><a id="l01904" name="l01904"></a><span class="lineno"> 1904</span>    <a class="code hl_class" href="classLocation.html">Location</a> loc;</div>
<div class="line"><a id="l01905" name="l01905"></a><span class="lineno"> 1905</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a>().get_location(loc)) {</div>
<div class="line"><a id="l01906" name="l01906"></a><span class="lineno"> 1906</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01907" name="l01907"></a><span class="lineno"> 1907</span>    }</div>
<div class="line"><a id="l01908" name="l01908"></a><span class="lineno"> 1908</span>    <a class="code hl_variable" href="classCompass.html#ac51b3cd4741176f62eb120617bd9f43b">_initial_location_set</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01909" name="l01909"></a><span class="lineno"> 1909</span> </div>
<div class="line"><a id="l01910" name="l01910"></a><span class="lineno"> 1910</span>    <span class="comment">// if automatic declination is configured, then compute</span></div>
<div class="line"><a id="l01911" name="l01911"></a><span class="lineno"> 1911</span>    <span class="comment">// the declination based on the initial GPS fix</span></div>
<div class="line"><a id="l01912" name="l01912"></a><span class="lineno"> 1912</span>    <span class="comment">// Set the declination based on the lat/lng from GPS</span></div>
<div class="line"><a id="l01913" name="l01913"></a><span class="lineno"> 1913</span>    <a class="code hl_variable" href="classCompass.html#a424b78025887b128dd21833cb6e31d0b">_declination</a>.set(<a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>(</div>
<div class="line"><a id="l01914" name="l01914"></a><span class="lineno"> 1914</span>                         <a class="code hl_function" href="classAP__Declination.html#ae3c4783226b79c64dc2c2be9180f9d6e">AP_Declination::get_declination</a>(</div>
<div class="line"><a id="l01915" name="l01915"></a><span class="lineno"> 1915</span>                             (<span class="keywordtype">float</span>)loc.<a class="code hl_variable" href="classLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a> / 10000000,</div>
<div class="line"><a id="l01916" name="l01916"></a><span class="lineno"> 1916</span>                             (<span class="keywordtype">float</span>)loc.<a class="code hl_variable" href="classLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a> / 10000000)));</div>
<div class="line"><a id="l01917" name="l01917"></a><span class="lineno"> 1917</span>}</div>
</div>
<div class="line"><a id="l01918" name="l01918"></a><span class="lineno"> 1918</span> </div>
<div class="line"><a id="l01920" name="l01920"></a><span class="lineno"> 1920</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01921" data-start="{" data-end="}">
<div class="line"><a id="l01921" name="l01921"></a><span class="lineno"><a class="line" href="classCompass.html#a099bc37c6d1b03238c2efe39ea3b14d3"> 1921</a></span><a class="code hl_function" href="classCompass.html#a099bc37c6d1b03238c2efe39ea3b14d3">Compass::use_for_yaw</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01922" name="l01922"></a><span class="lineno"> 1922</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01923" name="l01923"></a><span class="lineno"> 1923</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classCompass.html#a76b5ecbd5bd613d28b1172834d3a8db9">healthy</a>(<a class="code hl_variable" href="classCompass.html#a7cb1f23f85ae4861803c2bd6cacf678f">_first_usable</a>) &amp;&amp; <a class="code hl_function" href="classCompass.html#a099bc37c6d1b03238c2efe39ea3b14d3">use_for_yaw</a>(<a class="code hl_variable" href="classCompass.html#a7cb1f23f85ae4861803c2bd6cacf678f">_first_usable</a>);</div>
<div class="line"><a id="l01924" name="l01924"></a><span class="lineno"> 1924</span>}</div>
</div>
<div class="line"><a id="l01925" name="l01925"></a><span class="lineno"> 1925</span> </div>
<div class="line"><a id="l01927" name="l01927"></a><span class="lineno"> 1927</span><span class="keywordtype">bool</span></div>
<div class="foldopen" id="foldopen01928" data-start="{" data-end="}">
<div class="line"><a id="l01928" name="l01928"></a><span class="lineno"><a class="line" href="classCompass.html#af5c3da7e49f681c1d7a0354b91eba7ba"> 1928</a></span><a class="code hl_function" href="classCompass.html#a099bc37c6d1b03238c2efe39ea3b14d3">Compass::use_for_yaw</a>(uint8_t i)<span class="keyword"> const</span></div>
<div class="line"><a id="l01929" name="l01929"></a><span class="lineno"> 1929</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01930" name="l01930"></a><span class="lineno"> 1930</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classCompass.html#a90413f928c630414d9e3d06894cb30ad">available</a>()) {</div>
<div class="line"><a id="l01931" name="l01931"></a><span class="lineno"> 1931</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01932" name="l01932"></a><span class="lineno"> 1932</span>    }</div>
<div class="line"><a id="l01933" name="l01933"></a><span class="lineno"> 1933</span>    <span class="comment">// when we are doing in-flight compass learning the state</span></div>
<div class="line"><a id="l01934" name="l01934"></a><span class="lineno"> 1934</span>    <span class="comment">// estimator must not use the compass. The learning code turns off</span></div>
<div class="line"><a id="l01935" name="l01935"></a><span class="lineno"> 1935</span>    <span class="comment">// inflight learning when it has converged</span></div>
<div class="line"><a id="l01936" name="l01936"></a><span class="lineno"> 1936</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classCompass.html#afa8ec003900ff5b9727aa5f3a8372935">_use_for_yaw</a>[Priority(i)] &amp;&amp; <a class="code hl_variable" href="classCompass.html#a9a5653285eb6768ddfe8b7529ba12c03">_learn</a>.get() != <a class="code hl_enumvalue" href="classCompass.html#a5ed931ce45b6449a63d57bb01fe5a0c9ac67e46a1613956b81acf80a37742c288">LEARN_INFLIGHT</a>;</div>
<div class="line"><a id="l01937" name="l01937"></a><span class="lineno"> 1937</span>}</div>
</div>
<div class="line"><a id="l01938" name="l01938"></a><span class="lineno"> 1938</span> </div>
<div class="line"><a id="l01939" name="l01939"></a><span class="lineno"> 1939</span><span class="comment">/*</span></div>
<div class="line"><a id="l01940" name="l01940"></a><span class="lineno"> 1940</span><span class="comment">  return the number of enabled sensors. Used to determine if</span></div>
<div class="line"><a id="l01941" name="l01941"></a><span class="lineno"> 1941</span><span class="comment">  non-compass operation is desired</span></div>
<div class="line"><a id="l01942" name="l01942"></a><span class="lineno"> 1942</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen01943" data-start="{" data-end="}">
<div class="line"><a id="l01943" name="l01943"></a><span class="lineno"><a class="line" href="classCompass.html#af3deb20615b93859ff960f3a0cf90920"> 1943</a></span>uint8_t <a class="code hl_function" href="classCompass.html#af3deb20615b93859ff960f3a0cf90920">Compass::get_num_enabled</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01944" name="l01944"></a><span class="lineno"> 1944</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01945" name="l01945"></a><span class="lineno"> 1945</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classCompass.html#aab02220a8209d664f89f2be9050cf283">get_count</a>() == 0) {</div>
<div class="line"><a id="l01946" name="l01946"></a><span class="lineno"> 1946</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l01947" name="l01947"></a><span class="lineno"> 1947</span>    }</div>
<div class="line"><a id="l01948" name="l01948"></a><span class="lineno"> 1948</span>    uint8_t <a class="code hl_variable" href="test__expandingstring__failure_8cpp.html#a86988a65e0d3ece7990c032c159786d6">count</a> = 0;</div>
<div class="line"><a id="l01949" name="l01949"></a><span class="lineno"> 1949</span>    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l01950" name="l01950"></a><span class="lineno"> 1950</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classCompass.html#a099bc37c6d1b03238c2efe39ea3b14d3">use_for_yaw</a>(i)) {</div>
<div class="line"><a id="l01951" name="l01951"></a><span class="lineno"> 1951</span>            <a class="code hl_variable" href="test__expandingstring__failure_8cpp.html#a86988a65e0d3ece7990c032c159786d6">count</a>++;</div>
<div class="line"><a id="l01952" name="l01952"></a><span class="lineno"> 1952</span>        }</div>
<div class="line"><a id="l01953" name="l01953"></a><span class="lineno"> 1953</span>    }</div>
<div class="line"><a id="l01954" name="l01954"></a><span class="lineno"> 1954</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="test__expandingstring__failure_8cpp.html#a86988a65e0d3ece7990c032c159786d6">count</a>;</div>
<div class="line"><a id="l01955" name="l01955"></a><span class="lineno"> 1955</span>}</div>
</div>
<div class="line"><a id="l01956" name="l01956"></a><span class="lineno"> 1956</span> </div>
<div class="line"><a id="l01957" name="l01957"></a><span class="lineno"> 1957</span><span class="keywordtype">void</span></div>
<div class="foldopen" id="foldopen01958" data-start="{" data-end="}">
<div class="line"><a id="l01958" name="l01958"></a><span class="lineno"><a class="line" href="classCompass.html#ac3584d30eca4e60567613c1b09785505"> 1958</a></span><a class="code hl_function" href="classCompass.html#ac3584d30eca4e60567613c1b09785505">Compass::set_declination</a>(<span class="keywordtype">float</span> <a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>, <span class="keywordtype">bool</span> save_to_eeprom)</div>
<div class="line"><a id="l01959" name="l01959"></a><span class="lineno"> 1959</span>{</div>
<div class="line"><a id="l01960" name="l01960"></a><span class="lineno"> 1960</span>    <span class="keywordflow">if</span> (save_to_eeprom) {</div>
<div class="line"><a id="l01961" name="l01961"></a><span class="lineno"> 1961</span>        <a class="code hl_variable" href="classCompass.html#a424b78025887b128dd21833cb6e31d0b">_declination</a>.set_and_save(<a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>);</div>
<div class="line"><a id="l01962" name="l01962"></a><span class="lineno"> 1962</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01963" name="l01963"></a><span class="lineno"> 1963</span>        <a class="code hl_variable" href="classCompass.html#a424b78025887b128dd21833cb6e31d0b">_declination</a>.set(<a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>);</div>
<div class="line"><a id="l01964" name="l01964"></a><span class="lineno"> 1964</span>    }</div>
<div class="line"><a id="l01965" name="l01965"></a><span class="lineno"> 1965</span>}</div>
</div>
<div class="line"><a id="l01966" name="l01966"></a><span class="lineno"> 1966</span> </div>
<div class="line"><a id="l01967" name="l01967"></a><span class="lineno"> 1967</span><span class="keywordtype">float</span></div>
<div class="foldopen" id="foldopen01968" data-start="{" data-end="}">
<div class="line"><a id="l01968" name="l01968"></a><span class="lineno"><a class="line" href="classCompass.html#a4519009b6dc2e68c498903eb314c2a60"> 1968</a></span><a class="code hl_function" href="classCompass.html#a4519009b6dc2e68c498903eb314c2a60">Compass::get_declination</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l01969" name="l01969"></a><span class="lineno"> 1969</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01970" name="l01970"></a><span class="lineno"> 1970</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classCompass.html#a424b78025887b128dd21833cb6e31d0b">_declination</a>.get();</div>
<div class="line"><a id="l01971" name="l01971"></a><span class="lineno"> 1971</span>}</div>
</div>
<div class="line"><a id="l01972" name="l01972"></a><span class="lineno"> 1972</span> </div>
<div class="line"><a id="l01973" name="l01973"></a><span class="lineno"> 1973</span><span class="comment">/*</span></div>
<div class="line"><a id="l01974" name="l01974"></a><span class="lineno"> 1974</span><span class="comment">  calculate a compass heading given the attitude from DCM and the mag vector</span></div>
<div class="line"><a id="l01975" name="l01975"></a><span class="lineno"> 1975</span><span class="comment"> */</span></div>
<div class="line"><a id="l01976" name="l01976"></a><span class="lineno"> 1976</span><span class="keywordtype">float</span></div>
<div class="foldopen" id="foldopen01977" data-start="{" data-end="}">
<div class="line"><a id="l01977" name="l01977"></a><span class="lineno"><a class="line" href="classCompass.html#ad627397f365948397dd403ae14542b6f"> 1977</a></span><a class="code hl_function" href="classCompass.html#a0005716f188963f3ac6494c2a5ce2e2c">Compass::calculate_heading</a>(<span class="keyword">const</span> <a class="code hl_class" href="classMatrix3.html">Matrix3f</a> &amp;dcm_matrix, uint8_t i)<span class="keyword"> const</span></div>
<div class="line"><a id="l01978" name="l01978"></a><span class="lineno"> 1978</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01979" name="l01979"></a><span class="lineno"> 1979</span><span class="comment">/*</span></div>
<div class="line"><a id="l01980" name="l01980"></a><span class="lineno"> 1980</span><span class="comment">    This extracts a roll/pitch-only rotation which is then used to rotate the body frame field into earth frame so the heading can be calculated.</span></div>
<div class="line"><a id="l01981" name="l01981"></a><span class="lineno"> 1981</span><span class="comment">    One could do:</span></div>
<div class="line"><a id="l01982" name="l01982"></a><span class="lineno"> 1982</span><span class="comment">        float roll, pitch, yaw;</span></div>
<div class="line"><a id="l01983" name="l01983"></a><span class="lineno"> 1983</span><span class="comment">        dcm_matrix.to_euler(roll, pitch, yaw)</span></div>
<div class="line"><a id="l01984" name="l01984"></a><span class="lineno"> 1984</span><span class="comment">        Matrix3f rp_rot;</span></div>
<div class="line"><a id="l01985" name="l01985"></a><span class="lineno"> 1985</span><span class="comment">        rp_rot.from_euler(roll, pitch, 0)</span></div>
<div class="line"><a id="l01986" name="l01986"></a><span class="lineno"> 1986</span><span class="comment">        Vector3f ef = rp_rot * field</span></div>
<div class="line"><a id="l01987" name="l01987"></a><span class="lineno"> 1987</span><span class="comment"></span> </div>
<div class="line"><a id="l01988" name="l01988"></a><span class="lineno"> 1988</span><span class="comment">    Because only the X and Y components are needed it&#39;s more efficient to manually calculate:</span></div>
<div class="line"><a id="l01989" name="l01989"></a><span class="lineno"> 1989</span><span class="comment"></span> </div>
<div class="line"><a id="l01990" name="l01990"></a><span class="lineno"> 1990</span><span class="comment">        rp_rot = [ cos(pitch), sin(roll) * sin(pitch),  cos(roll) * sin(pitch)</span></div>
<div class="line"><a id="l01991" name="l01991"></a><span class="lineno"> 1991</span><span class="comment">                            0,              cos(roll),              -sin(roll)]</span></div>
<div class="line"><a id="l01992" name="l01992"></a><span class="lineno"> 1992</span><span class="comment"></span> </div>
<div class="line"><a id="l01993" name="l01993"></a><span class="lineno"> 1993</span><span class="comment">    If the whole matrix is multiplied by cos(pitch) the required trigonometric values can be extracted directly from the existing dcm matrix.</span></div>
<div class="line"><a id="l01994" name="l01994"></a><span class="lineno"> 1994</span><span class="comment">    This multiplication has no effect on the calculated heading as it changes the length of the North/East vector but not its angle.</span></div>
<div class="line"><a id="l01995" name="l01995"></a><span class="lineno"> 1995</span><span class="comment"></span> </div>
<div class="line"><a id="l01996" name="l01996"></a><span class="lineno"> 1996</span><span class="comment">        rp_rot = [ cos(pitch)^2, sin(roll) * sin(pitch) * cos(pitch),  cos(roll) * sin(pitch) * cos(pitch)</span></div>
<div class="line"><a id="l01997" name="l01997"></a><span class="lineno"> 1997</span><span class="comment">                              0,              cos(roll) * cos(pitch),              -sin(roll) * cos(pitch)]</span></div>
<div class="line"><a id="l01998" name="l01998"></a><span class="lineno"> 1998</span><span class="comment"></span> </div>
<div class="line"><a id="l01999" name="l01999"></a><span class="lineno"> 1999</span><span class="comment">    Preexisting values can be substituted in:</span></div>
<div class="line"><a id="l02000" name="l02000"></a><span class="lineno"> 2000</span><span class="comment"></span> </div>
<div class="line"><a id="l02001" name="l02001"></a><span class="lineno"> 2001</span><span class="comment">        dcm_matrix.c.x = -sin(pitch)</span></div>
<div class="line"><a id="l02002" name="l02002"></a><span class="lineno"> 2002</span><span class="comment">        dcm_matrix.c.y =  sin(roll) * cos(pitch)</span></div>
<div class="line"><a id="l02003" name="l02003"></a><span class="lineno"> 2003</span><span class="comment">        dcm_matrix.c.z =  cos(roll) * cos(pitch)</span></div>
<div class="line"><a id="l02004" name="l02004"></a><span class="lineno"> 2004</span><span class="comment"></span> </div>
<div class="line"><a id="l02005" name="l02005"></a><span class="lineno"> 2005</span><span class="comment">        rp_rot = [ cos(pitch)^2, dcm_matrix.c.y * -dcm_matrix.c.x,  dcm_matrix.c.z * -dcm_matrix.c.x</span></div>
<div class="line"><a id="l02006" name="l02006"></a><span class="lineno"> 2006</span><span class="comment">                              0,                   dcm_matrix.c.z,                   -dcm_matrix.c.y]</span></div>
<div class="line"><a id="l02007" name="l02007"></a><span class="lineno"> 2007</span><span class="comment"></span> </div>
<div class="line"><a id="l02008" name="l02008"></a><span class="lineno"> 2008</span><span class="comment">    cos(pitch)^2 is stil needed. This is the same as 1 - sin(pitch)^2.</span></div>
<div class="line"><a id="l02009" name="l02009"></a><span class="lineno"> 2009</span><span class="comment">    sin(pitch) is avalable as dcm_matrix.c.x</span></div>
<div class="line"><a id="l02010" name="l02010"></a><span class="lineno"> 2010</span><span class="comment">*/</span></div>
<div class="line"><a id="l02011" name="l02011"></a><span class="lineno"> 2011</span> </div>
<div class="line"><a id="l02012" name="l02012"></a><span class="lineno"> 2012</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> cos_pitch_sq = 1.0f-(dcm_matrix.<a class="code hl_variable" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code hl_variable" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>*dcm_matrix.<a class="code hl_variable" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code hl_variable" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>);</div>
<div class="line"><a id="l02013" name="l02013"></a><span class="lineno"> 2013</span> </div>
<div class="line"><a id="l02014" name="l02014"></a><span class="lineno"> 2014</span>    <span class="comment">// Tilt compensated magnetic field Y component:</span></div>
<div class="line"><a id="l02015" name="l02015"></a><span class="lineno"> 2015</span>    <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;<a class="code hl_variable" href="test__magfield_8cpp.html#a3ba91122ce457819d940c04b8e436480">field</a> = <a class="code hl_function" href="classCompass.html#a68c13ec59710efc99bfb7ea96211b426">get_field</a>(i);</div>
<div class="line"><a id="l02016" name="l02016"></a><span class="lineno"> 2016</span> </div>
<div class="line"><a id="l02017" name="l02017"></a><span class="lineno"> 2017</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> headY = <a class="code hl_variable" href="test__magfield_8cpp.html#a3ba91122ce457819d940c04b8e436480">field</a>.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> * dcm_matrix.<a class="code hl_variable" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> - <a class="code hl_variable" href="test__magfield_8cpp.html#a3ba91122ce457819d940c04b8e436480">field</a>.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> * dcm_matrix.<a class="code hl_variable" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a id="l02018" name="l02018"></a><span class="lineno"> 2018</span> </div>
<div class="line"><a id="l02019" name="l02019"></a><span class="lineno"> 2019</span>    <span class="comment">// Tilt compensated magnetic field X component:</span></div>
<div class="line"><a id="l02020" name="l02020"></a><span class="lineno"> 2020</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> headX = <a class="code hl_variable" href="test__magfield_8cpp.html#a3ba91122ce457819d940c04b8e436480">field</a>.<a class="code hl_variable" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> * cos_pitch_sq - dcm_matrix.<a class="code hl_variable" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code hl_variable" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> * (<a class="code hl_variable" href="test__magfield_8cpp.html#a3ba91122ce457819d940c04b8e436480">field</a>.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> * dcm_matrix.<a class="code hl_variable" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> + <a class="code hl_variable" href="test__magfield_8cpp.html#a3ba91122ce457819d940c04b8e436480">field</a>.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> * dcm_matrix.<a class="code hl_variable" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>);</div>
<div class="line"><a id="l02021" name="l02021"></a><span class="lineno"> 2021</span> </div>
<div class="line"><a id="l02022" name="l02022"></a><span class="lineno"> 2022</span>    <span class="comment">// magnetic heading</span></div>
<div class="line"><a id="l02023" name="l02023"></a><span class="lineno"> 2023</span>    <span class="comment">// 6/4/11 - added constrain to keep bad values from ruining DCM Yaw - Jason S.</span></div>
<div class="line"><a id="l02024" name="l02024"></a><span class="lineno"> 2024</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> heading = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(atan2f(-headY,headX), -<a class="code hl_define" href="definitions_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>, <a class="code hl_define" href="definitions_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>);</div>
<div class="line"><a id="l02025" name="l02025"></a><span class="lineno"> 2025</span> </div>
<div class="line"><a id="l02026" name="l02026"></a><span class="lineno"> 2026</span>    <span class="comment">// Declination correction</span></div>
<div class="line"><a id="l02027" name="l02027"></a><span class="lineno"> 2027</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="AP__Math_8cpp.html#ae77517d032abb1e1b525d2b43ff9a27d">wrap_PI</a>(heading + <a class="code hl_variable" href="classCompass.html#a424b78025887b128dd21833cb6e31d0b">_declination</a>);</div>
<div class="line"><a id="l02028" name="l02028"></a><span class="lineno"> 2028</span>}</div>
</div>
<div class="line"><a id="l02029" name="l02029"></a><span class="lineno"> 2029</span> </div>
<div class="foldopen" id="foldopen02034" data-start="{" data-end="}">
<div class="line"><a id="l02034" name="l02034"></a><span class="lineno"><a class="line" href="classCompass.html#a59622e8195dc29485f24d7c27a9cf7f0"> 2034</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classCompass.html#a59622e8195dc29485f24d7c27a9cf7f0">Compass::configured</a>(uint8_t i)</div>
<div class="line"><a id="l02035" name="l02035"></a><span class="lineno"> 2035</span>{</div>
<div class="line"><a id="l02036" name="l02036"></a><span class="lineno"> 2036</span>    <span class="comment">// exit immediately if instance is beyond the number of compasses we have available</span></div>
<div class="line"><a id="l02037" name="l02037"></a><span class="lineno"> 2037</span>    <span class="keywordflow">if</span> (i &gt; <a class="code hl_function" href="classCompass.html#aab02220a8209d664f89f2be9050cf283">get_count</a>()) {</div>
<div class="line"><a id="l02038" name="l02038"></a><span class="lineno"> 2038</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02039" name="l02039"></a><span class="lineno"> 2039</span>    }</div>
<div class="line"><a id="l02040" name="l02040"></a><span class="lineno"> 2040</span> </div>
<div class="line"><a id="l02041" name="l02041"></a><span class="lineno"> 2041</span>    <span class="comment">// exit immediately if all offsets are zero</span></div>
<div class="line"><a id="l02042" name="l02042"></a><span class="lineno"> 2042</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(<a class="code hl_function" href="classCompass.html#a885d8a0a74407b8c5c795ebee1b3635e">get_offsets</a>(i).length())) {</div>
<div class="line"><a id="l02043" name="l02043"></a><span class="lineno"> 2043</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02044" name="l02044"></a><span class="lineno"> 2044</span>    }</div>
<div class="line"><a id="l02045" name="l02045"></a><span class="lineno"> 2045</span> </div>
<div class="line"><a id="l02046" name="l02046"></a><span class="lineno"> 2046</span>    StateIndex <span class="keywordtype">id</span> = <a class="code hl_function" href="classCompass.html#a5b6bd29bfc993d353ed2f8b03b387de4">_get_state_id</a>(Priority(i));</div>
<div class="line"><a id="l02047" name="l02047"></a><span class="lineno"> 2047</span>    <span class="comment">// exit immediately if dev_id hasn&#39;t been detected</span></div>
<div class="line"><a id="l02048" name="l02048"></a><span class="lineno"> 2048</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[<span class="keywordtype">id</span>].detected_dev_id == 0 || </div>
<div class="line"><a id="l02049" name="l02049"></a><span class="lineno"> 2049</span>        <span class="keywordtype">id</span> == <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) {</div>
<div class="line"><a id="l02050" name="l02050"></a><span class="lineno"> 2050</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02051" name="l02051"></a><span class="lineno"> 2051</span>    }</div>
<div class="line"><a id="l02052" name="l02052"></a><span class="lineno"> 2052</span> </div>
<div class="line"><a id="l02053" name="l02053"></a><span class="lineno"> 2053</span><span class="preprocessor">#ifdef HAL_USE_EMPTY_STORAGE</span></div>
<div class="line"><a id="l02054" name="l02054"></a><span class="lineno"> 2054</span>    <span class="comment">// the load() call below returns zeroes on empty storage, so the</span></div>
<div class="line"><a id="l02055" name="l02055"></a><span class="lineno"> 2055</span>    <span class="comment">// check-stored-value check here will always fail.  Since nobody</span></div>
<div class="line"><a id="l02056" name="l02056"></a><span class="lineno"> 2056</span>    <span class="comment">// really cares about the empty-storage case, shortcut out here</span></div>
<div class="line"><a id="l02057" name="l02057"></a><span class="lineno"> 2057</span>    <span class="comment">// for simplicity.</span></div>
<div class="line"><a id="l02058" name="l02058"></a><span class="lineno"> 2058</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02059" name="l02059"></a><span class="lineno"> 2059</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02060" name="l02060"></a><span class="lineno"> 2060</span> </div>
<div class="line"><a id="l02061" name="l02061"></a><span class="lineno"> 2061</span>    <span class="comment">// back up cached value of dev_id</span></div>
<div class="line"><a id="l02062" name="l02062"></a><span class="lineno"> 2062</span>    int32_t dev_id_cache_value = <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[id].dev_id;</div>
<div class="line"><a id="l02063" name="l02063"></a><span class="lineno"> 2063</span> </div>
<div class="line"><a id="l02064" name="l02064"></a><span class="lineno"> 2064</span>    <span class="comment">// load dev_id from eeprom</span></div>
<div class="line"><a id="l02065" name="l02065"></a><span class="lineno"> 2065</span>    <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[id].dev_id.load();</div>
<div class="line"><a id="l02066" name="l02066"></a><span class="lineno"> 2066</span> </div>
<div class="line"><a id="l02067" name="l02067"></a><span class="lineno"> 2067</span>    <span class="comment">// if dev_id loaded from eeprom is different from detected dev id or dev_id loaded from eeprom is different from cached dev_id, compass is unconfigured</span></div>
<div class="line"><a id="l02068" name="l02068"></a><span class="lineno"> 2068</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[<span class="keywordtype">id</span>].dev_id != <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[<span class="keywordtype">id</span>].detected_dev_id || <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[<span class="keywordtype">id</span>].dev_id != dev_id_cache_value) {</div>
<div class="line"><a id="l02069" name="l02069"></a><span class="lineno"> 2069</span>        <span class="comment">// restore cached value</span></div>
<div class="line"><a id="l02070" name="l02070"></a><span class="lineno"> 2070</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[id].dev_id.set(dev_id_cache_value);</div>
<div class="line"><a id="l02071" name="l02071"></a><span class="lineno"> 2071</span>        <span class="comment">// return failure</span></div>
<div class="line"><a id="l02072" name="l02072"></a><span class="lineno"> 2072</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02073" name="l02073"></a><span class="lineno"> 2073</span>    }</div>
<div class="line"><a id="l02074" name="l02074"></a><span class="lineno"> 2074</span> </div>
<div class="line"><a id="l02075" name="l02075"></a><span class="lineno"> 2075</span>    <span class="comment">// if we got here then it must be configured</span></div>
<div class="line"><a id="l02076" name="l02076"></a><span class="lineno"> 2076</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02077" name="l02077"></a><span class="lineno"> 2077</span>}</div>
</div>
<div class="line"><a id="l02078" name="l02078"></a><span class="lineno"> 2078</span> </div>
<div class="foldopen" id="foldopen02079" data-start="{" data-end="}">
<div class="line"><a id="l02079" name="l02079"></a><span class="lineno"><a class="line" href="classCompass.html#ad8a5991c6492a40f8a93efe28d9c4726"> 2079</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classCompass.html#a59622e8195dc29485f24d7c27a9cf7f0">Compass::configured</a>(<span class="keywordtype">char</span> *failure_msg, uint8_t failure_msg_len)</div>
<div class="line"><a id="l02080" name="l02080"></a><span class="lineno"> 2080</span>{</div>
<div class="line"><a id="l02081" name="l02081"></a><span class="lineno"> 2081</span><span class="preprocessor">#if COMPASS_MAX_INSTANCES &gt; 1</span></div>
<div class="line"><a id="l02082" name="l02082"></a><span class="lineno"> 2082</span>    <span class="comment">// Check if any of the registered devs are not registered</span></div>
<div class="line"><a id="l02083" name="l02083"></a><span class="lineno"> 2083</span>    <span class="keywordflow">for</span> (Priority i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l02084" name="l02084"></a><span class="lineno"> 2084</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[i] != 0 &amp;&amp; <a class="code hl_function" href="classCompass.html#a099bc37c6d1b03238c2efe39ea3b14d3">use_for_yaw</a>(uint8_t(i))) {</div>
<div class="line"><a id="l02085" name="l02085"></a><span class="lineno"> 2085</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="classCompass.html#acea3a6c15669b5b88b5b077179dd82ac">_get_state</a>(i).registered) {</div>
<div class="line"><a id="l02086" name="l02086"></a><span class="lineno"> 2086</span>                <a class="code hl_function" href="stdio_8h.html#a37c1e8ce8a2b411fa666dc33972a2cec">snprintf</a>(failure_msg, failure_msg_len, <span class="stringliteral">&quot;Compass %d not found&quot;</span>, uint8_t(i + 1));</div>
<div class="line"><a id="l02087" name="l02087"></a><span class="lineno"> 2087</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02088" name="l02088"></a><span class="lineno"> 2088</span>            }</div>
<div class="line"><a id="l02089" name="l02089"></a><span class="lineno"> 2089</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">_priority_did_list</a>[i] != <a class="code hl_variable" href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">_priority_did_stored_list</a>[i]) {</div>
<div class="line"><a id="l02090" name="l02090"></a><span class="lineno"> 2090</span>                <a class="code hl_function" href="stdio_8h.html#a37c1e8ce8a2b411fa666dc33972a2cec">snprintf</a>(failure_msg, failure_msg_len, <span class="stringliteral">&quot;Compass order change requires reboot&quot;</span>);</div>
<div class="line"><a id="l02091" name="l02091"></a><span class="lineno"> 2091</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02092" name="l02092"></a><span class="lineno"> 2092</span>            }</div>
<div class="line"><a id="l02093" name="l02093"></a><span class="lineno"> 2093</span>        }</div>
<div class="line"><a id="l02094" name="l02094"></a><span class="lineno"> 2094</span>    }</div>
<div class="line"><a id="l02095" name="l02095"></a><span class="lineno"> 2095</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02096" name="l02096"></a><span class="lineno"> 2096</span> </div>
<div class="line"><a id="l02097" name="l02097"></a><span class="lineno"> 2097</span>    <span class="keywordtype">bool</span> all_configured = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02098" name="l02098"></a><span class="lineno"> 2098</span>    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code hl_function" href="classCompass.html#aab02220a8209d664f89f2be9050cf283">get_count</a>(); i++) {</div>
<div class="line"><a id="l02099" name="l02099"></a><span class="lineno"> 2099</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classCompass.html#a59622e8195dc29485f24d7c27a9cf7f0">configured</a>(i)) {</div>
<div class="line"><a id="l02100" name="l02100"></a><span class="lineno"> 2100</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02101" name="l02101"></a><span class="lineno"> 2101</span>        }</div>
<div class="line"><a id="l02102" name="l02102"></a><span class="lineno"> 2102</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="classCompass.html#a099bc37c6d1b03238c2efe39ea3b14d3">use_for_yaw</a>(i)) {</div>
<div class="line"><a id="l02103" name="l02103"></a><span class="lineno"> 2103</span>            <span class="comment">// we&#39;re not planning on using this anyway so sure,</span></div>
<div class="line"><a id="l02104" name="l02104"></a><span class="lineno"> 2104</span>            <span class="comment">// whatever, it&#39;s configured....</span></div>
<div class="line"><a id="l02105" name="l02105"></a><span class="lineno"> 2105</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02106" name="l02106"></a><span class="lineno"> 2106</span>        }</div>
<div class="line"><a id="l02107" name="l02107"></a><span class="lineno"> 2107</span>        all_configured = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02108" name="l02108"></a><span class="lineno"> 2108</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02109" name="l02109"></a><span class="lineno"> 2109</span>    }</div>
<div class="line"><a id="l02110" name="l02110"></a><span class="lineno"> 2110</span>    <span class="keywordflow">if</span> (!all_configured) {</div>
<div class="line"><a id="l02111" name="l02111"></a><span class="lineno"> 2111</span>        <a class="code hl_function" href="stdio_8h.html#a37c1e8ce8a2b411fa666dc33972a2cec">snprintf</a>(failure_msg, failure_msg_len, <span class="stringliteral">&quot;Compass not calibrated&quot;</span>);</div>
<div class="line"><a id="l02112" name="l02112"></a><span class="lineno"> 2112</span>    }</div>
<div class="line"><a id="l02113" name="l02113"></a><span class="lineno"> 2113</span>    <span class="keywordflow">return</span> all_configured;</div>
<div class="line"><a id="l02114" name="l02114"></a><span class="lineno"> 2114</span>}</div>
</div>
<div class="line"><a id="l02115" name="l02115"></a><span class="lineno"> 2115</span> </div>
<div class="line"><a id="l02116" name="l02116"></a><span class="lineno"> 2116</span><span class="comment">/*</span></div>
<div class="line"><a id="l02117" name="l02117"></a><span class="lineno"> 2117</span><span class="comment">  set the type of motor compensation to use</span></div>
<div class="line"><a id="l02118" name="l02118"></a><span class="lineno"> 2118</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen02119" data-start="{" data-end="}">
<div class="line"><a id="l02119" name="l02119"></a><span class="lineno"><a class="line" href="classCompass.html#ad897fd4be9dd67a65343465614629568"> 2119</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classCompass.html#ad897fd4be9dd67a65343465614629568">Compass::motor_compensation_type</a>(<span class="keyword">const</span> uint8_t comp_type)</div>
<div class="line"><a id="l02120" name="l02120"></a><span class="lineno"> 2120</span>{</div>
<div class="line"><a id="l02121" name="l02121"></a><span class="lineno"> 2121</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a53de8105fdd000b28afe20ced1b85d5a">_motor_comp_type</a> &lt;= <a class="code hl_define" href="AP__Compass_8h.html#aa22be79a45fb28cb3160eacdf5ad4432">AP_COMPASS_MOT_COMP_CURRENT</a> &amp;&amp; <a class="code hl_variable" href="classCompass.html#a53de8105fdd000b28afe20ced1b85d5a">_motor_comp_type</a> != (int8_t)comp_type) {</div>
<div class="line"><a id="l02122" name="l02122"></a><span class="lineno"> 2122</span>        <a class="code hl_variable" href="classCompass.html#a53de8105fdd000b28afe20ced1b85d5a">_motor_comp_type</a>.set((int8_t)comp_type);</div>
<div class="line"><a id="l02123" name="l02123"></a><span class="lineno"> 2123</span>        <a class="code hl_variable" href="classCompass.html#a27440d8cc0751bd27d9dfd4ba9f17957">_thr</a> = 0; <span class="comment">// set current  throttle to zero</span></div>
<div class="line"><a id="l02124" name="l02124"></a><span class="lineno"> 2124</span>        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l02125" name="l02125"></a><span class="lineno"> 2125</span>            <a class="code hl_function" href="classCompass.html#a307ba851d14fd2ac3b655227812f6b4d">set_motor_compensation</a>(i, <a class="code hl_typedef" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>(0,0,0)); <span class="comment">// clear out invalid compensation vectors</span></div>
<div class="line"><a id="l02126" name="l02126"></a><span class="lineno"> 2126</span>        }</div>
<div class="line"><a id="l02127" name="l02127"></a><span class="lineno"> 2127</span>    }</div>
<div class="line"><a id="l02128" name="l02128"></a><span class="lineno"> 2128</span>}</div>
</div>
<div class="line"><a id="l02129" name="l02129"></a><span class="lineno"> 2129</span> </div>
<div class="foldopen" id="foldopen02130" data-start="{" data-end="}">
<div class="line"><a id="l02130" name="l02130"></a><span class="lineno"><a class="line" href="classCompass.html#af8d0469972b7da6464a0d91e20715082"> 2130</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classCompass.html#af8d0469972b7da6464a0d91e20715082">Compass::consistent</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l02131" name="l02131"></a><span class="lineno"> 2131</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02132" name="l02132"></a><span class="lineno"> 2132</span>    <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;primary_mag_field { <a class="code hl_function" href="classCompass.html#a68c13ec59710efc99bfb7ea96211b426">get_field</a>() };</div>
<div class="line"><a id="l02133" name="l02133"></a><span class="lineno"> 2133</span>    <span class="keyword">const</span> <a class="code hl_class" href="structVector2.html">Vector2f</a> &amp;primary_mag_field_xy { primary_mag_field.xy() };</div>
<div class="line"><a id="l02134" name="l02134"></a><span class="lineno"> 2134</span> </div>
<div class="line"><a id="l02135" name="l02135"></a><span class="lineno"> 2135</span>    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code hl_function" href="classCompass.html#aab02220a8209d664f89f2be9050cf283">get_count</a>(); i++) {</div>
<div class="line"><a id="l02136" name="l02136"></a><span class="lineno"> 2136</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="classCompass.html#a099bc37c6d1b03238c2efe39ea3b14d3">use_for_yaw</a>(i)) {</div>
<div class="line"><a id="l02137" name="l02137"></a><span class="lineno"> 2137</span>            <span class="comment">// configured not-to-be-used</span></div>
<div class="line"><a id="l02138" name="l02138"></a><span class="lineno"> 2138</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l02139" name="l02139"></a><span class="lineno"> 2139</span>        }</div>
<div class="line"><a id="l02140" name="l02140"></a><span class="lineno"> 2140</span> </div>
<div class="line"><a id="l02141" name="l02141"></a><span class="lineno"> 2141</span>        <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;mag_field = <a class="code hl_function" href="classCompass.html#a68c13ec59710efc99bfb7ea96211b426">get_field</a>(i);</div>
<div class="line"><a id="l02142" name="l02142"></a><span class="lineno"> 2142</span>        <span class="keyword">const</span> <a class="code hl_class" href="structVector2.html">Vector2f</a> &amp;mag_field_xy = mag_field.<a class="code hl_function" href="classVector3.html#abcf8b89285b9966932d1aceeeadb21d3">xy</a>();</div>
<div class="line"><a id="l02143" name="l02143"></a><span class="lineno"> 2143</span> </div>
<div class="line"><a id="l02144" name="l02144"></a><span class="lineno"> 2144</span>        <span class="keywordflow">if</span> (mag_field_xy.<a class="code hl_function" href="structVector2.html#a90e5514bef75383f219b19d944c039f3">is_zero</a>()) {</div>
<div class="line"><a id="l02145" name="l02145"></a><span class="lineno"> 2145</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02146" name="l02146"></a><span class="lineno"> 2146</span>        }</div>
<div class="line"><a id="l02147" name="l02147"></a><span class="lineno"> 2147</span> </div>
<div class="line"><a id="l02148" name="l02148"></a><span class="lineno"> 2148</span>        <span class="comment">// check for gross misalignment on all axes</span></div>
<div class="line"><a id="l02149" name="l02149"></a><span class="lineno"> 2149</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> xyz_ang_diff  = mag_field.<a class="code hl_function" href="classVector3.html#aa420cb879eaa193857e69556522f9c68">angle</a>(primary_mag_field);</div>
<div class="line"><a id="l02150" name="l02150"></a><span class="lineno"> 2150</span>        <span class="keywordflow">if</span> (xyz_ang_diff &gt; <a class="code hl_define" href="AP__Compass_8h.html#a55cc3f7c59fe257f8926d02f8462aa20">AP_COMPASS_MAX_XYZ_ANG_DIFF</a>) {</div>
<div class="line"><a id="l02151" name="l02151"></a><span class="lineno"> 2151</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02152" name="l02152"></a><span class="lineno"> 2152</span>        }</div>
<div class="line"><a id="l02153" name="l02153"></a><span class="lineno"> 2153</span> </div>
<div class="line"><a id="l02154" name="l02154"></a><span class="lineno"> 2154</span>        <span class="comment">// check for an unacceptable angle difference on the xy plane</span></div>
<div class="line"><a id="l02155" name="l02155"></a><span class="lineno"> 2155</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> xy_ang_diff  = mag_field_xy.<a class="code hl_function" href="structVector2.html#aa5b16091858399424b79f7a580e4284e">angle</a>(primary_mag_field_xy);</div>
<div class="line"><a id="l02156" name="l02156"></a><span class="lineno"> 2156</span>        <span class="keywordflow">if</span> (xy_ang_diff &gt; <a class="code hl_define" href="AP__Compass_8h.html#a8bc3b9dad383e949bb7a78683f027132">AP_COMPASS_MAX_XY_ANG_DIFF</a>) {</div>
<div class="line"><a id="l02157" name="l02157"></a><span class="lineno"> 2157</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02158" name="l02158"></a><span class="lineno"> 2158</span>        }</div>
<div class="line"><a id="l02159" name="l02159"></a><span class="lineno"> 2159</span> </div>
<div class="line"><a id="l02160" name="l02160"></a><span class="lineno"> 2160</span>        <span class="comment">// check for an unacceptable length difference on the xy plane</span></div>
<div class="line"><a id="l02161" name="l02161"></a><span class="lineno"> 2161</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> xy_len_diff = (primary_mag_field_xy-mag_field_xy).length();</div>
<div class="line"><a id="l02162" name="l02162"></a><span class="lineno"> 2162</span>        <span class="keywordflow">if</span> (xy_len_diff &gt; <a class="code hl_define" href="AP__Compass_8h.html#a062f390a5503097ca313e53f277d1f64">AP_COMPASS_MAX_XY_LENGTH_DIFF</a>) {</div>
<div class="line"><a id="l02163" name="l02163"></a><span class="lineno"> 2163</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02164" name="l02164"></a><span class="lineno"> 2164</span>        }</div>
<div class="line"><a id="l02165" name="l02165"></a><span class="lineno"> 2165</span>    }</div>
<div class="line"><a id="l02166" name="l02166"></a><span class="lineno"> 2166</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02167" name="l02167"></a><span class="lineno"> 2167</span>}</div>
</div>
<div class="line"><a id="l02168" name="l02168"></a><span class="lineno"> 2168</span> </div>
<div class="foldopen" id="foldopen02169" data-start="{" data-end="}">
<div class="line"><a id="l02169" name="l02169"></a><span class="lineno"><a class="line" href="classCompass.html#a2e508ee3e4651ef9bb60591d2e2f1618"> 2169</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classCompass.html#a76b5ecbd5bd613d28b1172834d3a8db9">Compass::healthy</a>(uint8_t i)<span class="keyword"> const</span></div>
<div class="line"><a id="l02170" name="l02170"></a><span class="lineno"> 2170</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02171" name="l02171"></a><span class="lineno"> 2171</span>    <span class="keywordflow">return</span> (i &lt; <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>) ? <a class="code hl_function" href="classCompass.html#acea3a6c15669b5b88b5b077179dd82ac">_get_state</a>(Priority(i)).<a class="code hl_variable" href="structCompass_1_1mag__state.html#ad12e4054ec35030309b98a799e9f0df4">healthy</a> : <span class="keyword">false</span>;</div>
<div class="line"><a id="l02172" name="l02172"></a><span class="lineno"> 2172</span>}</div>
</div>
<div class="line"><a id="l02173" name="l02173"></a><span class="lineno"> 2173</span> </div>
<div class="line"><a id="l02174" name="l02174"></a><span class="lineno"> 2174</span><span class="comment">/*</span></div>
<div class="line"><a id="l02175" name="l02175"></a><span class="lineno"> 2175</span><span class="comment">  return true if we have a valid scale factor</span></div>
<div class="line"><a id="l02176" name="l02176"></a><span class="lineno"> 2176</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen02177" data-start="{" data-end="}">
<div class="line"><a id="l02177" name="l02177"></a><span class="lineno"><a class="line" href="classCompass.html#a44f157950e6ee02dd8563050e2883ee7"> 2177</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classCompass.html#a44f157950e6ee02dd8563050e2883ee7">Compass::have_scale_factor</a>(uint8_t i)<span class="keyword"> const</span></div>
<div class="line"><a id="l02178" name="l02178"></a><span class="lineno"> 2178</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02179" name="l02179"></a><span class="lineno"> 2179</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classCompass.html#a90413f928c630414d9e3d06894cb30ad">available</a>()) {</div>
<div class="line"><a id="l02180" name="l02180"></a><span class="lineno"> 2180</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02181" name="l02181"></a><span class="lineno"> 2181</span>    }</div>
<div class="line"><a id="l02182" name="l02182"></a><span class="lineno"> 2182</span>    StateIndex <span class="keywordtype">id</span> = <a class="code hl_function" href="classCompass.html#a5b6bd29bfc993d353ed2f8b03b387de4">_get_state_id</a>(Priority(i));</div>
<div class="line"><a id="l02183" name="l02183"></a><span class="lineno"> 2183</span>    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &gt;= <a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a> ||</div>
<div class="line"><a id="l02184" name="l02184"></a><span class="lineno"> 2184</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[<span class="keywordtype">id</span>].scale_factor &lt; <a class="code hl_define" href="AP__Compass__config_8h.html#a79413bd88a22d26029d31f371194ce83">COMPASS_MIN_SCALE_FACTOR</a> ||</div>
<div class="line"><a id="l02185" name="l02185"></a><span class="lineno"> 2185</span>        <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[<span class="keywordtype">id</span>].scale_factor &gt; <a class="code hl_define" href="AP__Compass__config_8h.html#a4df4025b44b9c02868f5ca0458a30500">COMPASS_MAX_SCALE_FACTOR</a>) {</div>
<div class="line"><a id="l02186" name="l02186"></a><span class="lineno"> 2186</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02187" name="l02187"></a><span class="lineno"> 2187</span>    }</div>
<div class="line"><a id="l02188" name="l02188"></a><span class="lineno"> 2188</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02189" name="l02189"></a><span class="lineno"> 2189</span>}</div>
</div>
<div class="line"><a id="l02190" name="l02190"></a><span class="lineno"> 2190</span> </div>
<div class="line"><a id="l02191" name="l02191"></a><span class="lineno"> 2191</span><span class="preprocessor">#if AP_COMPASS_MSP_ENABLED</span></div>
<div class="line"><a id="l02192" name="l02192"></a><span class="lineno"> 2192</span><span class="keywordtype">void</span> Compass::handle_msp(<span class="keyword">const</span> <a class="code hl_struct" href="structMSP_1_1PACKED.html">MSP::msp_compass_data_message_t</a> &amp;pkt)</div>
<div class="line"><a id="l02193" name="l02193"></a><span class="lineno"> 2193</span>{</div>
<div class="line"><a id="l02194" name="l02194"></a><span class="lineno"> 2194</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classCompass.html#a678ad037acc44e46598012b7ad17b2a6">_driver_enabled</a>(DRIVER_MSP)) {</div>
<div class="line"><a id="l02195" name="l02195"></a><span class="lineno"> 2195</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02196" name="l02196"></a><span class="lineno"> 2196</span>    }</div>
<div class="line"><a id="l02197" name="l02197"></a><span class="lineno"> 2197</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classCompass.html#a72dcc2b111d806635ebde2700e70a33c">init_done</a>) {</div>
<div class="line"><a id="l02198" name="l02198"></a><span class="lineno"> 2198</span>        <span class="keywordflow">if</span> (pkt.<a class="code hl_variable" href="structMSP_1_1PACKED.html#a863be8e04d31a445030fe6100f587589">instance</a> &lt; 8) {</div>
<div class="line"><a id="l02199" name="l02199"></a><span class="lineno"> 2199</span>            msp_instance_mask |= 1U&lt;&lt;pkt.<a class="code hl_variable" href="structMSP_1_1PACKED.html#a863be8e04d31a445030fe6100f587589">instance</a>;</div>
<div class="line"><a id="l02200" name="l02200"></a><span class="lineno"> 2200</span>        }</div>
<div class="line"><a id="l02201" name="l02201"></a><span class="lineno"> 2201</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l02202" name="l02202"></a><span class="lineno"> 2202</span>        <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code hl_variable" href="classCompass.html#ac3bf8f6ab108927b2ea704b3dcba1355">_backend_count</a>; i++) {</div>
<div class="line"><a id="l02203" name="l02203"></a><span class="lineno"> 2203</span>            <a class="code hl_variable" href="classCompass.html#af46d67cb8eb4bc4c51bb12be6813cfdd">_backends</a>[i]-&gt;handle_msp(pkt);</div>
<div class="line"><a id="l02204" name="l02204"></a><span class="lineno"> 2204</span>        }</div>
<div class="line"><a id="l02205" name="l02205"></a><span class="lineno"> 2205</span>    }</div>
<div class="line"><a id="l02206" name="l02206"></a><span class="lineno"> 2206</span>}</div>
<div class="line"><a id="l02207" name="l02207"></a><span class="lineno"> 2207</span><span class="preprocessor">#endif </span><span class="comment">// AP_COMPASS_MSP_ENABLED</span></div>
<div class="line"><a id="l02208" name="l02208"></a><span class="lineno"> 2208</span> </div>
<div class="line"><a id="l02209" name="l02209"></a><span class="lineno"> 2209</span><span class="preprocessor">#if AP_COMPASS_EXTERNALAHRS_ENABLED</span></div>
<div class="line"><a id="l02210" name="l02210"></a><span class="lineno"> 2210</span><span class="keywordtype">void</span> Compass::handle_external(<span class="keyword">const</span> AP_ExternalAHRS::mag_data_message_t &amp;pkt)</div>
<div class="line"><a id="l02211" name="l02211"></a><span class="lineno"> 2211</span>{</div>
<div class="line"><a id="l02212" name="l02212"></a><span class="lineno"> 2212</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classCompass.html#a678ad037acc44e46598012b7ad17b2a6">_driver_enabled</a>(DRIVER_EXTERNALAHRS)) {</div>
<div class="line"><a id="l02213" name="l02213"></a><span class="lineno"> 2213</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02214" name="l02214"></a><span class="lineno"> 2214</span>    }</div>
<div class="line"><a id="l02215" name="l02215"></a><span class="lineno"> 2215</span>    <span class="keywordflow">for</span> (uint8_t i=0; i&lt;<a class="code hl_variable" href="classCompass.html#ac3bf8f6ab108927b2ea704b3dcba1355">_backend_count</a>; i++) {</div>
<div class="line"><a id="l02216" name="l02216"></a><span class="lineno"> 2216</span>        <a class="code hl_variable" href="classCompass.html#af46d67cb8eb4bc4c51bb12be6813cfdd">_backends</a>[i]-&gt;handle_external(pkt);</div>
<div class="line"><a id="l02217" name="l02217"></a><span class="lineno"> 2217</span>    }</div>
<div class="line"><a id="l02218" name="l02218"></a><span class="lineno"> 2218</span>}</div>
<div class="line"><a id="l02219" name="l02219"></a><span class="lineno"> 2219</span><span class="preprocessor">#endif </span><span class="comment">// AP_COMPASS_EXTERNALAHRS_ENABLED</span></div>
<div class="line"><a id="l02220" name="l02220"></a><span class="lineno"> 2220</span> </div>
<div class="line"><a id="l02221" name="l02221"></a><span class="lineno"> 2221</span><span class="comment">// force save of current calibration as valid</span></div>
<div class="foldopen" id="foldopen02222" data-start="{" data-end="}">
<div class="line"><a id="l02222" name="l02222"></a><span class="lineno"><a class="line" href="classCompass.html#aea7f01834588d36bf856f378417bf7a7"> 2222</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classCompass.html#aea7f01834588d36bf856f378417bf7a7">Compass::force_save_calibration</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l02223" name="l02223"></a><span class="lineno"> 2223</span>{</div>
<div class="line"><a id="l02224" name="l02224"></a><span class="lineno"> 2224</span>    <span class="keywordflow">for</span> (StateIndex i(0); i&lt;<a class="code hl_define" href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a>; i++) {</div>
<div class="line"><a id="l02225" name="l02225"></a><span class="lineno"> 2225</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].dev_id != 0) {</div>
<div class="line"><a id="l02226" name="l02226"></a><span class="lineno"> 2226</span>            <a class="code hl_variable" href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">_state</a>[i].dev_id.save();</div>
<div class="line"><a id="l02227" name="l02227"></a><span class="lineno"> 2227</span>        }</div>
<div class="line"><a id="l02228" name="l02228"></a><span class="lineno"> 2228</span>    }</div>
<div class="line"><a id="l02229" name="l02229"></a><span class="lineno"> 2229</span>}</div>
</div>
<div class="line"><a id="l02230" name="l02230"></a><span class="lineno"> 2230</span> </div>
<div class="line"><a id="l02231" name="l02231"></a><span class="lineno"> 2231</span><span class="comment">// singleton instance</span></div>
<div class="line"><a id="l02232" name="l02232"></a><span class="lineno"> 2232</span><a class="code hl_class" href="classCompass.html">Compass</a> *<a class="code hl_variable" href="classCompass.html#aa3e1ccaef661d5ff5d2e51cd7742c6ba">Compass::_singleton</a>;</div>
<div class="line"><a id="l02233" name="l02233"></a><span class="lineno"> 2233</span> </div>
<div class="line"><a id="l02234" name="l02234"></a><span class="lineno"> 2234</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceAP.html">AP</a></div>
<div class="line"><a id="l02235" name="l02235"></a><span class="lineno"> 2235</span>{</div>
<div class="line"><a id="l02236" name="l02236"></a><span class="lineno"> 2236</span> </div>
<div class="foldopen" id="foldopen02237" data-start="{" data-end="}">
<div class="line"><a id="l02237" name="l02237"></a><span class="lineno"><a class="line" href="namespaceAP.html#ab9d0bcbec954b6c20abd8e13e6de7356"> 2237</a></span><a class="code hl_class" href="classCompass.html">Compass</a> &amp;<a class="code hl_variable" href="AP__Compass__test_8cpp.html#a58b8e143b1d5e3b2c1048c94ffa16ee2">compass</a>()</div>
<div class="line"><a id="l02238" name="l02238"></a><span class="lineno"> 2238</span>{</div>
<div class="line"><a id="l02239" name="l02239"></a><span class="lineno"> 2239</span>    <span class="keywordflow">return</span> *<a class="code hl_function" href="classCompass.html#aa478093c27cb5fc0e3652cd3cb98b2a5">Compass::get_singleton</a>();</div>
<div class="line"><a id="l02240" name="l02240"></a><span class="lineno"> 2240</span>}</div>
</div>
<div class="line"><a id="l02241" name="l02241"></a><span class="lineno"> 2241</span> </div>
<div class="line"><a id="l02242" name="l02242"></a><span class="lineno"> 2242</span>}</div>
<div class="line"><a id="l02243" name="l02243"></a><span class="lineno"> 2243</span> </div>
<div class="line"><a id="l02244" name="l02244"></a><span class="lineno"> 2244</span><span class="preprocessor">#endif  </span><span class="comment">// AP_COMPASS_ENABLED</span></div>
<div class="ttc" id="aAC__AttitudeControl_8cpp_html_a240c1a4ae2a70d1855f91e4a0b1ac938"><div class="ttname"><a href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__AK09916_8cpp_source.html#l00059">AP_Compass_AK09916.cpp:59</a></div></div>
<div class="ttc" id="aAP__Airspeed_8cpp_html_a1d1ca2e01f4d02fdb3e3e66c46739c02"><div class="ttname"><a href="AP__Airspeed_8cpp.html#a1d1ca2e01f4d02fdb3e3e66c46739c02">GET_I2C_DEVICE</a></div><div class="ttdeci">#define GET_I2C_DEVICE(bus, address)</div><div class="ttdef"><b>Definition</b> <a href="AP__Airspeed_8cpp_source.html#l00213">AP_Airspeed.cpp:213</a></div></div>
<div class="ttc" id="aAP__Airspeed_8cpp_html_a839fcd37cc527c893f6d41ecfc80aeac"><div class="ttname"><a href="AP__Airspeed_8cpp.html#a839fcd37cc527c893f6d41ecfc80aeac">ADD_BACKEND</a></div><div class="ttdeci">#define ADD_BACKEND(backend)</div><div class="ttdef"><b>Definition</b> <a href="AP__Airspeed_8cpp_source.html#l00237">AP_Airspeed.cpp:237</a></div></div>
<div class="ttc" id="aAP__BoardConfig_8h_html"><div class="ttname"><a href="AP__BoardConfig_8h.html">AP_BoardConfig.h</a></div></div>
<div class="ttc" id="aAP__Common_8h_html_a121caf32c5b5d704ef3453f0885a9ea5"><div class="ttname"><a href="AP__Common_8h.html#a121caf32c5b5d704ef3453f0885a9ea5">ARRAY_SIZE</a></div><div class="ttdeci">#define ARRAY_SIZE(_arr)</div><div class="ttdef"><b>Definition</b> <a href="AP__Common_8h_source.html#l00099">AP_Common.h:99</a></div></div>
<div class="ttc" id="aAP__Compass_8cpp_html_a6db3df6d28073ae8f6bb62bd31c7ca54"><div class="ttname"><a href="AP__Compass_8cpp.html#a6db3df6d28073ae8f6bb62bd31c7ca54">AP_COMPASS_OFFSETS_MAX_DEFAULT</a></div><div class="ttdeci">#define AP_COMPASS_OFFSETS_MAX_DEFAULT</div><div class="ttdef"><b>Definition</b> <a href="#l00060">AP_Compass.cpp:60</a></div></div>
<div class="ttc" id="aAP__Compass_8cpp_html_abbd00be969534e4587e3479da3759384"><div class="ttname"><a href="AP__Compass_8cpp.html#abbd00be969534e4587e3479da3759384">COMPASS_LEARN_DEFAULT</a></div><div class="ttdeci">#define COMPASS_LEARN_DEFAULT</div><div class="ttdef"><b>Definition</b> <a href="#l00056">AP_Compass.cpp:56</a></div></div>
<div class="ttc" id="aAP__Compass_8cpp_html_abd241224760f1a380278880c2908a112"><div class="ttname"><a href="AP__Compass_8cpp.html#abd241224760f1a380278880c2908a112">HAL_COMPASS_AUTO_ROT_DEFAULT</a></div><div class="ttdeci">#define HAL_COMPASS_AUTO_ROT_DEFAULT</div><div class="ttdef"><b>Definition</b> <a href="#l00068">AP_Compass.cpp:68</a></div></div>
<div class="ttc" id="aAP__Compass_8cpp_html_aced1819bbf63ee14663aa60cca76fa80"><div class="ttname"><a href="AP__Compass_8cpp.html#aced1819bbf63ee14663aa60cca76fa80">HAL_COMPASS_FILTER_DEFAULT</a></div><div class="ttdeci">#define HAL_COMPASS_FILTER_DEFAULT</div><div class="ttdef"><b>Definition</b> <a href="#l00064">AP_Compass.cpp:64</a></div></div>
<div class="ttc" id="aAP__Compass_8cpp_html_ad644760d1cab90de3f8ad72b11a7c2a7"><div class="ttname"><a href="AP__Compass_8cpp.html#ad644760d1cab90de3f8ad72b11a7c2a7">CHECK_UNREG_LIMIT_RETURN</a></div><div class="ttdeci">#define CHECK_UNREG_LIMIT_RETURN</div><div class="ttdef"><b>Definition</b> <a href="#l01076">AP_Compass.cpp:1076</a></div></div>
<div class="ttc" id="aAP__Compass_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="AP__Compass_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition</b> <a href="AC__PID__test_8cpp_source.html#l00021">AC_PID_test.cpp:21</a></div></div>
<div class="ttc" id="aAP__Compass_8cpp_html_aee5d048c798959cb31261517f64bdfbb"><div class="ttname"><a href="AP__Compass_8cpp.html#aee5d048c798959cb31261517f64bdfbb">AP_COMPASS_ENABLE_DEFAULT</a></div><div class="ttdeci">#define AP_COMPASS_ENABLE_DEFAULT</div><div class="ttdef"><b>Definition</b> <a href="#l00052">AP_Compass.cpp:52</a></div></div>
<div class="ttc" id="aAP__Compass_8h_html"><div class="ttname"><a href="AP__Compass_8h.html">AP_Compass.h</a></div></div>
<div class="ttc" id="aAP__Compass_8h_html_a062f390a5503097ca313e53f277d1f64"><div class="ttname"><a href="AP__Compass_8h.html#a062f390a5503097ca313e53f277d1f64">AP_COMPASS_MAX_XY_LENGTH_DIFF</a></div><div class="ttdeci">#define AP_COMPASS_MAX_XY_LENGTH_DIFF</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00049">AP_Compass.h:49</a></div></div>
<div class="ttc" id="aAP__Compass_8h_html_a0a6a0f28d3465747ea15e7d9091994de"><div class="ttname"><a href="AP__Compass_8h.html#a0a6a0f28d3465747ea15e7d9091994de">COMPASS_MAX_INSTANCES</a></div><div class="ttdeci">#define COMPASS_MAX_INSTANCES</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00071">AP_Compass.h:71</a></div></div>
<div class="ttc" id="aAP__Compass_8h_html_a55cc3f7c59fe257f8926d02f8462aa20"><div class="ttname"><a href="AP__Compass_8h.html#a55cc3f7c59fe257f8926d02f8462aa20">AP_COMPASS_MAX_XYZ_ANG_DIFF</a></div><div class="ttdeci">#define AP_COMPASS_MAX_XYZ_ANG_DIFF</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00047">AP_Compass.h:47</a></div></div>
<div class="ttc" id="aAP__Compass_8h_html_a5ae256887a80a65f39d06f1cb2cbfacb"><div class="ttname"><a href="AP__Compass_8h.html#a5ae256887a80a65f39d06f1cb2cbfacb">COMPASS_MAX_BACKEND</a></div><div class="ttdeci">#define COMPASS_MAX_BACKEND</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00072">AP_Compass.h:72</a></div></div>
<div class="ttc" id="aAP__Compass_8h_html_a8bc3b9dad383e949bb7a78683f027132"><div class="ttname"><a href="AP__Compass_8h.html#a8bc3b9dad383e949bb7a78683f027132">AP_COMPASS_MAX_XY_ANG_DIFF</a></div><div class="ttdeci">#define AP_COMPASS_MAX_XY_ANG_DIFF</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00048">AP_Compass.h:48</a></div></div>
<div class="ttc" id="aAP__Compass_8h_html_aa22be79a45fb28cb3160eacdf5ad4432"><div class="ttname"><a href="AP__Compass_8h.html#aa22be79a45fb28cb3160eacdf5ad4432">AP_COMPASS_MOT_COMP_CURRENT</a></div><div class="ttdeci">#define AP_COMPASS_MOT_COMP_CURRENT</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00023">AP_Compass.h:23</a></div></div>
<div class="ttc" id="aAP__Compass_8h_html_ac01ecc2c9da354c12911bb0ecfa5b7e6"><div class="ttname"><a href="AP__Compass_8h.html#ac01ecc2c9da354c12911bb0ecfa5b7e6">COMPASS_MAX_UNREG_DEV</a></div><div class="ttdeci">#define COMPASS_MAX_UNREG_DEV</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00060">AP_Compass.h:60</a></div></div>
<div class="ttc" id="aAP__Compass_8h_html_aea476312c9a32f19ab3a0d62f4027869"><div class="ttname"><a href="AP__Compass_8h.html#aea476312c9a32f19ab3a0d62f4027869">AP_COMPASS_MOT_COMP_DISABLED</a></div><div class="ttdeci">#define AP_COMPASS_MOT_COMP_DISABLED</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00021">AP_Compass.h:21</a></div></div>
<div class="ttc" id="aAP__Compass_8h_html_af4b14d20a1ad32e0d381181e1d92a7ca"><div class="ttname"><a href="AP__Compass_8h.html#af4b14d20a1ad32e0d381181e1d92a7ca">AP_COMPASS_CALIBRATION_FITNESS_DEFAULT</a></div><div class="ttdeci">#define AP_COMPASS_CALIBRATION_FITNESS_DEFAULT</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00046">AP_Compass.h:46</a></div></div>
<div class="ttc" id="aAP__Compass__AK09916_8h_html"><div class="ttname"><a href="AP__Compass__AK09916_8h.html">AP_Compass_AK09916.h</a></div></div>
<div class="ttc" id="aAP__Compass__AK09916_8h_html_a386455d25827367b386dc62db68c772a"><div class="ttname"><a href="AP__Compass__AK09916_8h.html#a386455d25827367b386dc62db68c772a">HAL_COMPASS_ICM20948_I2C_ADDR2</a></div><div class="ttdeci">#define HAL_COMPASS_ICM20948_I2C_ADDR2</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__AK09916_8h_source.html#l00039">AP_Compass_AK09916.h:39</a></div></div>
<div class="ttc" id="aAP__Compass__AK09916_8h_html_a6848bf4867620c224db61628e399feec"><div class="ttname"><a href="AP__Compass__AK09916_8h.html#a6848bf4867620c224db61628e399feec">HAL_COMPASS_AK09916_I2C_ADDR</a></div><div class="ttdeci">#define HAL_COMPASS_AK09916_I2C_ADDR</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__AK09916_8h_source.html#l00030">AP_Compass_AK09916.h:30</a></div></div>
<div class="ttc" id="aAP__Compass__AK09916_8h_html_abfe14523e6aac1631ce4430716b927db"><div class="ttname"><a href="AP__Compass__AK09916_8h.html#abfe14523e6aac1631ce4430716b927db">HAL_COMPASS_ICM20948_I2C_ADDR</a></div><div class="ttdeci">#define HAL_COMPASS_ICM20948_I2C_ADDR</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__AK09916_8h_source.html#l00035">AP_Compass_AK09916.h:35</a></div></div>
<div class="ttc" id="aAP__Compass__AK8963_8h_html"><div class="ttname"><a href="AP__Compass__AK8963_8h.html">AP_Compass_AK8963.h</a></div></div>
<div class="ttc" id="aAP__Compass__BMM150_8h_html"><div class="ttname"><a href="AP__Compass__BMM150_8h.html">AP_Compass_BMM150.h</a></div></div>
<div class="ttc" id="aAP__Compass__BMM150_8h_html_a55e65fcfc75d2234201d5d7beccab96f"><div class="ttname"><a href="AP__Compass__BMM150_8h.html#a55e65fcfc75d2234201d5d7beccab96f">BMM150_I2C_ADDR_MIN</a></div><div class="ttdeci">#define BMM150_I2C_ADDR_MIN</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__BMM150_8h_source.html#l00031">AP_Compass_BMM150.h:31</a></div></div>
<div class="ttc" id="aAP__Compass__BMM150_8h_html_a5aec83ecfcba3cd9d9f869edf9c8614d"><div class="ttname"><a href="AP__Compass__BMM150_8h.html#a5aec83ecfcba3cd9d9f869edf9c8614d">BMM150_I2C_ADDR_MAX</a></div><div class="ttdeci">#define BMM150_I2C_ADDR_MAX</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__BMM150_8h_source.html#l00032">AP_Compass_BMM150.h:32</a></div></div>
<div class="ttc" id="aAP__Compass__Backend_8h_html"><div class="ttname"><a href="AP__Compass__Backend_8h.html">AP_Compass_Backend.h</a></div></div>
<div class="ttc" id="aAP__Compass__DroneCAN_8h_html"><div class="ttname"><a href="AP__Compass__DroneCAN_8h.html">AP_Compass_DroneCAN.h</a></div></div>
<div class="ttc" id="aAP__Compass__ExternalAHRS_8h_html"><div class="ttname"><a href="AP__Compass__ExternalAHRS_8h.html">AP_Compass_ExternalAHRS.h</a></div></div>
<div class="ttc" id="aAP__Compass__HMC5843_8h_html"><div class="ttname"><a href="AP__Compass__HMC5843_8h.html">AP_Compass_HMC5843.h</a></div></div>
<div class="ttc" id="aAP__Compass__HMC5843_8h_html_a51869742d3196f59f9e5e323f9d6c11b"><div class="ttname"><a href="AP__Compass__HMC5843_8h.html#a51869742d3196f59f9e5e323f9d6c11b">HAL_COMPASS_HMC5843_I2C_ADDR</a></div><div class="ttdeci">#define HAL_COMPASS_HMC5843_I2C_ADDR</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__HMC5843_8h_source.html#l00008">AP_Compass_HMC5843.h:8</a></div></div>
<div class="ttc" id="aAP__Compass__IST8308_8h_html"><div class="ttname"><a href="AP__Compass__IST8308_8h.html">AP_Compass_IST8308.h</a></div></div>
<div class="ttc" id="aAP__Compass__IST8308_8h_html_a3ceac9a4a67efd3aa707dce7a6d55281"><div class="ttname"><a href="AP__Compass__IST8308_8h.html#a3ceac9a4a67efd3aa707dce7a6d55281">HAL_COMPASS_IST8308_I2C_ADDR</a></div><div class="ttdeci">#define HAL_COMPASS_IST8308_I2C_ADDR</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__IST8308_8h_source.html#l00030">AP_Compass_IST8308.h:30</a></div></div>
<div class="ttc" id="aAP__Compass__IST8310_8h_html"><div class="ttname"><a href="AP__Compass__IST8310_8h.html">AP_Compass_IST8310.h</a></div></div>
<div class="ttc" id="aAP__Compass__IST8310_8h_html_a008c10b66a4077acc3a610c41291773b"><div class="ttname"><a href="AP__Compass__IST8310_8h.html#a008c10b66a4077acc3a610c41291773b">HAL_COMPASS_IST8310_I2C_ADDR</a></div><div class="ttdeci">#define HAL_COMPASS_IST8310_I2C_ADDR</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__IST8310_8h_source.html#l00031">AP_Compass_IST8310.h:31</a></div></div>
<div class="ttc" id="aAP__Compass__IST8310_8h_html_a4452854bc90a4defb2f8be8c205b02db"><div class="ttname"><a href="AP__Compass__IST8310_8h.html#a4452854bc90a4defb2f8be8c205b02db">AP_COMPASS_IST8310_DEFAULT_ROTATION</a></div><div class="ttdeci">#define AP_COMPASS_IST8310_DEFAULT_ROTATION</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__IST8310_8h_source.html#l00035">AP_Compass_IST8310.h:35</a></div></div>
<div class="ttc" id="aAP__Compass__LIS3MDL_8h_html"><div class="ttname"><a href="AP__Compass__LIS3MDL_8h.html">AP_Compass_LIS3MDL.h</a></div></div>
<div class="ttc" id="aAP__Compass__LIS3MDL_8h_html_a094c5397594967479d9a2af852999e9a"><div class="ttname"><a href="AP__Compass__LIS3MDL_8h.html#a094c5397594967479d9a2af852999e9a">HAL_COMPASS_LIS3MDL_I2C_ADDR2</a></div><div class="ttdeci">#define HAL_COMPASS_LIS3MDL_I2C_ADDR2</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__LIS3MDL_8h_source.html#l00034">AP_Compass_LIS3MDL.h:34</a></div></div>
<div class="ttc" id="aAP__Compass__LIS3MDL_8h_html_ac10cbbe8e0464aff5b30a33809111cef"><div class="ttname"><a href="AP__Compass__LIS3MDL_8h.html#ac10cbbe8e0464aff5b30a33809111cef">HAL_COMPASS_LIS3MDL_I2C_ADDR</a></div><div class="ttdeci">#define HAL_COMPASS_LIS3MDL_I2C_ADDR</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__LIS3MDL_8h_source.html#l00030">AP_Compass_LIS3MDL.h:30</a></div></div>
<div class="ttc" id="aAP__Compass__LSM303D_8h_html"><div class="ttname"><a href="AP__Compass__LSM303D_8h.html">AP_Compass_LSM303D.h</a></div></div>
<div class="ttc" id="aAP__Compass__LSM9DS1_8h_html"><div class="ttname"><a href="AP__Compass__LSM9DS1_8h.html">AP_Compass_LSM9DS1.h</a></div></div>
<div class="ttc" id="aAP__Compass__MAG3110_8h_html"><div class="ttname"><a href="AP__Compass__MAG3110_8h.html">AP_Compass_MAG3110.h</a></div></div>
<div class="ttc" id="aAP__Compass__MMC3416_8h_html"><div class="ttname"><a href="AP__Compass__MMC3416_8h.html">AP_Compass_MMC3416.h</a></div></div>
<div class="ttc" id="aAP__Compass__MMC3416_8h_html_ad5d0ccbdb55e9d937b5dd3e76b08a30c"><div class="ttname"><a href="AP__Compass__MMC3416_8h.html#ad5d0ccbdb55e9d937b5dd3e76b08a30c">HAL_COMPASS_MMC3416_I2C_ADDR</a></div><div class="ttdeci">#define HAL_COMPASS_MMC3416_I2C_ADDR</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__MMC3416_8h_source.html#l00030">AP_Compass_MMC3416.h:30</a></div></div>
<div class="ttc" id="aAP__Compass__MMC5xx3_8h_html"><div class="ttname"><a href="AP__Compass__MMC5xx3_8h.html">AP_Compass_MMC5xx3.h</a></div></div>
<div class="ttc" id="aAP__Compass__MSP_8h_html"><div class="ttname"><a href="AP__Compass__MSP_8h.html">AP_Compass_MSP.h</a></div></div>
<div class="ttc" id="aAP__Compass__QMC5883L_8h_html"><div class="ttname"><a href="AP__Compass__QMC5883L_8h.html">AP_Compass_QMC5883L.h</a></div></div>
<div class="ttc" id="aAP__Compass__QMC5883L_8h_html_a3f1e879cd41b64877257c513fbf11467"><div class="ttname"><a href="AP__Compass__QMC5883L_8h.html#a3f1e879cd41b64877257c513fbf11467">HAL_COMPASS_QMC5883L_I2C_ADDR</a></div><div class="ttdeci">#define HAL_COMPASS_QMC5883L_I2C_ADDR</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__QMC5883L_8h_source.html#l00032">AP_Compass_QMC5883L.h:32</a></div></div>
<div class="ttc" id="aAP__Compass__QMC5883L_8h_html_a53ec2f60b031c276dc75bb835a27ba5a"><div class="ttname"><a href="AP__Compass__QMC5883L_8h.html#a53ec2f60b031c276dc75bb835a27ba5a">HAL_COMPASS_QMC5883L_ORIENTATION_EXTERNAL</a></div><div class="ttdeci">#define HAL_COMPASS_QMC5883L_ORIENTATION_EXTERNAL</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__QMC5883L_8h_source.html#l00039">AP_Compass_QMC5883L.h:39</a></div></div>
<div class="ttc" id="aAP__Compass__QMC5883L_8h_html_a620cedda01ad03d53443edb4a0131d88"><div class="ttname"><a href="AP__Compass__QMC5883L_8h.html#a620cedda01ad03d53443edb4a0131d88">HAL_COMPASS_QMC5883L_ORIENTATION_INTERNAL</a></div><div class="ttdeci">#define HAL_COMPASS_QMC5883L_ORIENTATION_INTERNAL</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__QMC5883L_8h_source.html#l00043">AP_Compass_QMC5883L.h:43</a></div></div>
<div class="ttc" id="aAP__Compass__QMC5883P_8h_html"><div class="ttname"><a href="AP__Compass__QMC5883P_8h.html">AP_Compass_QMC5883P.h</a></div></div>
<div class="ttc" id="aAP__Compass__QMC5883P_8h_html_a077ad934e55886ac292928650bba27e9"><div class="ttname"><a href="AP__Compass__QMC5883P_8h.html#a077ad934e55886ac292928650bba27e9">HAL_COMPASS_QMC5883P_ORIENTATION_INTERNAL</a></div><div class="ttdeci">#define HAL_COMPASS_QMC5883P_ORIENTATION_INTERNAL</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__QMC5883P_8h_source.html#l00042">AP_Compass_QMC5883P.h:42</a></div></div>
<div class="ttc" id="aAP__Compass__QMC5883P_8h_html_a22916e51e76a7db0c07365d0a73ecf2b"><div class="ttname"><a href="AP__Compass__QMC5883P_8h.html#a22916e51e76a7db0c07365d0a73ecf2b">HAL_COMPASS_QMC5883P_I2C_ADDR</a></div><div class="ttdeci">#define HAL_COMPASS_QMC5883P_I2C_ADDR</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__QMC5883P_8h_source.html#l00031">AP_Compass_QMC5883P.h:31</a></div></div>
<div class="ttc" id="aAP__Compass__QMC5883P_8h_html_a4a40c58b0e747eeb4d29f2e719054ce4"><div class="ttname"><a href="AP__Compass__QMC5883P_8h.html#a4a40c58b0e747eeb4d29f2e719054ce4">HAL_COMPASS_QMC5883P_ORIENTATION_EXTERNAL</a></div><div class="ttdeci">#define HAL_COMPASS_QMC5883P_ORIENTATION_EXTERNAL</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__QMC5883P_8h_source.html#l00038">AP_Compass_QMC5883P.h:38</a></div></div>
<div class="ttc" id="aAP__Compass__RM3100_8h_html"><div class="ttname"><a href="AP__Compass__RM3100_8h.html">AP_Compass_RM3100.h</a></div></div>
<div class="ttc" id="aAP__Compass__RM3100_8h_html_a186d62a551025147dcc1cf86a65d0b9f"><div class="ttname"><a href="AP__Compass__RM3100_8h.html#a186d62a551025147dcc1cf86a65d0b9f">HAL_COMPASS_RM3100_I2C_ADDR2</a></div><div class="ttdeci">#define HAL_COMPASS_RM3100_I2C_ADDR2</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__RM3100_8h_source.html#l00031">AP_Compass_RM3100.h:31</a></div></div>
<div class="ttc" id="aAP__Compass__RM3100_8h_html_a2eb7b355c85809717aea927690022a20"><div class="ttname"><a href="AP__Compass__RM3100_8h.html#a2eb7b355c85809717aea927690022a20">HAL_COMPASS_RM3100_I2C_ADDR4</a></div><div class="ttdeci">#define HAL_COMPASS_RM3100_I2C_ADDR4</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__RM3100_8h_source.html#l00033">AP_Compass_RM3100.h:33</a></div></div>
<div class="ttc" id="aAP__Compass__RM3100_8h_html_a8b9229141dbaf6d2ca85bfd7b5ca245b"><div class="ttname"><a href="AP__Compass__RM3100_8h.html#a8b9229141dbaf6d2ca85bfd7b5ca245b">HAL_COMPASS_RM3100_I2C_ADDR1</a></div><div class="ttdeci">#define HAL_COMPASS_RM3100_I2C_ADDR1</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__RM3100_8h_source.html#l00030">AP_Compass_RM3100.h:30</a></div></div>
<div class="ttc" id="aAP__Compass__RM3100_8h_html_ac57fee850eb20c3991552df3a7b13c39"><div class="ttname"><a href="AP__Compass__RM3100_8h.html#ac57fee850eb20c3991552df3a7b13c39">HAL_COMPASS_RM3100_I2C_ADDR3</a></div><div class="ttdeci">#define HAL_COMPASS_RM3100_I2C_ADDR3</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__RM3100_8h_source.html#l00032">AP_Compass_RM3100.h:32</a></div></div>
<div class="ttc" id="aAP__Compass__SITL_8h_html"><div class="ttname"><a href="AP__Compass__SITL_8h.html">AP_Compass_SITL.h</a></div></div>
<div class="ttc" id="aAP__Compass__config_8h_html"><div class="ttname"><a href="AP__Compass__config_8h.html">AP_Compass_config.h</a></div></div>
<div class="ttc" id="aAP__Compass__config_8h_html_a4df4025b44b9c02868f5ca0458a30500"><div class="ttname"><a href="AP__Compass__config_8h.html#a4df4025b44b9c02868f5ca0458a30500">COMPASS_MAX_SCALE_FACTOR</a></div><div class="ttdeci">#define COMPASS_MAX_SCALE_FACTOR</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__config_8h_source.html#l00025">AP_Compass_config.h:25</a></div></div>
<div class="ttc" id="aAP__Compass__config_8h_html_a79413bd88a22d26029d31f371194ce83"><div class="ttname"><a href="AP__Compass__config_8h.html#a79413bd88a22d26029d31f371194ce83">COMPASS_MIN_SCALE_FACTOR</a></div><div class="ttdeci">#define COMPASS_MIN_SCALE_FACTOR</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__config_8h_source.html#l00026">AP_Compass_config.h:26</a></div></div>
<div class="ttc" id="aAP__Compass__test_8cpp_html_a58b8e143b1d5e3b2c1048c94ffa16ee2"><div class="ttname"><a href="AP__Compass__test_8cpp.html#a58b8e143b1d5e3b2c1048c94ffa16ee2">compass</a></div><div class="ttdeci">static Compass compass</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__test_8cpp_source.html#l00044">AP_Compass_test.cpp:44</a></div></div>
<div class="ttc" id="aAP__CustomRotations_8h_html"><div class="ttname"><a href="AP__CustomRotations_8h.html">AP_CustomRotations.h</a></div></div>
<div class="ttc" id="aAP__ExternalAHRS_8h_html"><div class="ttname"><a href="AP__ExternalAHRS_8h.html">AP_ExternalAHRS.h</a></div></div>
<div class="ttc" id="aAP__HAL_2I2CDevice_8h_html_a09f11b4bf995e11cb0b54264fa1b831c"><div class="ttname"><a href="AP__HAL_2I2CDevice_8h.html#a09f11b4bf995e11cb0b54264fa1b831c">FOREACH_I2C_EXTERNAL</a></div><div class="ttdeci">#define FOREACH_I2C_EXTERNAL(i)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2I2CDevice_8h_source.html#l00113">I2CDevice.h:113</a></div></div>
<div class="ttc" id="aAP__HAL_2I2CDevice_8h_html_ad421e4346d33acf4c95a34a807dc531b"><div class="ttname"><a href="AP__HAL_2I2CDevice_8h.html#ad421e4346d33acf4c95a34a807dc531b">FOREACH_I2C_INTERNAL</a></div><div class="ttdeci">#define FOREACH_I2C_INTERNAL(i)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2I2CDevice_8h_source.html#l00114">I2CDevice.h:114</a></div></div>
<div class="ttc" id="aAP__HAL_8h_html"><div class="ttname"><a href="AP__HAL_8h.html">AP_HAL.h</a></div></div>
<div class="ttc" id="aAP__HAL__Linux_2I2CDevice_8h_html"><div class="ttname"><a href="AP__HAL__Linux_2I2CDevice_8h.html">I2CDevice.h</a></div></div>
<div class="ttc" id="aAP__InternalError_8cpp_html_a02ad7a50d04e0dbf28c6c90a183a0579"><div class="ttname"><a href="AP__InternalError_8cpp.html#a02ad7a50d04e0dbf28c6c90a183a0579">instance</a></div><div class="ttdeci">static AP_InternalError instance</div><div class="ttdef"><b>Definition</b> <a href="AP__InternalError_8cpp_source.html#l00015">AP_InternalError.cpp:15</a></div></div>
<div class="ttc" id="aAP__JSON_8cpp_html_a37700c57263ada4716d7dbbc43089a24"><div class="ttname"><a href="AP__JSON_8cpp.html#a37700c57263ada4716d7dbbc43089a24">value</a></div><div class="ttdeci">AP_JSON::value value</div><div class="ttdef"><b>Definition</b> <a href="AP__JSON_8cpp_source.html#l00110">AP_JSON.cpp:110</a></div></div>
<div class="ttc" id="aAP__Logger_8h_html"><div class="ttname"><a href="AP__Logger_8h.html">AP_Logger.h</a></div></div>
<div class="ttc" id="aAP__Logger_8h_html_a88b4cdb83aeee0d38a55b8194381057fab513c44a4d8c00922c7155d8a90dfde5"><div class="ttname"><a href="AP__Logger_8h.html#a88b4cdb83aeee0d38a55b8194381057fab513c44a4d8c00922c7155d8a90dfde5">LogErrorSubsystem::COMPASS</a></div><div class="ttdeci">@ COMPASS</div></div>
<div class="ttc" id="aAP__Logger_8h_html_a90bd604ad2616a0bd3da3a8c055d33c9"><div class="ttname"><a href="AP__Logger_8h.html#a90bd604ad2616a0bd3da3a8c055d33c9">LogErrorCode</a></div><div class="ttdeci">LogErrorCode</div><div class="ttdef"><b>Definition</b> <a href="AP__Logger_8h_source.html#l00141">AP_Logger.h:141</a></div></div>
<div class="ttc" id="aAP__Logger_8h_html_a90bd604ad2616a0bd3da3a8c055d33c9a7438a7e4e4f36f04fda32fa100121e47"><div class="ttname"><a href="AP__Logger_8h.html#a90bd604ad2616a0bd3da3a8c055d33c9a7438a7e4e4f36f04fda32fa100121e47">LogErrorCode::UNHEALTHY</a></div><div class="ttdeci">@ UNHEALTHY</div></div>
<div class="ttc" id="aAP__Logger_8h_html_a90bd604ad2616a0bd3da3a8c055d33c9a7ae9e07d0c1fad47a312c844704c5abc"><div class="ttname"><a href="AP__Logger_8h.html#a90bd604ad2616a0bd3da3a8c055d33c9a7ae9e07d0c1fad47a312c844704c5abc">LogErrorCode::ERROR_RESOLVED</a></div><div class="ttdeci">@ ERROR_RESOLVED</div></div>
<div class="ttc" id="aAP__Math_8cpp_html_ae77517d032abb1e1b525d2b43ff9a27d"><div class="ttname"><a href="AP__Math_8cpp.html#ae77517d032abb1e1b525d2b43ff9a27d">wrap_PI</a></div><div class="ttdeci">ftype wrap_PI(const ftype radian)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8cpp_source.html#l00248">AP_Math.cpp:248</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a2a12cce483e9b870da70d30406d82c60"><div class="ttname"><a href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a></div><div class="ttdeci">bool is_zero(const T fVal1)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00053">AP_Math.h:53</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a49ad7fa2fa2e3d8aa75e8e0ec3f83b99"><div class="ttname"><a href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a></div><div class="ttdeci">static constexpr ftype radians(ftype deg)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00213">AP_Math.h:213</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a5256308fd38a7098b8f95607aa56888f"><div class="ttname"><a href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a></div><div class="ttdeci">#define constrain_float(amt, low, high)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00174">AP_Math.h:174</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00163">AP_Param.h:163</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a16c360358c5d6a08d34f60921fd916a9"><div class="ttname"><a href="AP__Param_8h.html#a16c360358c5d6a08d34f60921fd916a9">AP_SUBGROUPINFO</a></div><div class="ttdeci">#define AP_SUBGROUPINFO(element, name, idx, thisclazz, elclazz)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00152">AP_Param.h:152</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a78a408c84f2a1bafde256ac650142e4d"><div class="ttname"><a href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, clazz, element, def)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00145">AP_Param.h:145</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_ad9ca22a1e508dceea20feda89a344f9aa6b298bc938d9667ff3d25c0e8b94c349"><div class="ttname"><a href="AP__Param_8h.html#ad9ca22a1e508dceea20feda89a344f9aa6b298bc938d9667ff3d25c0e8b94c349">AP_PARAM_FLOAT</a></div><div class="ttdeci">@ AP_PARAM_FLOAT</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00183">AP_Param.h:183</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_ad9ca22a1e508dceea20feda89a344f9aae846a3e359a88214fe754f3862bc9347"><div class="ttname"><a href="AP__Param_8h.html#ad9ca22a1e508dceea20feda89a344f9aae846a3e359a88214fe754f3862bc9347">AP_PARAM_INT8</a></div><div class="ttdeci">@ AP_PARAM_INT8</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00180">AP_Param.h:180</a></div></div>
<div class="ttc" id="aAP__Scripting_2generator_2src_2main_8c_html_a8d04d02fe8bb190484bba202fee18f5c"><div class="ttname"><a href="AP__Scripting_2generator_2src_2main_8c.html#a8d04d02fe8bb190484bba202fee18f5c">state</a></div><div class="ttdeci">static struct generator_state state</div><div class="ttdef"><b>Definition</b> <a href="AP__Scripting_2generator_2src_2main_8c_source.html#l00087">main.c:87</a></div></div>
<div class="ttc" id="aAP__Vehicle__Type_8h_html"><div class="ttname"><a href="AP__Vehicle__Type_8h.html">AP_Vehicle_Type.h</a></div></div>
<div class="ttc" id="aCompass__learn_8h_html"><div class="ttname"><a href="Compass__learn_8h.html">Compass_learn.h</a></div></div>
<div class="ttc" id="aGCS_8h_html"><div class="ttname"><a href="GCS_8h.html">GCS.h</a></div><div class="ttdoc">Interface definition for the various Ground Control System.</div></div>
<div class="ttc" id="aGCS_8h_html_a266bfe8eda675e1092f045e93932b4a6"><div class="ttname"><a href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a></div><div class="ttdeci">#define GCS_SEND_TEXT(severity, format, args...)</div><div class="ttdef"><b>Definition</b> <a href="GCS_8h_source.html#l01349">GCS.h:1349</a></div></div>
<div class="ttc" id="aGCS_8h_html_ab53f292b698f9a6a3f029dfdbd5a43de"><div class="ttname"><a href="GCS_8h.html#ab53f292b698f9a6a3f029dfdbd5a43de">gcs</a></div><div class="ttdeci">GCS &amp; gcs()</div><div class="ttdef"><b>Definition</b> <a href="GCS__Common_8cpp_source.html#l06846">GCS_Common.cpp:6846</a></div></div>
<div class="ttc" id="aHAL_8h_html_a9d530d34abf7afeae6b7da9363551282"><div class="ttname"><a href="HAL_8h.html#a9d530d34abf7afeae6b7da9363551282">DEV_PRINTF</a></div><div class="ttdeci">#define DEV_PRINTF(fmt, args ...)</div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00156">HAL.h:156</a></div></div>
<div class="ttc" id="achibios_8h_html_a2c59d23ab6be2e59b18f06e2431e5dbb"><div class="ttname"><a href="chibios_8h.html#a2c59d23ab6be2e59b18f06e2431e5dbb">HAL_INS_LSM9DS0_A_NAME</a></div><div class="ttdeci">#define HAL_INS_LSM9DS0_A_NAME</div><div class="ttdef"><b>Definition</b> <a href="chibios_8h_source.html#l00082">chibios.h:82</a></div></div>
<div class="ttc" id="achibios_8h_html_a4a4d9b4dac87e452c5ee78083fbe7949"><div class="ttname"><a href="chibios_8h.html#a4a4d9b4dac87e452c5ee78083fbe7949">HAL_COMPASS_HMC5843_NAME</a></div><div class="ttdeci">#define HAL_COMPASS_HMC5843_NAME</div><div class="ttdef"><b>Definition</b> <a href="chibios_8h_source.html#l00096">chibios.h:96</a></div></div>
<div class="ttc" id="achibios_8h_html_ae30b37f1f4cd685cec0014ac3a5e00ad"><div class="ttname"><a href="chibios_8h.html#ae30b37f1f4cd685cec0014ac3a5e00ad">HAL_INS_LSM9DS0_EXT_A_NAME</a></div><div class="ttdeci">#define HAL_INS_LSM9DS0_EXT_A_NAME</div><div class="ttdef"><b>Definition</b> <a href="chibios_8h_source.html#l00085">chibios.h:85</a></div></div>
<div class="ttc" id="achibios_8h_html_af93f1bddafc9785287d1f3e638125dbc"><div class="ttname"><a href="chibios_8h.html#af93f1bddafc9785287d1f3e638125dbc">HAL_COMPASS_LIS3MDL_NAME</a></div><div class="ttdeci">#define HAL_COMPASS_LIS3MDL_NAME</div><div class="ttdef"><b>Definition</b> <a href="chibios_8h_source.html#l00097">chibios.h:97</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a7284d5e65c5863f5678b4d93000b116e"><div class="ttname"><a href="classAP__AHRS.html#a7284d5e65c5863f5678b4d93000b116e">AP_AHRS::update_orientation</a></div><div class="ttdeci">void update_orientation()</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8cpp_source.html#l00071">AP_AHRS_Backend.cpp:71</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a05ec778f42256d22fbdf58c458707b38"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a05ec778f42256d22fbdf58c458707b38">AP_BoardConfig::PX4_BOARD_PIXHAWK_PRO</a></div><div class="ttdeci">@ PX4_BOARD_PIXHAWK_PRO</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00054">AP_BoardConfig.h:54</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a122ab74c52fd603b79d0b2c0b5651ed5"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a122ab74c52fd603b79d0b2c0b5651ed5">AP_BoardConfig::VRX_BOARD_UBRAIN52</a></div><div class="ttdeci">@ VRX_BOARD_UBRAIN52</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00064">AP_BoardConfig.h:64</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a212c2ff8c6c4ada3668b927ac6728a87"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a212c2ff8c6c4ada3668b927ac6728a87">AP_BoardConfig::VRX_BOARD_BRAIN51</a></div><div class="ttdeci">@ VRX_BOARD_BRAIN51</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00060">AP_BoardConfig.h:60</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a2548b608826699e872a2de7f4e1ff877"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a2548b608826699e872a2de7f4e1ff877">AP_BoardConfig::PX4_BOARD_SP01</a></div><div class="ttdeci">@ PX4_BOARD_SP01</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00058">AP_BoardConfig.h:58</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a2f0a5b6527161d6a622728dfe8fd4023"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a2f0a5b6527161d6a622728dfe8fd4023">AP_BoardConfig::VRX_BOARD_CORE10</a></div><div class="ttdeci">@ VRX_BOARD_CORE10</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00065">AP_BoardConfig.h:65</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a3c5386db31b5c706894441bb6279eefc"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a3c5386db31b5c706894441bb6279eefc">AP_BoardConfig::VRX_BOARD_BRAIN54</a></div><div class="ttdeci">@ VRX_BOARD_BRAIN54</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00066">AP_BoardConfig.h:66</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a53e500f8c050e0ae471194b0fca121cb"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a53e500f8c050e0ae471194b0fca121cb">AP_BoardConfig::VRX_BOARD_UBRAIN51</a></div><div class="ttdeci">@ VRX_BOARD_UBRAIN51</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00063">AP_BoardConfig.h:63</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a6aaf12ce90b5b9586d350af949ab84a0"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a6aaf12ce90b5b9586d350af949ab84a0">AP_BoardConfig::PX4_BOARD_MINDPXV2</a></div><div class="ttdeci">@ PX4_BOARD_MINDPXV2</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00057">AP_BoardConfig.h:57</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a6f39405e261af307e647f079d8a6ec56"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a6f39405e261af307e647f079d8a6ec56">AP_BoardConfig::PX4_BOARD_FMUV5</a></div><div class="ttdeci">@ PX4_BOARD_FMUV5</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00059">AP_BoardConfig.h:59</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a78f917fc079eb5acb3e9623f0bbe0ff9"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a78f917fc079eb5acb3e9623f0bbe0ff9">AP_BoardConfig::PX4_BOARD_PH2SLIM</a></div><div class="ttdeci">@ PX4_BOARD_PH2SLIM</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00052">AP_BoardConfig.h:52</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a922eeb71ccd9862923f68246f86bb667"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a922eeb71ccd9862923f68246f86bb667">AP_BoardConfig::PX4_BOARD_AUAV21</a></div><div class="ttdeci">@ PX4_BOARD_AUAV21</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00055">AP_BoardConfig.h:55</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a939e3484a227aa39019088ac96a9cfd3"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a939e3484a227aa39019088ac96a9cfd3">AP_BoardConfig::VRX_BOARD_BRAIN52</a></div><div class="ttdeci">@ VRX_BOARD_BRAIN52</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00061">AP_BoardConfig.h:61</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983a97426996f59ed4a7534cfd7bb6a3174a"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983a97426996f59ed4a7534cfd7bb6a3174a">AP_BoardConfig::PX4_BOARD_AEROFC</a></div><div class="ttdeci">@ PX4_BOARD_AEROFC</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00053">AP_BoardConfig.h:53</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983aa4b366ff17e0c44076231ae8c51edd42"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983aa4b366ff17e0c44076231ae8c51edd42">AP_BoardConfig::PX4_BOARD_PHMINI</a></div><div class="ttdeci">@ PX4_BOARD_PHMINI</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00051">AP_BoardConfig.h:51</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983aa765b43df6cbdb15f9720f993d79ceb3"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983aa765b43df6cbdb15f9720f993d79ceb3">AP_BoardConfig::PX4_BOARD_PIXHAWK</a></div><div class="ttdeci">@ PX4_BOARD_PIXHAWK</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00048">AP_BoardConfig.h:48</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983ac37e0c90b91e19c9b6945baa8b05b278"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ac37e0c90b91e19c9b6945baa8b05b278">AP_BoardConfig::PX4_BOARD_PCNC1</a></div><div class="ttdeci">@ PX4_BOARD_PCNC1</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00056">AP_BoardConfig.h:56</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983acf567833f77e46ce320a961f68611bff"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983acf567833f77e46ce320a961f68611bff">AP_BoardConfig::PX4_BOARD_PX4V1</a></div><div class="ttdeci">@ PX4_BOARD_PX4V1</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00047">AP_BoardConfig.h:47</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983ad387380811280b3f995f8387ab50264e"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ad387380811280b3f995f8387ab50264e">AP_BoardConfig::PX4_BOARD_PIXHAWK2</a></div><div class="ttdeci">@ PX4_BOARD_PIXHAWK2</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00049">AP_BoardConfig.h:49</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983ae3bc20831e04c6038b9ad40680003eda"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983ae3bc20831e04c6038b9ad40680003eda">AP_BoardConfig::PX4_BOARD_FMUV6</a></div><div class="ttdeci">@ PX4_BOARD_FMUV6</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00067">AP_BoardConfig.h:67</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a5dc0661313a5b2f45f8428c6d1024983aedbfaade4bc5663cfd73a8652235bb30"><div class="ttname"><a href="classAP__BoardConfig.html#a5dc0661313a5b2f45f8428c6d1024983aedbfaade4bc5663cfd73a8652235bb30">AP_BoardConfig::VRX_BOARD_BRAIN52E</a></div><div class="ttdeci">@ VRX_BOARD_BRAIN52E</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00062">AP_BoardConfig.h:62</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a8a3185c191ab40fd95ceeadd8a5b0cf9"><div class="ttname"><a href="classAP__BoardConfig.html#a8a3185c191ab40fd95ceeadd8a5b0cf9">AP_BoardConfig::get_board_type</a></div><div class="ttdeci">static enum px4_board_type get_board_type(void)</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8h_source.html#l00078">AP_BoardConfig.h:78</a></div></div>
<div class="ttc" id="aclassAP__Compass__AK09916_html_a0b9b0bead6ea1cc7ab03df4e95f14820"><div class="ttname"><a href="classAP__Compass__AK09916.html#a0b9b0bead6ea1cc7ab03df4e95f14820">AP_Compass_AK09916::probe</a></div><div class="ttdeci">static AP_Compass_Backend * probe(AP_HAL::OwnPtr&lt; AP_HAL::I2CDevice &gt; dev, bool force_external, enum Rotation rotation)</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__AK09916_8cpp_source.html#l00075">AP_Compass_AK09916.cpp:75</a></div></div>
<div class="ttc" id="aclassAP__Compass__AK09916_html_acf28ed980c21a6fd6c15111a10e33cb3"><div class="ttname"><a href="classAP__Compass__AK09916.html#acf28ed980c21a6fd6c15111a10e33cb3">AP_Compass_AK09916::probe_ICM20948</a></div><div class="ttdeci">static AP_Compass_Backend * probe_ICM20948(AP_HAL::OwnPtr&lt; AP_HAL::I2CDevice &gt; dev, AP_HAL::OwnPtr&lt; AP_HAL::I2CDevice &gt; dev_icm, bool force_external, enum Rotation rotation)</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__AK09916_8cpp_source.html#l00097">AP_Compass_AK09916.cpp:97</a></div></div>
<div class="ttc" id="aclassAP__Compass__AK8963_html_af51ed96aa80a37fc89cd7856bf588b5c"><div class="ttname"><a href="classAP__Compass__AK8963.html#af51ed96aa80a37fc89cd7856bf588b5c">AP_Compass_AK8963::probe_mpu9250</a></div><div class="ttdeci">static AP_Compass_Backend * probe_mpu9250(AP_HAL::OwnPtr&lt; AP_HAL::I2CDevice &gt; dev, enum Rotation rotation)</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__AK8963_8cpp_source.html#l00086">AP_Compass_AK8963.cpp:86</a></div></div>
<div class="ttc" id="aclassAP__Compass__BMM150_html_a4b88fda01e1d04414a1c11f1f63f8862"><div class="ttname"><a href="classAP__Compass__BMM150.html#a4b88fda01e1d04414a1c11f1f63f8862">AP_Compass_BMM150::probe</a></div><div class="ttdeci">static AP_Compass_Backend * probe(AP_HAL::OwnPtr&lt; AP_HAL::I2CDevice &gt; dev, bool force_external, enum Rotation rotation)</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__BMM150_8cpp_source.html#l00068">AP_Compass_BMM150.cpp:68</a></div></div>
<div class="ttc" id="aclassAP__Compass__Backend_html"><div class="ttname"><a href="classAP__Compass__Backend.html">AP_Compass_Backend</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__Backend_8h_source.html#l00035">AP_Compass_Backend.h:36</a></div></div>
<div class="ttc" id="aclassAP__Compass__Backend_html_a4ad0e616103be3703829b829ab590a53"><div class="ttname"><a href="classAP__Compass__Backend.html#a4ad0e616103be3703829b829ab590a53">AP_Compass_Backend::read</a></div><div class="ttdeci">virtual void read(void)=0</div></div>
<div class="ttc" id="aclassAP__Compass__HMC5843_html_a09a02590425dc0fd9470cfef5d820af6"><div class="ttname"><a href="classAP__Compass__HMC5843.html#a09a02590425dc0fd9470cfef5d820af6">AP_Compass_HMC5843::probe</a></div><div class="ttdeci">static AP_Compass_Backend * probe(AP_HAL::OwnPtr&lt; AP_HAL::Device &gt; dev, bool force_external, enum Rotation rotation)</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__HMC5843_8cpp_source.html#l00108">AP_Compass_HMC5843.cpp:108</a></div></div>
<div class="ttc" id="aclassAP__Compass__IST8308_html_a173673c5186c86ef17579f7e93528562"><div class="ttname"><a href="classAP__Compass__IST8308.html#a173673c5186c86ef17579f7e93528562">AP_Compass_IST8308::probe</a></div><div class="ttdeci">static AP_Compass_Backend * probe(AP_HAL::OwnPtr&lt; AP_HAL::I2CDevice &gt; dev, bool force_external, enum Rotation rotation)</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__IST8308_8cpp_source.html#l00084">AP_Compass_IST8308.cpp:84</a></div></div>
<div class="ttc" id="aclassAP__Compass__IST8310_html_a05a1edca31561bd2de4ca9b22dc18ce4"><div class="ttname"><a href="classAP__Compass__IST8310.html#a05a1edca31561bd2de4ca9b22dc18ce4">AP_Compass_IST8310::probe</a></div><div class="ttdeci">static AP_Compass_Backend * probe(AP_HAL::OwnPtr&lt; AP_HAL::I2CDevice &gt; dev, bool force_external, enum Rotation rotation)</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__IST8310_8cpp_source.html#l00081">AP_Compass_IST8310.cpp:81</a></div></div>
<div class="ttc" id="aclassAP__Compass__LIS3MDL_html_a4c2b4001b3b9f479be154c9127665328"><div class="ttname"><a href="classAP__Compass__LIS3MDL.html#a4c2b4001b3b9f479be154c9127665328">AP_Compass_LIS3MDL::probe</a></div><div class="ttdeci">static AP_Compass_Backend * probe(AP_HAL::OwnPtr&lt; AP_HAL::Device &gt; dev, bool force_external, enum Rotation rotation)</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__LIS3MDL_8cpp_source.html#l00053">AP_Compass_LIS3MDL.cpp:53</a></div></div>
<div class="ttc" id="aclassAP__Compass__LSM303D_html_a1326916718eb1f574158cecd6904cac5"><div class="ttname"><a href="classAP__Compass__LSM303D.html#a1326916718eb1f574158cecd6904cac5">AP_Compass_LSM303D::probe</a></div><div class="ttdeci">static AP_Compass_Backend * probe(AP_HAL::OwnPtr&lt; AP_HAL::Device &gt; dev, enum Rotation rotation)</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__LSM303D_8cpp_source.html#l00161">AP_Compass_LSM303D.cpp:161</a></div></div>
<div class="ttc" id="aclassAP__Compass__MMC3416_html_ae5c6a57de1262158fcd2d28ae3920122"><div class="ttname"><a href="classAP__Compass__MMC3416.html#ae5c6a57de1262158fcd2d28ae3920122">AP_Compass_MMC3416::probe</a></div><div class="ttdeci">static AP_Compass_Backend * probe(AP_HAL::OwnPtr&lt; AP_HAL::I2CDevice &gt; dev, bool force_external, enum Rotation rotation)</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__MMC3416_8cpp_source.html#l00046">AP_Compass_MMC3416.cpp:46</a></div></div>
<div class="ttc" id="aclassAP__Compass__QMC5883L_html_a7c1440740e30ff68a714061f0e5be310"><div class="ttname"><a href="classAP__Compass__QMC5883L.html#a7c1440740e30ff68a714061f0e5be310">AP_Compass_QMC5883L::probe</a></div><div class="ttdeci">static AP_Compass_Backend * probe(AP_HAL::OwnPtr&lt; AP_HAL::I2CDevice &gt; dev, bool force_external, enum Rotation rotation)</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__QMC5883L_8cpp_source.html#l00062">AP_Compass_QMC5883L.cpp:62</a></div></div>
<div class="ttc" id="aclassAP__Compass__QMC5883P_html_a630ee718676deb68bf47693ab8ef2196"><div class="ttname"><a href="classAP__Compass__QMC5883P.html#a630ee718676deb68bf47693ab8ef2196">AP_Compass_QMC5883P::probe</a></div><div class="ttdeci">static AP_Compass_Backend * probe(AP_HAL::OwnPtr&lt; AP_HAL::I2CDevice &gt; dev, bool force_external, enum Rotation rotation)</div></div>
<div class="ttc" id="aclassAP__Compass__RM3100_html_a3ff201ee861339587a3c2bd23f02aaca"><div class="ttname"><a href="classAP__Compass__RM3100.html#a3ff201ee861339587a3c2bd23f02aaca">AP_Compass_RM3100::probe</a></div><div class="ttdeci">static AP_Compass_Backend * probe(AP_HAL::OwnPtr&lt; AP_HAL::Device &gt; dev, bool force_external, enum Rotation rotation)</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__RM3100_8cpp_source.html#l00070">AP_Compass_RM3100.cpp:70</a></div></div>
<div class="ttc" id="aclassAP__CustomRotations_html_a55d430e886478ffd871f38686b216c5d"><div class="ttname"><a href="classAP__CustomRotations.html#a55d430e886478ffd871f38686b216c5d">AP_CustomRotations::convert</a></div><div class="ttdeci">void convert(Rotation r, float roll, float pitch, float yaw)</div><div class="ttdef"><b>Definition</b> <a href="AP__CustomRotations_8cpp_source.html#l00072">AP_CustomRotations.cpp:72</a></div></div>
<div class="ttc" id="aclassAP__Declination_html_ae3c4783226b79c64dc2c2be9180f9d6e"><div class="ttname"><a href="classAP__Declination.html#ae3c4783226b79c64dc2c2be9180f9d6e">AP_Declination::get_declination</a></div><div class="ttdeci">static float get_declination(float latitude_deg, float longitude_deg)</div><div class="ttdef"><b>Definition</b> <a href="AP__Declination_8cpp_source.html#l00122">AP_Declination.cpp:122</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Device_html_aa66dae71b7f46e115e94cc8302a83c1e"><div class="ttname"><a href="classAP__HAL_1_1Device.html#aa66dae71b7f46e115e94cc8302a83c1e">AP_HAL::Device::devid_get_bus_type</a></div><div class="ttdeci">static enum BusType devid_get_bus_type(uint32_t dev_id)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Device_8cpp_source.html#l00251">Device.cpp:251</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Device_html_abdd5c39f57e7022979565e92b6578ba1a3cba5573df48b0d7c5c9e7e307f09da9"><div class="ttname"><a href="classAP__HAL_1_1Device.html#abdd5c39f57e7022979565e92b6578ba1a3cba5573df48b0d7c5c9e7e307f09da9">AP_HAL::Device::BUS_TYPE_I2C</a></div><div class="ttdeci">@ BUS_TYPE_I2C</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Device_8h_source.html#l00031">Device.h:31</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Device_html_abdd5c39f57e7022979565e92b6578ba1a5f4d64573ea0feed48cd2d29691cd45c"><div class="ttname"><a href="classAP__HAL_1_1Device.html#abdd5c39f57e7022979565e92b6578ba1a5f4d64573ea0feed48cd2d29691cd45c">AP_HAL::Device::BUS_TYPE_UAVCAN</a></div><div class="ttdeci">@ BUS_TYPE_UAVCAN</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Device_8h_source.html#l00033">Device.h:33</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Device_html_ac6d1c8dc3010b5531b896f1c265fb232"><div class="ttname"><a href="classAP__HAL_1_1Device.html#ac6d1c8dc3010b5531b896f1c265fb232">AP_HAL::Device::change_bus_id</a></div><div class="ttdeci">static uint32_t change_bus_id(uint32_t old_id, uint8_t devtype)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Device_8cpp_source.html#l00234">Device.cpp:234</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Device_html_ad75f42859a61892f9de8273c514dd360"><div class="ttname"><a href="classAP__HAL_1_1Device.html#ad75f42859a61892f9de8273c514dd360">AP_HAL::Device::make_bus_id</a></div><div class="ttdeci">static uint32_t make_bus_id(enum BusType bus_type, uint8_t bus, uint8_t address, uint8_t devtype)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Device_8cpp_source.html#l00221">Device.cpp:221</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00021">HAL.h:21</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html_a9337a60383f4264fa96a20dbe43a4e2e"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">AP_HAL::HAL::util</a></div><div class="ttdeci">AP_HAL::Util * util</div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00131">HAL.h:131</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html_a94ab41309b1ff10b8b862b826e59c882"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">AP_HAL::HAL::scheduler</a></div><div class="ttdeci">AP_HAL::Scheduler * scheduler</div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00130">HAL.h:130</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html_af8c602bce948527aa20ec7a32562010d"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#af8c602bce948527aa20ec7a32562010d">AP_HAL::HAL::spi</a></div><div class="ttdeci">AP_HAL::SPIDeviceManager * spi</div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00122">HAL.h:122</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1SPIDeviceManager_html_af75a266dd7de8f0ee072dd667461d2ab"><div class="ttname"><a href="classAP__HAL_1_1SPIDeviceManager.html#af75a266dd7de8f0ee072dd667461d2ab">AP_HAL::SPIDeviceManager::get_device</a></div><div class="ttdeci">virtual OwnPtr&lt; SPIDevice &gt; get_device(const char *name)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2SPIDevice_8h_source.html#l00071">SPIDevice.h:71</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Scheduler_html_ab3175e2e6223ccfe82f957e41cc12b26"><div class="ttname"><a href="classAP__HAL_1_1Scheduler.html#ab3175e2e6223ccfe82f957e41cc12b26">AP_HAL::Scheduler::delay</a></div><div class="ttdeci">virtual void delay(uint16_t ms)=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1Util_html_a287a2b82fa30b92c8d52aad61d4d27b7"><div class="ttname"><a href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">AP_HAL::Util::get_soft_armed</a></div><div class="ttdeci">bool get_soft_armed() const</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Util_8h_source.html#l00018">Util.h:18</a></div></div>
<div class="ttc" id="aclassAP__JSON_1_1value_html"><div class="ttname"><a href="classAP__JSON_1_1value.html">AP_JSON::value</a></div><div class="ttdef"><b>Definition</b> <a href="AP__JSON_8h_source.html#l00023">AP_JSON.h:24</a></div></div>
<div class="ttc" id="aclassAP__JSON_1_1value_html_a32a893be19e12a7e7e439c1eda273b7d"><div class="ttname"><a href="classAP__JSON_1_1value.html#a32a893be19e12a7e7e439c1eda273b7d">AP_JSON::value::get</a></div><div class="ttdeci">const T &amp; get() const</div></div>
<div class="ttc" id="aclassAP__JSON_1_1value_html_aabbfc0b8e550ba2be749158f4312f6a8"><div class="ttname"><a href="classAP__JSON_1_1value.html#aabbfc0b8e550ba2be749158f4312f6a8">AP_JSON::value::set</a></div><div class="ttdeci">void set(const T &amp;)</div></div>
<div class="ttc" id="aclassAP__Logger_html_a5f47086952bb5e841d979491e6dd562f"><div class="ttname"><a href="classAP__Logger.html#a5f47086952bb5e841d979491e6dd562f">AP_Logger::Write_Error</a></div><div class="ttdeci">void Write_Error(LogErrorSubsystem sub_system, LogErrorCode error_code)</div><div class="ttdef"><b>Definition</b> <a href="AP__Logger_8cpp_source.html#l01498">AP_Logger.cpp:1498</a></div></div>
<div class="ttc" id="aclassAP__Logger_html_aa24dd7890759f0d20d05fedbd5b474dc"><div class="ttname"><a href="classAP__Logger.html#aa24dd7890759f0d20d05fedbd5b474dc">AP_Logger::Write_Compass</a></div><div class="ttdeci">void Write_Compass()</div><div class="ttdef"><b>Definition</b> <a href="LogFile_8cpp_source.html#l00427">LogFile.cpp:427</a></div></div>
<div class="ttc" id="aclassAP__Param_html_a5f6dcfce1c0a79cf5bd81283e22f3201"><div class="ttname"><a href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a></div><div class="ttdeci">static void setup_object_defaults(const void *object_pointer, const struct GroupInfo *group_info)</div><div class="ttdef"><b>Definition</b> <a href="main_8cpp_source.html#l00010">main.cpp:10</a></div></div>
<div class="ttc" id="aclassAP__Param_html_a857c14c819b6d550957d0f9c56c379d0"><div class="ttname"><a href="classAP__Param.html#a857c14c819b6d550957d0f9c56c379d0">AP_Param::find_old_parameter</a></div><div class="ttdeci">static bool find_old_parameter(const struct ConversionInfo *info, AP_Param *value)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8cpp_source.html#l01935">AP_Param.cpp:1935</a></div></div>
<div class="ttc" id="aclassAP__Param_html_a97a7b5f898c84c99cb57c76d4ddc870c"><div class="ttname"><a href="classAP__Param.html#a97a7b5f898c84c99cb57c76d4ddc870c">AP_Param::find_top_level_key_by_pointer</a></div><div class="ttdeci">static bool find_top_level_key_by_pointer(const void *ptr, uint16_t &amp;key)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8cpp_source.html#l01057">AP_Param.cpp:1057</a></div></div>
<div class="ttc" id="aclassCompassLearn_html_ac8ff1a868c253b5ae8bd434be2bc7e3d"><div class="ttname"><a href="classCompassLearn.html#ac8ff1a868c253b5ae8bd434be2bc7e3d">CompassLearn::update</a></div><div class="ttdeci">void update(void)</div></div>
<div class="ttc" id="aclassCompass__PerMotor_html"><div class="ttname"><a href="classCompass__PerMotor.html">Compass_PerMotor</a></div><div class="ttdef"><b>Definition</b> <a href="Compass__PerMotor_8h_source.html#l00012">Compass_PerMotor.h:12</a></div></div>
<div class="ttc" id="aclassCompass_html"><div class="ttname"><a href="classCompass.html">Compass</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00080">AP_Compass.h:81</a></div></div>
<div class="ttc" id="aclassCompass_html_a0005716f188963f3ac6494c2a5ce2e2c"><div class="ttname"><a href="classCompass.html#a0005716f188963f3ac6494c2a5ce2e2c">Compass::calculate_heading</a></div><div class="ttdeci">float calculate_heading(const Matrix3f &amp;dcm_matrix) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00117">AP_Compass.h:117</a></div></div>
<div class="ttc" id="aclassCompass_html_a049567dd39f99577797beb087e41f13a"><div class="ttname"><a href="classCompass.html#a049567dd39f99577797beb087e41f13a">Compass::get_healthy_mask</a></div><div class="ttdeci">uint8_t get_healthy_mask() const</div><div class="ttdef"><b>Definition</b> <a href="#l01783">AP_Compass.cpp:1783</a></div></div>
<div class="ttc" id="aclassCompass_html_a068308f9242c606086b60416142e437b"><div class="ttname"><a href="classCompass.html#a068308f9242c606086b60416142e437b">Compass::_log_bit</a></div><div class="ttdeci">uint32_t _log_bit</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00521">AP_Compass.h:521</a></div></div>
<div class="ttc" id="aclassCompass_html_a099bc37c6d1b03238c2efe39ea3b14d3"><div class="ttname"><a href="classCompass.html#a099bc37c6d1b03238c2efe39ea3b14d3">Compass::use_for_yaw</a></div><div class="ttdeci">bool use_for_yaw(void) const</div><div class="ttdoc">return true if the compass should be used for yaw calculations</div><div class="ttdef"><b>Definition</b> <a href="#l01921">AP_Compass.cpp:1921</a></div></div>
<div class="ttc" id="aclassCompass_html_a0f869a4e64bfe1c9b86265c71b73e0e8"><div class="ttname"><a href="classCompass.html#a0f869a4e64bfe1c9b86265c71b73e0e8">Compass::probe_i2c_spi_compasses</a></div><div class="ttdeci">void probe_i2c_spi_compasses(void)</div><div class="ttdef"><b>Definition</b> <a href="#l01377">AP_Compass.cpp:1377</a></div></div>
<div class="ttc" id="aclassCompass_html_a18ec405430e055e4a01912a8ca73cbc3"><div class="ttname"><a href="classCompass.html#a18ec405430e055e4a01912a8ca73cbc3">Compass::set_offsets</a></div><div class="ttdeci">void set_offsets(uint8_t i, const Vector3f &amp;offsets)</div><div class="ttdef"><b>Definition</b> <a href="#l01795">AP_Compass.cpp:1795</a></div></div>
<div class="ttc" id="aclassCompass_html_a1976764e3dd9aa75441275f8d3a0a78e"><div class="ttname"><a href="classCompass.html#a1976764e3dd9aa75441275f8d3a0a78e">Compass::set_and_save_orientation</a></div><div class="ttdeci">void set_and_save_orientation(uint8_t i, Rotation orientation)</div><div class="ttdef"><b>Definition</b> <a href="#l01857">AP_Compass.cpp:1857</a></div></div>
<div class="ttc" id="aclassCompass_html_a1c33938b408e23179770f88aec029f57"><div class="ttname"><a href="classCompass.html#a1c33938b408e23179770f88aec029f57">Compass::register_compass</a></div><div class="ttdeci">bool register_compass(int32_t dev_id, uint8_t &amp;instance)</div><div class="ttdef"><b>Definition</b> <a href="#l00938">AP_Compass.cpp:938</a></div></div>
<div class="ttc" id="aclassCompass_html_a1c48170d8c8966b22fb150b1634443ec"><div class="ttname"><a href="classCompass.html#a1c48170d8c8966b22fb150b1634443ec">Compass::_detect_backends</a></div><div class="ttdeci">void _detect_backends(void)</div><div class="ttdef"><b>Definition</b> <a href="#l01321">AP_Compass.cpp:1321</a></div></div>
<div class="ttc" id="aclassCompass_html_a23dca9254efb3dedb9dcd565c829d707"><div class="ttname"><a href="classCompass.html#a23dca9254efb3dedb9dcd565c829d707">Compass::_add_backend</a></div><div class="ttdeci">bool _add_backend(AP_Compass_Backend *backend)</div><div class="ttdef"><b>Definition</b> <a href="#l01033">AP_Compass.cpp:1033</a></div></div>
<div class="ttc" id="aclassCompass_html_a24c1845620411cd3e169d4a04ecc66dd"><div class="ttname"><a href="classCompass.html#a24c1845620411cd3e169d4a04ecc66dd">Compass::_update_priority_list</a></div><div class="ttdeci">Priority _update_priority_list(int32_t dev_id)</div><div class="ttdef"><b>Definition</b> <a href="#l00861">AP_Compass.cpp:861</a></div></div>
<div class="ttc" id="aclassCompass_html_a2593e947a6c8a4937dccd2d367158b74"><div class="ttname"><a href="classCompass.html#a2593e947a6c8a4937dccd2d367158b74">Compass::read</a></div><div class="ttdeci">bool read()</div><div class="ttdef"><b>Definition</b> <a href="#l01715">AP_Compass.cpp:1715</a></div></div>
<div class="ttc" id="aclassCompass_html_a26f0faff382edb23410e1beb8e9a18e5"><div class="ttname"><a href="classCompass.html#a26f0faff382edb23410e1beb8e9a18e5">Compass::_unreg_compass_count</a></div><div class="ttdeci">uint8_t _unreg_compass_count</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00506">AP_Compass.h:506</a></div></div>
<div class="ttc" id="aclassCompass_html_a27440d8cc0751bd27d9dfd4ba9f17957"><div class="ttname"><a href="classCompass.html#a27440d8cc0751bd27d9dfd4ba9f17957">Compass::_thr</a></div><div class="ttdeci">float _thr</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00531">AP_Compass.h:531</a></div></div>
<div class="ttc" id="aclassCompass_html_a307ba851d14fd2ac3b655227812f6b4d"><div class="ttname"><a href="classCompass.html#a307ba851d14fd2ac3b655227812f6b4d">Compass::set_motor_compensation</a></div><div class="ttdeci">void set_motor_compensation(uint8_t i, const Vector3f &amp;motor_comp_factor)</div><div class="ttdef"><b>Definition</b> <a href="#l01874">AP_Compass.cpp:1874</a></div></div>
<div class="ttc" id="aclassCompass_html_a32fb8b55b7ee1c439e7c42ce2c02f5eb"><div class="ttname"><a href="classCompass.html#a32fb8b55b7ee1c439e7c42ce2c02f5eb">Compass::_have_i2c_driver</a></div><div class="ttdeci">bool _have_i2c_driver(uint8_t bus_num, uint8_t address) const</div><div class="ttdef"><b>Definition</b> <a href="#l01060">AP_Compass.cpp:1060</a></div></div>
<div class="ttc" id="aclassCompass_html_a424b78025887b128dd21833cb6e31d0b"><div class="ttname"><a href="classCompass.html#a424b78025887b128dd21833cb6e31d0b">Compass::_declination</a></div><div class="ttdeci">AP_Float _declination</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00515">AP_Compass.h:515</a></div></div>
<div class="ttc" id="aclassCompass_html_a433e7a61c3b4f0432d12067bdd2c4045"><div class="ttname"><a href="classCompass.html#a433e7a61c3b4f0432d12067bdd2c4045">Compass::_reset_compass_id</a></div><div class="ttdeci">void _reset_compass_id()</div><div class="ttdef"><b>Definition</b> <a href="#l01656">AP_Compass.cpp:1656</a></div></div>
<div class="ttc" id="aclassCompass_html_a445d5074e9345fafeab0abee41bb367e"><div class="ttname"><a href="classCompass.html#a445d5074e9345fafeab0abee41bb367e">Compass::_state</a></div><div class="ttdeci">RestrictIDTypeArray&lt; mag_state, COMPASS_MAX_INSTANCES+1, StateIndex &gt; _state</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00579">AP_Compass.h:579</a></div></div>
<div class="ttc" id="aclassCompass_html_a44f157950e6ee02dd8563050e2883ee7"><div class="ttname"><a href="classCompass.html#a44f157950e6ee02dd8563050e2883ee7">Compass::have_scale_factor</a></div><div class="ttdeci">bool have_scale_factor(uint8_t i) const</div><div class="ttdoc">Return true if we have set a scale factor for a compass.</div><div class="ttdef"><b>Definition</b> <a href="#l02177">AP_Compass.cpp:2177</a></div></div>
<div class="ttc" id="aclassCompass_html_a4519009b6dc2e68c498903eb314c2a60"><div class="ttname"><a href="classCompass.html#a4519009b6dc2e68c498903eb314c2a60">Compass::get_declination</a></div><div class="ttdeci">float get_declination() const</div><div class="ttdef"><b>Definition</b> <a href="#l01968">AP_Compass.cpp:1968</a></div></div>
<div class="ttc" id="aclassCompass_html_a4e19069e5c7edee20fe8eb2c02aae3e2"><div class="ttname"><a href="classCompass.html#a4e19069e5c7edee20fe8eb2c02aae3e2">Compass::option_set</a></div><div class="ttdeci">bool option_set(Option opt) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00620">AP_Compass.h:620</a></div></div>
<div class="ttc" id="aclassCompass_html_a53de8105fdd000b28afe20ced1b85d5a"><div class="ttname"><a href="classCompass.html#a53de8105fdd000b28afe20ced1b85d5a">Compass::_motor_comp_type</a></div><div class="ttdeci">AP_Int8 _motor_comp_type</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00525">AP_Compass.h:525</a></div></div>
<div class="ttc" id="aclassCompass_html_a59622e8195dc29485f24d7c27a9cf7f0"><div class="ttname"><a href="classCompass.html#a59622e8195dc29485f24d7c27a9cf7f0">Compass::configured</a></div><div class="ttdeci">bool configured(uint8_t i)</div><div class="ttdef"><b>Definition</b> <a href="#l02034">AP_Compass.cpp:2034</a></div></div>
<div class="ttc" id="aclassCompass_html_a5a838bd25f13f41d428c10a8c44e965a"><div class="ttname"><a href="classCompass.html#a5a838bd25f13f41d428c10a8c44e965a">Compass::learn</a></div><div class="ttdeci">CompassLearn * learn</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00645">AP_Compass.h:645</a></div></div>
<div class="ttc" id="aclassCompass_html_a5b6bd29bfc993d353ed2f8b03b387de4"><div class="ttname"><a href="classCompass.html#a5b6bd29bfc993d353ed2f8b03b387de4">Compass::_get_state_id</a></div><div class="ttdeci">StateIndex _get_state_id(Priority priority) const</div><div class="ttdef"><b>Definition</b> <a href="#l01016">AP_Compass.cpp:1016</a></div></div>
<div class="ttc" id="aclassCompass_html_a5ed931ce45b6449a63d57bb01fe5a0c9ac67e46a1613956b81acf80a37742c288"><div class="ttname"><a href="classCompass.html#a5ed931ce45b6449a63d57bb01fe5a0c9ac67e46a1613956b81acf80a37742c288">Compass::LEARN_INFLIGHT</a></div><div class="ttdeci">@ LEARN_INFLIGHT</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00322">AP_Compass.h:321</a></div></div>
<div class="ttc" id="aclassCompass_html_a625a1c702621a199c1bc52f89e970038"><div class="ttname"><a href="classCompass.html#a625a1c702621a199c1bc52f89e970038">Compass::is_replacement_mag</a></div><div class="ttdeci">bool is_replacement_mag(uint32_t dev_id)</div><div class="ttdef"><b>Definition</b> <a href="#l01611">AP_Compass.cpp:1611</a></div></div>
<div class="ttc" id="aclassCompass_html_a6728a7129a64d973461b9d5eb95dc81a"><div class="ttname"><a href="classCompass.html#a6728a7129a64d973461b9d5eb95dc81a">Compass::set_and_save_offdiagonals</a></div><div class="ttdeci">void set_and_save_offdiagonals(uint8_t i, const Vector3f &amp;diagonals)</div><div class="ttdef"><b>Definition</b> <a href="#l01827">AP_Compass.cpp:1827</a></div></div>
<div class="ttc" id="aclassCompass_html_a678ad037acc44e46598012b7ad17b2a6"><div class="ttname"><a href="classCompass.html#a678ad037acc44e46598012b7ad17b2a6">Compass::_driver_enabled</a></div><div class="ttdeci">bool _driver_enabled(enum DriverType driver_type)</div><div class="ttdef"><b>Definition</b> <a href="#l01051">AP_Compass.cpp:1051</a></div></div>
<div class="ttc" id="aclassCompass_html_a68bd2a073cc0d461b2b46529aae04765"><div class="ttname"><a href="classCompass.html#a68bd2a073cc0d461b2b46529aae04765">Compass::Compass</a></div><div class="ttdeci">Compass()</div><div class="ttdef"><b>Definition</b> <a href="#l00693">AP_Compass.cpp:693</a></div></div>
<div class="ttc" id="aclassCompass_html_a68c13ec59710efc99bfb7ea96211b426"><div class="ttname"><a href="classCompass.html#a68c13ec59710efc99bfb7ea96211b426">Compass::get_field</a></div><div class="ttdeci">const Vector3f &amp; get_field(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00160">AP_Compass.h:160</a></div></div>
<div class="ttc" id="aclassCompass_html_a72dcc2b111d806635ebde2700e70a33c"><div class="ttname"><a href="classCompass.html#a72dcc2b111d806635ebde2700e70a33c">Compass::init_done</a></div><div class="ttdeci">bool init_done</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00661">AP_Compass.h:661</a></div></div>
<div class="ttc" id="aclassCompass_html_a75aaff7b480627c038a0810862606bf9"><div class="ttname"><a href="classCompass.html#a75aaff7b480627c038a0810862606bf9">Compass::learn_allocated</a></div><div class="ttdeci">bool learn_allocated</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00646">AP_Compass.h:646</a></div></div>
<div class="ttc" id="aclassCompass_html_a766d77e1b78dc08be50ba76994c8b4ab"><div class="ttname"><a href="classCompass.html#a766d77e1b78dc08be50ba76994c8b4ab">Compass::_probe_external_i2c_compasses</a></div><div class="ttdeci">void _probe_external_i2c_compasses(void)</div><div class="ttdef"><b>Definition</b> <a href="#l01095">AP_Compass.cpp:1095</a></div></div>
<div class="ttc" id="aclassCompass_html_a76b5ecbd5bd613d28b1172834d3a8db9"><div class="ttname"><a href="classCompass.html#a76b5ecbd5bd613d28b1172834d3a8db9">Compass::healthy</a></div><div class="ttdeci">bool healthy(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00206">AP_Compass.h:206</a></div></div>
<div class="ttc" id="aclassCompass_html_a79db6bfd3fe309c6258d783f126326c6"><div class="ttname"><a href="classCompass.html#a79db6bfd3fe309c6258d783f126326c6">Compass::init</a></div><div class="ttdeci">void init()</div><div class="ttdef"><b>Definition</b> <a href="#l00707">AP_Compass.cpp:707</a></div></div>
<div class="ttc" id="aclassCompass_html_a7af9628dd3e3b814a11241d91996562b"><div class="ttname"><a href="classCompass.html#a7af9628dd3e3b814a11241d91996562b">Compass::_reorder_compass_params</a></div><div class="ttdeci">void _reorder_compass_params()</div><div class="ttdef"><b>Definition</b> <a href="#l00896">AP_Compass.cpp:896</a></div></div>
<div class="ttc" id="aclassCompass_html_a7cb1f23f85ae4861803c2bd6cacf678f"><div class="ttname"><a href="classCompass.html#a7cb1f23f85ae4861803c2bd6cacf678f">Compass::_first_usable</a></div><div class="ttdeci">uint8_t _first_usable</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00665">AP_Compass.h:665</a></div></div>
<div class="ttc" id="aclassCompass_html_a80e369bd0d6a5d30b78d933b219d327e"><div class="ttname"><a href="classCompass.html#a80e369bd0d6a5d30b78d933b219d327e">Compass::CompassLearn</a></div><div class="ttdeci">friend class CompassLearn</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00094">AP_Compass.h:94</a></div></div>
<div class="ttc" id="aclassCompass_html_a86a6d63e7b398dd8b0098371d53c0ea3"><div class="ttname"><a href="classCompass.html#a86a6d63e7b398dd8b0098371d53c0ea3">Compass::extra_dev_id</a></div><div class="ttdeci">AP_Int32 extra_dev_id[COMPASS_MAX_UNREG_DEV]</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00639">AP_Compass.h:639</a></div></div>
<div class="ttc" id="aclassCompass_html_a885d8a0a74407b8c5c795ebee1b3635e"><div class="ttname"><a href="classCompass.html#a885d8a0a74407b8c5c795ebee1b3635e">Compass::get_offsets</a></div><div class="ttdeci">const Vector3f &amp; get_offsets(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00214">AP_Compass.h:214</a></div></div>
<div class="ttc" id="aclassCompass_html_a8e98bdea111f293a50e21f15afca1e19"><div class="ttname"><a href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19">Compass::DriverType</a></div><div class="ttdeci">DriverType</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00430">AP_Compass.h:430</a></div></div>
<div class="ttc" id="aclassCompass_html_a8e98bdea111f293a50e21f15afca1e19a03a77be7424a941a21861931eed0dded"><div class="ttname"><a href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a03a77be7424a941a21861931eed0dded">Compass::DRIVER_LIS3MDL</a></div><div class="ttdeci">@ DRIVER_LIS3MDL</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00447">AP_Compass.h:447</a></div></div>
<div class="ttc" id="aclassCompass_html_a8e98bdea111f293a50e21f15afca1e19a102db3d1e1b2b4fe5c8fffd7de522664"><div class="ttname"><a href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a102db3d1e1b2b4fe5c8fffd7de522664">Compass::DRIVER_AK8963</a></div><div class="ttdeci">@ DRIVER_AK8963</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00438">AP_Compass.h:438</a></div></div>
<div class="ttc" id="aclassCompass_html_a8e98bdea111f293a50e21f15afca1e19a217078085d95a700a86b76f0446e6909"><div class="ttname"><a href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a217078085d95a700a86b76f0446e6909">Compass::DRIVER_HMC5843</a></div><div class="ttdeci">@ DRIVER_HMC5843</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00432">AP_Compass.h:432</a></div></div>
<div class="ttc" id="aclassCompass_html_a8e98bdea111f293a50e21f15afca1e19a51912f7ed58536a787c5b7f165dc61e9"><div class="ttname"><a href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a51912f7ed58536a787c5b7f165dc61e9">Compass::DRIVER_ICM20948</a></div><div class="ttdeci">@ DRIVER_ICM20948</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00456">AP_Compass.h:456</a></div></div>
<div class="ttc" id="aclassCompass_html_a8e98bdea111f293a50e21f15afca1e19a92f9ce72391607b31b0bbcfae036f536"><div class="ttname"><a href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19a92f9ce72391607b31b0bbcfae036f536">Compass::DRIVER_MMC3416</a></div><div class="ttdeci">@ DRIVER_MMC3416</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00459">AP_Compass.h:459</a></div></div>
<div class="ttc" id="aclassCompass_html_a8e98bdea111f293a50e21f15afca1e19ac271f3a78ee820edc8a9c95f64dac68e"><div class="ttname"><a href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19ac271f3a78ee820edc8a9c95f64dac68e">Compass::DRIVER_QMC5883L</a></div><div class="ttdeci">@ DRIVER_QMC5883L</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00465">AP_Compass.h:465</a></div></div>
<div class="ttc" id="aclassCompass_html_a8e98bdea111f293a50e21f15afca1e19ac351a800221e67444411df60735a92ff"><div class="ttname"><a href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19ac351a800221e67444411df60735a92ff">Compass::DRIVER_RM3100</a></div><div class="ttdeci">@ DRIVER_RM3100</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00477">AP_Compass.h:477</a></div></div>
<div class="ttc" id="aclassCompass_html_a8e98bdea111f293a50e21f15afca1e19acc5d43bb11e0e4733807bc8fbc37bd76"><div class="ttname"><a href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19acc5d43bb11e0e4733807bc8fbc37bd76">Compass::DRIVER_IST8310</a></div><div class="ttdeci">@ DRIVER_IST8310</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00453">AP_Compass.h:453</a></div></div>
<div class="ttc" id="aclassCompass_html_a8e98bdea111f293a50e21f15afca1e19ad0a33febf127c0dccbe03f0709f94122"><div class="ttname"><a href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19ad0a33febf127c0dccbe03f0709f94122">Compass::DRIVER_BMM150</a></div><div class="ttdeci">@ DRIVER_BMM150</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00441">AP_Compass.h:441</a></div></div>
<div class="ttc" id="aclassCompass_html_a8e98bdea111f293a50e21f15afca1e19ad69cd8acf903e732a7c58992df756cd7"><div class="ttname"><a href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19ad69cd8acf903e732a7c58992df756cd7">Compass::DRIVER_LSM303D</a></div><div class="ttdeci">@ DRIVER_LSM303D</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00435">AP_Compass.h:435</a></div></div>
<div class="ttc" id="aclassCompass_html_a8e98bdea111f293a50e21f15afca1e19aefd4c56c784bb6ccfcaea5a6f8cbcda1"><div class="ttname"><a href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19aefd4c56c784bb6ccfcaea5a6f8cbcda1">Compass::DRIVER_IST8308</a></div><div class="ttdeci">@ DRIVER_IST8308</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00474">AP_Compass.h:474</a></div></div>
<div class="ttc" id="aclassCompass_html_a8e98bdea111f293a50e21f15afca1e19afd40b80be9d564b799206268c73199c4"><div class="ttname"><a href="classCompass.html#a8e98bdea111f293a50e21f15afca1e19afd40b80be9d564b799206268c73199c4">Compass::DRIVER_AK09916</a></div><div class="ttdeci">@ DRIVER_AK09916</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00450">AP_Compass.h:450</a></div></div>
<div class="ttc" id="aclassCompass_html_a8ebdf639bae4d6c56169a2bb746f02de"><div class="ttname"><a href="classCompass.html#a8ebdf639bae4d6c56169a2bb746f02de">Compass::_priority_did_stored_list</a></div><div class="ttdeci">RestrictIDTypeArray&lt; AP_Int32, COMPASS_MAX_INSTANCES, Priority &gt; _priority_did_stored_list</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00609">AP_Compass.h:609</a></div></div>
<div class="ttc" id="aclassCompass_html_a90413f928c630414d9e3d06894cb30ad"><div class="ttname"><a href="classCompass.html#a90413f928c630414d9e3d06894cb30ad">Compass::available</a></div><div class="ttdeci">bool available() const</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00109">AP_Compass.h:109</a></div></div>
<div class="ttc" id="aclassCompass_html_a92a1e23d7ff2ade9024f2145e4e8d0a2"><div class="ttname"><a href="classCompass.html#a92a1e23d7ff2ade9024f2145e4e8d0a2">Compass::_auto_declination</a></div><div class="ttdeci">AP_Int8 _auto_declination</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00518">AP_Compass.h:518</a></div></div>
<div class="ttc" id="aclassCompass_html_a93d4187acb991b33c5c25f9e16b3b0ce"><div class="ttname"><a href="classCompass.html#a93d4187acb991b33c5c25f9e16b3b0ce">Compass::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00071">AP_Compass.h:71</a></div></div>
<div class="ttc" id="aclassCompass_html_a9921f864c9ba926d0b5ad318f3ba66f6"><div class="ttname"><a href="classCompass.html#a9921f864c9ba926d0b5ad318f3ba66f6">Compass::suppress_devid_save</a></div><div class="ttdeci">bool suppress_devid_save</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00663">AP_Compass.h:663</a></div></div>
<div class="ttc" id="aclassCompass_html_a9a5653285eb6768ddfe8b7529ba12c03"><div class="ttname"><a href="classCompass.html#a9a5653285eb6768ddfe8b7529ba12c03">Compass::_learn</a></div><div class="ttdeci">AP_Int8 _learn</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00509">AP_Compass.h:509</a></div></div>
<div class="ttc" id="aclassCompass_html_a9fcdb386c14b2879dba2080374b2179f"><div class="ttname"><a href="classCompass.html#a9fcdb386c14b2879dba2080374b2179f">Compass::try_set_initial_location</a></div><div class="ttdeci">void try_set_initial_location()</div><div class="ttdef"><b>Definition</b> <a href="#l01895">AP_Compass.cpp:1895</a></div></div>
<div class="ttc" id="aclassCompass_html_aa2db70e5e7eb6b25d70550322849b862"><div class="ttname"><a href="classCompass.html#aa2db70e5e7eb6b25d70550322849b862">Compass::_driver_type_mask</a></div><div class="ttdeci">AP_Int32 _driver_type_mask</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00635">AP_Compass.h:635</a></div></div>
<div class="ttc" id="aclassCompass_html_aa3e1ccaef661d5ff5d2e51cd7742c6ba"><div class="ttname"><a href="classCompass.html#aa3e1ccaef661d5ff5d2e51cd7742c6ba">Compass::_singleton</a></div><div class="ttdeci">static Compass * _singleton</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00369">AP_Compass.h:369</a></div></div>
<div class="ttc" id="aclassCompass_html_aa478093c27cb5fc0e3652cd3cb98b2a5"><div class="ttname"><a href="classCompass.html#aa478093c27cb5fc0e3652cd3cb98b2a5">Compass::get_singleton</a></div><div class="ttdeci">static Compass * get_singleton()</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00090">AP_Compass.h:90</a></div></div>
<div class="ttc" id="aclassCompass_html_aab02220a8209d664f89f2be9050cf283"><div class="ttname"><a href="classCompass.html#aab02220a8209d664f89f2be9050cf283">Compass::get_count</a></div><div class="ttdeci">uint8_t get_count(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00153">AP_Compass.h:153</a></div></div>
<div class="ttc" id="aclassCompass_html_ab22c1f0bf0495f27855c24f7d3d58117ae3162512b851187b768bfb71354dad04"><div class="ttname"><a href="classCompass.html#ab22c1f0bf0495f27855c24f7d3d58117ae3162512b851187b768bfb71354dad04">Compass::Option::ALLOW_DRONECAN_AUTO_REPLACEMENT</a></div><div class="ttdeci">@ ALLOW_DRONECAN_AUTO_REPLACEMENT</div></div>
<div class="ttc" id="aclassCompass_html_ab315b6dc2d05ea4649d5cf8f1a2b511a"><div class="ttname"><a href="classCompass.html#ab315b6dc2d05ea4649d5cf8f1a2b511a">Compass::_enabled</a></div><div class="ttdeci">AP_Int8 _enabled</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00500">AP_Compass.h:500</a></div></div>
<div class="ttc" id="aclassCompass_html_abfc394b43272d5a6e97001232e201b7f"><div class="ttname"><a href="classCompass.html#abfc394b43272d5a6e97001232e201b7f">Compass::save_offsets</a></div><div class="ttdeci">void save_offsets(void)</div><div class="ttdef"><b>Definition</b> <a href="#l01866">AP_Compass.cpp:1866</a></div></div>
<div class="ttc" id="aclassCompass_html_ac3584d30eca4e60567613c1b09785505"><div class="ttname"><a href="classCompass.html#ac3584d30eca4e60567613c1b09785505">Compass::set_declination</a></div><div class="ttdeci">void set_declination(float radians, bool save_to_eeprom=true)</div><div class="ttdef"><b>Definition</b> <a href="#l01958">AP_Compass.cpp:1958</a></div></div>
<div class="ttc" id="aclassCompass_html_ac3bf8f6ab108927b2ea704b3dcba1355"><div class="ttname"><a href="classCompass.html#ac3bf8f6ab108927b2ea704b3dcba1355">Compass::_backend_count</a></div><div class="ttdeci">uint8_t _backend_count</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00497">AP_Compass.h:497</a></div></div>
<div class="ttc" id="aclassCompass_html_ac51b3cd4741176f62eb120617bd9f43b"><div class="ttname"><a href="classCompass.html#ac51b3cd4741176f62eb120617bd9f43b">Compass::_initial_location_set</a></div><div class="ttdeci">bool _initial_location_set</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00654">AP_Compass.h:654</a></div></div>
<div class="ttc" id="aclassCompass_html_acea3a6c15669b5b88b5b077179dd82ac"><div class="ttname"><a href="classCompass.html#acea3a6c15669b5b88b5b077179dd82ac">Compass::_get_state</a></div><div class="ttdeci">const struct mag_state &amp; _get_state(Priority priority) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00584">AP_Compass.h:584</a></div></div>
<div class="ttc" id="aclassCompass_html_acf324ab18d365c3ed1969fd888f314b2"><div class="ttname"><a href="classCompass.html#acf324ab18d365c3ed1969fd888f314b2">Compass::_detect_runtime</a></div><div class="ttdeci">void _detect_runtime(void)</div><div class="ttdef"><b>Definition</b> <a href="#l01685">AP_Compass.cpp:1685</a></div></div>
<div class="ttc" id="aclassCompass_html_ad15f118665655ffc5e9791abf7737c29"><div class="ttname"><a href="classCompass.html#ad15f118665655ffc5e9791abf7737c29">Compass::_previously_unreg_mag</a></div><div class="ttdeci">uint32_t _previously_unreg_mag[COMPASS_MAX_UNREG_DEV]</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00640">AP_Compass.h:640</a></div></div>
<div class="ttc" id="aclassCompass_html_ad84a5f766939ab72f377c218ad39800e"><div class="ttname"><a href="classCompass.html#ad84a5f766939ab72f377c218ad39800e">Compass::_priority_did_list</a></div><div class="ttdeci">RestrictIDTypeArray&lt; int32_t, COMPASS_MAX_INSTANCES, Priority &gt; _priority_did_list</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00610">AP_Compass.h:610</a></div></div>
<div class="ttc" id="aclassCompass_html_ad897fd4be9dd67a65343465614629568"><div class="ttname"><a href="classCompass.html#ad897fd4be9dd67a65343465614629568">Compass::motor_compensation_type</a></div><div class="ttdeci">void motor_compensation_type(const uint8_t comp_type)</div><div class="ttdef"><b>Definition</b> <a href="#l02119">AP_Compass.cpp:2119</a></div></div>
<div class="ttc" id="aclassCompass_html_adeefda110ce0a02edfb3d344d632777a"><div class="ttname"><a href="classCompass.html#adeefda110ce0a02edfb3d344d632777a">Compass::save_motor_compensation</a></div><div class="ttdeci">void save_motor_compensation()</div><div class="ttdef"><b>Definition</b> <a href="#l01883">AP_Compass.cpp:1883</a></div></div>
<div class="ttc" id="aclassCompass_html_ae581710aa79ddf7abce3b3893bb08ea5"><div class="ttname"><a href="classCompass.html#ae581710aa79ddf7abce3b3893bb08ea5">Compass::set_and_save_diagonals</a></div><div class="ttdeci">void set_and_save_diagonals(uint8_t i, const Vector3f &amp;diagonals)</div><div class="ttdef"><b>Definition</b> <a href="#l01817">AP_Compass.cpp:1817</a></div></div>
<div class="ttc" id="aclassCompass_html_aea7f01834588d36bf856f378417bf7a7"><div class="ttname"><a href="classCompass.html#aea7f01834588d36bf856f378417bf7a7">Compass::force_save_calibration</a></div><div class="ttdeci">void force_save_calibration(void)</div><div class="ttdef"><b>Definition</b> <a href="#l02222">AP_Compass.cpp:2222</a></div></div>
<div class="ttc" id="aclassCompass_html_aef26ec454da865f61012aa9033cf3358"><div class="ttname"><a href="classCompass.html#aef26ec454da865f61012aa9033cf3358">Compass::remove_unreg_dev_id</a></div><div class="ttdeci">void remove_unreg_dev_id(uint32_t devid)</div><div class="ttdef"><b>Definition</b> <a href="#l01637">AP_Compass.cpp:1637</a></div></div>
<div class="ttc" id="aclassCompass_html_af3deb20615b93859ff960f3a0cf90920"><div class="ttname"><a href="classCompass.html#af3deb20615b93859ff960f3a0cf90920">Compass::get_num_enabled</a></div><div class="ttdeci">uint8_t get_num_enabled(void) const</div><div class="ttdef"><b>Definition</b> <a href="#l01943">AP_Compass.cpp:1943</a></div></div>
<div class="ttc" id="aclassCompass_html_af46d67cb8eb4bc4c51bb12be6813cfdd"><div class="ttname"><a href="classCompass.html#af46d67cb8eb4bc4c51bb12be6813cfdd">Compass::_backends</a></div><div class="ttdeci">AP_Compass_Backend * _backends[COMPASS_MAX_BACKEND]</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00496">AP_Compass.h:496</a></div></div>
<div class="ttc" id="aclassCompass_html_af6329b7b824c203c368278e6f2c4a6c4"><div class="ttname"><a href="classCompass.html#af6329b7b824c203c368278e6f2c4a6c4">Compass::set_and_save_scale_factor</a></div><div class="ttdeci">void set_and_save_scale_factor(uint8_t i, float scale_factor)</div><div class="ttdef"><b>Definition</b> <a href="#l01838">AP_Compass.cpp:1838</a></div></div>
<div class="ttc" id="aclassCompass_html_af8d0469972b7da6464a0d91e20715082"><div class="ttname"><a href="classCompass.html#af8d0469972b7da6464a0d91e20715082">Compass::consistent</a></div><div class="ttdeci">bool consistent() const</div><div class="ttdef"><b>Definition</b> <a href="#l02130">AP_Compass.cpp:2130</a></div></div>
<div class="ttc" id="aclassCompass_html_afa8ec003900ff5b9727aa5f3a8372935"><div class="ttname"><a href="classCompass.html#afa8ec003900ff5b9727aa5f3a8372935">Compass::_use_for_yaw</a></div><div class="ttdeci">RestrictIDTypeArray&lt; AP_Int8, COMPASS_MAX_INSTANCES, Priority &gt; _use_for_yaw</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00607">AP_Compass.h:607</a></div></div>
<div class="ttc" id="aclassCompass_html_afd52e3b95b4813b56a79742c0d98e6e4"><div class="ttname"><a href="classCompass.html#afd52e3b95b4813b56a79742c0d98e6e4">Compass::_compass_count</a></div><div class="ttdeci">uint8_t _compass_count</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00503">AP_Compass.h:503</a></div></div>
<div class="ttc" id="aclassCompass_html_afeac6bcfad2650762cccda72dbce3e69"><div class="ttname"><a href="classCompass.html#afeac6bcfad2650762cccda72dbce3e69">Compass::set_and_save_offsets</a></div><div class="ttdeci">void set_and_save_offsets(uint8_t i, const Vector3f &amp;offsets)</div><div class="ttdef"><b>Definition</b> <a href="#l01805">AP_Compass.cpp:1805</a></div></div>
<div class="ttc" id="aclassGCS_html_a2f099d18721b0874af08fde3f6aae6b6"><div class="ttname"><a href="classGCS.html#a2f099d18721b0874af08fde3f6aae6b6">GCS::send_text</a></div><div class="ttdeci">void send_text(MAV_SEVERITY severity, const char *fmt,...) FMT_PRINTF(3</div><div class="ttdef"><b>Definition</b> <a href="GCS_8cpp_source.html#l00080">GCS.cpp:80</a></div></div>
<div class="ttc" id="aclassLocation_html"><div class="ttname"><a href="classLocation.html">Location</a></div><div class="ttdef"><b>Definition</b> <a href="Location_8h_source.html#l00007">Location.h:8</a></div></div>
<div class="ttc" id="aclassLocation_html_a5831f0aca9e51a15adb96fad465f72f8"><div class="ttname"><a href="classLocation.html#a5831f0aca9e51a15adb96fad465f72f8">Location::lng</a></div><div class="ttdeci">int32_t lng</div><div class="ttdef"><b>Definition</b> <a href="Location_8h_source.html#l00020">Location.h:20</a></div></div>
<div class="ttc" id="aclassLocation_html_ae51548c2cf32311043ca19b94b9a9223"><div class="ttname"><a href="classLocation.html#ae51548c2cf32311043ca19b94b9a9223">Location::lat</a></div><div class="ttdeci">int32_t lat</div><div class="ttdef"><b>Definition</b> <a href="Location_8h_source.html#l00019">Location.h:19</a></div></div>
<div class="ttc" id="aclassMatrix3_html"><div class="ttname"><a href="classMatrix3.html">Matrix3&lt; float &gt;</a></div></div>
<div class="ttc" id="aclassMatrix3_html_a7efa0e7bd4c621a7fe76cd9168960b94"><div class="ttname"><a href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">Matrix3::c</a></div><div class="ttdeci">Vector3&lt; T &gt; c</div><div class="ttdef"><b>Definition</b> <a href="matrix3_8h_source.html#l00054">matrix3.h:54</a></div></div>
<div class="ttc" id="aclassRestrictIDTypeArray_html_a0b10d9276b019b22ce10901178da2827"><div class="ttname"><a href="classRestrictIDTypeArray.html#a0b10d9276b019b22ce10901178da2827">RestrictIDTypeArray::_priv_instance</a></div><div class="ttdeci">base_type _priv_instance[num_instances]</div><div class="ttdef"><b>Definition</b> <a href="TSIndex_8h_source.html#l00108">TSIndex.h:108</a></div></div>
<div class="ttc" id="aclassVector3_html"><div class="ttname"><a href="classVector3.html">Vector3&lt; float &gt;</a></div></div>
<div class="ttc" id="aclassVector3_html_a1a0f7e168c71ca798099f0ba8a444244"><div class="ttname"><a href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">Vector3::x</a></div><div class="ttdeci">T x</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00076">vector3.h:76</a></div></div>
<div class="ttc" id="aclassVector3_html_a561df88b28e106e337a25bb86554a569"><div class="ttname"><a href="classVector3.html#a561df88b28e106e337a25bb86554a569">Vector3::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00076">vector3.h:76</a></div></div>
<div class="ttc" id="aclassVector3_html_aa420cb879eaa193857e69556522f9c68"><div class="ttname"><a href="classVector3.html#aa420cb879eaa193857e69556522f9c68">Vector3::angle</a></div><div class="ttdeci">T angle(const Vector3&lt; T &gt; &amp;v2) const</div><div class="ttdef"><b>Definition</b> <a href="vector3_8cpp_source.html#l00425">vector3.cpp:425</a></div></div>
<div class="ttc" id="aclassVector3_html_ab3e7f5401dd6e951978bfa746809f74f"><div class="ttname"><a href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">Vector3::z</a></div><div class="ttdeci">T z</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00076">vector3.h:76</a></div></div>
<div class="ttc" id="aclassVector3_html_abcf8b89285b9966932d1aceeeadb21d3"><div class="ttname"><a href="classVector3.html#abcf8b89285b9966932d1aceeeadb21d3">Vector3::xy</a></div><div class="ttdeci">const Vector2&lt; T &gt; &amp; xy() const</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00203">vector3.h:203</a></div></div>
<div class="ttc" id="adefinitions_8h_html_ae71449b1cc6e6250b91f539153a7a0d3"><div class="ttname"><a href="definitions_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a></div><div class="ttdeci">#define M_PI</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00010">definitions.h:10</a></div></div>
<div class="ttc" id="aesp32diy_8h_html_a0af4e497b206c0129814f492962f28f1"><div class="ttname"><a href="esp32diy_8h.html#a0af4e497b206c0129814f492962f28f1">HAL_MAG_PROBE_LIST</a></div><div class="ttdeci">#define HAL_MAG_PROBE_LIST</div><div class="ttdef"><b>Definition</b> <a href="esp32diy_8h_source.html#l00050">esp32diy.h:50</a></div></div>
<div class="ttc" id="alparser_8c_html_a81b42517a626e76f00bbe1bf33d3aeba"><div class="ttname"><a href="lparser_8c.html#a81b42517a626e76f00bbe1bf33d3aeba">priority</a></div><div class="ttdeci">static const struct @195 priority[]</div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a52edeef7d5ffaa365e1229b87c170307"><div class="ttname"><a href="namespaceAP__HAL.html#a52edeef7d5ffaa365e1229b87c170307">AP_HAL::panic</a></div><div class="ttdeci">void panic(const char *errormsg,...) FMT_PRINTF(1</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2system_8cpp_source.html#l00327">system.cpp:327</a></div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a77dffbb18891996280308e21316ec186"><div class="ttname"><a href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a></div><div class="ttdeci">uint32_t millis()</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2system_8cpp_source.html#l00377">system.cpp:377</a></div></div>
<div class="ttc" id="anamespaceAP_html"><div class="ttname"><a href="namespaceAP.html">AP</a></div><div class="ttdef"><b>Definition</b> <a href="AC__Avoid_8cpp_source.html#l01481">AC_Avoid.cpp:1481</a></div></div>
<div class="ttc" id="anamespaceAP_html_a1a3d63c4a3dd8a0bd9a17a0e500ead31"><div class="ttname"><a href="namespaceAP.html#a1a3d63c4a3dd8a0bd9a17a0e500ead31">AP::custom_rotations</a></div><div class="ttdeci">AP_CustomRotations &amp; custom_rotations()</div><div class="ttdef"><b>Definition</b> <a href="AP__CustomRotations_8cpp_source.html#l00154">AP_CustomRotations.cpp:154</a></div></div>
<div class="ttc" id="anamespaceAP_html_a99432cfdb696952c9b7146f155a815aa"><div class="ttname"><a href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a></div><div class="ttdeci">AP_AHRS &amp; ahrs()</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8cpp_source.html#l03558">AP_AHRS.cpp:3558</a></div></div>
<div class="ttc" id="anamespaceAP_html_aa35bfac1ea2da16f110e8e72db7b3b20"><div class="ttname"><a href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a></div><div class="ttdeci">AP_Logger &amp; logger()</div><div class="ttdef"><b>Definition</b> <a href="AP__Logger_8cpp_source.html#l01740">AP_Logger.cpp:1740</a></div></div>
<div class="ttc" id="arotations_8h_html_a67a250c97139a5466814a54c4aa4a681"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681">Rotation</a></div><div class="ttdeci">Rotation</div><div class="ttdef"><b>Definition</b> <a href="rotations_8h_source.html#l00027">rotations.h:27</a></div></div>
<div class="ttc" id="arotations_8h_html_a67a250c97139a5466814a54c4aa4a681a16e7696bfbca8f804e76718d5cfa5bef"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a16e7696bfbca8f804e76718d5cfa5bef">ROTATION_PITCH_180</a></div><div class="ttdeci">@ ROTATION_PITCH_180</div><div class="ttdef"><b>Definition</b> <a href="rotations_8h_source.html#l00040">rotations.h:40</a></div></div>
<div class="ttc" id="arotations_8h_html_a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3c485d0686ff0555d4db0c22959f9dec">ROTATION_NONE</a></div><div class="ttdeci">@ ROTATION_NONE</div><div class="ttdef"><b>Definition</b> <a href="rotations_8h_source.html#l00028">rotations.h:28</a></div></div>
<div class="ttc" id="arotations_8h_html_a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a3eaa4f433c1b87308e89d9c7bedd7076">ROTATION_ROLL_180_YAW_90</a></div><div class="ttdeci">@ ROTATION_ROLL_180_YAW_90</div><div class="ttdef"><b>Definition</b> <a href="rotations_8h_source.html#l00038">rotations.h:38</a></div></div>
<div class="ttc" id="arotations_8h_html_a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a5d8b9c520b551d026df8d4aea2801294">ROTATION_YAW_270</a></div><div class="ttdeci">@ ROTATION_YAW_270</div><div class="ttdef"><b>Definition</b> <a href="rotations_8h_source.html#l00034">rotations.h:34</a></div></div>
<div class="ttc" id="arotations_8h_html_a67a250c97139a5466814a54c4aa4a681a869e0e4a85746c9248e03bb2f1ad0229"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a869e0e4a85746c9248e03bb2f1ad0229">ROTATION_PITCH_180_YAW_90</a></div><div class="ttdeci">@ ROTATION_PITCH_180_YAW_90</div><div class="ttdef"><b>Definition</b> <a href="rotations_8h_source.html#l00054">rotations.h:54</a></div></div>
<div class="ttc" id="arotations_8h_html_a67a250c97139a5466814a54c4aa4a681a90f75701d0b21bcb9d12826ac8cb4ef6"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a90f75701d0b21bcb9d12826ac8cb4ef6">ROTATION_PITCH_180_YAW_270</a></div><div class="ttdeci">@ ROTATION_PITCH_180_YAW_270</div><div class="ttdef"><b>Definition</b> <a href="rotations_8h_source.html#l00055">rotations.h:55</a></div></div>
<div class="ttc" id="arotations_8h_html_a67a250c97139a5466814a54c4aa4a681ad5347a011def1f02c6a2a7bf2b1fb780"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681ad5347a011def1f02c6a2a7bf2b1fb780">ROTATION_CUSTOM_2</a></div><div class="ttdeci">@ ROTATION_CUSTOM_2</div><div class="ttdef"><b>Definition</b> <a href="rotations_8h_source.html#l00081">rotations.h:81</a></div></div>
<div class="ttc" id="arotations_8h_html_a67a250c97139a5466814a54c4aa4a681ae7d6d0015028e041def96e2ba339bba7"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681ae7d6d0015028e041def96e2ba339bba7">ROTATION_CUSTOM_OLD</a></div><div class="ttdeci">@ ROTATION_CUSTOM_OLD</div><div class="ttdef"><b>Definition</b> <a href="rotations_8h_source.html#l00079">rotations.h:79</a></div></div>
<div class="ttc" id="arotations_8h_html_a67a250c97139a5466814a54c4aa4a681aeb81d9199def1f929a5e5798d37c49c5"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681aeb81d9199def1f929a5e5798d37c49c5">ROTATION_ROLL_180</a></div><div class="ttdeci">@ ROTATION_ROLL_180</div><div class="ttdef"><b>Definition</b> <a href="rotations_8h_source.html#l00036">rotations.h:36</a></div></div>
<div class="ttc" id="arotations_8h_html_a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681afae5b963b8902f5e5846a8929b9b74ba">ROTATION_YAW_90</a></div><div class="ttdeci">@ ROTATION_YAW_90</div><div class="ttdef"><b>Definition</b> <a href="rotations_8h_source.html#l00030">rotations.h:30</a></div></div>
<div class="ttc" id="astdio_8h_html"><div class="ttname"><a href="stdio_8h.html">stdio.h</a></div></div>
<div class="ttc" id="astdio_8h_html_a37c1e8ce8a2b411fa666dc33972a2cec"><div class="ttname"><a href="stdio_8h.html#a37c1e8ce8a2b411fa666dc33972a2cec">snprintf</a></div><div class="ttdeci">int snprintf(char *str, size_t size, const char *fmt,...)</div></div>
<div class="ttc" id="astructAP__Param_1_1ConversionInfo_html"><div class="ttname"><a href="structAP__Param_1_1ConversionInfo.html">AP_Param::ConversionInfo</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00225">AP_Param.h:225</a></div></div>
<div class="ttc" id="astructAP__Param_1_1ConversionInfo_html_a75ff5c9be71f27763a405bb41e0c0aff"><div class="ttname"><a href="structAP__Param_1_1ConversionInfo.html#a75ff5c9be71f27763a405bb41e0c0aff">AP_Param::ConversionInfo::old_key</a></div><div class="ttdeci">uint16_t old_key</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00226">AP_Param.h:226</a></div></div>
<div class="ttc" id="astructAP__Param_1_1ConversionInfo_html_ac734a9afbd723a353dd23e05006c8f90"><div class="ttname"><a href="structAP__Param_1_1ConversionInfo.html#ac734a9afbd723a353dd23e05006c8f90">AP_Param::ConversionInfo::old_group_element</a></div><div class="ttdeci">uint32_t old_group_element</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00227">AP_Param.h:227</a></div></div>
<div class="ttc" id="astructAP__Param_1_1ConversionInfo_html_aefe1f37268bb6e4cdb0920db26127a7f"><div class="ttname"><a href="structAP__Param_1_1ConversionInfo.html#aefe1f37268bb6e4cdb0920db26127a7f">AP_Param::ConversionInfo::type</a></div><div class="ttdeci">enum ap_var_type type</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00228">AP_Param.h:228</a></div></div>
<div class="ttc" id="astructAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00199">AP_Param.h:199</a></div></div>
<div class="ttc" id="astructCompass_1_1mag__state_html"><div class="ttname"><a href="structCompass_1_1mag__state.html">Compass::mag_state</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00533">AP_Compass.h:533</a></div></div>
<div class="ttc" id="astructCompass_1_1mag__state_html_a037376c09d0116a149c11cceac015c6a"><div class="ttname"><a href="structCompass_1_1mag__state.html#a037376c09d0116a149c11cceac015c6a">Compass::mag_state::orientation</a></div><div class="ttdeci">AP_Int8 orientation</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00538">AP_Compass.h:538</a></div></div>
<div class="ttc" id="astructCompass_1_1mag__state_html_a36f869627ba5bb5d3060aa8816e98f13"><div class="ttname"><a href="structCompass_1_1mag__state.html#a36f869627ba5bb5d3060aa8816e98f13">Compass::mag_state::scale_factor</a></div><div class="ttdeci">AP_Float scale_factor</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00544">AP_Compass.h:544</a></div></div>
<div class="ttc" id="astructCompass_1_1mag__state_html_a3e2ff88eb37ae470b4c1b4b3c232305e"><div class="ttname"><a href="structCompass_1_1mag__state.html#a3e2ff88eb37ae470b4c1b4b3c232305e">Compass::mag_state::offset</a></div><div class="ttdeci">AP_Vector3f offset</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00539">AP_Compass.h:539</a></div></div>
<div class="ttc" id="astructCompass_1_1mag__state_html_a4ac6e96bb0e028b4bad4faba7ecdb8c1"><div class="ttname"><a href="structCompass_1_1mag__state.html#a4ac6e96bb0e028b4bad4faba7ecdb8c1">Compass::mag_state::offdiagonals</a></div><div class="ttdeci">AP_Vector3f offdiagonals</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00542">AP_Compass.h:542</a></div></div>
<div class="ttc" id="astructCompass_1_1mag__state_html_a50dc445d1c9b8ed874a7a7d7054737d2"><div class="ttname"><a href="structCompass_1_1mag__state.html#a50dc445d1c9b8ed874a7a7d7054737d2">Compass::mag_state::diagonals</a></div><div class="ttdeci">AP_Vector3f diagonals</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00541">AP_Compass.h:541</a></div></div>
<div class="ttc" id="astructCompass_1_1mag__state_html_a5302e4e3e39eba5731acaf5185155287"><div class="ttname"><a href="structCompass_1_1mag__state.html#a5302e4e3e39eba5731acaf5185155287">Compass::mag_state::copy_from</a></div><div class="ttdeci">void copy_from(const mag_state &amp;state)</div><div class="ttdef"><b>Definition</b> <a href="#l00921">AP_Compass.cpp:921</a></div></div>
<div class="ttc" id="astructCompass_1_1mag__state_html_a6e1b66a2e77ea4c79a545bf1951e85a3"><div class="ttname"><a href="structCompass_1_1mag__state.html#a6e1b66a2e77ea4c79a545bf1951e85a3">Compass::mag_state::external</a></div><div class="ttdeci">AP_Int8 external</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00534">AP_Compass.h:534</a></div></div>
<div class="ttc" id="astructCompass_1_1mag__state_html_a90887b7c30ed529dc3fecfb36729f9d7"><div class="ttname"><a href="structCompass_1_1mag__state.html#a90887b7c30ed529dc3fecfb36729f9d7">Compass::mag_state::motor_compensation</a></div><div class="ttdeci">AP_Vector3f motor_compensation</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00556">AP_Compass.h:556</a></div></div>
<div class="ttc" id="astructCompass_1_1mag__state_html_ab31c41328588f72210c09ffee6e1e7bd"><div class="ttname"><a href="structCompass_1_1mag__state.html#ab31c41328588f72210c09ffee6e1e7bd">Compass::mag_state::expected_dev_id</a></div><div class="ttdeci">int32_t expected_dev_id</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00553">AP_Compass.h:553</a></div></div>
<div class="ttc" id="astructCompass_1_1mag__state_html_ad12e4054ec35030309b98a799e9f0df4"><div class="ttname"><a href="structCompass_1_1mag__state.html#ad12e4054ec35030309b98a799e9f0df4">Compass::mag_state::healthy</a></div><div class="ttdeci">bool healthy</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00535">AP_Compass.h:535</a></div></div>
<div class="ttc" id="astructCompass_1_1mag__state_html_ae481124101db4d2104091b1ddc0f4085"><div class="ttname"><a href="structCompass_1_1mag__state.html#ae481124101db4d2104091b1ddc0f4085">Compass::mag_state::detected_dev_id</a></div><div class="ttdeci">int32_t detected_dev_id</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00551">AP_Compass.h:551</a></div></div>
<div class="ttc" id="astructCompass_1_1mag__state_html_afe6deabcf507751cd66c36639bb9dde0"><div class="ttname"><a href="structCompass_1_1mag__state.html#afe6deabcf507751cd66c36639bb9dde0">Compass::mag_state::dev_id</a></div><div class="ttdeci">AP_Int32 dev_id</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8h_source.html#l00549">AP_Compass.h:549</a></div></div>
<div class="ttc" id="astructMSP_1_1PACKED_html"><div class="ttname"><a href="structMSP_1_1PACKED.html">MSP::PACKED</a></div><div class="ttdef"><b>Definition</b> <a href="msp_8h_source.html#l00095">msp.h:95</a></div></div>
<div class="ttc" id="astructMSP_1_1PACKED_html_a863be8e04d31a445030fe6100f587589"><div class="ttname"><a href="structMSP_1_1PACKED.html#a863be8e04d31a445030fe6100f587589">MSP::PACKED::instance</a></div><div class="ttdeci">uint8_t instance</div><div class="ttdef"><b>Definition</b> <a href="msp__sensors_8h_source.html#l00020">msp_sensors.h:20</a></div></div>
<div class="ttc" id="astructVector2_html"><div class="ttname"><a href="structVector2.html">Vector2&lt; float &gt;</a></div></div>
<div class="ttc" id="astructVector2_html_a90e5514bef75383f219b19d944c039f3"><div class="ttname"><a href="structVector2.html#a90e5514bef75383f219b19d944c039f3">Vector2::is_zero</a></div><div class="ttdeci">bool is_zero(void) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="vector2_8h_source.html#l00115">vector2.h:115</a></div></div>
<div class="ttc" id="astructVector2_html_aa5b16091858399424b79f7a580e4284e"><div class="ttname"><a href="structVector2.html#aa5b16091858399424b79f7a580e4284e">Vector2::angle</a></div><div class="ttdeci">T angle(const Vector2&lt; T &gt; &amp;v2) const</div><div class="ttdef"><b>Definition</b> <a href="vector2_8cpp_source.html#l00145">vector2.cpp:145</a></div></div>
<div class="ttc" id="atest__expandingstring__failure_8cpp_html_a86988a65e0d3ece7990c032c159786d6"><div class="ttname"><a href="test__expandingstring__failure_8cpp.html#a86988a65e0d3ece7990c032c159786d6">count</a></div><div class="ttdeci">static uint32_t count</div><div class="ttdef"><b>Definition</b> <a href="test__expandingstring__failure_8cpp_source.html#l00012">test_expandingstring_failure.cpp:12</a></div></div>
<div class="ttc" id="atest__magfield_8cpp_html_a3ba91122ce457819d940c04b8e436480"><div class="ttname"><a href="test__magfield_8cpp.html#a3ba91122ce457819d940c04b8e436480">field</a></div><div class="ttdeci">Vector3f field</div><div class="ttdef"><b>Definition</b> <a href="test__magfield_8cpp_source.html#l00011">test_magfield.cpp:11</a></div></div>
<div class="ttc" id="avector3_8h_html_af345ad77ba5e240c7ab72b4b2077e754"><div class="ttname"><a href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a></div><div class="ttdeci">Vector3&lt; float &gt; Vector3f</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00412">vector3.h:412</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 22 2024 16:14:13 for APM:Libraries by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
