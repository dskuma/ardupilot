<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APM:Libraries: libraries/AP_Rally/AP_Rally.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_a13c6ed4fd97de966b0386f9b4eb86c6.html">AP_Rally</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">AP_Rally.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="AP__Rally_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Rally__config_8h.html">AP_Rally_config.h</a>&quot;</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span> </div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="preprocessor">#if HAL_RALLY_ENABLED</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span> </div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#include &quot;<a class="code" href="AP__Rally_8h.html">AP_Rally.h</a>&quot;</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="preprocessor">#include &lt;<a class="code" href="AP__AHRS_8h.html">AP_AHRS/AP_AHRS.h</a>&gt;</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Logger_8h.html">AP_Logger/AP_Logger.h</a>&gt;</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="preprocessor">#include &lt;<a class="code" href="StorageManager_8h.html">StorageManager/StorageManager.h</a>&gt;</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Vehicle__Type_8h.html">AP_Vehicle/AP_Vehicle_Type.h</a>&gt;</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">// storage object</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><a class="code hl_class" href="classStorageAccess.html">StorageAccess</a> <a class="code hl_variable" href="classAP__Rally.html#a1712d3afc63c3815dfc08543d07c24ad">AP_Rally::_storage</a>(<a class="code hl_enumvalue" href="classStorageManager.html#a8a47a036f4478b1631984c9577d73a46a42e46109d6193f717d28cbc3c5f40c14">StorageManager::StorageRally</a>);</div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span> </div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#if APM_BUILD_COPTER_OR_HELI</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">  #define RALLY_LIMIT_KM_DEFAULT 0.3f</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">  #define RALLY_INCLUDE_HOME_DEFAULT 1</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#elif APM_BUILD_TYPE(APM_BUILD_ArduPlane)</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">  #define RALLY_LIMIT_KM_DEFAULT 5.0f</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">  #define RALLY_INCLUDE_HOME_DEFAULT 0</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#elif APM_BUILD_TYPE(APM_BUILD_Rover)</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">  #define RALLY_LIMIT_KM_DEFAULT 0.5f</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">  #define RALLY_INCLUDE_HOME_DEFAULT 1</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno"><a class="line" href="AP__Rally_8cpp.html#a9090efafdd1cacb7aa5646da3ef2bee0">   25</a></span><span class="preprocessor">  #define RALLY_LIMIT_KM_DEFAULT 1.0f</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno"><a class="line" href="AP__Rally_8cpp.html#a6cf8535f6d897b3dadefb50cf2d61e8a">   26</a></span><span class="preprocessor">  #define RALLY_INCLUDE_HOME_DEFAULT 0</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span> </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="keyword">const</span> <a class="code hl_struct" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code hl_variable" href="classAP__Rally.html#a906e63c18a936240cb1f85563e9ee9df">AP_Rally::var_info</a>[] = {</div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>    <span class="comment">// @Param: TOTAL</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>    <span class="comment">// @DisplayName: Rally Total</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>    <span class="comment">// @Description: Number of rally points currently loaded</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TOTAL&quot;</span>, 0, <a class="code hl_class" href="classAP__Rally.html">AP_Rally</a>, _rally_point_total_count, 0),</div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span> </div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span>    <span class="comment">// @Param: LIMIT_KM</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>    <span class="comment">// @DisplayName: Rally Limit</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    <span class="comment">// @Description: Maximum distance to rally point. If the closest rally point is more than this number of kilometers from the current position and the home location is closer than any of the rally points from the current position then do RTL to home rather than to the closest rally point. This prevents a leftover rally point from a different airfield being used accidentally. If this is set to 0 then the closest rally point is always used.</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    <span class="comment">// @Units: km</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LIMIT_KM&quot;</span>, 1, <a class="code hl_class" href="classAP__Rally.html">AP_Rally</a>, _rally_limit_km, <a class="code hl_define" href="AP__Rally_8cpp.html#a9090efafdd1cacb7aa5646da3ef2bee0">RALLY_LIMIT_KM_DEFAULT</a>),</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span> </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>    <span class="comment">// @Param: INCL_HOME</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>    <span class="comment">// @DisplayName: Rally Include Home</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    <span class="comment">// @Description: Controls if Home is included as a Rally point (i.e. as a safe landing place) for RTL</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>    <span class="comment">// @Values: 0:DoNotIncludeHome,1:IncludeHome</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;INCL_HOME&quot;</span>, 2, <a class="code hl_class" href="classAP__Rally.html">AP_Rally</a>, _rally_incl_home, <a class="code hl_define" href="AP__Rally_8cpp.html#a6cf8535f6d897b3dadefb50cf2d61e8a">RALLY_INCLUDE_HOME_DEFAULT</a>),</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span> </div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    <a class="code hl_define" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>};</div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span> </div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="comment">// constructor</span></div>
<div class="foldopen" id="foldopen00055" data-start="{" data-end="}">
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno"><a class="line" href="classAP__Rally.html#a2b1d9a21a9c805031bafda8957a78c89">   55</a></span><a class="code hl_function" href="classAP__Rally.html#a2b1d9a21a9c805031bafda8957a78c89">AP_Rally::AP_Rally</a>()</div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>{</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>    <a class="code hl_define" href="AP__Common_8h.html#a4e0f819d3251024b04630efbf118b524">ASSERT_STORAGE_SIZE</a>(<a class="code hl_struct" href="structRallyLocation.html">RallyLocation</a>, 15);</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span> </div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span><span class="preprocessor">#if CONFIG_HAL_BOARD == HAL_BOARD_SITL</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__Rally.html#a0cb8f360c5561331a0300dc01142a065">_singleton</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>        <a class="code hl_function" href="namespaceAP__HAL.html#a52edeef7d5ffaa365e1229b87c170307">AP_HAL::panic</a>(<span class="stringliteral">&quot;Rally must be singleton&quot;</span>);</div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    }</div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    <a class="code hl_variable" href="classAP__Rally.html#a0cb8f360c5561331a0300dc01142a065">_singleton</a> = <span class="keyword">this</span>;</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    <a class="code hl_function" href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a>(<span class="keyword">this</span>, var_info);</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>}</div>
</div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span> </div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span><span class="comment">// get a rally point from EEPROM</span></div>
<div class="foldopen" id="foldopen00069" data-start="{" data-end="}">
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno"><a class="line" href="classAP__Rally.html#a728713781ee97d3d18aa3e6a798e21e6">   69</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__Rally.html#a728713781ee97d3d18aa3e6a798e21e6">AP_Rally::get_rally_point_with_index</a>(uint8_t i, <a class="code hl_struct" href="structRallyLocation.html">RallyLocation</a> &amp;ret)<span class="keyword"> const</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <span class="keywordflow">if</span> (i &gt;= (uint8_t) <a class="code hl_variable" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>) {</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    }</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span> </div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    <a class="code hl_variable" href="classAP__Rally.html#a1712d3afc63c3815dfc08543d07c24ad">_storage</a>.<a class="code hl_function" href="classStorageAccess.html#abb169f592c849f2158a48615c8dee90a">read_block</a>(&amp;ret, i * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structRallyLocation.html">RallyLocation</a>), <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structRallyLocation.html">RallyLocation</a>));</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span> </div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    <span class="keywordflow">if</span> (ret.<a class="code hl_variable" href="structRallyLocation.html#aaaabfdf90e21cefd9dbeb234c7a5e251">lat</a> == 0 &amp;&amp; ret.<a class="code hl_variable" href="structRallyLocation.html#a8227727c3c6fa6ef6739525c0a14bfb1">lng</a> == 0) {</div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// sanity check</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    }</div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span> </div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>; </div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>}</div>
</div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span> </div>
<div class="foldopen" id="foldopen00084" data-start="{" data-end="}">
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno"><a class="line" href="classAP__Rally.html#af9320c7dfb7d74a430cc6b00962981ed">   84</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__Rally.html#af9320c7dfb7d74a430cc6b00962981ed">AP_Rally::truncate</a>(uint8_t num)</div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>{</div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    <span class="keywordflow">if</span> (num &gt; <a class="code hl_variable" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>) {</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>        <span class="comment">// we never make the space larger this way</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    }</div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <a class="code hl_variable" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>.set_and_save_ifchanged(num);</div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>}</div>
</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span> </div>
<div class="foldopen" id="foldopen00093" data-start="{" data-end="}">
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno"><a class="line" href="classAP__Rally.html#a4659da1b7d085328ace76c58135d4795">   93</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__Rally.html#a4659da1b7d085328ace76c58135d4795">AP_Rally::append</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structRallyLocation.html">RallyLocation</a> &amp;loc)</div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>{</div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <span class="keyword">const</span> uint8_t current_total = <a class="code hl_function" href="classAP__Rally.html#ae6419c289bb0f42d3db189f415d7d9d6">get_rally_total</a>();</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    <a class="code hl_variable" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>.set_and_save_ifchanged(current_total + 1);</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__Rally.html#a7d931e38aad349dec7ef42965f8d6a60">set_rally_point_with_index</a>(current_total, loc)) {</div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>        <a class="code hl_variable" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>.set_and_save_ifchanged(current_total);</div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    }</div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>}</div>
</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span><span class="comment">// save a rally point to EEPROM - this assumes that the RALLY_TOTAL param has been incremented beforehand, which is the case in Mission Planner</span></div>
<div class="foldopen" id="foldopen00105" data-start="{" data-end="}">
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno"><a class="line" href="classAP__Rally.html#a7d931e38aad349dec7ef42965f8d6a60">  105</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__Rally.html#a7d931e38aad349dec7ef42965f8d6a60">AP_Rally::set_rally_point_with_index</a>(uint8_t i, <span class="keyword">const</span> <a class="code hl_struct" href="structRallyLocation.html">RallyLocation</a> &amp;rallyLoc)</div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>{</div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>    <span class="keywordflow">if</span> (i &gt;= (uint8_t) <a class="code hl_variable" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>) {</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    }</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span> </div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    <span class="keywordflow">if</span> (i &gt;= <a class="code hl_function" href="classAP__Rally.html#aa75859b78d62d8bf981337ee7baadd3f">get_rally_max</a>()) {</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    }</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span> </div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    <a class="code hl_variable" href="classAP__Rally.html#a1712d3afc63c3815dfc08543d07c24ad">_storage</a>.<a class="code hl_function" href="classStorageAccess.html#a926243785eeb37f394e3abb352715186">write_block</a>(i * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structRallyLocation.html">RallyLocation</a>), &amp;rallyLoc, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structRallyLocation.html">RallyLocation</a>));</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span> </div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    <a class="code hl_variable" href="classAP__Rally.html#a44f72c79ead390458f8dee9d0d4ca458">_last_change_time_ms</a> = <a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span> </div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span><span class="preprocessor">#if HAL_LOGGING_ENABLED</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    <a class="code hl_function" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().<a class="code hl_function" href="classAP__Logger.html#ac2afa33737683a342ab688efffdd0e4b">Write_RallyPoint</a>(<a class="code hl_variable" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>, i, rallyLoc);</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span> </div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>}</div>
</div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span> </div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span><span class="comment">// helper function to translate a RallyLocation to a Location</span></div>
<div class="foldopen" id="foldopen00127" data-start="{" data-end="}">
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno"><a class="line" href="classAP__Rally.html#ad0fa2bf50adadcd2c32aa2da3a08d2ef">  127</a></span><a class="code hl_class" href="classLocation.html">Location</a> <a class="code hl_function" href="classAP__Rally.html#ad0fa2bf50adadcd2c32aa2da3a08d2ef">AP_Rally::rally_location_to_location</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structRallyLocation.html">RallyLocation</a> &amp;rally_loc)<span class="keyword"> const</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    <span class="comment">//Relative altitudes are relative to HOME point&#39;s altitude:</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    <a class="code hl_class" href="classLocation.html">Location</a> ret {</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>        rally_loc.<a class="code hl_variable" href="structRallyLocation.html#aaaabfdf90e21cefd9dbeb234c7a5e251">lat</a>,</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>        rally_loc.<a class="code hl_variable" href="structRallyLocation.html#a8227727c3c6fa6ef6739525c0a14bfb1">lng</a>,</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>        rally_loc.<a class="code hl_variable" href="structRallyLocation.html#adfdbf88bff5056e7c569909ba7ff67f5">alt</a> * 100,</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>        (rally_loc.<a class="code hl_variable" href="structRallyLocation.html#aa10420406f82765e752ae7e749c8e68a">alt_frame_valid</a> == 1) ? <a class="code hl_enumeration" href="classLocation.html#af494dabb88cd43e0d4efa99f04d31351">Location::AltFrame</a>(rally_loc.<a class="code hl_variable" href="structRallyLocation.html#a64921f3d4c134f6c7b662559fc901e38">alt_frame</a>) : <a class="code hl_enumvalue" href="classLocation.html#af494dabb88cd43e0d4efa99f04d31351adc2241348a103ecefcef66579c80336f">Location::AltFrame::ABOVE_HOME</a></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    };</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span> </div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>}</div>
</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span> </div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span><span class="comment">// returns true if a valid rally point is found, otherwise returns false to indicate home position should be used</span></div>
<div class="foldopen" id="foldopen00141" data-start="{" data-end="}">
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno"><a class="line" href="classAP__Rally.html#a599a1cba7da15f1be6178ea19ee47541">  141</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__Rally.html#a599a1cba7da15f1be6178ea19ee47541">AP_Rally::find_nearest_rally_point</a>(<span class="keyword">const</span> <a class="code hl_class" href="classLocation.html">Location</a> &amp;current_loc, <a class="code hl_struct" href="structRallyLocation.html">RallyLocation</a> &amp;return_loc)<span class="keyword"> const</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    <span class="keywordtype">float</span> min_dis = -1;</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span> </div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; (uint8_t) <a class="code hl_variable" href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">_rally_point_total_count</a>; i++) {</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>        <a class="code hl_struct" href="structRallyLocation.html">RallyLocation</a> next_rally;</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__Rally.html#a728713781ee97d3d18aa3e6a798e21e6">get_rally_point_with_index</a>(i, next_rally)) {</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>        }</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>        <a class="code hl_class" href="classLocation.html">Location</a> rally_loc = <a class="code hl_function" href="classAP__Rally.html#ad0fa2bf50adadcd2c32aa2da3a08d2ef">rally_location_to_location</a>(next_rally);</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>        <span class="keywordtype">float</span> dis = current_loc.<a class="code hl_function" href="classLocation.html#a4365e0555609b7ad249a9cd6f1f828c2">get_distance</a>(rally_loc);</div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span> </div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__Rally.html#a1663d1947b69eb467541366951385ef9">is_valid</a>(rally_loc) &amp;&amp; (dis &lt; min_dis || min_dis &lt; 0)) {</div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>            min_dis = dis;</div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>            return_loc = next_rally;</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>        }</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    }</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    <span class="comment">// if a limit is defined and all rally points are beyond that limit, use home if it is closer</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__Rally.html#a4c33c19632fe49df12ed4cfdf55e35e9">_rally_limit_km</a> &gt; 0) &amp;&amp; (min_dis &gt; <a class="code hl_variable" href="classAP__Rally.html#a4c33c19632fe49df12ed4cfdf55e35e9">_rally_limit_km</a>*1000.0f)) {</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// use home position</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    }</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span> </div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    <span class="comment">// use home if no rally points found</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    <span class="keywordflow">return</span> min_dis &gt;= 0;</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>}</div>
</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span> </div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span><span class="comment">// return best RTL location from current position</span></div>
<div class="foldopen" id="foldopen00169" data-start="{" data-end="}">
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno"><a class="line" href="classAP__Rally.html#a36ab65141aa3561122592001a3c51389">  169</a></span><a class="code hl_class" href="classLocation.html">Location</a> <a class="code hl_function" href="classAP__Rally.html#a36ab65141aa3561122592001a3c51389">AP_Rally::calc_best_rally_or_home_location</a>(<span class="keyword">const</span> <a class="code hl_class" href="classLocation.html">Location</a> &amp;current_loc, <span class="keywordtype">float</span> rtl_home_alt_amsl_cm)<span class="keyword"> const</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <span class="comment">// if no valid rally point, return home position:</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    <a class="code hl_class" href="classLocation.html">Location</a> return_loc { <a class="code hl_function" href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a>().<a class="code hl_function" href="classAP__AHRS.html#a8c6d86329f149416dd092d873345bc7f">get_home</a>() };</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    return_loc.<a class="code hl_function" href="classLocation.html#a42ff316c00ff41841042c65521a44944">set_alt_cm</a>(rtl_home_alt_amsl_cm, <a class="code hl_enumvalue" href="classLocation.html#af494dabb88cd43e0d4efa99f04d31351a3a0bc063b6db8cae0361657958be836f">Location::AltFrame::ABSOLUTE</a>);</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span> </div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    <a class="code hl_struct" href="structRallyLocation.html">RallyLocation</a> ral_loc;</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__Rally.html#a599a1cba7da15f1be6178ea19ee47541">find_nearest_rally_point</a>(current_loc, ral_loc)) {</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        <a class="code hl_class" href="classLocation.html">Location</a> loc = <a class="code hl_function" href="classAP__Rally.html#ad0fa2bf50adadcd2c32aa2da3a08d2ef">rally_location_to_location</a>(ral_loc);</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>        <span class="comment">// use the rally point if it&#39;s closer then home, or we aren&#39;t generally considering home as acceptable</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__Rally.html#a254081bd2be797fea7ce7308503d9d88">_rally_incl_home</a>  || (current_loc.<a class="code hl_function" href="classLocation.html#a4365e0555609b7ad249a9cd6f1f828c2">get_distance</a>(loc) &lt; current_loc.<a class="code hl_function" href="classLocation.html#a4365e0555609b7ad249a9cd6f1f828c2">get_distance</a>(return_loc))) {</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>            return_loc = <a class="code hl_function" href="classAP__Rally.html#ad0fa2bf50adadcd2c32aa2da3a08d2ef">rally_location_to_location</a>(ral_loc);</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>        }</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    }</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <span class="keywordflow">return</span> return_loc;</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>}</div>
</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span> </div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span><span class="comment">// singleton instance</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span><a class="code hl_class" href="classAP__Rally.html">AP_Rally</a> *<a class="code hl_variable" href="classAP__Rally.html#a0cb8f360c5561331a0300dc01142a065">AP_Rally::_singleton</a>;</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span> </div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceAP.html">AP</a> {</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span> </div>
<div class="foldopen" id="foldopen00192" data-start="{" data-end="}">
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno"><a class="line" href="namespaceAP.html#ae87744fcd7073579dee4ddbf9d32239e">  192</a></span><a class="code hl_class" href="classAP__Rally.html">AP_Rally</a> *<a class="code hl_function" href="namespaceAP.html#ae87744fcd7073579dee4ddbf9d32239e">rally</a>()</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>{</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classAP__Rally.html#a7f455861d64f4610fa118323095f7fe1">AP_Rally::get_singleton</a>();</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>}</div>
</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span> </div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>}</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span><span class="preprocessor">#endif </span><span class="comment">//HAL_RALLY_ENABLED</span></div>
<div class="ttc" id="aAP__AHRS_8h_html"><div class="ttname"><a href="AP__AHRS_8h.html">AP_AHRS.h</a></div></div>
<div class="ttc" id="aAP__Common_8h_html_a4e0f819d3251024b04630efbf118b524"><div class="ttname"><a href="AP__Common_8h.html#a4e0f819d3251024b04630efbf118b524">ASSERT_STORAGE_SIZE</a></div><div class="ttdeci">#define ASSERT_STORAGE_SIZE(structure, size)</div><div class="ttdef"><b>Definition</b> <a href="AP__Common_8h_source.html#l00147">AP_Common.h:147</a></div></div>
<div class="ttc" id="aAP__Logger_8h_html"><div class="ttname"><a href="AP__Logger_8h.html">AP_Logger.h</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00163">AP_Param.h:163</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a78a408c84f2a1bafde256ac650142e4d"><div class="ttname"><a href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, clazz, element, def)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00145">AP_Param.h:145</a></div></div>
<div class="ttc" id="aAP__Rally_8cpp_html_a6cf8535f6d897b3dadefb50cf2d61e8a"><div class="ttname"><a href="AP__Rally_8cpp.html#a6cf8535f6d897b3dadefb50cf2d61e8a">RALLY_INCLUDE_HOME_DEFAULT</a></div><div class="ttdeci">#define RALLY_INCLUDE_HOME_DEFAULT</div><div class="ttdef"><b>Definition</b> <a href="#l00026">AP_Rally.cpp:26</a></div></div>
<div class="ttc" id="aAP__Rally_8cpp_html_a9090efafdd1cacb7aa5646da3ef2bee0"><div class="ttname"><a href="AP__Rally_8cpp.html#a9090efafdd1cacb7aa5646da3ef2bee0">RALLY_LIMIT_KM_DEFAULT</a></div><div class="ttdeci">#define RALLY_LIMIT_KM_DEFAULT</div><div class="ttdef"><b>Definition</b> <a href="#l00025">AP_Rally.cpp:25</a></div></div>
<div class="ttc" id="aAP__Rally_8h_html"><div class="ttname"><a href="AP__Rally_8h.html">AP_Rally.h</a></div><div class="ttdoc">Handles rally point storage, retrieval and lookup.</div></div>
<div class="ttc" id="aAP__Rally__config_8h_html"><div class="ttname"><a href="AP__Rally__config_8h.html">AP_Rally_config.h</a></div></div>
<div class="ttc" id="aAP__Vehicle__Type_8h_html"><div class="ttname"><a href="AP__Vehicle__Type_8h.html">AP_Vehicle_Type.h</a></div></div>
<div class="ttc" id="aStorageManager_8h_html"><div class="ttname"><a href="StorageManager_8h.html">StorageManager.h</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a8c6d86329f149416dd092d873345bc7f"><div class="ttname"><a href="classAP__AHRS.html#a8c6d86329f149416dd092d873345bc7f">AP_AHRS::get_home</a></div><div class="ttdeci">const Location &amp; get_home(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00524">AP_AHRS.h:524</a></div></div>
<div class="ttc" id="aclassAP__Logger_html_ac2afa33737683a342ab688efffdd0e4b"><div class="ttname"><a href="classAP__Logger.html#ac2afa33737683a342ab688efffdd0e4b">AP_Logger::Write_RallyPoint</a></div><div class="ttdeci">void Write_RallyPoint(uint8_t total, uint8_t sequence, const class RallyLocation &amp;rally_point)</div></div>
<div class="ttc" id="aclassAP__Param_html_a5f6dcfce1c0a79cf5bd81283e22f3201"><div class="ttname"><a href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a></div><div class="ttdeci">static void setup_object_defaults(const void *object_pointer, const struct GroupInfo *group_info)</div><div class="ttdef"><b>Definition</b> <a href="main_8cpp_source.html#l00010">main.cpp:10</a></div></div>
<div class="ttc" id="aclassAP__Rally_html"><div class="ttname"><a href="classAP__Rally.html">AP_Rally</a></div><div class="ttdoc">Object managing Rally Points.</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00047">AP_Rally.h:47</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a0cb8f360c5561331a0300dc01142a065"><div class="ttname"><a href="classAP__Rally.html#a0cb8f360c5561331a0300dc01142a065">AP_Rally::_singleton</a></div><div class="ttdeci">static AP_Rally * _singleton</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00091">AP_Rally.h:91</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a1663d1947b69eb467541366951385ef9"><div class="ttname"><a href="classAP__Rally.html#a1663d1947b69eb467541366951385ef9">AP_Rally::is_valid</a></div><div class="ttdeci">virtual bool is_valid(const Location &amp;rally_point) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00093">AP_Rally.h:93</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a1712d3afc63c3815dfc08543d07c24ad"><div class="ttname"><a href="classAP__Rally.html#a1712d3afc63c3815dfc08543d07c24ad">AP_Rally::_storage</a></div><div class="ttdeci">static StorageAccess _storage</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00095">AP_Rally.h:95</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a254081bd2be797fea7ce7308503d9d88"><div class="ttname"><a href="classAP__Rally.html#a254081bd2be797fea7ce7308503d9d88">AP_Rally::_rally_incl_home</a></div><div class="ttdeci">AP_Int8 _rally_incl_home</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00100">AP_Rally.h:100</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a2b1d9a21a9c805031bafda8957a78c89"><div class="ttname"><a href="classAP__Rally.html#a2b1d9a21a9c805031bafda8957a78c89">AP_Rally::AP_Rally</a></div><div class="ttdeci">AP_Rally()</div><div class="ttdef"><b>Definition</b> <a href="#l00055">AP_Rally.cpp:55</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a36ab65141aa3561122592001a3c51389"><div class="ttname"><a href="classAP__Rally.html#a36ab65141aa3561122592001a3c51389">AP_Rally::calc_best_rally_or_home_location</a></div><div class="ttdeci">Location calc_best_rally_or_home_location(const Location &amp;current_loc, float rtl_home_alt_amsl_cm) const</div><div class="ttdef"><b>Definition</b> <a href="#l00169">AP_Rally.cpp:169</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a44f72c79ead390458f8dee9d0d4ca458"><div class="ttname"><a href="classAP__Rally.html#a44f72c79ead390458f8dee9d0d4ca458">AP_Rally::_last_change_time_ms</a></div><div class="ttdeci">uint32_t _last_change_time_ms</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00102">AP_Rally.h:102</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a4659da1b7d085328ace76c58135d4795"><div class="ttname"><a href="classAP__Rally.html#a4659da1b7d085328ace76c58135d4795">AP_Rally::append</a></div><div class="ttdeci">bool append(const RallyLocation &amp;loc) WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l00093">AP_Rally.cpp:93</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a4c33c19632fe49df12ed4cfdf55e35e9"><div class="ttname"><a href="classAP__Rally.html#a4c33c19632fe49df12ed4cfdf55e35e9">AP_Rally::_rally_limit_km</a></div><div class="ttdeci">AP_Float _rally_limit_km</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00099">AP_Rally.h:99</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a599a1cba7da15f1be6178ea19ee47541"><div class="ttname"><a href="classAP__Rally.html#a599a1cba7da15f1be6178ea19ee47541">AP_Rally::find_nearest_rally_point</a></div><div class="ttdeci">bool find_nearest_rally_point(const Location &amp;myloc, RallyLocation &amp;ret) const</div><div class="ttdef"><b>Definition</b> <a href="#l00141">AP_Rally.cpp:141</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a728713781ee97d3d18aa3e6a798e21e6"><div class="ttname"><a href="classAP__Rally.html#a728713781ee97d3d18aa3e6a798e21e6">AP_Rally::get_rally_point_with_index</a></div><div class="ttdeci">bool get_rally_point_with_index(uint8_t i, RallyLocation &amp;ret) const</div><div class="ttdef"><b>Definition</b> <a href="#l00069">AP_Rally.cpp:69</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a7d931e38aad349dec7ef42965f8d6a60"><div class="ttname"><a href="classAP__Rally.html#a7d931e38aad349dec7ef42965f8d6a60">AP_Rally::set_rally_point_with_index</a></div><div class="ttdeci">bool set_rally_point_with_index(uint8_t i, const RallyLocation &amp;rallyLoc)</div><div class="ttdef"><b>Definition</b> <a href="#l00105">AP_Rally.cpp:105</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a7df46c782c4d221590d48b720b9f6457"><div class="ttname"><a href="classAP__Rally.html#a7df46c782c4d221590d48b720b9f6457">AP_Rally::_rally_point_total_count</a></div><div class="ttdeci">AP_Int8 _rally_point_total_count</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00098">AP_Rally.h:98</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a7f455861d64f4610fa118323095f7fe1"><div class="ttname"><a href="classAP__Rally.html#a7f455861d64f4610fa118323095f7fe1">AP_Rally::get_singleton</a></div><div class="ttdeci">static AP_Rally * get_singleton()</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00087">AP_Rally.h:87</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_a906e63c18a936240cb1f85563e9ee9df"><div class="ttname"><a href="classAP__Rally.html#a906e63c18a936240cb1f85563e9ee9df">AP_Rally::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00029">AP_Rally.h:29</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_aa75859b78d62d8bf981337ee7baadd3f"><div class="ttname"><a href="classAP__Rally.html#aa75859b78d62d8bf981337ee7baadd3f">AP_Rally::get_rally_max</a></div><div class="ttdeci">uint8_t get_rally_max(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00060">AP_Rally.h:60</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_ad0fa2bf50adadcd2c32aa2da3a08d2ef"><div class="ttname"><a href="classAP__Rally.html#ad0fa2bf50adadcd2c32aa2da3a08d2ef">AP_Rally::rally_location_to_location</a></div><div class="ttdeci">Location rally_location_to_location(const RallyLocation &amp;ret) const</div><div class="ttdef"><b>Definition</b> <a href="#l00127">AP_Rally.cpp:127</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_ae6419c289bb0f42d3db189f415d7d9d6"><div class="ttname"><a href="classAP__Rally.html#ae6419c289bb0f42d3db189f415d7d9d6">AP_Rally::get_rally_total</a></div><div class="ttdeci">uint8_t get_rally_total() const</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00057">AP_Rally.h:57</a></div></div>
<div class="ttc" id="aclassAP__Rally_html_af9320c7dfb7d74a430cc6b00962981ed"><div class="ttname"><a href="classAP__Rally.html#af9320c7dfb7d74a430cc6b00962981ed">AP_Rally::truncate</a></div><div class="ttdeci">void truncate(uint8_t num)</div><div class="ttdef"><b>Definition</b> <a href="#l00084">AP_Rally.cpp:84</a></div></div>
<div class="ttc" id="aclassLocation_html"><div class="ttname"><a href="classLocation.html">Location</a></div><div class="ttdef"><b>Definition</b> <a href="Location_8h_source.html#l00007">Location.h:8</a></div></div>
<div class="ttc" id="aclassLocation_html_a42ff316c00ff41841042c65521a44944"><div class="ttname"><a href="classLocation.html#a42ff316c00ff41841042c65521a44944">Location::set_alt_cm</a></div><div class="ttdeci">void set_alt_cm(int32_t alt_cm, AltFrame frame)</div><div class="ttdef"><b>Definition</b> <a href="Location_8cpp_source.html#l00057">Location.cpp:57</a></div></div>
<div class="ttc" id="aclassLocation_html_a4365e0555609b7ad249a9cd6f1f828c2"><div class="ttname"><a href="classLocation.html#a4365e0555609b7ad249a9cd6f1f828c2">Location::get_distance</a></div><div class="ttdeci">ftype get_distance(const Location &amp;loc2) const</div><div class="ttdef"><b>Definition</b> <a href="Location_8cpp_source.html#l00244">Location.cpp:244</a></div></div>
<div class="ttc" id="aclassLocation_html_af494dabb88cd43e0d4efa99f04d31351"><div class="ttname"><a href="classLocation.html#af494dabb88cd43e0d4efa99f04d31351">Location::AltFrame</a></div><div class="ttdeci">AltFrame</div><div class="ttdoc">enumeration of possible altitude types</div><div class="ttdef"><b>Definition</b> <a href="Location_8h_source.html#l00023">Location.h:23</a></div></div>
<div class="ttc" id="aclassLocation_html_af494dabb88cd43e0d4efa99f04d31351a3a0bc063b6db8cae0361657958be836f"><div class="ttname"><a href="classLocation.html#af494dabb88cd43e0d4efa99f04d31351a3a0bc063b6db8cae0361657958be836f">Location::AltFrame::ABSOLUTE</a></div><div class="ttdeci">@ ABSOLUTE</div></div>
<div class="ttc" id="aclassLocation_html_af494dabb88cd43e0d4efa99f04d31351adc2241348a103ecefcef66579c80336f"><div class="ttname"><a href="classLocation.html#af494dabb88cd43e0d4efa99f04d31351adc2241348a103ecefcef66579c80336f">Location::AltFrame::ABOVE_HOME</a></div><div class="ttdeci">@ ABOVE_HOME</div></div>
<div class="ttc" id="aclassStorageAccess_html"><div class="ttname"><a href="classStorageAccess.html">StorageAccess</a></div><div class="ttdef"><b>Definition</b> <a href="StorageManager_8h_source.html#l00091">StorageManager.h:91</a></div></div>
<div class="ttc" id="aclassStorageAccess_html_a926243785eeb37f394e3abb352715186"><div class="ttname"><a href="classStorageAccess.html#a926243785eeb37f394e3abb352715186">StorageAccess::write_block</a></div><div class="ttdeci">bool write_block(uint16_t dst, const void *src, size_t n) const</div><div class="ttdef"><b>Definition</b> <a href="StorageManager_8cpp_source.html#l00193">StorageManager.cpp:193</a></div></div>
<div class="ttc" id="aclassStorageAccess_html_abb169f592c849f2158a48615c8dee90a"><div class="ttname"><a href="classStorageAccess.html#abb169f592c849f2158a48615c8dee90a">StorageAccess::read_block</a></div><div class="ttdeci">bool read_block(void *dst, uint16_t src, size_t n) const</div><div class="ttdef"><b>Definition</b> <a href="StorageManager_8cpp_source.html#l00139">StorageManager.cpp:139</a></div></div>
<div class="ttc" id="aclassStorageManager_html_a8a47a036f4478b1631984c9577d73a46a42e46109d6193f717d28cbc3c5f40c14"><div class="ttname"><a href="classStorageManager.html#a8a47a036f4478b1631984c9577d73a46a42e46109d6193f717d28cbc3c5f40c14">StorageManager::StorageRally</a></div><div class="ttdeci">@ StorageRally</div><div class="ttdef"><b>Definition</b> <a href="StorageManager_8h_source.html#l00057">StorageManager.h:57</a></div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a52edeef7d5ffaa365e1229b87c170307"><div class="ttname"><a href="namespaceAP__HAL.html#a52edeef7d5ffaa365e1229b87c170307">AP_HAL::panic</a></div><div class="ttdeci">void panic(const char *errormsg,...) FMT_PRINTF(1</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2system_8cpp_source.html#l00327">system.cpp:327</a></div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a77dffbb18891996280308e21316ec186"><div class="ttname"><a href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a></div><div class="ttdeci">uint32_t millis()</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2system_8cpp_source.html#l00377">system.cpp:377</a></div></div>
<div class="ttc" id="anamespaceAP_html"><div class="ttname"><a href="namespaceAP.html">AP</a></div><div class="ttdef"><b>Definition</b> <a href="AC__Avoid_8cpp_source.html#l01481">AC_Avoid.cpp:1481</a></div></div>
<div class="ttc" id="anamespaceAP_html_a99432cfdb696952c9b7146f155a815aa"><div class="ttname"><a href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a></div><div class="ttdeci">AP_AHRS &amp; ahrs()</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8cpp_source.html#l03558">AP_AHRS.cpp:3558</a></div></div>
<div class="ttc" id="anamespaceAP_html_aa35bfac1ea2da16f110e8e72db7b3b20"><div class="ttname"><a href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a></div><div class="ttdeci">AP_Logger &amp; logger()</div><div class="ttdef"><b>Definition</b> <a href="AP__Logger_8cpp_source.html#l01740">AP_Logger.cpp:1740</a></div></div>
<div class="ttc" id="anamespaceAP_html_ae87744fcd7073579dee4ddbf9d32239e"><div class="ttname"><a href="namespaceAP.html#ae87744fcd7073579dee4ddbf9d32239e">AP::rally</a></div><div class="ttdeci">AP_Rally * rally()</div><div class="ttdef"><b>Definition</b> <a href="#l00192">AP_Rally.cpp:192</a></div></div>
<div class="ttc" id="astructAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00199">AP_Param.h:199</a></div></div>
<div class="ttc" id="astructRallyLocation_html"><div class="ttname"><a href="structRallyLocation.html">RallyLocation</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00027">AP_Rally.h:27</a></div></div>
<div class="ttc" id="astructRallyLocation_html_a64921f3d4c134f6c7b662559fc901e38"><div class="ttname"><a href="structRallyLocation.html#a64921f3d4c134f6c7b662559fc901e38">RallyLocation::alt_frame</a></div><div class="ttdeci">uint8_t alt_frame</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00039">AP_Rally.h:39</a></div></div>
<div class="ttc" id="astructRallyLocation_html_a8227727c3c6fa6ef6739525c0a14bfb1"><div class="ttname"><a href="structRallyLocation.html#a8227727c3c6fa6ef6739525c0a14bfb1">RallyLocation::lng</a></div><div class="ttdeci">int32_t lng</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00029">AP_Rally.h:29</a></div></div>
<div class="ttc" id="astructRallyLocation_html_aa10420406f82765e752ae7e749c8e68a"><div class="ttname"><a href="structRallyLocation.html#aa10420406f82765e752ae7e749c8e68a">RallyLocation::alt_frame_valid</a></div><div class="ttdeci">uint8_t alt_frame_valid</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00038">AP_Rally.h:38</a></div></div>
<div class="ttc" id="astructRallyLocation_html_aaaabfdf90e21cefd9dbeb234c7a5e251"><div class="ttname"><a href="structRallyLocation.html#aaaabfdf90e21cefd9dbeb234c7a5e251">RallyLocation::lat</a></div><div class="ttdeci">int32_t lat</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00028">AP_Rally.h:28</a></div></div>
<div class="ttc" id="astructRallyLocation_html_adfdbf88bff5056e7c569909ba7ff67f5"><div class="ttname"><a href="structRallyLocation.html#adfdbf88bff5056e7c569909ba7ff67f5">RallyLocation::alt</a></div><div class="ttdeci">int16_t alt</div><div class="ttdef"><b>Definition</b> <a href="AP__Rally_8h_source.html#l00030">AP_Rally.h:30</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 22 2024 16:14:15 for APM:Libraries by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
