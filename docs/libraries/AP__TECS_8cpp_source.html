<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APM:Libraries: libraries/AP_TECS/AP_TECS.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_060ebec8bce34c75ed52fa2fa80763b7.html">AP_TECS</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">AP_TECS.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="AP__TECS_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="preprocessor">#include &quot;<a class="code" href="AP__TECS_8h.html">AP_TECS.h</a>&quot;</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span> </div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="preprocessor">#include &lt;<a class="code" href="AP__HAL_8h.html">AP_HAL/AP_HAL.h</a>&gt;</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Baro_8h.html">AP_Baro/AP_Baro.h</a>&gt;</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Logger_8h.html">AP_Logger/AP_Logger.h</a>&gt;</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Landing_8h.html">AP_Landing/AP_Landing.h</a>&gt;</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span> </div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="keyword">extern</span> <span class="keyword">const</span> <a class="code hl_class" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code hl_variable" href="AP__TECS_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span> </div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="preprocessor">#if CONFIG_HAL_BOARD == HAL_BOARD_SITL</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="preprocessor">#include &lt;<a class="code" href="stdio_8h.html">stdio.h</a>&gt;</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno"><a class="line" href="AP__TECS_8cpp.html#a323c80a92fab4037fe4440664139c522">   12</a></span><span class="preprocessor"># define Debug(fmt, args ...)  do {printf(&quot;%s:%d: &quot; fmt &quot;\n&quot;, __FUNCTION__, __LINE__, ## args); hal.scheduler-&gt;delay(1); } while(0)</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor"># define Debug(fmt, args ...)</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment">//Debug(&quot;%.2f %.2f %.2f %.2f \n&quot;, var1, var2, var3, var4);</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment">// table of user settable parameters</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="keyword">const</span> <a class="code hl_struct" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code hl_variable" href="classAP__TECS.html#ae12cafab2952c95615de86f723fc0d61">AP_TECS::var_info</a>[] = {</div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span>    <span class="comment">// @Param: CLMB_MAX</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span>    <span class="comment">// @DisplayName: Maximum Climb Rate (metres/sec)</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span>    <span class="comment">// @Description: Maximum demanded climb rate. Do not set higher than the climb speed at THR_MAX at AIRSPEED_CRUISE when the battery is at low voltage. Reduce value if airspeed cannot be maintained on ascent. Increase value if throttle does not increase significantly to ascend.</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span>    <span class="comment">// @Range: 0.1 20.0</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;CLMB_MAX&quot;</span>,    0, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _maxClimbRate, 5.0f),</div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span> </div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span>    <span class="comment">// @Param: SINK_MIN</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span>    <span class="comment">// @DisplayName: Minimum Sink Rate (metres/sec)</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span>    <span class="comment">// @Description: Minimum sink rate when at THR_MIN and AIRSPEED_CRUISE.</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span>    <span class="comment">// @Range: 0.1 10.0</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SINK_MIN&quot;</span>,    1, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _minSinkRate, 2.0f),</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span> </div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>    <span class="comment">// @Param: TIME_CONST</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    <span class="comment">// @DisplayName: Controller time constant (sec)</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    <span class="comment">// @Description: Time constant of the TECS control algorithm. Small values make faster altitude corrections but can cause overshoot and aggressive behavior.</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    <span class="comment">// @Range: 3.0 10.0</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    <span class="comment">// @Increment: 0.2</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TIME_CONST&quot;</span>,  2, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _timeConst, 5.0f),</div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span> </div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>    <span class="comment">// @Param: THR_DAMP</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    <span class="comment">// @DisplayName: Controller throttle damping</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>    <span class="comment">// @Description: Damping gain for throttle demand loop. Increase to add throttle activity to dampen oscillations in speed and height.</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>    <span class="comment">// @Range: 0.1 1.0</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;THR_DAMP&quot;</span>,    3, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _thrDamp, 0.5f),</div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    <span class="comment">// @Param: INTEG_GAIN</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    <span class="comment">// @DisplayName: Controller integrator</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    <span class="comment">// @Description: Integrator gain to trim out long-term speed and height errors.</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    <span class="comment">// @Range: 0.0 0.5</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>    <span class="comment">// @Increment: 0.02</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;INTEG_GAIN&quot;</span>, 4, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _integGain, 0.3f),</div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span> </div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    <span class="comment">// @Param: VERT_ACC</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    <span class="comment">// @DisplayName: Vertical Acceleration Limit (metres/sec^2)</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    <span class="comment">// @Description: Maximum vertical acceleration used to correct speed or height errors.</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    <span class="comment">// @Range: 1.0 10.0</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    <span class="comment">// @Increment: 0.5</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;VERT_ACC&quot;</span>,  5, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _vertAccLim, 7.0f),</div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span> </div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    <span class="comment">// @Param: HGT_OMEGA</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    <span class="comment">// @DisplayName: Height complementary filter frequency (radians/sec)</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <span class="comment">// @Description: This is the cross-over frequency of the complementary filter used to fuse vertical acceleration and baro alt to obtain an estimate of height rate and height.</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    <span class="comment">// @Range: 1.0 5.0</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    <span class="comment">// @Increment: 0.05</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;HGT_OMEGA&quot;</span>, 6, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _hgtCompFiltOmega, 3.0f),</div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span> </div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    <span class="comment">// @Param: SPD_OMEGA</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    <span class="comment">// @DisplayName: Speed complementary filter frequency (radians/sec)</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    <span class="comment">// @Description: This is the cross-over frequency of the complementary filter used to fuse longitudinal acceleration and airspeed to obtain a lower noise and lag estimate of airspeed.</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    <span class="comment">// @Range: 0.5 2.0</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    <span class="comment">// @Increment: 0.05</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SPD_OMEGA&quot;</span>, 7, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _spdCompFiltOmega, 2.0f),</div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span> </div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    <span class="comment">// @Param: RLL2THR</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    <span class="comment">// @DisplayName: Bank angle compensation gain</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    <span class="comment">// @Description: Gain from bank angle to throttle to compensate for loss of airspeed from drag in turns. Set to approximately 10x the sink rate in m/s caused by a 45-degree turn. High efficiency models may need less while less efficient aircraft may need more. Should be tuned in an automatic mission with waypoints and turns greater than 90 degrees. Tune with PTCH2SRV_RLL and KFF_RDDRMIX to achieve constant airspeed, constant altitude turns.</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    <span class="comment">// @Range: 5.0 30.0</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    <span class="comment">// @Increment: 1.0</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RLL2THR&quot;</span>,  8, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _rollComp, 10.0f),</div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span> </div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <span class="comment">// @Param: SPDWEIGHT</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    <span class="comment">// @DisplayName: Weighting applied to speed control</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <span class="comment">// @Description: Mixing of pitch and throttle correction for height and airspeed errors. Pitch controls altitude and throttle controls airspeed if set to 0. Pitch controls airspeed and throttle controls altitude if set to 2 (good for gliders). Blended if set to 1.</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    <span class="comment">// @Range: 0.0 2.0</span></div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SPDWEIGHT&quot;</span>, 9, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _spdWeight, 1.0f),</div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span> </div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    <span class="comment">// @Param: PTCH_DAMP</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    <span class="comment">// @DisplayName: Controller pitch damping</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    <span class="comment">// @Description: Damping gain for pitch control from TECS control.  Increasing may correct for oscillations in speed and height, but too much may cause additional oscillation and degraded control.</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    <span class="comment">// @Range: 0.1 1.0</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PTCH_DAMP&quot;</span>, 10, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _ptchDamp, 0.3f),</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span> </div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    <span class="comment">// @Param: SINK_MAX</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    <span class="comment">// @DisplayName: Maximum Descent Rate (metres/sec)</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    <span class="comment">// @Description: Maximum demanded descent rate. Do not set higher than the vertical speed the aircraft can maintain at THR_MIN, TECS_PITCH_MIN, and AIRSPEED_MAX.</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    <span class="comment">// @Range: 0.0 20.0</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SINK_MAX&quot;</span>,  11, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _maxSinkRate, 5.0f),</div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span> </div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    <span class="comment">// @Param: LAND_ARSPD</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    <span class="comment">// @DisplayName: Airspeed during landing approach (m/s)</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    <span class="comment">// @Description: When performing an autonomus landing, this value is used as the goal airspeed during approach.  Max airspeed allowed is Trim Airspeed or AIRSPEED_MAX as defined by LAND_OPTIONS bitmask.  Note that this parameter is not useful if your platform does not have an airspeed sensor (use TECS_LAND_THR instead).  If negative then this value is halfway between AIRSPEED_MIN and TRIM_CRUISE_CM speed for fixed wing autolandings.</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    <span class="comment">// @Range: -1 127</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_ARSPD&quot;</span>, 12, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _landAirspeed, -1),</div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span> </div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    <span class="comment">// @Param: LAND_THR</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    <span class="comment">// @DisplayName: Cruise throttle during landing approach (percentage)</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    <span class="comment">// @Description: Use this parameter instead of LAND_ARSPD if your platform does not have an airspeed sensor.  It is the cruise throttle during landing approach.  If this value is negative then it is disabled and TECS_LAND_ARSPD is used instead.</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    <span class="comment">// @Range: -1 100</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_THR&quot;</span>, 13, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _landThrottle, -1),</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span> </div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    <span class="comment">// @Param: LAND_SPDWGT</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <span class="comment">// @DisplayName: Weighting applied to speed control during landing.</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    <span class="comment">// @Description: Same as SPDWEIGHT parameter, with the exception that this parameter is applied during landing flight stages.  A value closer to 2 will result in the plane ignoring height error during landing and our experience has been that the plane will therefore keep the nose up -- sometimes good for a glider landing (with the side effect that you will likely glide a ways past the landing point).  A value closer to 0 results in the plane ignoring speed error -- use caution when lowering the value below 1 -- ignoring speed could result in a stall. Values between 0 and 2 are valid values for a fixed landing weight. When using -1 the weight will be scaled during the landing. At the start of the landing approach it starts with TECS_SPDWEIGHT and scales down to 0 by the time you reach the land point. Example: Halfway down the landing approach you&#39;ll effectively have a weight of TECS_SPDWEIGHT/2.</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    <span class="comment">// @Range: -1.0 2.0</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_SPDWGT&quot;</span>, 14, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _spdWeightLand, -1.0f),</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span> </div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    <span class="comment">// @Param: PITCH_MAX</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <span class="comment">// @DisplayName: Maximum pitch in auto flight</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    <span class="comment">// @Description: Overrides PTCH_LIM_MAX_DEG in automatic throttle modes to reduce climb rates. Uses PTCH_LIM_MAX_DEG if set to 0. For proper TECS tuning, set to the angle that the aircraft can climb at AIRSPEED_CRUISE and THR_MAX.</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    <span class="comment">// @Range: 0 45</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PITCH_MAX&quot;</span>, 15, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _pitch_max, 15),</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span> </div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    <span class="comment">// @Param: PITCH_MIN</span></div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    <span class="comment">// @DisplayName: Minimum pitch in auto flight</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    <span class="comment">// @Description: Overrides PTCH_LIM_MIN_DEG in automatic throttle modes to reduce descent rates. Uses PTCH_LIM_MIN_DEG if set to 0. For proper TECS tuning, set to the angle that the aircraft can descend at without overspeeding.</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <span class="comment">// @Range: -45 0</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PITCH_MIN&quot;</span>, 16, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _pitch_min, 0),</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span> </div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    <span class="comment">// @Param: LAND_SINK</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>    <span class="comment">// @DisplayName: Sink rate for final landing stage</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    <span class="comment">// @Description: The sink rate in meters/second for the final stage of landing.</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="comment">// @Range: 0.0 2.0</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_SINK&quot;</span>, 17, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _land_sink, 0.25f),</div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span> </div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    <span class="comment">// @Param: LAND_TCONST</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>    <span class="comment">// @DisplayName: Land controller time constant (sec)</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    <span class="comment">// @Description: This is the time constant of the TECS control algorithm when in final landing stage of flight. It should be smaller than TECS_TIME_CONST to allow for faster flare</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    <span class="comment">// @Range: 1.0 5.0</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <span class="comment">// @Increment: 0.2</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_TCONST&quot;</span>, 18, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _landTimeConst, 2.0f),</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span> </div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    <span class="comment">// @Param: LAND_DAMP</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>    <span class="comment">// @DisplayName: Controller sink rate to pitch gain during flare</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    <span class="comment">// @Description: This is the sink rate gain for the pitch demand loop when in final landing stage of flight. It should be larger than TECS_PTCH_DAMP to allow for better sink rate control during flare.</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    <span class="comment">// @Range: 0.1 1.0</span></div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_DAMP&quot;</span>, 19, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _landDamp, 0.5f),</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span> </div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    <span class="comment">// @Param: LAND_PMAX</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <span class="comment">// @DisplayName: Maximum pitch during final stage of landing</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    <span class="comment">// @Description: This limits the pitch used during the final stage of automatic landing. During the final landing stage most planes need to keep their pitch small to avoid stalling. A maximum of 10 degrees is usually good. A value of zero means to use the normal pitch limits.</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <span class="comment">// @Range: -5 40</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_PMAX&quot;</span>, 20, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _land_pitch_max, 10),</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span> </div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    <span class="comment">// @Param: APPR_SMAX</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>    <span class="comment">// @DisplayName: Sink rate max for landing approach stage</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    <span class="comment">// @Description: The sink rate max for the landing approach stage of landing. This will need to be large for steep landing approaches especially when using reverse thrust. If 0, then use TECS_SINK_MAX.</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    <span class="comment">// @Range: 0.0 20.0</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <span class="comment">// @Units: m/s</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;APPR_SMAX&quot;</span>, 21, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _maxSinkRate_approach, 0),</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span> </div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>    <span class="comment">// @Param: LAND_SRC</span></div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    <span class="comment">// @DisplayName: Land sink rate change</span></div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>    <span class="comment">// @Description: When zero, the flare sink rate (TECS_LAND_SINK) is a fixed sink demand. With this enabled the flare sinkrate will increase/decrease the flare sink demand as you get further beyond the LAND waypoint. Has no effect before the waypoint. This value is added to TECS_LAND_SINK proportional to distance traveled after wp. With an increasing sink rate you can still land in a given distance if you&#39;re traveling too fast and cruise passed the land point. A positive value will force the plane to land sooner proportional to distance passed land point. A negative number will tell the plane to slowly climb allowing for a pitched-up stall landing. Recommend 0.2 as initial value.</span></div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    <span class="comment">// @Range: -2.0 2.0</span></div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    <span class="comment">// @Units: m/s/m</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_SRC&quot;</span>, 22, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _land_sink_rate_change, 0),</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span> </div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    <span class="comment">// @Param: LAND_TDAMP</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    <span class="comment">// @DisplayName: Controller throttle damping when landing</span></div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>    <span class="comment">// @Description: Damping gain for the throttle demand loop during an auto-landing. Same as TECS_THR_DAMP but only in effect during an auto-land. Increase to add throttle activity to dampen oscillations in speed and height. When set to 0 landing throttle damping is controlled by TECS_THR_DAMP.</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>    <span class="comment">// @Range: 0.1 1.0</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_TDAMP&quot;</span>, 23, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _land_throttle_damp, 0),</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span> </div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>    <span class="comment">// @Param: LAND_IGAIN</span></div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    <span class="comment">// @DisplayName: Controller integrator during landing</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    <span class="comment">// @Description: This is the integrator gain on the control loop during landing. When set to 0 then TECS_INTEG_GAIN is used. Increase to increase the rate at which speed and height offsets are trimmed out. Typically values lower than TECS_INTEG_GAIN work best</span></div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    <span class="comment">// @Range: 0.0 0.5</span></div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    <span class="comment">// @Increment: 0.02</span></div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_IGAIN&quot;</span>, 24, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _integGain_land, 0),</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span> </div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span>    <span class="comment">// @Param: TKOFF_IGAIN</span></div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    <span class="comment">// @DisplayName: Controller integrator during takeoff</span></div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    <span class="comment">// @Description: This is the integrator gain on the control loop during takeoff. When set to 0 then TECS_INTEG_GAIN is used. Increase to increase the rate at which speed and height offsets are trimmed out. Typically values higher than TECS_INTEG_GAIN work best</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>    <span class="comment">// @Range: 0.0 0.5</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    <span class="comment">// @Increment: 0.02</span></div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TKOFF_IGAIN&quot;</span>, 25, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _integGain_takeoff, 0),</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span> </div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>    <span class="comment">// @Param: LAND_PDAMP</span></div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    <span class="comment">// @DisplayName: Pitch damping gain when landing</span></div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    <span class="comment">// @Description: This is the damping gain for the pitch demand loop during landing. Increase to add damping  to correct for oscillations in speed and height. If set to 0 then TECS_PTCH_DAMP will be used instead.</span></div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    <span class="comment">// @Range: 0.1 1.0</span></div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    <span class="comment">// @Increment: 0.1</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;LAND_PDAMP&quot;</span>, 26, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _land_pitch_damp, 0),</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span> </div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    <span class="comment">// @Param: SYNAIRSPEED</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>    <span class="comment">// @DisplayName: Enable the use of synthetic airspeed</span></div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <span class="comment">// @Description: This enables the use of synthetic airspeed in TECS for aircraft that don&#39;t have a real airspeed sensor. This is useful for development testing where the user is aware of the considerable limitations of the synthetic airspeed system, such as very poor estimates when a wind estimate is not accurate. Do not enable this option unless you fully understand the limitations of a synthetic airspeed estimate. This option has no effect if a healthy airspeed sensor is being used for airspeed measurements.</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    <span class="comment">// @Values: 0:Disable,1:Enable</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SYNAIRSPEED&quot;</span>, 27, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _use_synthetic_airspeed, 0),</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span> </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    <span class="comment">// @Param: OPTIONS</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>    <span class="comment">// @DisplayName: Extra TECS options</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>    <span class="comment">// @Description: This allows the enabling of special features in the speed/height controller.</span></div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>    <span class="comment">// @Bitmask: 0:GliderOnly,1:AllowDescentSpeedup</span></div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;OPTIONS&quot;</span>, 28, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _options, 0),</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>    <span class="comment">// @Param: PTCH_FF_V0</span></div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <span class="comment">// @DisplayName: Baseline airspeed for pitch feed-forward.</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>    <span class="comment">// @Description: This parameter sets the airspeed at which no feed-forward is applied between demanded airspeed and pitch. It should correspond to the airspeed in metres per second at which the plane glides at neutral pitch including STAB_PITCH_DOWN.</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    <span class="comment">// @Range: 5.0 50.0</span></div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PTCH_FF_V0&quot;</span>, 29, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _pitch_ff_v0, 12.0),</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span> </div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    <span class="comment">// @Param: PTCH_FF_K</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <span class="comment">// @DisplayName: Gain for pitch feed-forward.</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    <span class="comment">// @Description: This parameter sets the gain between demanded airspeed and pitch. It has units of radians per metre per second and should generally be negative. A good starting value is -0.04 for gliders and -0.08 for draggy airframes. The default (0.0) disables this feed-forward.</span></div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>    <span class="comment">// @Range: -5.0 0.0</span></div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PTCH_FF_K&quot;</span>, 30, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _pitch_ff_k, 0.0),</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span> </div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>    <span class="comment">// 31 previously used by TECS_LAND_PTRIM</span></div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span> </div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    <span class="comment">// @Param: FLARE_HGT</span></div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>    <span class="comment">// @DisplayName: Flare holdoff height</span></div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>    <span class="comment">// @Description: When height above ground is below this, the sink rate will be held at TECS_LAND_SINK. Use this to perform a hold-off manoeuvre when combined with small values for TECS_LAND_SINK.</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    <span class="comment">// @Range: 0 15</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    <span class="comment">// @Units: m</span></div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;FLARE_HGT&quot;</span>, 32, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _flare_holdoff_hgt, 1.0f),</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span> </div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    <span class="comment">// @Param: HDEM_TCONST</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>    <span class="comment">// @DisplayName: Height Demand Time Constant</span></div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    <span class="comment">// @Description: This sets the time constant of the low pass filter that is applied to the height demand input when bit 1 of TECS_OPTIONS is not selected.</span></div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>    <span class="comment">// @Range: 1.0 5.0</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>    <span class="comment">// @Units: s</span></div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>    <span class="comment">// @Increment: 0.2</span></div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;HDEM_TCONST&quot;</span>, 33, <a class="code hl_class" href="classAP__TECS.html">AP_TECS</a>, _hgt_dem_tconst, 3.0f),</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span> </div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    <a class="code hl_define" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>};</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span> </div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span><span class="comment">/*</span></div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span><span class="comment"> *  Written by Paul Riseborough 2013 to provide:</span></div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span><span class="comment"> *  - Combined control of speed and height using throttle to control</span></div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span><span class="comment"> *    total energy and pitch angle to control exchange of energy between</span></div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span><span class="comment"> *    potential and kinetic.</span></div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span><span class="comment"> *    Selectable speed or height priority modes when calculating pitch angle</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span><span class="comment"> *  - Fallback mode when no airspeed measurement is available that</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span><span class="comment"> *    sets throttle based on height rate demand and switches pitch angle control to</span></div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span><span class="comment"> *    height priority</span></div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span><span class="comment"> *  - Underspeed protection that demands maximum throttle and switches pitch angle control</span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span><span class="comment"> *    to speed priority mode</span></div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span><span class="comment"> *  - Relative ease of tuning through use of intuitive time constant, integrator and damping gains and the use</span></div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span><span class="comment"> *    of easy to measure aircraft performance data</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span><span class="comment"> *</span></div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span><span class="comment"> */</span></div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span> </div>
<div class="foldopen" id="foldopen00305" data-start="{" data-end="}">
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a4d52e4f283cb0475971dc3ce22597f1c">  305</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__TECS.html#a4d52e4f283cb0475971dc3ce22597f1c">AP_TECS::update_50hz</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>{</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    <span class="comment">// Implement third order complementary filter for height and height rate</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>    <span class="comment">// estimated height rate = _climb_rate</span></div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    <span class="comment">// estimated height above field elevation  = _height</span></div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>    <span class="comment">// Reference Paper :</span></div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>    <span class="comment">// Optimizing the Gains of the Baro-Inertial Vertical Channel</span></div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>    <span class="comment">// Widnall W.S, Sinha P.K,</span></div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>    <span class="comment">// AIAA Journal of Guidance and Control, 78-1307R</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span><span class="comment">      if we have a vertical position estimate from the EKF then use</span></div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span><span class="comment">      it, otherwise use barometric altitude</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span><span class="comment">     */</span></div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    <a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a0ce7fb0e943712be46d2ec00e2c7e7de">get_relative_position_D_home</a>(<a class="code hl_variable" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a>);</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    <a class="code hl_variable" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a> *= -1.0f;</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span> </div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>    <span class="comment">// Calculate time in seconds since last update</span></div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>    uint64_t now = <a class="code hl_function" href="namespaceAP__HAL.html#a7aa0ce7625c9680e30ff4a99940907a5">AP_HAL::micros64</a>();</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>    <span class="keywordtype">float</span> DT = (now - <a class="code hl_variable" href="classAP__TECS.html#ab4e43605acf8d36a5837334710d9c104">_update_50hz_last_usec</a>) * 1.0e-6f;</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a2bcfa703099ac31a48e80d95d19bf003">reset</a> = DT &gt; 1.0f;</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a2bcfa703099ac31a48e80d95d19bf003">reset</a>) {</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>        <a class="code hl_variable" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a> = 0.0f;</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>        <a class="code hl_variable" href="classAP__TECS.html#aab5acbcc71c36ff1efd9235d643ad4de">_height_filter</a>.dd_height = 0.0f;</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>        DT = 0.02f; <span class="comment">// when first starting TECS, use most likely time constant</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>        <a class="code hl_variable" href="classAP__TECS.html#abdc88637f15f20df5e282bf2052940c2">_vdot_filter</a>.<a class="code hl_function" href="classAverageFilter.html#a63c63f0e484476da1204319b88e3a24c">reset</a>();</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>        <a class="code hl_variable" href="classAP__TECS.html#a0a2e1747411c60941a678801e9af3178">_takeoff_start_ms</a> = 0;</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>    }</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    <a class="code hl_variable" href="classAP__TECS.html#ab4e43605acf8d36a5837334710d9c104">_update_50hz_last_usec</a> = now;</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span> </div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>    <span class="comment">// Use inertial nav verical velocity and height if available</span></div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>    <a class="code hl_class" href="classVector3.html">Vector3f</a> velned;</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a2bf7783e49e2237685ac740055a20866">get_velocity_NED</a>(velned)) {</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>        <span class="comment">// if possible use the EKF vertical velocity</span></div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>        <a class="code hl_variable" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a> = -velned.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>        <span class="comment">/*</span></div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span><span class="comment">          use a complimentary filter to calculate climb_rate. This is</span></div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span><span class="comment">          designed to minimise lag</span></div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span><span class="comment">         */</span></div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> baro_alt = <a class="code hl_function" href="namespaceAP.html#a8aec57eb0b7a79044cbc1f0ca4b75bcf">AP::baro</a>().<a class="code hl_function" href="classAP__Baro.html#a50ae73cce1699d88638e3dfab4ffd330">get_altitude</a>();</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>        <span class="comment">// Get height acceleration</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>        <span class="keywordtype">float</span> hgt_ddot_mea = -(<a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a68a0c485537e20cc9f73cc6af910bccb">get_accel_ef</a>().<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> + <a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>);</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>        <span class="comment">// Perform filter calculation using backwards Euler integration</span></div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>        <span class="comment">// Coefficients selected to place all three filter poles at omega</span></div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>        <span class="keywordtype">float</span> omega2 = <a class="code hl_variable" href="classAP__TECS.html#a44a3b1b7342744ddb5a9fc88af0b73e5">_hgtCompFiltOmega</a>*<a class="code hl_variable" href="classAP__TECS.html#a44a3b1b7342744ddb5a9fc88af0b73e5">_hgtCompFiltOmega</a>;</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>        <span class="keywordtype">float</span> hgt_err = baro_alt - <a class="code hl_variable" href="classAP__TECS.html#aab5acbcc71c36ff1efd9235d643ad4de">_height_filter</a>.height;</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>        <span class="keywordtype">float</span> integ1_input = hgt_err * omega2 * <a class="code hl_variable" href="classAP__TECS.html#a44a3b1b7342744ddb5a9fc88af0b73e5">_hgtCompFiltOmega</a>;</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span> </div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>        <a class="code hl_variable" href="classAP__TECS.html#aab5acbcc71c36ff1efd9235d643ad4de">_height_filter</a>.dd_height += integ1_input * DT;</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span> </div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>        <span class="keywordtype">float</span> integ2_input = <a class="code hl_variable" href="classAP__TECS.html#aab5acbcc71c36ff1efd9235d643ad4de">_height_filter</a>.dd_height + hgt_ddot_mea + hgt_err * omega2 * 3.0f;</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span> </div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>        <a class="code hl_variable" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a> += integ2_input * DT;</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span> </div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>        <span class="keywordtype">float</span> integ3_input = <a class="code hl_variable" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a> + hgt_err * <a class="code hl_variable" href="classAP__TECS.html#a44a3b1b7342744ddb5a9fc88af0b73e5">_hgtCompFiltOmega</a> * 3.0f;</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>        <span class="comment">// If more than 1 second has elapsed since last update then reset the integrator state</span></div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>        <span class="comment">// to the measured height</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a2bcfa703099ac31a48e80d95d19bf003">reset</a>) {</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>            <a class="code hl_variable" href="classAP__TECS.html#aab5acbcc71c36ff1efd9235d643ad4de">_height_filter</a>.height = <a class="code hl_variable" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a>;</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>            <a class="code hl_variable" href="classAP__TECS.html#aab5acbcc71c36ff1efd9235d643ad4de">_height_filter</a>.height += integ3_input*DT;</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>        }</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    }</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span> </div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>    <span class="comment">// Update the speed estimate using a 2nd order complementary filter</span></div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>    <a class="code hl_function" href="classAP__TECS.html#a6c1b577ec8587bee338d0751ecd7a6f4">_update_speed</a>(DT);</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>}</div>
</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span> </div>
<div class="foldopen" id="foldopen00374" data-start="{" data-end="}">
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a6c1b577ec8587bee338d0751ecd7a6f4">  374</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__TECS.html#a6c1b577ec8587bee338d0751ecd7a6f4">AP_TECS::_update_speed</a>(<span class="keywordtype">float</span> DT)</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>{</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>    <span class="comment">// Update and average speed rate of change</span></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span> </div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>    <span class="comment">// calculate a low pass filtered _vel_dot</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a2bcfa703099ac31a48e80d95d19bf003">reset</a>) {</div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>        <a class="code hl_variable" href="classAP__TECS.html#abdc88637f15f20df5e282bf2052940c2">_vdot_filter</a>.<a class="code hl_function" href="classAverageFilter.html#a63c63f0e484476da1204319b88e3a24c">reset</a>();</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>        <a class="code hl_variable" href="classAP__TECS.html#a594b11147d692c51e04a1e9882387537">_vel_dot_lpf</a> = <a class="code hl_variable" href="classAP__TECS.html#a4da8b5a68fcf0769d2200f4038ddebd8">_vel_dot</a>;</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>        <span class="comment">// Get DCM</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>        <span class="keyword">const</span> <a class="code hl_class" href="classMatrix3.html">Matrix3f</a> &amp;rotMat = <a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a00b2b4af62a91a50e14d8cf114b78639">get_rotation_body_to_ned</a>();</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>        <span class="comment">// Calculate speed rate of change</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>        <span class="keywordtype">float</span> temp = rotMat.<a class="code hl_variable" href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">c</a>.<a class="code hl_variable" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> * <a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a> + <a class="code hl_function" href="namespaceAP.html#ac571aa5a2ef71b7f4b4b2bfa09143fb9">AP::ins</a>().<a class="code hl_function" href="classAP__InertialSensor.html#a707bc3f8ef8270db68ceeec36171d6ac">get_accel</a>().<a class="code hl_variable" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>        <span class="comment">// take 5 point moving average</span></div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>        <a class="code hl_variable" href="classAP__TECS.html#a4da8b5a68fcf0769d2200f4038ddebd8">_vel_dot</a> = <a class="code hl_variable" href="classAP__TECS.html#abdc88637f15f20df5e282bf2052940c2">_vdot_filter</a>.<a class="code hl_function" href="classAverageFilter.html#a58f3da49063db38d512b15b8a0fc0995">apply</a>(temp);</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> alpha = DT / (DT + <a class="code hl_function" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">timeConstant</a>());</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>        <a class="code hl_variable" href="classAP__TECS.html#a594b11147d692c51e04a1e9882387537">_vel_dot_lpf</a> = <a class="code hl_variable" href="classAP__TECS.html#a594b11147d692c51e04a1e9882387537">_vel_dot_lpf</a> * (1.0f - alpha) + <a class="code hl_variable" href="classAP__TECS.html#a4da8b5a68fcf0769d2200f4038ddebd8">_vel_dot</a> * alpha;</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    }</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span> </div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    <span class="keywordtype">bool</span> use_airspeed = <a class="code hl_variable" href="classAP__TECS.html#a07f643564d913cf9020cd4a1b68f139d">_use_synthetic_airspeed_once</a> || <a class="code hl_variable" href="classAP__TECS.html#ada65aa88ad9ecd6db58d55dd783b7a1f">_use_synthetic_airspeed</a>.get() || <a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a4a17a0fa828d3250fef15bee06459418">using_airspeed_sensor</a>();</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span> </div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>    <span class="comment">// Convert equivalent airspeeds to true airspeeds and harmonise limits</span></div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span> </div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    <span class="keywordtype">float</span> EAS2TAS = <a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a64786b58a1607ee420ed4f0696c755b6">get_EAS2TAS</a>();</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>    <a class="code hl_variable" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#ae52e17111e872c29d269209efb7d5989">_EAS_dem</a> * EAS2TAS;</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a2bcfa703099ac31a48e80d95d19bf003">reset</a> || !use_airspeed) {</div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>        <a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a> = <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#ab3628cdc8abbecf0634d7e699853bc7a">airspeed_max</a> * EAS2TAS;</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a9bea918bd520e58ad0f9618e48d80894">_thr_clip_status</a> == <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">clipStatus::MAX</a>) {</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>        <span class="comment">// wind down airspeed upper limit  to prevent a situation where the aircraft can&#39;t climb</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>        <span class="comment">// at the maximum speed</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> velRateMin = 0.5f * <a class="code hl_variable" href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">_STEdot_min</a> / <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>, <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a2077bf8bbf9fc486c81be9b3f5b84500">airspeed_min</a> * EAS2TAS);</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>        <a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a> += <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> * velRateMin;</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>        <a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a>, <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a9787530264fe0198ac8e12d5923e5f20">airspeed_cruise</a> * EAS2TAS);</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>        <span class="comment">// wind airspeed upper limit back to parameter defined value</span></div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> velRateMax = 0.5f * <a class="code hl_variable" href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">_STEdot_max</a> / <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>, <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a2077bf8bbf9fc486c81be9b3f5b84500">airspeed_min</a> * EAS2TAS);</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>        <a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a> += <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> * velRateMax;</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    }</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>    <a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a>   = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aace31e2a082d17e038fcc6e3006166653">MIN</a>(<a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a>, <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#ab3628cdc8abbecf0634d7e699853bc7a">airspeed_max</a> * EAS2TAS);</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>    <a class="code hl_variable" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a>   = <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a2077bf8bbf9fc486c81be9b3f5b84500">airspeed_min</a> * EAS2TAS;</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span> </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#aa0b3ceea01732f41fb1ab2122f775a01">stall_prevention</a>) {</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>        <span class="comment">// when stall prevention is active we raise the minimum</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>        <span class="comment">// airspeed based on aerodynamic load factor</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>        <a class="code hl_variable" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a> *= <a class="code hl_variable" href="classAP__TECS.html#a94b18fc8586c008a3b57b1630d222a96">_load_factor</a>;</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>    }</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span> </div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a> &lt; <a class="code hl_variable" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a>) {</div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>        <a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a> = <a class="code hl_variable" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a>;</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>    }</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span> </div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>    <span class="comment">// Get measured airspeed or default to trim speed and constrain to range between min and max if</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    <span class="comment">// airspeed sensor data cannot be used</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>    <span class="keywordflow">if</span> (!use_airspeed || !<a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a69088a3b05155cc99c84feca718dd6cb">airspeed_estimate</a>(<a class="code hl_variable" href="classAP__TECS.html#abef22d8ca912f65ae8abdff6e54d8d3c">_EAS</a>)) {</div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>        <span class="comment">// If no airspeed available use average of min and max</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>        <a class="code hl_variable" href="classAP__TECS.html#abef22d8ca912f65ae8abdff6e54d8d3c">_EAS</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a9787530264fe0198ac8e12d5923e5f20">airspeed_cruise</a>.get(), (<span class="keywordtype">float</span>)<a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a2077bf8bbf9fc486c81be9b3f5b84500">airspeed_min</a>.get(), (<span class="keywordtype">float</span>)<a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#ab3628cdc8abbecf0634d7e699853bc7a">airspeed_max</a>.get());</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>    }</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span> </div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>    <span class="comment">// limit the airspeed to a minimum of 3 m/s</span></div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> min_airspeed = 3.0;</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span> </div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    <span class="comment">// Reset states of time since last update is too large</span></div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a2bcfa703099ac31a48e80d95d19bf003">reset</a>) {</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>        <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> = (<a class="code hl_variable" href="classAP__TECS.html#abef22d8ca912f65ae8abdff6e54d8d3c">_EAS</a> * EAS2TAS);</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>        <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>, min_airspeed);</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>        <a class="code hl_variable" href="classAP__TECS.html#ae4afaa108f4629b08efb5c19d3119233">_integDTAS_state</a> = 0.0f;</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>    }</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span> </div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    <span class="comment">// Implement a second order complementary filter to obtain a</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>    <span class="comment">// smoothed airspeed estimate</span></div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>    <span class="comment">// airspeed estimate is held in _TAS_state</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    <span class="keywordtype">float</span> aspdErr = (<a class="code hl_variable" href="classAP__TECS.html#abef22d8ca912f65ae8abdff6e54d8d3c">_EAS</a> * EAS2TAS) - <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>;</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>    <span class="keywordtype">float</span> integDTAS_input = aspdErr * <a class="code hl_variable" href="classAP__TECS.html#a7cd6a7f15461a776d453aebdbc1ba39f">_spdCompFiltOmega</a> * <a class="code hl_variable" href="classAP__TECS.html#a7cd6a7f15461a776d453aebdbc1ba39f">_spdCompFiltOmega</a>;</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>    <span class="comment">// Prevent state from winding up</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> &lt; 3.1f) {</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>        integDTAS_input = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(integDTAS_input, 0.0f);</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>    }</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>    <a class="code hl_variable" href="classAP__TECS.html#ae4afaa108f4629b08efb5c19d3119233">_integDTAS_state</a> = <a class="code hl_variable" href="classAP__TECS.html#ae4afaa108f4629b08efb5c19d3119233">_integDTAS_state</a> + integDTAS_input * DT;</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>    <span class="keywordtype">float</span> TAS_input = <a class="code hl_variable" href="classAP__TECS.html#ae4afaa108f4629b08efb5c19d3119233">_integDTAS_state</a> + <a class="code hl_variable" href="classAP__TECS.html#a4da8b5a68fcf0769d2200f4038ddebd8">_vel_dot</a> + aspdErr * <a class="code hl_variable" href="classAP__TECS.html#a7cd6a7f15461a776d453aebdbc1ba39f">_spdCompFiltOmega</a> * 1.4142f;</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>    <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> = <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> + TAS_input * DT;</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>    <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>, min_airspeed);</div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span> </div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>}</div>
</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span> </div>
<div class="foldopen" id="foldopen00459" data-start="{" data-end="}">
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a376593eecc4ab66559947a144106bdd5">  459</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__TECS.html#a376593eecc4ab66559947a144106bdd5">AP_TECS::_update_speed_demand</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>{</div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a1cbc008fde6dba92de34f6250e2fe355">_options</a> &amp; <a class="code hl_enumvalue" href="classAP__TECS.html#ab764ce341c82c93d3ab6fb1a20539213add71e487a40ead35e37526a3d702cfd7">OPTION_DESCENT_SPEEDUP</a>) {</div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>        <span class="comment">// Allow demanded speed to  go to maximum when descending at maximum descent rate</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>        <a class="code hl_variable" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a> + (<a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a> - <a class="code hl_variable" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a>) * <a class="code hl_variable" href="classAP__TECS.html#aeb462e3d18b68be11a13429cbe685bf7">_sink_fraction</a>;</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>    }</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span> </div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>    <span class="comment">// Set the airspeed demand to the minimum value if an underspeed condition exists</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>    <span class="comment">// or a bad descent condition exists</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>    <span class="comment">// This will minimise the rate of descent resulting from an engine failure,</span></div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>    <span class="comment">// enable the maximum climb rate to be achieved and prevent continued full power descent</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>    <span class="comment">// into the ground due to an unachievable airspeed value</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">badDescent</a>) || (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a>)) {</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>        <a class="code hl_variable" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a>     = <a class="code hl_variable" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a>;</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>    }</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span> </div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>    <span class="comment">// Constrain speed demand, taking into account the load factor</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>    <a class="code hl_variable" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a>, <a class="code hl_variable" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a>, <a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a>);</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span> </div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>    <span class="comment">// Determine the true cruising airspeed (m/s)</span></div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> TAScruise = <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a9787530264fe0198ac8e12d5923e5f20">airspeed_cruise</a> * <a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a64786b58a1607ee420ed4f0696c755b6">get_EAS2TAS</a>();</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span> </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    <span class="comment">// calculate velocity rate limits based on physical performance limits</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    <span class="comment">// provision to use a different rate limit if bad descent or underspeed condition exists</span></div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span>    <span class="comment">// Use 50% of maximum energy rate on gain, 90% on dissipation to allow margin for total energy controller</span></div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> velRateMax = 0.5f * <a class="code hl_variable" href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">_STEdot_max</a> / <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>;</div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>    <span class="comment">// Maximum permissible rate of deceleration value at max airspeed</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> velRateNegMax = 0.9f * <a class="code hl_variable" href="classAP__TECS.html#a334c90dbafe8f184467d58b1e631ca9f">_STEdot_neg_max</a> / <a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a>;</div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span>    <span class="comment">// Maximum permissible rate of deceleration value at cruise speed</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> velRateNegCruise = 0.9f * <a class="code hl_variable" href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">_STEdot_min</a> / TAScruise;</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    <span class="comment">// Linear interpolation between velocity rate at cruise and max speeds, capped at those speeds</span></div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> velRateMin = <a class="code hl_function" href="AP__Math_8cpp.html#ae2d4d03c107c3e6a127fb167e3908aa2">linear_interpolate</a>(velRateNegMax, velRateNegCruise, <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>, <a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a>, TAScruise);</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> TAS_dem_previous = <a class="code hl_variable" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a>;</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span> </div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>    <span class="comment">// Apply rate limit</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a> - TAS_dem_previous) &gt; (velRateMax * <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>)) {</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span>        <a class="code hl_variable" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a> = TAS_dem_previous + velRateMax * <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>;</div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>        <a class="code hl_variable" href="classAP__TECS.html#a2a336bda4da710cfabcc7279902fd6d7">_TAS_rate_dem</a> = velRateMax;</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a> - TAS_dem_previous) &lt; (velRateMin * <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>)) {</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>        <a class="code hl_variable" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a> = TAS_dem_previous + velRateMin * <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>;</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>        <a class="code hl_variable" href="classAP__TECS.html#a2a336bda4da710cfabcc7279902fd6d7">_TAS_rate_dem</a> = velRateMin;</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>        <a class="code hl_variable" href="classAP__TECS.html#a2a336bda4da710cfabcc7279902fd6d7">_TAS_rate_dem</a> = (<a class="code hl_variable" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a> - TAS_dem_previous) / <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>;</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>        <a class="code hl_variable" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a> = <a class="code hl_variable" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a>;</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>    }</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span> </div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>    <span class="comment">// calculate a low pass filtered _TAS_rate_dem</span></div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a2bcfa703099ac31a48e80d95d19bf003">reset</a>) {</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>        <a class="code hl_variable" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a> = <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>;</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>        <a class="code hl_variable" href="classAP__TECS.html#a53b44a17eb342bc77c0f6f50491af227">_TAS_rate_dem_lpf</a> = <a class="code hl_variable" href="classAP__TECS.html#a2a336bda4da710cfabcc7279902fd6d7">_TAS_rate_dem</a>;</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> alpha = <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> / (<a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> + <a class="code hl_function" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">timeConstant</a>());</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>        <a class="code hl_variable" href="classAP__TECS.html#a53b44a17eb342bc77c0f6f50491af227">_TAS_rate_dem_lpf</a> = <a class="code hl_variable" href="classAP__TECS.html#a53b44a17eb342bc77c0f6f50491af227">_TAS_rate_dem_lpf</a> * (1.0f - alpha) + <a class="code hl_variable" href="classAP__TECS.html#a2a336bda4da710cfabcc7279902fd6d7">_TAS_rate_dem</a> * alpha;</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>    }</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span> </div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>    <span class="comment">// Constrain speed demand again to protect against bad values on initialisation.</span></div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>    <a class="code hl_variable" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a>, <a class="code hl_variable" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a>, <a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a>);</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>}</div>
</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span> </div>
<div class="foldopen" id="foldopen00518" data-start="{" data-end="}">
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a91aeb22f68e2957bfad6285ec41182cf">  518</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__TECS.html#a91aeb22f68e2957bfad6285ec41182cf">AP_TECS::_update_height_demand</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>{</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>    <a class="code hl_variable" href="classAP__TECS.html#ac068b4c20d6a91be0dce44f2ed7363a9">_climb_rate_limit</a> = <a class="code hl_variable" href="classAP__TECS.html#aea68f106f8f04f199c8470e52532e6a5">_maxClimbRate</a> * <a class="code hl_variable" href="classAP__TECS.html#a91ce1f5e2d671c0d134997fa9859919e">_max_climb_scaler</a>;</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>    <a class="code hl_variable" href="classAP__TECS.html#aea49e5788e0f7a244a7c17f2eabdc65d">_sink_rate_limit</a> = <a class="code hl_variable" href="classAP__TECS.html#a7c97ba3776836f5760b4b79f4926e452">_maxSinkRate</a> * <a class="code hl_variable" href="classAP__TECS.html#ad9ffe375b8f411a6ad60f5e38a47b7a1">_max_sink_scaler</a>;</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a96bc0e6fadbf3202c5e5fc9ee2c01cec">_maxSinkRate_approach</a> &gt; 0 &amp;&amp; <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a>) {</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>        <span class="comment">// special sink rate for approach to accommodate steep slopes and reverse thrust.</span></div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>        <span class="comment">// A special check must be done to see if we&#39;re LANDing on approach but also if</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>        <span class="comment">// we&#39;re in that tiny window just starting NAV_LAND but still in NORMAL mode. If</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>        <span class="comment">// we have a steep slope with a short approach we&#39;ll want to allow acquiring the</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>        <span class="comment">// glide slope right away.</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>        <a class="code hl_variable" href="classAP__TECS.html#aea49e5788e0f7a244a7c17f2eabdc65d">_sink_rate_limit</a> = <a class="code hl_variable" href="classAP__TECS.html#a96bc0e6fadbf3202c5e5fc9ee2c01cec">_maxSinkRate_approach</a>;</div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>    }</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span> </div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span> </div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code hl_function" href="classAP__Landing.html#a5ff74bf65eb1a4083cc783af22276828">is_flaring</a>()) {</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>        <span class="comment">// Apply 2 point moving average to demanded height</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> hgt_dem = 0.5f * (<a class="code hl_variable" href="classAP__TECS.html#a91e85bf0a00beec54598231ee0cca7c5">_hgt_dem_in</a> + <a class="code hl_variable" href="classAP__TECS.html#adaae33ce3130a875fa9afb1cef61c725">_hgt_dem_in_prev</a>);</div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>        <a class="code hl_variable" href="classAP__TECS.html#adaae33ce3130a875fa9afb1cef61c725">_hgt_dem_in_prev</a> = <a class="code hl_variable" href="classAP__TECS.html#a91e85bf0a00beec54598231ee0cca7c5">_hgt_dem_in</a>;</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span> </div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>        <span class="comment">// Limit height rate of change</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>        <span class="keywordflow">if</span> ((hgt_dem - <a class="code hl_variable" href="classAP__TECS.html#ad838b3ab01f1d007aff6483c5164dd32">_hgt_dem_rate_ltd</a>) &gt; (<a class="code hl_variable" href="classAP__TECS.html#ac068b4c20d6a91be0dce44f2ed7363a9">_climb_rate_limit</a> * <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>)) {</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>            <a class="code hl_variable" href="classAP__TECS.html#ad838b3ab01f1d007aff6483c5164dd32">_hgt_dem_rate_ltd</a> = <a class="code hl_variable" href="classAP__TECS.html#ad838b3ab01f1d007aff6483c5164dd32">_hgt_dem_rate_ltd</a> + <a class="code hl_variable" href="classAP__TECS.html#ac068b4c20d6a91be0dce44f2ed7363a9">_climb_rate_limit</a> * <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>;</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>            <a class="code hl_variable" href="classAP__TECS.html#aeb462e3d18b68be11a13429cbe685bf7">_sink_fraction</a> = 0.0f;</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((hgt_dem - <a class="code hl_variable" href="classAP__TECS.html#ad838b3ab01f1d007aff6483c5164dd32">_hgt_dem_rate_ltd</a>) &lt; (-<a class="code hl_variable" href="classAP__TECS.html#aea49e5788e0f7a244a7c17f2eabdc65d">_sink_rate_limit</a> * <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>)) {</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>            <a class="code hl_variable" href="classAP__TECS.html#ad838b3ab01f1d007aff6483c5164dd32">_hgt_dem_rate_ltd</a> = <a class="code hl_variable" href="classAP__TECS.html#ad838b3ab01f1d007aff6483c5164dd32">_hgt_dem_rate_ltd</a> - <a class="code hl_variable" href="classAP__TECS.html#aea49e5788e0f7a244a7c17f2eabdc65d">_sink_rate_limit</a> * <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>;</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>            <a class="code hl_variable" href="classAP__TECS.html#aeb462e3d18b68be11a13429cbe685bf7">_sink_fraction</a> = 1.0f;</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> numerator = hgt_dem - <a class="code hl_variable" href="classAP__TECS.html#ad838b3ab01f1d007aff6483c5164dd32">_hgt_dem_rate_ltd</a>;</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> denominator = - <a class="code hl_variable" href="classAP__TECS.html#aea49e5788e0f7a244a7c17f2eabdc65d">_sink_rate_limit</a> * <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>;</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="AP__Math_8h.html#a8b6f71a42818d74fd8bfe348108942fa">is_negative</a>(numerator) &amp;&amp; <a class="code hl_function" href="AP__Math_8h.html#a8b6f71a42818d74fd8bfe348108942fa">is_negative</a>(denominator)) {</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>                <a class="code hl_variable" href="classAP__TECS.html#aeb462e3d18b68be11a13429cbe685bf7">_sink_fraction</a> = numerator / denominator;</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>                <a class="code hl_variable" href="classAP__TECS.html#aeb462e3d18b68be11a13429cbe685bf7">_sink_fraction</a> = 0.0f;</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>            }</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>            <a class="code hl_variable" href="classAP__TECS.html#ad838b3ab01f1d007aff6483c5164dd32">_hgt_dem_rate_ltd</a> = hgt_dem;</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>        }</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span> </div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>        <span class="comment">// Apply a first order lag to height demand and compensate for lag when commencing height</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>        <span class="comment">// control after takeoff to prevent plane pushing nose to level before climbing again. Post takeoff</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>        <span class="comment">// compensation offset is decayed using the same time constant as the height demand filter.</span></div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> coef = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aace31e2a082d17e038fcc6e3006166653">MIN</a>(<a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> / (<a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> + <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#ae466e45747e9b2eddb0ca00cbf8f5a7f">_hgt_dem_tconst</a>, <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>)), 1.0f);</div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>        <a class="code hl_variable" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a> = (<a class="code hl_variable" href="classAP__TECS.html#ad838b3ab01f1d007aff6483c5164dd32">_hgt_dem_rate_ltd</a> - <a class="code hl_variable" href="classAP__TECS.html#a045b368f51504b33da3916b166908fcc">_hgt_dem_lpf</a>) / <a class="code hl_variable" href="classAP__TECS.html#ae466e45747e9b2eddb0ca00cbf8f5a7f">_hgt_dem_tconst</a>;</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>        <a class="code hl_variable" href="classAP__TECS.html#a045b368f51504b33da3916b166908fcc">_hgt_dem_lpf</a> = <a class="code hl_variable" href="classAP__TECS.html#ad838b3ab01f1d007aff6483c5164dd32">_hgt_dem_rate_ltd</a> * coef + (1.0f - coef) * <a class="code hl_variable" href="classAP__TECS.html#a045b368f51504b33da3916b166908fcc">_hgt_dem_lpf</a>;</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>        <a class="code hl_variable" href="classAP__TECS.html#ae1b9ac9075a77848f261c56f9083e314">_post_TO_hgt_offset</a> *= (1.0f - coef);</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>        <a class="code hl_variable" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#a045b368f51504b33da3916b166908fcc">_hgt_dem_lpf</a> + <a class="code hl_variable" href="classAP__TECS.html#ae1b9ac9075a77848f261c56f9083e314">_post_TO_hgt_offset</a>;</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span> </div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>        <span class="comment">// during approach compensate for height filter lag</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a>) {</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>            <a class="code hl_variable" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> += <a class="code hl_variable" href="classAP__TECS.html#ae466e45747e9b2eddb0ca00cbf8f5a7f">_hgt_dem_tconst</a> * <a class="code hl_variable" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a>;</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>            <span class="comment">// Don&#39;t allow height demand to get too far ahead of the vehicles current height</span></div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>                <span class="comment">// if vehicle is unable to follow the demanded climb or descent</span></div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>            <span class="keywordtype">bool</span> max_climb_condition   = (<a class="code hl_variable" href="classAP__TECS.html#ab40a7ba8b52a3746d49f0bb1f3ceb197">_pitch_dem_unc</a> &gt; <a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>) ||</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>                                            (<a class="code hl_variable" href="classAP__TECS.html#ae0d43e99acc9993178e795b9a0ff6d32">_SEBdot_dem_clip</a> == <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">clipStatus::MAX</a>);</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>            <span class="keywordtype">bool</span> max_descent_condition = (<a class="code hl_variable" href="classAP__TECS.html#ab40a7ba8b52a3746d49f0bb1f3ceb197">_pitch_dem_unc</a> &lt; <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>) ||</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>                                            (<a class="code hl_variable" href="classAP__TECS.html#ae0d43e99acc9993178e795b9a0ff6d32">_SEBdot_dem_clip</a> == <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aace31e2a082d17e038fcc6e3006166653">clipStatus::MIN</a>);</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a569e77cb66a1f80a50119c5835248b44">_using_airspeed_for_throttle</a>) {</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>                <span class="comment">// large height errors will result in the throttle saturating</span></div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>                max_climb_condition   |= (<a class="code hl_variable" href="classAP__TECS.html#a9bea918bd520e58ad0f9618e48d80894">_thr_clip_status</a> == <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">clipStatus::MAX</a>) &amp;&amp;</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>                                            !((<a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6ba8fabc74a4ed0781d663336cbf8c9c53d">AP_FixedWing::FlightStage::TAKEOFF</a>) || (<a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6bae9f1c207fb0d669ee1d8ce8b8ef601e3">AP_FixedWing::FlightStage::ABORT_LANDING</a>));</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>                max_descent_condition |= (<a class="code hl_variable" href="classAP__TECS.html#a9bea918bd520e58ad0f9618e48d80894">_thr_clip_status</a> == <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aace31e2a082d17e038fcc6e3006166653">clipStatus::MIN</a>) &amp;&amp; !<a class="code hl_variable" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code hl_function" href="classAP__Landing.html#a5ff74bf65eb1a4083cc783af22276828">is_flaring</a>();</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>            }</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> hgt_dem_alpha = <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> / <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> + <a class="code hl_variable" href="classAP__TECS.html#ae466e45747e9b2eddb0ca00cbf8f5a7f">_hgt_dem_tconst</a>, <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>);</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>            <span class="keywordflow">if</span> (max_climb_condition &amp;&amp; <a class="code hl_variable" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> &gt; <a class="code hl_variable" href="classAP__TECS.html#a3f83a3c0553d099adb949ef55e05fa2e">_hgt_dem_prev</a>) {</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>                    <a class="code hl_variable" href="classAP__TECS.html#a91ce1f5e2d671c0d134997fa9859919e">_max_climb_scaler</a> *= (1.0f - hgt_dem_alpha);</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (max_descent_condition &amp;&amp; <a class="code hl_variable" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> &lt; <a class="code hl_variable" href="classAP__TECS.html#a3f83a3c0553d099adb949ef55e05fa2e">_hgt_dem_prev</a>) {</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>                <a class="code hl_variable" href="classAP__TECS.html#ad9ffe375b8f411a6ad60f5e38a47b7a1">_max_sink_scaler</a> *= (1.0f - hgt_dem_alpha);</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>                <a class="code hl_variable" href="classAP__TECS.html#a91ce1f5e2d671c0d134997fa9859919e">_max_climb_scaler</a> = <a class="code hl_variable" href="classAP__TECS.html#a91ce1f5e2d671c0d134997fa9859919e">_max_climb_scaler</a> * (1.0f - hgt_dem_alpha) + hgt_dem_alpha;</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>                <a class="code hl_variable" href="classAP__TECS.html#ad9ffe375b8f411a6ad60f5e38a47b7a1">_max_sink_scaler</a>  =  <a class="code hl_variable" href="classAP__TECS.html#ad9ffe375b8f411a6ad60f5e38a47b7a1">_max_sink_scaler</a> * (1.0f - hgt_dem_alpha) + hgt_dem_alpha;</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>            }</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>        }</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>        <a class="code hl_variable" href="classAP__TECS.html#a3f83a3c0553d099adb949ef55e05fa2e">_hgt_dem_prev</a> = <a class="code hl_variable" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a>;</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>        <span class="comment">// when flaring force height rate demand to the</span></div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>        <span class="comment">// configured sink rate and adjust the demanded height to</span></div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>        <span class="comment">// be kinematically consistent with the height rate.</span></div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span> </div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span>        <span class="comment">// set all height filter states to current height to prevent large pitch transients if flare is aborted</span></div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>        <a class="code hl_variable" href="classAP__TECS.html#a045b368f51504b33da3916b166908fcc">_hgt_dem_lpf</a>      = <a class="code hl_variable" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a>;</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>        <a class="code hl_variable" href="classAP__TECS.html#ad838b3ab01f1d007aff6483c5164dd32">_hgt_dem_rate_ltd</a> = <a class="code hl_variable" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a>;</div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>        <a class="code hl_variable" href="classAP__TECS.html#adaae33ce3130a875fa9afb1cef61c725">_hgt_dem_in_prev</a>  = <a class="code hl_variable" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a>;</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span> </div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__TECS.html#a549342fec91b2243b161346a92762767">_flare_initialised</a>) {</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span>            <a class="code hl_variable" href="classAP__TECS.html#a47e06765500c102946f198671232041c">_flare_hgt_dem_adj</a> = <a class="code hl_variable" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a>;</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>            <a class="code hl_variable" href="classAP__TECS.html#a38c6fa6f9b8cc7c82e594bb494b7f47c">_flare_hgt_dem_ideal</a> = <a class="code hl_variable" href="classAP__TECS.html#ac53298961dc0d4983cc0934174ab7222">_hgt_afe</a>;</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>            <a class="code hl_variable" href="classAP__TECS.html#a3979de95efa8eca22c0890607f5db8f6">_hgt_at_start_of_flare</a> = <a class="code hl_variable" href="classAP__TECS.html#ac53298961dc0d4983cc0934174ab7222">_hgt_afe</a>;</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span>            <a class="code hl_variable" href="classAP__TECS.html#a14cbf46b51ab9bcdb52a5b02abf269eb">_hgt_rate_at_flare_entry</a> = <a class="code hl_variable" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a>;</div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>            <a class="code hl_variable" href="classAP__TECS.html#a549342fec91b2243b161346a92762767">_flare_initialised</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>        }</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span> </div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>        <span class="comment">// adjust the flare sink rate to increase/decrease as your travel further beyond the land wp</span></div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>        <span class="keywordtype">float</span> land_sink_rate_adj = <a class="code hl_variable" href="classAP__TECS.html#a8d23075cf7fd1752877a893bd689a2ab">_land_sink</a> + <a class="code hl_variable" href="classAP__TECS.html#ab1d7e52ac8d8c6aa305275a30ba72a93">_land_sink_rate_change</a>*<a class="code hl_variable" href="classAP__TECS.html#a4dc0dac47faf337837f8c47c21494d67">_distance_beyond_land_wp</a>;</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span> </div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>        <span class="comment">// bring it in linearly with height</span></div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>        <span class="keywordtype">float</span> p;</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a3979de95efa8eca22c0890607f5db8f6">_hgt_at_start_of_flare</a> &gt; <a class="code hl_variable" href="classAP__TECS.html#a984593f4daada614bd626b6550bcb4a7">_flare_holdoff_hgt</a>) {</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>            p = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>((<a class="code hl_variable" href="classAP__TECS.html#a3979de95efa8eca22c0890607f5db8f6">_hgt_at_start_of_flare</a> - <a class="code hl_variable" href="classAP__TECS.html#ac53298961dc0d4983cc0934174ab7222">_hgt_afe</a>) / (<a class="code hl_variable" href="classAP__TECS.html#a3979de95efa8eca22c0890607f5db8f6">_hgt_at_start_of_flare</a> - <a class="code hl_variable" href="classAP__TECS.html#a984593f4daada614bd626b6550bcb4a7">_flare_holdoff_hgt</a>), 0.0f, 1.0f);</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>            p = 1.0f;</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>        }</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>        <a class="code hl_variable" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#a14cbf46b51ab9bcdb52a5b02abf269eb">_hgt_rate_at_flare_entry</a> * (1.0f - p) - land_sink_rate_adj * p;</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span> </div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span>        <a class="code hl_variable" href="classAP__TECS.html#a38c6fa6f9b8cc7c82e594bb494b7f47c">_flare_hgt_dem_ideal</a> += <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> * <a class="code hl_variable" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a>; <span class="comment">// the ideal height profile to follow</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span>        <a class="code hl_variable" href="classAP__TECS.html#a47e06765500c102946f198671232041c">_flare_hgt_dem_adj</a>   += <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> * <a class="code hl_variable" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a>; <span class="comment">// the demanded height profile that includes the pre-flare height tracking offset</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span> </div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span>        <span class="comment">// fade across to the ideal height profile</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>        <a class="code hl_variable" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#a47e06765500c102946f198671232041c">_flare_hgt_dem_adj</a> * (1.0f - p) + <a class="code hl_variable" href="classAP__TECS.html#a38c6fa6f9b8cc7c82e594bb494b7f47c">_flare_hgt_dem_ideal</a> * p;</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span> </div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>        <span class="comment">// correct for offset between height above ground and height above datum used by control loops</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>        <a class="code hl_variable" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> += (<a class="code hl_variable" href="classAP__TECS.html#ac53298961dc0d4983cc0934174ab7222">_hgt_afe</a> - <a class="code hl_variable" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a>);</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>    }</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>}</div>
</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span> </div>
<div class="foldopen" id="foldopen00632" data-start="{" data-end="}">
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a7318e1b5998b99f4febe0d53040c5744">  632</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__TECS.html#a7318e1b5998b99f4febe0d53040c5744">AP_TECS::_detect_underspeed</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>{</div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>    <span class="comment">// see if we can clear a previous underspeed condition. We clear</span></div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>    <span class="comment">// it if we are now more than 15% above min speed, and haven&#39;t</span></div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>    <span class="comment">// been below min speed for at least 3 seconds.</span></div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> &amp;&amp;</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>        <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> &gt;= <a class="code hl_variable" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a> * 1.15f &amp;&amp;</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>        <a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>() - <a class="code hl_variable" href="classAP__TECS.html#aa7b382d5c5f219be2fe639173654fbda">_underspeed_start_ms</a> &gt; 3000U) {</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span>    }</div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span> </div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6baa1ef2e72eb7f85ac2f96f20d1d49ba2c">AP_FixedWing::FlightStage::VTOL</a>) {</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((<a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> &lt; <a class="code hl_variable" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a> * 0.9f) &amp;&amp;</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>                (<a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> &gt;= <a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> * 0.95f) &amp;&amp;</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>                !<a class="code hl_variable" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code hl_function" href="classAP__Landing.html#a5ff74bf65eb1a4083cc783af22276828">is_flaring</a>()) ||</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>                ((<a class="code hl_variable" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a> &lt; <a class="code hl_variable" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a>) &amp;&amp; <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a>))</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>    {</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> &lt; <a class="code hl_variable" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a> * 0.9f) {</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>            <span class="comment">// reset start time as we are still underspeed</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>            <a class="code hl_variable" href="classAP__TECS.html#aa7b382d5c5f219be2fe639173654fbda">_underspeed_start_ms</a> = <a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>        }</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>        <span class="comment">// this clears underspeed if we reach our demanded height and</span></div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>        <span class="comment">// we are either below 95% throttle or we above 90% of min</span></div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>        <span class="comment">// airspeed</span></div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>    }</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>}</div>
</div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span> </div>
<div class="foldopen" id="foldopen00663" data-start="{" data-end="}">
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno"><a class="line" href="classAP__TECS.html#acf4aed1a469a3bce5d1f68ee8a73fed6">  663</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__TECS.html#acf4aed1a469a3bce5d1f68ee8a73fed6">AP_TECS::_update_energies</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>{</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span>    <span class="comment">// Calculate specific energy demands</span></div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>    <a class="code hl_variable" href="classAP__TECS.html#ae23c577644577aaabc247ea3c42da36a">_SPE_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a> * <a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>    <a class="code hl_variable" href="classAP__TECS.html#aeebe79e85106c8096f2902bad5478cc5">_SKE_dem</a> = 0.5f * <a class="code hl_variable" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a> * <a class="code hl_variable" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a>;</div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span> </div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>    <span class="comment">// Calculate specific energy rate demands and high pass filter demanded airspeed</span></div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>    <span class="comment">// rate of change to match the filtering applied to the measurement</span></div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span>    <a class="code hl_variable" href="classAP__TECS.html#a002c46ae3fbbd31dd4e110d13dfb9c08">_SKEdot_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> * (<a class="code hl_variable" href="classAP__TECS.html#a2a336bda4da710cfabcc7279902fd6d7">_TAS_rate_dem</a> - <a class="code hl_variable" href="classAP__TECS.html#a53b44a17eb342bc77c0f6f50491af227">_TAS_rate_dem_lpf</a>);</div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span> </div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>    <span class="comment">// Calculate specific energy</span></div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span>    <a class="code hl_variable" href="classAP__TECS.html#ac4c57b27adc7dc7e2edc7bcfc3e59de0">_SPE_est</a> = <a class="code hl_variable" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a> * <a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>    <a class="code hl_variable" href="classAP__TECS.html#a8cf182de07003d0734293f16cb554cae">_SKE_est</a> = 0.5f * <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> * <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>;</div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span> </div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>    <span class="comment">// Calculate specific energy rate and high pass filter airspeed rate of change</span></div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span>    <span class="comment">// to remove effect of complementary filter induced bias errors</span></div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>    <a class="code hl_variable" href="classAP__TECS.html#ae8327f2367078272adce7f8f25c605f4">_SPEdot</a> = <a class="code hl_variable" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a> * <a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>    <a class="code hl_variable" href="classAP__TECS.html#a41c98d353390a6bb386e5596c5d5a843">_SKEdot</a> = <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> * (<a class="code hl_variable" href="classAP__TECS.html#a4da8b5a68fcf0769d2200f4038ddebd8">_vel_dot</a> - <a class="code hl_variable" href="classAP__TECS.html#a594b11147d692c51e04a1e9882387537">_vel_dot_lpf</a>);</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span> </div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>}</div>
</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span> </div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span><span class="comment">/*</span></div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span><span class="comment">  current time constant. It is lower in landing to try to give a precise approach</span></div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00687" data-start="{" data-end="}">
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">  687</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">AP_TECS::timeConstant</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a>) {</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#aa6b37a801da411b61ba0a9fee93940cb">_landTimeConst</a> &lt; 0.1f) {</div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span>            <span class="keywordflow">return</span> 0.1f;</div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span>        }</div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__TECS.html#aa6b37a801da411b61ba0a9fee93940cb">_landTimeConst</a>;</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>    }</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a372aa3467ce5ffef5b34a1046f6c1392">_timeConst</a> &lt; 0.1f) {</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>        <span class="keywordflow">return</span> 0.1f;</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span>    }</div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__TECS.html#a372aa3467ce5ffef5b34a1046f6c1392">_timeConst</a>;</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>}</div>
</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span> </div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span><span class="comment">/*</span></div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span><span class="comment">  calculate throttle demand - airspeed enabled case</span></div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00704" data-start="{" data-end="}">
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno"><a class="line" href="classAP__TECS.html#ab8413b71612f09140b6ce14120ca740b">  704</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__TECS.html#ab8413b71612f09140b6ce14120ca740b">AP_TECS::_update_throttle_with_airspeed</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>{</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>    <span class="comment">// Calculate limits to be applied to potential energy error to prevent over or underspeed occurring due to large height errors</span></div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>    <span class="keywordtype">float</span> SPE_err_max = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#a8cf182de07003d0734293f16cb554cae">_SKE_est</a> - 0.5f * <a class="code hl_variable" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a> * <a class="code hl_variable" href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">_TASmin</a>, 0.0f);</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span>    <span class="keywordtype">float</span> SPE_err_min = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aace31e2a082d17e038fcc6e3006166653">MIN</a>(<a class="code hl_variable" href="classAP__TECS.html#a8cf182de07003d0734293f16cb554cae">_SKE_est</a> - 0.5f * <a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a> * <a class="code hl_variable" href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">_TASmax</a>, 0.0f);</div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span> </div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6baa1ef2e72eb7f85ac2f96f20d1d49ba2c">AP_FixedWing::FlightStage::VTOL</a>) {</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span>        <span class="comment">/*</span></div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span><span class="comment">          when we are in a VTOL state then we ignore potential energy</span></div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span><span class="comment">          errors as we have vertical motors that interfere with the</span></div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span><span class="comment">          total energy calculation.</span></div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span><span class="comment">         */</span></div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span>        SPE_err_max = SPE_err_min = 0;</div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>    }</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span> </div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span>    <span class="comment">// rate of change of potential energy is proportional to height error</span></div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span>    <a class="code hl_variable" href="classAP__TECS.html#aceeb5b086fc333e84f45afea2a9fbe0c">_SPEdot_dem</a> = (<a class="code hl_variable" href="classAP__TECS.html#ae23c577644577aaabc247ea3c42da36a">_SPE_dem</a> - <a class="code hl_variable" href="classAP__TECS.html#ac4c57b27adc7dc7e2edc7bcfc3e59de0">_SPE_est</a>) / <a class="code hl_function" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">timeConstant</a>();</div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span> </div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>    <span class="comment">// Calculate total energy error</span></div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>    <a class="code hl_variable" href="classAP__TECS.html#abcf8efaf10d02b61998c9fbdc4b83d0b">_STE_error</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>((<a class="code hl_variable" href="classAP__TECS.html#ae23c577644577aaabc247ea3c42da36a">_SPE_dem</a> - <a class="code hl_variable" href="classAP__TECS.html#ac4c57b27adc7dc7e2edc7bcfc3e59de0">_SPE_est</a>), SPE_err_min, SPE_err_max) + <a class="code hl_variable" href="classAP__TECS.html#aeebe79e85106c8096f2902bad5478cc5">_SKE_dem</a> - <a class="code hl_variable" href="classAP__TECS.html#a8cf182de07003d0734293f16cb554cae">_SKE_est</a>;</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span>    <span class="keywordtype">float</span> STEdot_dem = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>((<a class="code hl_variable" href="classAP__TECS.html#aceeb5b086fc333e84f45afea2a9fbe0c">_SPEdot_dem</a> + <a class="code hl_variable" href="classAP__TECS.html#a002c46ae3fbbd31dd4e110d13dfb9c08">_SKEdot_dem</a>), <a class="code hl_variable" href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">_STEdot_min</a>, <a class="code hl_variable" href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">_STEdot_max</a>);</div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span>    <span class="keywordtype">float</span> STEdot_error = STEdot_dem - <a class="code hl_variable" href="classAP__TECS.html#ae8327f2367078272adce7f8f25c605f4">_SPEdot</a> - <a class="code hl_variable" href="classAP__TECS.html#a41c98d353390a6bb386e5596c5d5a843">_SKEdot</a>;</div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span> </div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>    <span class="comment">// Apply 0.5 second first order filter to STEdot_error</span></div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>    <span class="comment">// This is required to remove accelerometer noise from the  measurement</span></div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> filt_coef = 2.0f * <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>;</div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>    STEdot_error = filt_coef * STEdot_error + (1.0f - filt_coef) * <a class="code hl_variable" href="classAP__TECS.html#a1a3a014f36ba7b9fe2cc3d9c4cb75777">_STEdotErrLast</a>;</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span>    <a class="code hl_variable" href="classAP__TECS.html#a1a3a014f36ba7b9fe2cc3d9c4cb75777">_STEdotErrLast</a> = STEdot_error;</div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span> </div>
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno">  733</span>    <span class="comment">// Calculate throttle demand</span></div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span>    <span class="comment">// If underspeed condition is set, then demand full throttle</span></div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a>) {</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span>        <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = 1.0f;</div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ae16dc10bcc947d81c729e030bd200a80">is_gliding</a>) {</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>        <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = 0.0f;</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span>        <span class="comment">// Calculate gain scaler from specific energy error to throttle</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>        <span class="comment">// (_STEdot_max - _STEdot_min) / (_THRmaxf - _THRminf) is the derivative of STEdot wrt throttle measured across the max allowed throttle range.</span></div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> K_STE2Thr = 1 / (<a class="code hl_function" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">timeConstant</a>() * (<a class="code hl_variable" href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">_STEdot_max</a> - <a class="code hl_variable" href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">_STEdot_min</a>) / (<a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - <a class="code hl_variable" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>));</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span> </div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>        <span class="comment">// Calculate feed-forward throttle</span></div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> nomThr = <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#af95e2dea4aee3c0a039d842db96028ef">throttle_cruise</a> * 0.01f;</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span>        <span class="keyword">const</span> <a class="code hl_class" href="classMatrix3.html">Matrix3f</a> &amp;rotMat = <a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a00b2b4af62a91a50e14d8cf114b78639">get_rotation_body_to_ned</a>();</div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span>        <span class="comment">// Use the demanded rate of change of total energy as the feed-forward demand, but add</span></div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span>        <span class="comment">// additional component which scales with (1/cos(bank angle) - 1) to compensate for induced</span></div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>        <span class="comment">// drag increase during turns.</span></div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> cosPhi = sqrtf((rotMat.<a class="code hl_variable" href="classMatrix3.html#acd7bf3421047fa155168a9c8e5164a2b">a</a>.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>*rotMat.<a class="code hl_variable" href="classMatrix3.html#acd7bf3421047fa155168a9c8e5164a2b">a</a>.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>) + (rotMat.<a class="code hl_variable" href="classMatrix3.html#ae16bed039ad87c3337f15837c33fe2fb">b</a>.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>*rotMat.<a class="code hl_variable" href="classMatrix3.html#ae16bed039ad87c3337f15837c33fe2fb">b</a>.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>));</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>        STEdot_dem = STEdot_dem + <a class="code hl_variable" href="classAP__TECS.html#aabf43104f81a4de93b6b21dff03fce37">_rollComp</a> * (1.0f/<a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(cosPhi * cosPhi, 0.1f, 1.0f) - 1.0f);</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> ff_throttle = nomThr + STEdot_dem / (<a class="code hl_variable" href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">_STEdot_max</a> - <a class="code hl_variable" href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">_STEdot_min</a>) * (<a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - <a class="code hl_variable" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>);</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span> </div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span>        <span class="comment">// Calculate PD + FF throttle</span></div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span>        <span class="keywordtype">float</span> throttle_damp = <a class="code hl_variable" href="classAP__TECS.html#a1a46eb22cdadf76b7fab1cbc307e6d81">_thrDamp</a>;</div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a> &amp;&amp; !<a class="code hl_function" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(<a class="code hl_variable" href="classAP__TECS.html#a620dd7d52dc60fd6914dbd7d98e1b9cd">_land_throttle_damp</a>)) {</div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>            throttle_damp = <a class="code hl_variable" href="classAP__TECS.html#a620dd7d52dc60fd6914dbd7d98e1b9cd">_land_throttle_damp</a>;</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>        }</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span>        <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = (<a class="code hl_variable" href="classAP__TECS.html#abcf8efaf10d02b61998c9fbdc4b83d0b">_STE_error</a> + STEdot_error * throttle_damp) * K_STE2Thr + ff_throttle;</div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span> </div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span>        <span class="keywordtype">float</span> THRminf_clipped_to_zero = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>, 0, <a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a>);</div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span> </div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>        <span class="comment">// Calculate integrator state upper and lower limits</span></div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span>        <span class="comment">// Set to a value that will allow 0.1 (10%) throttle saturation to allow for noise on the demand</span></div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>        <span class="comment">// Additionally constrain the integrator state amplitude so that the integrator comes off limits faster.</span></div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> maxAmp = 0.5f*(<a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - THRminf_clipped_to_zero);</div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> integ_max = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>((<a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> + 0.1f),-maxAmp,maxAmp);</div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> integ_min = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>((<a class="code hl_variable" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a> - <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> - 0.1f),-maxAmp,maxAmp);</div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span> </div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>        <span class="comment">// Calculate integrator state, constraining state</span></div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>        <span class="comment">// Set integrator to a max throttle value during climbout</span></div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span>        <a class="code hl_variable" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a> = <a class="code hl_variable" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a> + (<a class="code hl_variable" href="classAP__TECS.html#abcf8efaf10d02b61998c9fbdc4b83d0b">_STE_error</a> * <a class="code hl_function" href="classAP__TECS.html#a95645382d976d27216d75bf47a623d32">_get_i_gain</a>()) * <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> * K_STE2Thr;</div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6ba8fabc74a4ed0781d663336cbf8c9c53d">AP_FixedWing::FlightStage::TAKEOFF</a> || <a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6bae9f1c207fb0d669ee1d8ce8b8ef601e3">AP_FixedWing::FlightStage::ABORT_LANDING</a>) {</div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a83fb08f23acbfcfae39d614c5030eb78">reached_speed_takeoff</a>) {</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>                <span class="comment">// ensure we run at full throttle until we reach the target airspeed</span></div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span>                <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a>, <a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - <a class="code hl_variable" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a>);</div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span>            }</div>
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno">  778</span>            <a class="code hl_variable" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a> = integ_max;</div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span>            <a class="code hl_variable" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a>, integ_min, integ_max);</div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>        }</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span> </div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>        <span class="comment">// Rate limit PD + FF throttle</span></div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>        <span class="comment">// Calculate the throttle increment from the specified slew time</span></div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span>        int8_t throttle_slewrate = <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a4314bf4f1e3814e97a941e0c23f41f62">throttle_slewrate</a>;</div>
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno">  786</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code hl_function" href="classAP__Landing.html#a1429174262aa7716b6b00df8eed75e81">is_on_approach</a>()) {</div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span>            <span class="keyword">const</span> int8_t land_slewrate = <a class="code hl_variable" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code hl_function" href="classAP__Landing.html#a7bf5659737da858f602c2b6543b1a8b0">get_throttle_slewrate</a>();</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span>            <span class="keywordflow">if</span> (land_slewrate &gt; 0) {</div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>                throttle_slewrate = land_slewrate;</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span>            }</div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>        }</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span> </div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span>        <span class="keywordflow">if</span> (throttle_slewrate != 0) {</div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> thrRateIncr = <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> * (<a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - THRminf_clipped_to_zero) * throttle_slewrate * 0.01f;</div>
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno">  795</span> </div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span>            <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a>,</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>                                            <a class="code hl_variable" href="classAP__TECS.html#ab09e31937002d75d0bb3c2b487cd6351">_last_throttle_dem</a> - thrRateIncr,</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span>                                            <a class="code hl_variable" href="classAP__TECS.html#ab09e31937002d75d0bb3c2b487cd6351">_last_throttle_dem</a> + thrRateIncr);</div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>            <a class="code hl_variable" href="classAP__TECS.html#ab09e31937002d75d0bb3c2b487cd6351">_last_throttle_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a>;</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>        }</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span> </div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span>        <span class="comment">// Sum the components.</span></div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span>        <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> + <a class="code hl_variable" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a>;</div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span> </div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span><span class="preprocessor">#if HAL_LOGGING_ENABLED</span></div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().should_log(<a class="code hl_variable" href="classAP__TECS.html#aa6eefe49a8513c2cfb8f638873e96a9b">_log_bitmask</a>)){</div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span>            <a class="code hl_function" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().<a class="code hl_function" href="classAP__Logger.html#abab7cb26825a8dfb1e5e92cf7fcf4152">WriteStreaming</a>(<span class="stringliteral">&quot;TEC3&quot;</span>,<span class="stringliteral">&quot;TimeUS,KED,PED,KEDD,PEDD,TEE,TEDE,FFT,Imin,Imax,I,Emin,Emax&quot;</span>,</div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span>                                        <span class="stringliteral">&quot;Qffffffffffff&quot;</span>,</div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>                                        <a class="code hl_function" href="namespaceAP__HAL.html#a7aa0ce7625c9680e30ff4a99940907a5">AP_HAL::micros64</a>(),</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>                                        (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a41c98d353390a6bb386e5596c5d5a843">_SKEdot</a>,</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>                                        (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#ae8327f2367078272adce7f8f25c605f4">_SPEdot</a>,</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span>                                        (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a002c46ae3fbbd31dd4e110d13dfb9c08">_SKEdot_dem</a>,</div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span>                                        (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#aceeb5b086fc333e84f45afea2a9fbe0c">_SPEdot_dem</a>,</div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span>                                        (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#abcf8efaf10d02b61998c9fbdc4b83d0b">_STE_error</a>,</div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>                                        (<span class="keywordtype">double</span>)STEdot_error,</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>                                        (<span class="keywordtype">double</span>)ff_throttle,</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span>                                        (<span class="keywordtype">double</span>)integ_min,</div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span>                                        (<span class="keywordtype">double</span>)integ_max,</div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span>                                        (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a>,</div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>                                        (<span class="keywordtype">double</span>)SPE_err_min,</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>                                        (<span class="keywordtype">double</span>)SPE_err_max);</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span>        }</div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>    }</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span> </div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span>    <span class="comment">// Constrain throttle demand and record clipping</span></div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> &gt; <a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a>) {</div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span>        <a class="code hl_variable" href="classAP__TECS.html#a9bea918bd520e58ad0f9618e48d80894">_thr_clip_status</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">clipStatus::MAX</a>;</div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span>        <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a>;</div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> &lt; <a class="code hl_variable" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>) {</div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span>        <a class="code hl_variable" href="classAP__TECS.html#a9bea918bd520e58ad0f9618e48d80894">_thr_clip_status</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aace31e2a082d17e038fcc6e3006166653">clipStatus::MIN</a>;</div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span>        <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>;</div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno">  834</span>        <a class="code hl_variable" href="classAP__TECS.html#a9bea918bd520e58ad0f9618e48d80894">_thr_clip_status</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aab50339a10e1de285ac99d4c3990b8693">clipStatus::NONE</a>;</div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span>    }</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>}</div>
</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span> </div>
<div class="foldopen" id="foldopen00838" data-start="{" data-end="}">
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a95645382d976d27216d75bf47a623d32">  838</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classAP__TECS.html#a95645382d976d27216d75bf47a623d32">AP_TECS::_get_i_gain</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>{</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>    <span class="keywordtype">float</span> i_gain = <a class="code hl_variable" href="classAP__TECS.html#a03df83679af5e791ca881cfe7bb1a024">_integGain</a>;</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6ba8fabc74a4ed0781d663336cbf8c9c53d">AP_FixedWing::FlightStage::TAKEOFF</a> || <a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6bae9f1c207fb0d669ee1d8ce8b8ef601e3">AP_FixedWing::FlightStage::ABORT_LANDING</a>) {</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(<a class="code hl_variable" href="classAP__TECS.html#af345f0190f5c67d2b0bfb46613e4893d">_integGain_takeoff</a>)) {</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span>            i_gain = <a class="code hl_variable" href="classAP__TECS.html#af345f0190f5c67d2b0bfb46613e4893d">_integGain_takeoff</a>;</div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span>        }</div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a>) {</div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(<a class="code hl_variable" href="classAP__TECS.html#a6bc6c5cdb2dbeae5abe4091f50646fde">_integGain_land</a>)) {</div>
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno">  847</span>            i_gain = <a class="code hl_variable" href="classAP__TECS.html#a6bc6c5cdb2dbeae5abe4091f50646fde">_integGain_land</a>;</div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span>        }</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>    }</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>    <span class="keywordflow">return</span> i_gain;</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>}</div>
</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span> </div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span><span class="comment">/*</span></div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span><span class="comment">  calculate throttle, non-airspeed case</span></div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00856" data-start="{" data-end="}">
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno"><a class="line" href="classAP__TECS.html#ab65f6851177f49401c2d8ee204603641">  856</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__TECS.html#ab65f6851177f49401c2d8ee204603641">AP_TECS::_update_throttle_without_airspeed</a>(int16_t throttle_nudge, <span class="keywordtype">float</span> pitch_trim_deg)</div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span>{</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>    <span class="comment">// reset clip status after possible use of synthetic airspeed</span></div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>    <a class="code hl_variable" href="classAP__TECS.html#a9bea918bd520e58ad0f9618e48d80894">_thr_clip_status</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aab50339a10e1de285ac99d4c3990b8693">clipStatus::NONE</a>;</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span> </div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span>    <span class="comment">// Calculate throttle demand by interpolating between pitch and throttle limits</span></div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span>    <span class="keywordtype">float</span> nomThr;</div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span>    <span class="comment">//If landing and we don&#39;t have an airspeed sensor and we have a non-zero</span></div>
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno">  864</span>    <span class="comment">//TECS_LAND_THR param then use it</span></div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a> &amp;&amp; <a class="code hl_variable" href="classAP__TECS.html#a08f575ea9d3b0a609fc3c359335c5d4a">_landThrottle</a> &gt;= 0) {</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>        nomThr = (<a class="code hl_variable" href="classAP__TECS.html#a08f575ea9d3b0a609fc3c359335c5d4a">_landThrottle</a> + throttle_nudge) * 0.01f;</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>    } <span class="keywordflow">else</span> { <span class="comment">//not landing or not using TECS_LAND_THR parameter</span></div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>        nomThr = (<a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#af95e2dea4aee3c0a039d842db96028ef">throttle_cruise</a> + throttle_nudge)* 0.01f;</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>    }</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span> </div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>    <span class="comment">// Use a pitch angle that is the sum of a highpassed _pitch_dem and a lowpassed ahrs pitch</span></div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>    <span class="comment">// so that the throttle mapping adjusts for the effect of pitch control errors</span></div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>    <a class="code hl_variable" href="classAP__TECS.html#a41174014c87cbe20f6792779cd5c4fc6">_pitch_demand_lpf</a>.<a class="code hl_function" href="classLowPassFilter.html#aa390849d2e18ff3287f92b89d8657841">apply</a>(<a class="code hl_variable" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a>, <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>);</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> pitch_demand_hpf = <a class="code hl_variable" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> - <a class="code hl_variable" href="classAP__TECS.html#a41174014c87cbe20f6792779cd5c4fc6">_pitch_demand_lpf</a>.<a class="code hl_function" href="classLowPassFilter.html#a34bc75aa770bc6cc0facee3b43a05bec">get</a>();</div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>    <a class="code hl_variable" href="classAP__TECS.html#acd76a5444bb0f89fcaa5a296ff824edb">_pitch_measured_lpf</a>.<a class="code hl_function" href="classLowPassFilter.html#aa390849d2e18ff3287f92b89d8657841">apply</a>(<a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a992a48fcef2892301f1a41b795d2e8c2">get_pitch</a>(), <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>);</div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> pitch_corrected_lpf = <a class="code hl_variable" href="classAP__TECS.html#acd76a5444bb0f89fcaa5a296ff824edb">_pitch_measured_lpf</a>.<a class="code hl_function" href="classLowPassFilter.html#a34bc75aa770bc6cc0facee3b43a05bec">get</a>() - <a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>(pitch_trim_deg);</div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> pitch_blended = pitch_demand_hpf + pitch_corrected_lpf;</div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span> </div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>    <span class="keywordflow">if</span> (pitch_blended &gt; 0.0f &amp;&amp; <a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> &gt; 0.0f)</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>    {</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>        <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = nomThr + (<a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - nomThr) * pitch_blended / <a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>;</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span>    }</div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pitch_blended &lt; 0.0f &amp;&amp; <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> &lt; 0.0f)</div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span>    {</div>
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno">  885</span>        <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = nomThr + (<a class="code hl_variable" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a> - nomThr) * pitch_blended / <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>;</div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span>    }</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span>    <span class="keywordflow">else</span></div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>    {</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span>        <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = nomThr;</div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span>    }</div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span> </div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6ba8fabc74a4ed0781d663336cbf8c9c53d">AP_FixedWing::FlightStage::TAKEOFF</a>) {</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span>        <span class="keyword">const</span> uint32_t now = <a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a0a2e1747411c60941a678801e9af3178">_takeoff_start_ms</a> == 0) {</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>            <a class="code hl_variable" href="classAP__TECS.html#a0a2e1747411c60941a678801e9af3178">_takeoff_start_ms</a> = now;</div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>        }</div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>        <span class="keyword">const</span> uint32_t dt = now - <a class="code hl_variable" href="classAP__TECS.html#a0a2e1747411c60941a678801e9af3178">_takeoff_start_ms</a>;</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>        <span class="keywordflow">if</span> (dt*0.001 &lt; <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#ac946bfe2f77ff45006af53ca5e0ac70e">takeoff_throttle_max_t</a>) {</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>            <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a>;</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>        }</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>        <a class="code hl_variable" href="classAP__TECS.html#a0a2e1747411c60941a678801e9af3178">_takeoff_start_ms</a> = 0;</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>    }</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ae16dc10bcc947d81c729e030bd200a80">is_gliding</a>) {</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>        <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = 0.0f;</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span>    }</div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span> </div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>    <span class="comment">// Calculate additional throttle for turn drag compensation including throttle nudging</span></div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>    <span class="keyword">const</span> <a class="code hl_class" href="classMatrix3.html">Matrix3f</a> &amp;rotMat = <a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a00b2b4af62a91a50e14d8cf114b78639">get_rotation_body_to_ned</a>();</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>    <span class="comment">// Use the demanded rate of change of total energy as the feed-forward demand, but add</span></div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>    <span class="comment">// additional component which scales with (1/cos(bank angle) - 1) to compensate for induced</span></div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span>    <span class="comment">// drag increase during turns.</span></div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>    <span class="keywordtype">float</span> cosPhi = sqrtf((rotMat.<a class="code hl_variable" href="classMatrix3.html#acd7bf3421047fa155168a9c8e5164a2b">a</a>.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>*rotMat.<a class="code hl_variable" href="classMatrix3.html#acd7bf3421047fa155168a9c8e5164a2b">a</a>.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>) + (rotMat.<a class="code hl_variable" href="classMatrix3.html#ae16bed039ad87c3337f15837c33fe2fb">b</a>.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>*rotMat.<a class="code hl_variable" href="classMatrix3.html#ae16bed039ad87c3337f15837c33fe2fb">b</a>.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>));</div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span>    <span class="keywordtype">float</span> STEdot_dem = <a class="code hl_variable" href="classAP__TECS.html#aabf43104f81a4de93b6b21dff03fce37">_rollComp</a> * (1.0f/<a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(cosPhi * cosPhi, 0.1f, 1.0f) - 1.0f);</div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>    <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> + STEdot_dem / (<a class="code hl_variable" href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">_STEdot_max</a> - <a class="code hl_variable" href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">_STEdot_min</a>) * (<a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> - <a class="code hl_variable" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>);</div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>}</div>
</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span> </div>
<div class="foldopen" id="foldopen00919" data-start="{" data-end="}">
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno"><a class="line" href="classAP__TECS.html#ab5ab1cc93f631786bb0c9df8596eef44">  919</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__TECS.html#ab5ab1cc93f631786bb0c9df8596eef44">AP_TECS::_detect_bad_descent</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>{</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span>    <span class="comment">// Detect a demanded airspeed too high for the aircraft to achieve. This will be</span></div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>    <span class="comment">// evident by the following conditions:</span></div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>    <span class="comment">// 1) Underspeed protection not active</span></div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>    <span class="comment">// 2) Specific total energy error &gt; 200 (greater than ~20m height error)</span></div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span>    <span class="comment">// 3) Specific total energy reducing</span></div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span>    <span class="comment">// 4) throttle demand &gt; 90%</span></div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span>    <span class="comment">// If these four conditions exist simultaneously, then the protection</span></div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>    <span class="comment">// mode will be activated.</span></div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>    <span class="comment">// Once active, the following condition are required to stay in the mode</span></div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>    <span class="comment">// 1) Underspeed protection not active</span></div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span>    <span class="comment">// 2) Specific total energy error &gt; 0</span></div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span>    <span class="comment">// This mode will produce an undulating speed and height response as it cuts in and out but will prevent the aircraft from descending into the ground if an unachievable speed demand is set</span></div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span>    <span class="keywordtype">float</span> STEdot = <a class="code hl_variable" href="classAP__TECS.html#ae8327f2367078272adce7f8f25c605f4">_SPEdot</a> + <a class="code hl_variable" href="classAP__TECS.html#a41c98d353390a6bb386e5596c5d5a843">_SKEdot</a>;</div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>    <span class="keywordflow">if</span> (((!<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> &amp;&amp; (<a class="code hl_variable" href="classAP__TECS.html#abcf8efaf10d02b61998c9fbdc4b83d0b">_STE_error</a> &gt; 200.0f) &amp;&amp; (STEdot &lt; 0.0f) &amp;&amp; (<a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a> &gt;= <a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> * 0.9f)) || (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">badDescent</a> &amp;&amp; !<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> &amp;&amp; (<a class="code hl_variable" href="classAP__TECS.html#abcf8efaf10d02b61998c9fbdc4b83d0b">_STE_error</a> &gt; 0.0f))) &amp;&amp; !<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ae16dc10bcc947d81c729e030bd200a80">is_gliding</a>) {</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">badDescent</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">badDescent</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span>    }</div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>}</div>
</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span> </div>
<div class="foldopen" id="foldopen00941" data-start="{" data-end="}">
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a7854ecaf0d95d9da406568583f6e287f">  941</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__TECS.html#a7854ecaf0d95d9da406568583f6e287f">AP_TECS::_update_pitch</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span>{</div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span>    <span class="comment">// Calculate Speed/Height Control Weighting</span></div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>    <span class="comment">// This is used to determine how the pitch control prioritises speed and height control</span></div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>    <span class="comment">// A weighting of 1 provides equal priority (this is the normal mode of operation)</span></div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>    <span class="comment">// A SKE_weighting of 0 provides 100% priority to height control. This is used when no airspeed measurement is available</span></div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span>    <span class="comment">// A SKE_weighting of 2 provides 100% priority to speed control. This is used when an underspeed condition is detected. In this instance, if airspeed</span></div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span>    <span class="comment">// rises above the demanded value, the pitch angle will be increased by the TECS controller.</span></div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span>    <a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__TECS.html#af56a4ac86036ce9aad7063d5838eff6d">_spdWeight</a>, 0.0f, 2.0f);</div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>    <span class="keywordflow">if</span> (!(<a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a4a17a0fa828d3250fef15bee06459418">using_airspeed_sensor</a>() || <a class="code hl_variable" href="classAP__TECS.html#ada65aa88ad9ecd6db58d55dd783b7a1f">_use_synthetic_airspeed</a>)) {</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span>        <a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a> = 0.0f;</div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6baa1ef2e72eb7f85ac2f96f20d1d49ba2c">AP_FixedWing::FlightStage::VTOL</a>) {</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>        <span class="comment">// if we are in VTOL mode then control pitch without regard to</span></div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span>        <span class="comment">// speed. Speed is also taken care of independently of</span></div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>        <span class="comment">// height. This is needed as the usual relationship of speed</span></div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span>        <span class="comment">// and height is broken by the VTOL motors</span></div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span>        <a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a> = 0.0f;</div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a> || <a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6ba8fabc74a4ed0781d663336cbf8c9c53d">AP_FixedWing::FlightStage::TAKEOFF</a> || <a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6bae9f1c207fb0d669ee1d8ce8b8ef601e3">AP_FixedWing::FlightStage::ABORT_LANDING</a> || <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ae16dc10bcc947d81c729e030bd200a80">is_gliding</a>) {</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span>        <a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a> = 2.0f;</div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a>) {</div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ae160176b8170eb74b19b37db1413c70c">_spdWeightLand</a> &lt; 0) {</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>            <span class="comment">// use sliding scale from normal weight down to zero at landing</span></div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>            <span class="keywordtype">float</span> scaled_weight = <a class="code hl_variable" href="classAP__TECS.html#af56a4ac86036ce9aad7063d5838eff6d">_spdWeight</a> * (1.0f - <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__TECS.html#ac94ec1f860105c16d714eeb2f62fade7">_path_proportion</a>,0,1));</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>            <a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(scaled_weight, 0.0f, 2.0f);</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>            <a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__TECS.html#ae160176b8170eb74b19b37db1413c70c">_spdWeightLand</a>, 0.0f, 2.0f);</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>        }</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>    }</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span> </div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>    <span class="keywordtype">float</span> SPE_weighting = 2.0f - <a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a>;</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span> </div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>    <span class="comment">// either weight can fade to 0, but don&#39;t go above 1 to prevent instability if tuned at a speed weight of 1 and wieghting is varied to end points in flight.</span></div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>    SPE_weighting = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aace31e2a082d17e038fcc6e3006166653">MIN</a>(SPE_weighting, 1.0f);</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>    <a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aace31e2a082d17e038fcc6e3006166653">MIN</a>(<a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a>, 1.0f);</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span> </div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>    <span class="comment">// Calculate demanded specific energy balance and error</span></div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span>    <span class="keywordtype">float</span> SEB_dem = <a class="code hl_variable" href="classAP__TECS.html#ae23c577644577aaabc247ea3c42da36a">_SPE_dem</a> * SPE_weighting - <a class="code hl_variable" href="classAP__TECS.html#aeebe79e85106c8096f2902bad5478cc5">_SKE_dem</a> * <a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a>;</div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span>    <span class="keywordtype">float</span> SEB_est = <a class="code hl_variable" href="classAP__TECS.html#ac4c57b27adc7dc7e2edc7bcfc3e59de0">_SPE_est</a> * SPE_weighting - <a class="code hl_variable" href="classAP__TECS.html#a8cf182de07003d0734293f16cb554cae">_SKE_est</a> * <a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a>;</div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>    <span class="keywordtype">float</span> SEB_error = SEB_dem - SEB_est;</div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span> </div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>    <span class="comment">// track demanded height using the specified time constant</span></div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span>    <span class="keywordtype">float</span> SEBdot_dem = <a class="code hl_variable" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a> * <a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a> * SPE_weighting + SEB_error / <a class="code hl_function" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">timeConstant</a>();</div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> SEBdot_dem_min = - <a class="code hl_variable" href="classAP__TECS.html#a7c97ba3776836f5760b4b79f4926e452">_maxSinkRate</a> * <a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> SEBdot_dem_max = <a class="code hl_variable" href="classAP__TECS.html#aea68f106f8f04f199c8470e52532e6a5">_maxClimbRate</a> * <a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>    <span class="keywordflow">if</span> (SEBdot_dem &lt; SEBdot_dem_min) {</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span>        SEBdot_dem = SEBdot_dem_min;</div>
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno">  987</span>        <a class="code hl_variable" href="classAP__TECS.html#ae0d43e99acc9993178e795b9a0ff6d32">_SEBdot_dem_clip</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aace31e2a082d17e038fcc6e3006166653">clipStatus::MIN</a>;</div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (SEBdot_dem &gt; SEBdot_dem_max) {</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>        SEBdot_dem = SEBdot_dem_max;</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span>        <a class="code hl_variable" href="classAP__TECS.html#ae0d43e99acc9993178e795b9a0ff6d32">_SEBdot_dem_clip</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">clipStatus::MAX</a>;</div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>        <a class="code hl_variable" href="classAP__TECS.html#ae0d43e99acc9993178e795b9a0ff6d32">_SEBdot_dem_clip</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aab50339a10e1de285ac99d4c3990b8693">clipStatus::NONE</a>;</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span>    }</div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span> </div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>    <span class="comment">// calculate specific energy balance rate error</span></div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> SEBdot_est = <a class="code hl_variable" href="classAP__TECS.html#ae8327f2367078272adce7f8f25c605f4">_SPEdot</a> * SPE_weighting - <a class="code hl_variable" href="classAP__TECS.html#a41c98d353390a6bb386e5596c5d5a843">_SKEdot</a> * <a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a>;</div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span>    <span class="keywordtype">float</span> SEBdot_error = SEBdot_dem - SEBdot_est;</div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span> </div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span>    <span class="comment">// sum predicted plus damping correction</span></div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span>    <span class="comment">// integral correction is added later</span></div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>    <span class="comment">// During flare a different damping gain is used</span></div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span>    <span class="keywordtype">float</span> pitch_damp = <a class="code hl_variable" href="classAP__TECS.html#a425d214dcedbca7ea37929cc32eaf58c">_ptchDamp</a>;</div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code hl_function" href="classAP__Landing.html#a5ff74bf65eb1a4083cc783af22276828">is_flaring</a>()) {</div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>        pitch_damp = <a class="code hl_variable" href="classAP__TECS.html#a9f94dc1aaf643448d9f0f056bb10137c">_landDamp</a>;</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code hl_function" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(<a class="code hl_variable" href="classAP__TECS.html#ac4ef736b39412013b47c62b8fbd65668">_land_pitch_damp</a>) &amp;&amp; <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a>) {</div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>        pitch_damp = <a class="code hl_variable" href="classAP__TECS.html#ac4ef736b39412013b47c62b8fbd65668">_land_pitch_damp</a>;</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>    }</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span>    <span class="keywordtype">float</span> SEBdot_dem_total = SEBdot_dem + SEBdot_error * pitch_damp;</div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span> </div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>    <span class="comment">// inverse of gain from SEB to pitch angle</span></div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>    <span class="keywordtype">float</span> gainInv = (<a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> * <a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>);</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span> </div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>    <span class="comment">// During climbout/takeoff, bias the demanded pitch angle so that zero speed error produces a pitch angle</span></div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>    <span class="comment">// demand equal to the minimum value (which is )set by the mission plan during this mode). Otherwise the</span></div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span>    <span class="comment">// integrator has to catch up before the nose can be raised to reduce speed during climbout.</span></div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6ba8fabc74a4ed0781d663336cbf8c9c53d">AP_FixedWing::FlightStage::TAKEOFF</a> || <a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6bae9f1c207fb0d669ee1d8ce8b8ef601e3">AP_FixedWing::FlightStage::ABORT_LANDING</a>) {</div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span>        SEBdot_dem_total += <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> * gainInv;</div>
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"> 1018</span>    }</div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span> </div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>    <span class="comment">// don&#39;t allow the integrator to rise by more than 20% of its full</span></div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span>    <span class="comment">// Calculate max and min values for integrator state that will allow for no more than</span></div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>    <span class="comment">// 5deg of saturation. This allows for some pitch variation due to gusts before the</span></div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>    <span class="comment">// integrator is clipped. Otherwise the effectiveness of the integrator will be reduced in turbulence</span></div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span>    <span class="keywordtype">float</span> integSEBdot_min = (gainInv * (<a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> - <a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>(5.0f))) - SEBdot_dem_total;</div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span>    <span class="keywordtype">float</span> integSEBdot_max = (gainInv * (<a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> + <a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>(5.0f))) - SEBdot_dem_total;</div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span> </div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>    <span class="comment">// Calculate integrator state, constraining input if pitch limits are exceeded</span></div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span>    <span class="comment">// don&#39;t allow the integrator to rise by more than 10% of its full</span></div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span>    <span class="comment">// range in one step. This prevents single value glitches from</span></div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span>    <span class="comment">// causing massive integrator changes. See Issue#4066</span></div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>    <span class="keywordtype">float</span> integSEB_range = integSEBdot_max - integSEBdot_min;</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>    <span class="keywordtype">float</span> integSEB_delta = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(SEBdot_error * <a class="code hl_function" href="classAP__TECS.html#a95645382d976d27216d75bf47a623d32">_get_i_gain</a>() * <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>, -integSEB_range*0.1f, integSEB_range*0.1f);</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span> </div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span>    <span class="comment">// predict what pitch will be with uncontrained integration</span></div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span>    <a class="code hl_variable" href="classAP__TECS.html#ab40a7ba8b52a3746d49f0bb1f3ceb197">_pitch_dem_unc</a> = (SEBdot_dem_total + <a class="code hl_variable" href="classAP__TECS.html#a678202e9f1970ba937da805a9e1f26b1">_integSEBdot</a> + integSEB_delta + <a class="code hl_variable" href="classAP__TECS.html#a0bcda5e4ea0098e10b74105f9bc54b8f">_integKE</a>) / gainInv;</div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span> </div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>    <span class="comment">// integrate SEB rate error and apply integrator state limits</span></div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> inhibit_integrator = ((<a class="code hl_variable" href="classAP__TECS.html#ab40a7ba8b52a3746d49f0bb1f3ceb197">_pitch_dem_unc</a> &gt; <a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>) &amp;&amp; integSEB_delta &gt; 0.0f) ||</div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span>                                    ((<a class="code hl_variable" href="classAP__TECS.html#ab40a7ba8b52a3746d49f0bb1f3ceb197">_pitch_dem_unc</a> &lt; <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>) &amp;&amp; integSEB_delta &lt; 0.0f);</div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span>    <span class="keywordflow">if</span> (!inhibit_integrator) {</div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>        <a class="code hl_variable" href="classAP__TECS.html#a678202e9f1970ba937da805a9e1f26b1">_integSEBdot</a> += integSEB_delta;</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>        <a class="code hl_variable" href="classAP__TECS.html#a0bcda5e4ea0098e10b74105f9bc54b8f">_integKE</a> += (<a class="code hl_variable" href="classAP__TECS.html#a8cf182de07003d0734293f16cb554cae">_SKE_est</a> - <a class="code hl_variable" href="classAP__TECS.html#aeebe79e85106c8096f2902bad5478cc5">_SKE_dem</a>) * <a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a> * <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> / <a class="code hl_function" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">timeConstant</a>();</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>        <span class="comment">// fade out integrator if saturating</span></div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> coef = 1.0f - <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> / (<a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> + <a class="code hl_function" href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">timeConstant</a>());</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>        <a class="code hl_variable" href="classAP__TECS.html#a678202e9f1970ba937da805a9e1f26b1">_integSEBdot</a> *= coef;</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span>        <a class="code hl_variable" href="classAP__TECS.html#a0bcda5e4ea0098e10b74105f9bc54b8f">_integKE</a> *= coef;</div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span>    }</div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span>    <a class="code hl_variable" href="classAP__TECS.html#a678202e9f1970ba937da805a9e1f26b1">_integSEBdot</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__TECS.html#a678202e9f1970ba937da805a9e1f26b1">_integSEBdot</a>, integSEBdot_min, integSEBdot_max);</div>
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"> 1050</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> KE_integ_limit = 0.25f * (<a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> - <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>) * gainInv; <span class="comment">// allow speed trim integrator to access 505 of pitch range</span></div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span>    <a class="code hl_variable" href="classAP__TECS.html#a0bcda5e4ea0098e10b74105f9bc54b8f">_integKE</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__TECS.html#a0bcda5e4ea0098e10b74105f9bc54b8f">_integKE</a>, - KE_integ_limit, KE_integ_limit);</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span> </div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span>    <span class="comment">// Calculate pitch demand from specific energy balance signals</span></div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>    <a class="code hl_variable" href="classAP__TECS.html#ab40a7ba8b52a3746d49f0bb1f3ceb197">_pitch_dem_unc</a> = (SEBdot_dem_total + <a class="code hl_variable" href="classAP__TECS.html#a678202e9f1970ba937da805a9e1f26b1">_integSEBdot</a> + <a class="code hl_variable" href="classAP__TECS.html#a0bcda5e4ea0098e10b74105f9bc54b8f">_integKE</a>) / gainInv;</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span> </div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span>    <span class="comment">// Add a feedforward term from demanded airspeed to pitch</span></div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ae16dc10bcc947d81c729e030bd200a80">is_gliding</a>) {</div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>        <a class="code hl_variable" href="classAP__TECS.html#ab40a7ba8b52a3746d49f0bb1f3ceb197">_pitch_dem_unc</a> += (<a class="code hl_variable" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a> - <a class="code hl_variable" href="classAP__TECS.html#ad389410d7cdfeb64006760ea718ef325">_pitch_ff_v0</a>) * <a class="code hl_variable" href="classAP__TECS.html#a9682e4151e22e34446f6ffd066e5f304">_pitch_ff_k</a>;</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>    }</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span> </div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span>    <span class="comment">// Constrain pitch demand</span></div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span>    <a class="code hl_variable" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__TECS.html#ab40a7ba8b52a3746d49f0bb1f3ceb197">_pitch_dem_unc</a>, <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>, <a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>);</div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span> </div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>    <span class="comment">// Rate limit the pitch demand to comply with specified vertical</span></div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span>    <span class="comment">// acceleration limit</span></div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span>    <span class="keywordtype">float</span> ptchRateIncr = <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> * <a class="code hl_variable" href="classAP__TECS.html#aea6abce622dc2d63d55351a2bc4a03de">_vertAccLim</a> / <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>;</div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span> </div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> - <a class="code hl_variable" href="classAP__TECS.html#a920b0cf7e46bcdb0a5081a02c8a75c00">_last_pitch_dem</a>) &gt; ptchRateIncr) {</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>        <a class="code hl_variable" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#a920b0cf7e46bcdb0a5081a02c8a75c00">_last_pitch_dem</a> + ptchRateIncr;</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> - <a class="code hl_variable" href="classAP__TECS.html#a920b0cf7e46bcdb0a5081a02c8a75c00">_last_pitch_dem</a>) &lt; -ptchRateIncr) {</div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span>        <a class="code hl_variable" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#a920b0cf7e46bcdb0a5081a02c8a75c00">_last_pitch_dem</a> - ptchRateIncr;</div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>    }</div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span> </div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>    <a class="code hl_variable" href="classAP__TECS.html#a920b0cf7e46bcdb0a5081a02c8a75c00">_last_pitch_dem</a> = <a class="code hl_variable" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a>;</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span> </div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span><span class="preprocessor">#if HAL_LOGGING_ENABLED</span></div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().should_log(<a class="code hl_variable" href="classAP__TECS.html#aa6eefe49a8513c2cfb8f638873e96a9b">_log_bitmask</a>)){</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>        <span class="comment">// log to AP_Logger</span></div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>        <span class="comment">// @LoggerMessage: TEC2</span></div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>        <span class="comment">// @Vehicles: Plane</span></div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>        <span class="comment">// @Description: Additional information about the Total Energy Control System</span></div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>        <span class="comment">// @URL: http://ardupilot.org/plane/docs/tecs-total-energy-control-system-for-speed-height-tuning-guide.html</span></div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>        <span class="comment">// @Field: TimeUS: Time since system startup</span></div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>        <span class="comment">// @Field: PEW: Potential energy weighting</span></div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>        <span class="comment">// @Field: KEW: Kinetic energy weighting</span></div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>        <span class="comment">// @Field: EBD: Energy balance demand</span></div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>        <span class="comment">// @Field: EBE: Energy balance error</span></div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>        <span class="comment">// @Field: EBDD: Energy balance rate demand</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>        <span class="comment">// @Field: EBDE: Energy balance rate error</span></div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>        <span class="comment">// @Field: EBDDT: Energy balance rate demand + Energy balance rate error*pitch_damping</span></div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span>        <span class="comment">// @Field: Imin: Minimum integrator value</span></div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span>        <span class="comment">// @Field: Imax: Maximum integrator value</span></div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>        <span class="comment">// @Field: I: Energy balance error integral</span></div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>        <span class="comment">// @Field: KI: Pitch demand kinetic energy integral</span></div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>        <span class="comment">// @Field: pmin: Pitch min</span></div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span>        <span class="comment">// @Field: pmax: Pitch max</span></div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>        <a class="code hl_function" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().<a class="code hl_function" href="classAP__Logger.html#abab7cb26825a8dfb1e5e92cf7fcf4152">WriteStreaming</a>(<span class="stringliteral">&quot;TEC2&quot;</span>,<span class="stringliteral">&quot;TimeUS,PEW,KEW,EBD,EBE,EBDD,EBDE,EBDDT,Imin,Imax,I,KI,pmin,pmax&quot;</span>,</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>                                    <span class="stringliteral">&quot;Qfffffffffffff&quot;</span>,</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>                                    <a class="code hl_function" href="namespaceAP__HAL.html#a7aa0ce7625c9680e30ff4a99940907a5">AP_HAL::micros64</a>(),</div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>                                    (<span class="keywordtype">double</span>)SPE_weighting,</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a>,</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>                                    (<span class="keywordtype">double</span>)SEB_dem,</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>                                    (<span class="keywordtype">double</span>)SEB_est,</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span>                                    (<span class="keywordtype">double</span>)SEBdot_dem,</div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>                                    (<span class="keywordtype">double</span>)SEBdot_est,</div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>                                    (<span class="keywordtype">double</span>)SEBdot_dem_total,</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>                                    (<span class="keywordtype">double</span>)integSEBdot_min,</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>                                    (<span class="keywordtype">double</span>)integSEBdot_max,</div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a678202e9f1970ba937da805a9e1f26b1">_integSEBdot</a>,</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a0bcda5e4ea0098e10b74105f9bc54b8f">_integKE</a>,</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>,</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>);</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>    }</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>}</div>
</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span> </div>
<div class="foldopen" id="foldopen01117" data-start="{" data-end="}">
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a2ecab25bceacdfb0c15694ff8428608f"> 1117</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__TECS.html#a2ecab25bceacdfb0c15694ff8428608f">AP_TECS::_initialise_states</a>(int32_t ptchMinCO_cd, <span class="keywordtype">float</span> hgt_afe)</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span>{</div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>    <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a2bcfa703099ac31a48e80d95d19bf003">reset</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span> </div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>    <span class="comment">// Initialise states and variables if DT &gt; 0.2 second or in climbout</span></div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> &gt; 0.2f || <a class="code hl_variable" href="classAP__TECS.html#af328e7107be4e75cf496abd5f42a7e05">_need_reset</a>) {</div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>        <a class="code hl_variable" href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">_SKE_weighting</a>        = 1.0f;</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>        <a class="code hl_variable" href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">_integTHR_state</a>       = 0.0f;</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>        <a class="code hl_variable" href="classAP__TECS.html#a678202e9f1970ba937da805a9e1f26b1">_integSEBdot</a>          = 0.0f;</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>        <a class="code hl_variable" href="classAP__TECS.html#a0bcda5e4ea0098e10b74105f9bc54b8f">_integKE</a>              = 0.0f;</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span>        <a class="code hl_variable" href="classAP__TECS.html#ab09e31937002d75d0bb3c2b487cd6351">_last_throttle_dem</a>    = <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#af95e2dea4aee3c0a039d842db96028ef">throttle_cruise</a> * 0.01f;</div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>        <a class="code hl_variable" href="classAP__TECS.html#a920b0cf7e46bcdb0a5081a02c8a75c00">_last_pitch_dem</a>       = <a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a992a48fcef2892301f1a41b795d2e8c2">get_pitch</a>();</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>        <a class="code hl_variable" href="classAP__TECS.html#ac53298961dc0d4983cc0934174ab7222">_hgt_afe</a>              = hgt_afe;</div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>        <a class="code hl_variable" href="classAP__TECS.html#adaae33ce3130a875fa9afb1cef61c725">_hgt_dem_in_prev</a>      = hgt_afe;</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>        <a class="code hl_variable" href="classAP__TECS.html#a045b368f51504b33da3916b166908fcc">_hgt_dem_lpf</a>          = hgt_afe;</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>        <a class="code hl_variable" href="classAP__TECS.html#ad838b3ab01f1d007aff6483c5164dd32">_hgt_dem_rate_ltd</a>     = hgt_afe;</div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>        <a class="code hl_variable" href="classAP__TECS.html#a3f83a3c0553d099adb949ef55e05fa2e">_hgt_dem_prev</a>         = hgt_afe;</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>        <a class="code hl_variable" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a>          = <a class="code hl_variable" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a>;</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a2bcfa703099ac31a48e80d95d19bf003">reset</a>          = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>        <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>                   = 0.02f; <span class="comment">// when first starting TECS, use the most likely time constant</span></div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>        <a class="code hl_variable" href="classAP__TECS.html#a365f9c40b77c29164902b859e2783113">_lag_comp_hgt_offset</a>  = 0.0f;</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span>        <a class="code hl_variable" href="classAP__TECS.html#ae1b9ac9075a77848f261c56f9083e314">_post_TO_hgt_offset</a>   = 0.0f;</div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span>        <a class="code hl_variable" href="classAP__TECS.html#a0a2e1747411c60941a678801e9af3178">_takeoff_start_ms</a> = 0;</div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>        <a class="code hl_variable" href="classAP__TECS.html#a07f643564d913cf9020cd4a1b68f139d">_use_synthetic_airspeed_once</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span> </div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a>            = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">badDescent</a>            = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a83fb08f23acbfcfae39d614c5030eb78">reached_speed_takeoff</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>        <a class="code hl_variable" href="classAP__TECS.html#af328e7107be4e75cf496abd5f42a7e05">_need_reset</a>                  = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span> </div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span>        <span class="comment">// misc variables used for alternative precision landing pitch control</span></div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>        <a class="code hl_variable" href="classAP__TECS.html#a3979de95efa8eca22c0890607f5db8f6">_hgt_at_start_of_flare</a>    = 0.0f;</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>        <a class="code hl_variable" href="classAP__TECS.html#a14cbf46b51ab9bcdb52a5b02abf269eb">_hgt_rate_at_flare_entry</a>  = 0.0f;</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>        <a class="code hl_variable" href="classAP__TECS.html#ac53298961dc0d4983cc0934174ab7222">_hgt_afe</a>                  = 0.0f;</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>        <a class="code hl_variable" href="classAP__TECS.html#a8b0d9a0da66f68c57f060720bf2a1014">_pitch_min_at_flare_entry</a> = 0.0f;</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span> </div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>        <a class="code hl_variable" href="classAP__TECS.html#a91ce1f5e2d671c0d134997fa9859919e">_max_climb_scaler</a> = 1.0f;</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span>        <a class="code hl_variable" href="classAP__TECS.html#ad9ffe375b8f411a6ad60f5e38a47b7a1">_max_sink_scaler</a> = 1.0f;</div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span> </div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> fc = 1.0f / (<a class="code hl_define" href="definitions_8h.html#a4aa2c43b09c1300c334821f5507d6f71">M_2PI</a> * <a class="code hl_variable" href="classAP__TECS.html#a372aa3467ce5ffef5b34a1046f6c1392">_timeConst</a>);</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>        <a class="code hl_variable" href="classAP__TECS.html#a41174014c87cbe20f6792779cd5c4fc6">_pitch_demand_lpf</a>.<a class="code hl_function" href="classLowPassFilter.html#a1cc5016de137b01080fa0a6fa7fe53cd">set_cutoff_frequency</a>(fc);</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>        <a class="code hl_variable" href="classAP__TECS.html#acd76a5444bb0f89fcaa5a296ff824edb">_pitch_measured_lpf</a>.<a class="code hl_function" href="classLowPassFilter.html#a1cc5016de137b01080fa0a6fa7fe53cd">set_cutoff_frequency</a>(fc);</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>        <a class="code hl_variable" href="classAP__TECS.html#a41174014c87cbe20f6792779cd5c4fc6">_pitch_demand_lpf</a>.<a class="code hl_function" href="classLowPassFilter.html#adad51ea3b156f167fff0fb586a912cb5">reset</a>(<a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a992a48fcef2892301f1a41b795d2e8c2">get_pitch</a>());</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>        <a class="code hl_variable" href="classAP__TECS.html#acd76a5444bb0f89fcaa5a296ff824edb">_pitch_measured_lpf</a>.<a class="code hl_function" href="classLowPassFilter.html#adad51ea3b156f167fff0fb586a912cb5">reset</a>(<a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a992a48fcef2892301f1a41b795d2e8c2">get_pitch</a>());</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span> </div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6ba8fabc74a4ed0781d663336cbf8c9c53d">AP_FixedWing::FlightStage::TAKEOFF</a> || <a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6bae9f1c207fb0d669ee1d8ce8b8ef601e3">AP_FixedWing::FlightStage::ABORT_LANDING</a>) {</div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>        <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>            = 0.000174533f * ptchMinCO_cd;</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>        <a class="code hl_variable" href="classAP__TECS.html#ac53298961dc0d4983cc0934174ab7222">_hgt_afe</a>              = hgt_afe;</div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>        <a class="code hl_variable" href="classAP__TECS.html#a045b368f51504b33da3916b166908fcc">_hgt_dem_lpf</a>          = hgt_afe;</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span>        <a class="code hl_variable" href="classAP__TECS.html#ad838b3ab01f1d007aff6483c5164dd32">_hgt_dem_rate_ltd</a>     = hgt_afe;</div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>        <a class="code hl_variable" href="classAP__TECS.html#a3f83a3c0553d099adb949ef55e05fa2e">_hgt_dem_prev</a>         = hgt_afe;</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span>        <a class="code hl_variable" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a>              = hgt_afe;</div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>        <a class="code hl_variable" href="classAP__TECS.html#adaae33ce3130a875fa9afb1cef61c725">_hgt_dem_in_prev</a>      = hgt_afe;</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span>        <a class="code hl_variable" href="classAP__TECS.html#aaf33c63f1727d62dbe00fa4ca98ad567">_hgt_dem_in_raw</a>       = hgt_afe;</div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>        <a class="code hl_variable" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a>          = <a class="code hl_variable" href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">_TAS_dem</a>;</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a2bcfa703099ac31a48e80d95d19bf003">reset</a>          = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span>        <a class="code hl_variable" href="classAP__TECS.html#ae1b9ac9075a77848f261c56f9083e314">_post_TO_hgt_offset</a>   = <a class="code hl_variable" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a> * <a class="code hl_variable" href="classAP__TECS.html#ae466e45747e9b2eddb0ca00cbf8f5a7f">_hgt_dem_tconst</a>;</div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">underspeed</a>     = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"> 1175</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">badDescent</a>     = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span> </div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>        <a class="code hl_variable" href="classAP__TECS.html#a91ce1f5e2d671c0d134997fa9859919e">_max_climb_scaler</a> = 1.0f;</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>        <a class="code hl_variable" href="classAP__TECS.html#ad9ffe375b8f411a6ad60f5e38a47b7a1">_max_sink_scaler</a> = 1.0f;</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span> </div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>        <a class="code hl_variable" href="classAP__TECS.html#a41174014c87cbe20f6792779cd5c4fc6">_pitch_demand_lpf</a>.<a class="code hl_function" href="classLowPassFilter.html#adad51ea3b156f167fff0fb586a912cb5">reset</a>(<a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a992a48fcef2892301f1a41b795d2e8c2">get_pitch</a>());</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span>        <a class="code hl_variable" href="classAP__TECS.html#acd76a5444bb0f89fcaa5a296ff824edb">_pitch_measured_lpf</a>.<a class="code hl_function" href="classLowPassFilter.html#adad51ea3b156f167fff0fb586a912cb5">reset</a>(<a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a992a48fcef2892301f1a41b795d2e8c2">get_pitch</a>());</div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>    }</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span> </div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> != <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6ba8fabc74a4ed0781d663336cbf8c9c53d">AP_FixedWing::FlightStage::TAKEOFF</a> &amp;&amp; <a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> != <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6bae9f1c207fb0d669ee1d8ce8b8ef601e3">AP_FixedWing::FlightStage::ABORT_LANDING</a>) {</div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>        <span class="comment">// reset takeoff speed flag when not in takeoff</span></div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a83fb08f23acbfcfae39d614c5030eb78">reached_speed_takeoff</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>    }</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>}</div>
</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span> </div>
<div class="foldopen" id="foldopen01190" data-start="{" data-end="}">
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a6eab6d44faa6a51fbdd7a59279e17035"> 1190</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__TECS.html#a6eab6d44faa6a51fbdd7a59279e17035">AP_TECS::_update_STE_rate_lim</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span>{</div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span>    <span class="comment">// Calculate Specific Total Energy Rate Limits &amp; deceleration rate bounds</span></div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span>    <span class="comment">// Keep the 50% energy margin from the original velRate calculation for now</span></div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>    <span class="comment">// This is a trivial calculation at the moment but will get bigger once we start adding altitude effects</span></div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>    <a class="code hl_variable" href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">_STEdot_max</a> = <a class="code hl_variable" href="classAP__TECS.html#ac068b4c20d6a91be0dce44f2ed7363a9">_climb_rate_limit</a> * <a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>    <a class="code hl_variable" href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">_STEdot_min</a> = - <a class="code hl_variable" href="classAP__TECS.html#ac5836e7e185100808a4bb2ba8c18e8b5">_minSinkRate</a> * <a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>    <a class="code hl_variable" href="classAP__TECS.html#a334c90dbafe8f184467d58b1e631ca9f">_STEdot_neg_max</a> = - <a class="code hl_variable" href="classAP__TECS.html#a7c97ba3776836f5760b4b79f4926e452">_maxSinkRate</a> * <a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>;</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span>}</div>
</div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span> </div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span> </div>
<div class="foldopen" id="foldopen01201" data-start="{" data-end="}">
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"><a class="line" href="classAP__TECS.html#a09c40b70f25eeac0647626f6b5caf78e"> 1201</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__TECS.html#a09c40b70f25eeac0647626f6b5caf78e">AP_TECS::update_pitch_throttle</a>(int32_t hgt_dem_cm,</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>                                    int32_t EAS_dem_cm,</div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>                                    <span class="keyword">enum</span> <a class="code hl_enumeration" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6b">AP_FixedWing::FlightStage</a> flight_stage,</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>                                    <span class="keywordtype">float</span> distance_beyond_land_wp,</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span>                                    int32_t ptchMinCO_cd,</div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span>                                    int16_t throttle_nudge,</div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span>                                    <span class="keywordtype">float</span> hgt_afe,</div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>                                    <span class="keywordtype">float</span> load_factor,</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>                                    <span class="keywordtype">float</span> pitch_trim_deg)</div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>{</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span>    uint64_t now = <a class="code hl_function" href="namespaceAP__HAL.html#a7aa0ce7625c9680e30ff4a99940907a5">AP_HAL::micros64</a>();</div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span>    <span class="comment">// check how long since we last did the 50Hz update; do nothing in</span></div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span>    <span class="comment">// this loop if that hasn&#39;t run for some signficant period of</span></div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>    <span class="comment">// time.  Notably, it may never have run, leaving _TAS_state as</span></div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>    <span class="comment">// zero and subsequently division-by-zero errors.</span></div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> _DT_for_update_50hz = (now - <a class="code hl_variable" href="classAP__TECS.html#ab4e43605acf8d36a5837334710d9c104">_update_50hz_last_usec</a>) * 1.0e-6f;</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ab4e43605acf8d36a5837334710d9c104">_update_50hz_last_usec</a> == 0 || _DT_for_update_50hz &gt; 1.0) {</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>        <span class="comment">// more than 1 second since it was run, don&#39;t do anything yet:</span></div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>    }</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span> </div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>    <span class="comment">// Calculate time in seconds since last update</span></div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span>    <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> = (now - <a class="code hl_variable" href="classAP__TECS.html#a8db124836a733bfcee48843fb0ff28db">_update_pitch_throttle_last_usec</a>) * 1.0e-6f;</div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>    <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>, 0.001f);</div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>    <a class="code hl_variable" href="classAP__TECS.html#a8db124836a733bfcee48843fb0ff28db">_update_pitch_throttle_last_usec</a> = now;</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span> </div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span>    <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ae16dc10bcc947d81c729e030bd200a80">is_gliding</a> = <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ae857503d52c95f7f2290290e229ee1d5">gliding_requested</a> || <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ae76491c5502bc87945e7ef5ee9a5b521">propulsion_failed</a> || <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a5ecfa2480411bccfd392a771d56988d1">throttle_max</a>==0;</div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span>    <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">is_doing_auto_land</a> = (flight_stage == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6ba479a809c0b6eaaefd3b1df16f976df06">AP_FixedWing::FlightStage::LAND</a>);</div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span>    <a class="code hl_variable" href="classAP__TECS.html#a4dc0dac47faf337837f8c47c21494d67">_distance_beyond_land_wp</a> = distance_beyond_land_wp;</div>
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"> 1230</span>    <a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> = flight_stage;</div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span> </div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>    <span class="comment">// Convert inputs</span></div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>    <a class="code hl_variable" href="classAP__TECS.html#aaf33c63f1727d62dbe00fa4ca98ad567">_hgt_dem_in_raw</a> = hgt_dem_cm * 0.01f;</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>    <a class="code hl_variable" href="classAP__TECS.html#ae52e17111e872c29d269209efb7d5989">_EAS_dem</a> = EAS_dem_cm * 0.01f;</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>    <a class="code hl_variable" href="classAP__TECS.html#ac53298961dc0d4983cc0934174ab7222">_hgt_afe</a> = hgt_afe;</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span>    <a class="code hl_variable" href="classAP__TECS.html#a94b18fc8586c008a3b57b1630d222a96">_load_factor</a> = load_factor;</div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span> </div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span>    <span class="comment">// Don&#39;t allow height deamnd to continue changing in a direction that saturates vehicle manoeuvre limits</span></div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span>    <span class="comment">// if vehicle is unable to follow the demanded climb or descent.</span></div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> max_climb_condition = (<a class="code hl_variable" href="classAP__TECS.html#ab40a7ba8b52a3746d49f0bb1f3ceb197">_pitch_dem_unc</a> &gt; <a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> || <a class="code hl_variable" href="classAP__TECS.html#a9bea918bd520e58ad0f9618e48d80894">_thr_clip_status</a> == <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">clipStatus::MAX</a>) &amp;&amp;</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>                                    !(<a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6ba8fabc74a4ed0781d663336cbf8c9c53d">AP_FixedWing::FlightStage::TAKEOFF</a> || <a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6bae9f1c207fb0d669ee1d8ce8b8ef601e3">AP_FixedWing::FlightStage::ABORT_LANDING</a>);</div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> max_descent_condition = <a class="code hl_variable" href="classAP__TECS.html#ab40a7ba8b52a3746d49f0bb1f3ceb197">_pitch_dem_unc</a> &lt; <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> || <a class="code hl_variable" href="classAP__TECS.html#a9bea918bd520e58ad0f9618e48d80894">_thr_clip_status</a> == <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aace31e2a082d17e038fcc6e3006166653">clipStatus::MIN</a>;</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>    <span class="keywordflow">if</span> (max_climb_condition &amp;&amp; <a class="code hl_variable" href="classAP__TECS.html#aaf33c63f1727d62dbe00fa4ca98ad567">_hgt_dem_in_raw</a> &gt; <a class="code hl_variable" href="classAP__TECS.html#adaae33ce3130a875fa9afb1cef61c725">_hgt_dem_in_prev</a>) {</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>        <a class="code hl_variable" href="classAP__TECS.html#a91e85bf0a00beec54598231ee0cca7c5">_hgt_dem_in</a> = <a class="code hl_variable" href="classAP__TECS.html#adaae33ce3130a875fa9afb1cef61c725">_hgt_dem_in_prev</a>;</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (max_descent_condition &amp;&amp; <a class="code hl_variable" href="classAP__TECS.html#aaf33c63f1727d62dbe00fa4ca98ad567">_hgt_dem_in_raw</a> &lt; <a class="code hl_variable" href="classAP__TECS.html#adaae33ce3130a875fa9afb1cef61c725">_hgt_dem_in_prev</a>) {</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span>        <a class="code hl_variable" href="classAP__TECS.html#a91e85bf0a00beec54598231ee0cca7c5">_hgt_dem_in</a> = <a class="code hl_variable" href="classAP__TECS.html#adaae33ce3130a875fa9afb1cef61c725">_hgt_dem_in_prev</a>;</div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span>        <a class="code hl_variable" href="classAP__TECS.html#a91e85bf0a00beec54598231ee0cca7c5">_hgt_dem_in</a> = <a class="code hl_variable" href="classAP__TECS.html#aaf33c63f1727d62dbe00fa4ca98ad567">_hgt_dem_in_raw</a>;</div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>    }</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span> </div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a70597e95dd49631eb0f9ad9aad997282">takeoff_throttle_max</a> != 0 &amp;&amp;</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>        (<a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6ba8fabc74a4ed0781d663336cbf8c9c53d">AP_FixedWing::FlightStage::TAKEOFF</a> || <a class="code hl_variable" href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">_flight_stage</a> == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6bae9f1c207fb0d669ee1d8ce8b8ef601e3">AP_FixedWing::FlightStage::ABORT_LANDING</a>)) {</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>        <a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a>  = <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a70597e95dd49631eb0f9ad9aad997282">takeoff_throttle_max</a> * 0.01f;</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>        <a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a>  = <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a5ecfa2480411bccfd392a771d56988d1">throttle_max</a> * 0.01f;</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span>    }</div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span>    <a class="code hl_variable" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>  = <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a2b9a5e70b886a6cdd9467a25a3e79299">throttle_min</a> * 0.01f;</div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span> </div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>    <span class="comment">// min of 1% throttle range to prevent a numerical error</span></div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>    <a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">_THRmaxf</a>, <a class="code hl_variable" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a>+0.01);</div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span> </div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>    <span class="comment">// work out the maximum and minimum pitch</span></div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>    <span class="comment">// if TECS_PITCH_{MAX,MIN} isn&#39;t set then use</span></div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>    <span class="comment">// LIM_PITCH_{MAX,MIN}. Don&#39;t allow TECS_PITCH_{MAX,MIN} to be</span></div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>    <span class="comment">// larger than LIM_PITCH_{MAX,MIN}</span></div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a55b1f4cfa9b6cb2beb622316c0089d70">_pitch_max</a> == 0) {</div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span>        <a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> = <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a5d7e8ce2b3ffd287a1d62a478f25886e">pitch_limit_max</a>;</div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>        <a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aace31e2a082d17e038fcc6e3006166653">MIN</a>(<a class="code hl_variable" href="classAP__TECS.html#a55b1f4cfa9b6cb2beb622316c0089d70">_pitch_max</a>, <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a5d7e8ce2b3ffd287a1d62a478f25886e">pitch_limit_max</a>);</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>    }</div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span> </div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad483df34b0acfb5b06bb97826f6aa55f">_pitch_min</a> &gt;= 0) {</div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span>        <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a47294736b4f6b3cf4498ee7fa134652f">pitch_limit_min</a>;</div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>        <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#ad483df34b0acfb5b06bb97826f6aa55f">_pitch_min</a>, <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a47294736b4f6b3cf4498ee7fa134652f">pitch_limit_min</a>);</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>    }</div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span> </div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span>    <span class="comment">// apply temporary pitch limit and clear</span></div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#adb53c053feaac9e2b5fa7704cfd95d2c">_pitch_max_limit</a> &lt; 90) {</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span>        <a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>, -90, <a class="code hl_variable" href="classAP__TECS.html#adb53c053feaac9e2b5fa7704cfd95d2c">_pitch_max_limit</a>);</div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>        <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>, -<a class="code hl_variable" href="classAP__TECS.html#adb53c053feaac9e2b5fa7704cfd95d2c">_pitch_max_limit</a>, <a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>);</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span>        <a class="code hl_variable" href="classAP__TECS.html#adb53c053feaac9e2b5fa7704cfd95d2c">_pitch_max_limit</a> = 90;</div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>    }</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span> </div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code hl_function" href="classAP__Landing.html#a1429174262aa7716b6b00df8eed75e81">is_on_approach</a>()) {</div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span>        <span class="comment">// reset land pitch min when not landing</span></div>
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"> 1287</span>        <a class="code hl_variable" href="classAP__TECS.html#ad6f0fd12653837e232d71ae0f5755c23">_land_pitch_min</a> = <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>;</div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span>    }</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span> </div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>    <span class="comment">// calculate the expected pitch angle from the demanded climb rate and airspeed fo ruse during approach and flare</span></div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code hl_function" href="classAP__Landing.html#a5ff74bf65eb1a4083cc783af22276828">is_flaring</a>()) {</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>        <span class="comment">// smoothly move the min pitch to the required minimum at touchdown</span></div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span>        <span class="keywordtype">float</span> p; <span class="comment">// 0 at start of flare, 1 at finish</span></div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__TECS.html#a549342fec91b2243b161346a92762767">_flare_initialised</a>) {</div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span>            p = 0.0f;</div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a3979de95efa8eca22c0890607f5db8f6">_hgt_at_start_of_flare</a> &gt; <a class="code hl_variable" href="classAP__TECS.html#a984593f4daada614bd626b6550bcb4a7">_flare_holdoff_hgt</a>) {</div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>            p = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>((<a class="code hl_variable" href="classAP__TECS.html#a3979de95efa8eca22c0890607f5db8f6">_hgt_at_start_of_flare</a> - <a class="code hl_variable" href="classAP__TECS.html#ac53298961dc0d4983cc0934174ab7222">_hgt_afe</a>) / <a class="code hl_variable" href="classAP__TECS.html#a3979de95efa8eca22c0890607f5db8f6">_hgt_at_start_of_flare</a>, 0.0f, 1.0f);</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>            p = 1.0f;</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>        }</div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> pitch_limit_deg = (1.0f - p) * <a class="code hl_variable" href="classAP__TECS.html#a8b0d9a0da66f68c57f060720bf2a1014">_pitch_min_at_flare_entry</a> + p * 0.01f * <a class="code hl_variable" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code hl_function" href="classAP__Landing.html#aea63b41c71cd665c1933b83cd681e0b0">get_pitch_cd</a>();</div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span> </div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>        <span class="comment">// in flare use min pitch from LAND_PITCH_DEG</span></div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span>        <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>, pitch_limit_deg);</div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span> </div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span>        <span class="comment">// and use max pitch from TECS_LAND_PMAX</span></div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a0ba5d70bc0549b5226f1fe5179aba1b0">_land_pitch_max</a> != 0) {</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>            <span class="comment">// note that this allows a flare pitch outside the normal TECS auto limits</span></div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>            <a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> = <a class="code hl_variable" href="classAP__TECS.html#a0ba5d70bc0549b5226f1fe5179aba1b0">_land_pitch_max</a>;</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>        }</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span> </div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span>        <span class="comment">// and allow zero throttle</span></div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span>        <a class="code hl_variable" href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">_THRminf</a> = 0;</div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code hl_function" href="classAP__Landing.html#a1429174262aa7716b6b00df8eed75e81">is_on_approach</a>()) {</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>        <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>, <a class="code hl_variable" href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">aparm</a>.<a class="code hl_variable" href="structAP__FixedWing.html#a47294736b4f6b3cf4498ee7fa134652f">pitch_limit_min</a>);</div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>        <a class="code hl_variable" href="classAP__TECS.html#a8b0d9a0da66f68c57f060720bf2a1014">_pitch_min_at_flare_entry</a> = <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>;</div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>        <a class="code hl_variable" href="classAP__TECS.html#a549342fec91b2243b161346a92762767">_flare_initialised</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span>        <a class="code hl_variable" href="classAP__TECS.html#a549342fec91b2243b161346a92762767">_flare_initialised</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span>    }</div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span> </div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">_landing</a>.<a class="code hl_function" href="classAP__Landing.html#a1429174262aa7716b6b00df8eed75e81">is_on_approach</a>()) {</div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>        <span class="comment">// don&#39;t allow the lower bound of pitch to decrease, nor allow</span></div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span>        <span class="comment">// it to increase rapidly. This prevents oscillation of pitch</span></div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span>        <span class="comment">// demand while in landing approach based on rapidly changing</span></div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span>        <span class="comment">// time to flare estimate</span></div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#ad6f0fd12653837e232d71ae0f5755c23">_land_pitch_min</a> &lt;= -90) {</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>            <a class="code hl_variable" href="classAP__TECS.html#ad6f0fd12653837e232d71ae0f5755c23">_land_pitch_min</a> = <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>;</div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>        }</div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> flare_pitch_range = 20;</div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> delta_per_loop = (flare_pitch_range/<a class="code hl_variable" href="classAP__TECS.html#aa6b37a801da411b61ba0a9fee93940cb">_landTimeConst</a>) * <a class="code hl_variable" href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">_DT</a>;</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span>        <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aace31e2a082d17e038fcc6e3006166653">MIN</a>(<a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>, <a class="code hl_variable" href="classAP__TECS.html#ad6f0fd12653837e232d71ae0f5755c23">_land_pitch_min</a>+delta_per_loop);</div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>        <a class="code hl_variable" href="classAP__TECS.html#ad6f0fd12653837e232d71ae0f5755c23">_land_pitch_min</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#ad6f0fd12653837e232d71ae0f5755c23">_land_pitch_min</a>, <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>);</div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>        <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#ad6f0fd12653837e232d71ae0f5755c23">_land_pitch_min</a>, <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>);</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>    }</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span> </div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span>    <span class="keywordflow">if</span> (flight_stage == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6ba8fabc74a4ed0781d663336cbf8c9c53d">AP_FixedWing::FlightStage::TAKEOFF</a> || flight_stage == <a class="code hl_enumvalue" href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6bae9f1c207fb0d669ee1d8ce8b8ef601e3">AP_FixedWing::FlightStage::ABORT_LANDING</a>) {</div>
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"> 1338</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a83fb08f23acbfcfae39d614c5030eb78">reached_speed_takeoff</a> &amp;&amp; <a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a> &gt;= <a class="code hl_variable" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a>) {</div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span>            <span class="comment">// we have reached our target speed in takeoff, allow for</span></div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>            <span class="comment">// normal throttle control</span></div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span>            <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#a83fb08f23acbfcfae39d614c5030eb78">reached_speed_takeoff</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>        }</div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>    }</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span> </div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span>    <span class="comment">// convert to radians</span></div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span>    <a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> = <a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>(<a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>);</div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>    <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a> = <a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>(<a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>);</div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span> </div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>    <span class="comment">// don&#39;t allow max pitch to go below min pitch</span></div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>    <a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a> = <a class="code hl_enumvalue" href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">MAX</a>(<a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>, <a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>);</div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span> </div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span>    <span class="comment">// initialise selected states and variables if DT &gt; 1 second or in climbout</span></div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span>    <a class="code hl_function" href="classAP__TECS.html#a2ecab25bceacdfb0c15694ff8428608f">_initialise_states</a>(ptchMinCO_cd, hgt_afe);</div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span> </div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>    <span class="comment">// Calculate Specific Total Energy Rate Limits</span></div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span>    <a class="code hl_function" href="classAP__TECS.html#a6eab6d44faa6a51fbdd7a59279e17035">_update_STE_rate_lim</a>();</div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span> </div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>    <span class="comment">// Calculate the speed demand</span></div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>    <a class="code hl_function" href="classAP__TECS.html#a376593eecc4ab66559947a144106bdd5">_update_speed_demand</a>();</div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span> </div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span>    <span class="comment">// Calculate the height demand</span></div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span>    <a class="code hl_function" href="classAP__TECS.html#a91aeb22f68e2957bfad6285ec41182cf">_update_height_demand</a>();</div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span> </div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>    <span class="comment">// Detect underspeed condition</span></div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span>    <a class="code hl_function" href="classAP__TECS.html#a7318e1b5998b99f4febe0d53040c5744">_detect_underspeed</a>();</div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span> </div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>    <span class="comment">// Calculate specific energy quantitiues</span></div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>    <a class="code hl_function" href="classAP__TECS.html#acf4aed1a469a3bce5d1f68ee8a73fed6">_update_energies</a>();</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span> </div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span>    <span class="comment">// Calculate pitch demand</span></div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>    <a class="code hl_function" href="classAP__TECS.html#a7854ecaf0d95d9da406568583f6e287f">_update_pitch</a>();</div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span> </div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>    <span class="comment">// Calculate throttle demand - use simple pitch to throttle if no</span></div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span>    <span class="comment">// airspeed sensor.</span></div>
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"> 1375</span>    <span class="comment">// Note that caller can demand the use of</span></div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>    <span class="comment">// synthetic airspeed for one loop if needed. This is required</span></div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>    <span class="comment">// during QuadPlane transition when pitch is constrained</span></div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">_ahrs</a>.<a class="code hl_function" href="classAP__AHRS.html#a4a17a0fa828d3250fef15bee06459418">using_airspeed_sensor</a>() || <a class="code hl_variable" href="classAP__TECS.html#ada65aa88ad9ecd6db58d55dd783b7a1f">_use_synthetic_airspeed</a> || <a class="code hl_variable" href="classAP__TECS.html#a07f643564d913cf9020cd4a1b68f139d">_use_synthetic_airspeed_once</a>) {</div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>        <a class="code hl_function" href="classAP__TECS.html#ab8413b71612f09140b6ce14120ca740b">_update_throttle_with_airspeed</a>();</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>        <a class="code hl_variable" href="classAP__TECS.html#a07f643564d913cf9020cd4a1b68f139d">_use_synthetic_airspeed_once</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span>        <a class="code hl_variable" href="classAP__TECS.html#a569e77cb66a1f80a50119c5835248b44">_using_airspeed_for_throttle</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>        <a class="code hl_function" href="classAP__TECS.html#ab65f6851177f49401c2d8ee204603641">_update_throttle_without_airspeed</a>(throttle_nudge, pitch_trim_deg);</div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span>        <a class="code hl_variable" href="classAP__TECS.html#a569e77cb66a1f80a50119c5835248b44">_using_airspeed_for_throttle</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span>    }</div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span> </div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span>    <span class="comment">// Detect bad descent due to demanded airspeed being too high</span></div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span>    <a class="code hl_function" href="classAP__TECS.html#ab5ab1cc93f631786bb0c9df8596eef44">_detect_bad_descent</a>();</div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span> </div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__TECS.html#a1cbc008fde6dba92de34f6250e2fe355">_options</a> &amp; <a class="code hl_enumvalue" href="classAP__TECS.html#ab764ce341c82c93d3ab6fb1a20539213a694225bd41c366bb88c0c0139d7e66c2">OPTION_GLIDER_ONLY</a>) {</div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>        <a class="code hl_variable" href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">_flags</a>.<a class="code hl_variable" href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">badDescent</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span>    }</div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span> </div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span><span class="preprocessor">#if HAL_LOGGING_ENABLED</span></div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().should_log(<a class="code hl_variable" href="classAP__TECS.html#aa6eefe49a8513c2cfb8f638873e96a9b">_log_bitmask</a>)){</div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span>        <span class="comment">// log to AP_Logger</span></div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>        <span class="comment">// @LoggerMessage: TECS</span></div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span>        <span class="comment">// @Vehicles: Plane</span></div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>        <span class="comment">// @Description: Information about the Total Energy Control System</span></div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>        <span class="comment">// @URL: http://ardupilot.org/plane/docs/tecs-total-energy-control-system-for-speed-height-tuning-guide.html</span></div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span>        <span class="comment">// @Field: TimeUS: Time since system startup</span></div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span>        <span class="comment">// @Field: h: height estimate (UP) currently in use by TECS</span></div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span>        <span class="comment">// @Field: dh: current climb rate (&quot;delta-height&quot;)</span></div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span>        <span class="comment">// @Field: hin: height demand received by TECS</span></div>
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"> 1405</span>        <span class="comment">// @Field: hdem: height demand after rate limiting and filtering that TECS is currently trying to achieve</span></div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>        <span class="comment">// @Field: dhdem: climb rate TECS is currently trying to achieve</span></div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>        <span class="comment">// @Field: spdem: True AirSpeed TECS is currently trying to achieve</span></div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span>        <span class="comment">// @Field: sp: current estimated True AirSpeed</span></div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span>        <span class="comment">// @Field: dsp: x-axis acceleration estimate (&quot;delta-speed&quot;)</span></div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span>        <span class="comment">// @Field: th: throttle output</span></div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span>        <span class="comment">// @Field: ph: pitch output</span></div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>        <span class="comment">// @Field: pmin: pitch lower limit</span></div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span>        <span class="comment">// @Field: pmax: pitch upper limit</span></div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span>        <span class="comment">// @Field: dspdem: demanded acceleration output (&quot;delta-speed demand&quot;)</span></div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>        <span class="comment">// @Field: f: flags</span></div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>        <span class="comment">// @FieldBits: f: Underspeed,UnachievableDescent,AutoLanding,ReachedTakeoffSpd</span></div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span>        <a class="code hl_function" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().<a class="code hl_function" href="classAP__Logger.html#abab7cb26825a8dfb1e5e92cf7fcf4152">WriteStreaming</a>(<span class="stringliteral">&quot;TECS&quot;</span>, <span class="stringliteral">&quot;TimeUS,h,dh,hin,hdem,dhdem,spdem,sp,dsp,th,ph,pmin,pmax,dspdem,f&quot;</span>,</div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>                                    <span class="stringliteral">&quot;smnmmnnnn------&quot;</span>,</div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span>                                    <span class="stringliteral">&quot;F00000000------&quot;</span>,</div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span>                                    <span class="stringliteral">&quot;QfffffffffffffB&quot;</span>,</div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span>                                    now,</div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">_height</a>,</div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">_climb_rate</a>,</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#aaf33c63f1727d62dbe00fa4ca98ad567">_hgt_dem_in_raw</a>,</div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">_hgt_dem</a>,</div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">_hgt_rate_dem</a>,</div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">_TAS_dem_adj</a>,</div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">_TAS_state</a>,</div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a4da8b5a68fcf0769d2200f4038ddebd8">_vel_dot</a>,</div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">_throttle_dem</a>,</div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">_pitch_dem</a>,</div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">_PITCHminf</a>,</div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">_PITCHmaxf</a>,</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>                                    (<span class="keywordtype">double</span>)<a class="code hl_variable" href="classAP__TECS.html#a2a336bda4da710cfabcc7279902fd6d7">_TAS_rate_dem</a>,</div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>                                    <a class="code hl_variable" href="classAP__TECS.html#af61e93b060aeade818382323b9430daa">_flags_byte</a>);</div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>    }</div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span>}</div>
</div>
<div class="ttc" id="aAP__Baro_8h_html"><div class="ttname"><a href="AP__Baro_8h.html">AP_Baro.h</a></div></div>
<div class="ttc" id="aAP__HAL_8h_html"><div class="ttname"><a href="AP__HAL_8h.html">AP_HAL.h</a></div></div>
<div class="ttc" id="aAP__Landing_8h_html"><div class="ttname"><a href="AP__Landing_8h.html">AP_Landing.h</a></div></div>
<div class="ttc" id="aAP__Logger_8h_html"><div class="ttname"><a href="AP__Logger_8h.html">AP_Logger.h</a></div></div>
<div class="ttc" id="aAP__Math_8cpp_html_ae2d4d03c107c3e6a127fb167e3908aa2"><div class="ttname"><a href="AP__Math_8cpp.html#ae2d4d03c107c3e6a127fb167e3908aa2">linear_interpolate</a></div><div class="ttdeci">float linear_interpolate(float low_output, float high_output, float var_value, float var_low, float var_high)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8cpp_source.html#l00098">AP_Math.cpp:98</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a2a12cce483e9b870da70d30406d82c60"><div class="ttname"><a href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a></div><div class="ttdeci">bool is_zero(const T fVal1)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00053">AP_Math.h:53</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a49ad7fa2fa2e3d8aa75e8e0ec3f83b99"><div class="ttname"><a href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a></div><div class="ttdeci">static constexpr ftype radians(ftype deg)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00213">AP_Math.h:213</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a5256308fd38a7098b8f95607aa56888f"><div class="ttname"><a href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a></div><div class="ttdeci">#define constrain_float(amt, low, high)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00174">AP_Math.h:174</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a8b6f71a42818d74fd8bfe348108942fa"><div class="ttname"><a href="AP__Math_8h.html#a8b6f71a42818d74fd8bfe348108942fa">is_negative</a></div><div class="ttdeci">bool is_negative(const T fVal1)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00074">AP_Math.h:74</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00163">AP_Param.h:163</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a78a408c84f2a1bafde256ac650142e4d"><div class="ttname"><a href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, clazz, element, def)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00145">AP_Param.h:145</a></div></div>
<div class="ttc" id="aAP__TECS_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="AP__TECS_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition</b> <a href="AC__PID__test_8cpp_source.html#l00021">AC_PID_test.cpp:21</a></div></div>
<div class="ttc" id="aAP__TECS_8h_html"><div class="ttname"><a href="AP__TECS_8h.html">AP_TECS.h</a></div><div class="ttdoc">Combined Total Energy Speed &amp; Height Control. This is a instance of an.</div></div>
<div class="ttc" id="aclassAP__AHRS_html_a00b2b4af62a91a50e14d8cf114b78639"><div class="ttname"><a href="classAP__AHRS.html#a00b2b4af62a91a50e14d8cf114b78639">AP_AHRS::get_rotation_body_to_ned</a></div><div class="ttdeci">const Matrix3f &amp; get_rotation_body_to_ned(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00581">AP_AHRS.h:581</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a0ce7fb0e943712be46d2ec00e2c7e7de"><div class="ttname"><a href="classAP__AHRS.html#a0ce7fb0e943712be46d2ec00e2c7e7de">AP_AHRS::get_relative_position_D_home</a></div><div class="ttdeci">void get_relative_position_D_home(float &amp;posD) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8cpp_source.html#l01799">AP_AHRS.cpp:1799</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a2bf7783e49e2237685ac740055a20866"><div class="ttname"><a href="classAP__AHRS.html#a2bf7783e49e2237685ac740055a20866">AP_AHRS::get_velocity_NED</a></div><div class="ttdeci">bool get_velocity_NED(Vector3f &amp;vec) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8cpp_source.html#l03522">AP_AHRS.cpp:3522</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a4a17a0fa828d3250fef15bee06459418"><div class="ttname"><a href="classAP__AHRS.html#a4a17a0fa828d3250fef15bee06459418">AP_AHRS::using_airspeed_sensor</a></div><div class="ttdeci">bool using_airspeed_sensor() const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8cpp_source.html#l00856">AP_AHRS.cpp:856</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a64786b58a1607ee420ed4f0696c755b6"><div class="ttname"><a href="classAP__AHRS.html#a64786b58a1607ee420ed4f0696c755b6">AP_AHRS::get_EAS2TAS</a></div><div class="ttdeci">float get_EAS2TAS(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00144">AP_AHRS.h:144</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a68a0c485537e20cc9f73cc6af910bccb"><div class="ttname"><a href="classAP__AHRS.html#a68a0c485537e20cc9f73cc6af910bccb">AP_AHRS::get_accel_ef</a></div><div class="ttdeci">const Vector3f &amp; get_accel_ef() const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00227">AP_AHRS.h:227</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a69088a3b05155cc99c84feca718dd6cb"><div class="ttname"><a href="classAP__AHRS.html#a69088a3b05155cc99c84feca718dd6cb">AP_AHRS::airspeed_estimate</a></div><div class="ttdeci">bool airspeed_estimate(float &amp;airspeed_ret) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8cpp_source.html#l03475">AP_AHRS.cpp:3475</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a992a48fcef2892301f1a41b795d2e8c2"><div class="ttname"><a href="classAP__AHRS.html#a992a48fcef2892301f1a41b795d2e8c2">AP_AHRS::get_pitch</a></div><div class="ttdeci">float get_pitch() const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00553">AP_AHRS.h:553</a></div></div>
<div class="ttc" id="aclassAP__Baro_html_a50ae73cce1699d88638e3dfab4ffd330"><div class="ttname"><a href="classAP__Baro.html#a50ae73cce1699d88638e3dfab4ffd330">AP_Baro::get_altitude</a></div><div class="ttdeci">float get_altitude(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Baro_8h_source.html#l00105">AP_Baro.h:105</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00021">HAL.h:21</a></div></div>
<div class="ttc" id="aclassAP__InertialSensor_html_a707bc3f8ef8270db68ceeec36171d6ac"><div class="ttname"><a href="classAP__InertialSensor.html#a707bc3f8ef8270db68ceeec36171d6ac">AP_InertialSensor::get_accel</a></div><div class="ttdeci">const Vector3f &amp; get_accel(uint8_t i) const</div><div class="ttdef"><b>Definition</b> <a href="AP__InertialSensor_8h_source.html#l00133">AP_InertialSensor.h:133</a></div></div>
<div class="ttc" id="aclassAP__Landing_html_a1429174262aa7716b6b00df8eed75e81"><div class="ttname"><a href="classAP__Landing.html#a1429174262aa7716b6b00df8eed75e81">AP_Landing::is_on_approach</a></div><div class="ttdeci">bool is_on_approach(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Landing_8cpp_source.html#l00355">AP_Landing.cpp:355</a></div></div>
<div class="ttc" id="aclassAP__Landing_html_a5ff74bf65eb1a4083cc783af22276828"><div class="ttname"><a href="classAP__Landing.html#a5ff74bf65eb1a4083cc783af22276828">AP_Landing::is_flaring</a></div><div class="ttdeci">bool is_flaring(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Landing_8cpp_source.html#l00333">AP_Landing.cpp:333</a></div></div>
<div class="ttc" id="aclassAP__Landing_html_a7bf5659737da858f602c2b6543b1a8b0"><div class="ttname"><a href="classAP__Landing.html#a7bf5659737da858f602c2b6543b1a8b0">AP_Landing::get_throttle_slewrate</a></div><div class="ttdeci">int8_t get_throttle_slewrate(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Landing_8h_source.html#l00107">AP_Landing.h:107</a></div></div>
<div class="ttc" id="aclassAP__Landing_html_aea63b41c71cd665c1933b83cd681e0b0"><div class="ttname"><a href="classAP__Landing.html#aea63b41c71cd665c1933b83cd681e0b0">AP_Landing::get_pitch_cd</a></div><div class="ttdeci">int16_t get_pitch_cd(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Landing_8h_source.html#l00101">AP_Landing.h:101</a></div></div>
<div class="ttc" id="aclassAP__Logger_html_abab7cb26825a8dfb1e5e92cf7fcf4152"><div class="ttname"><a href="classAP__Logger.html#abab7cb26825a8dfb1e5e92cf7fcf4152">AP_Logger::WriteStreaming</a></div><div class="ttdeci">void WriteStreaming(const char *name, const char *labels, const char *fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="AP__Logger_8cpp_source.html#l00992">AP_Logger.cpp:992</a></div></div>
<div class="ttc" id="aclassAP__TECS_html"><div class="ttname"><a href="classAP__TECS.html">AP_TECS</a></div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00027">AP_TECS.h:27</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a002c46ae3fbbd31dd4e110d13dfb9c08"><div class="ttname"><a href="classAP__TECS.html#a002c46ae3fbbd31dd4e110d13dfb9c08">AP_TECS::_SKEdot_dem</a></div><div class="ttdeci">float _SKEdot_dem</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00380">AP_TECS.h:380</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a03df83679af5e791ca881cfe7bb1a024"><div class="ttname"><a href="classAP__TECS.html#a03df83679af5e791ca881cfe7bb1a024">AP_TECS::_integGain</a></div><div class="ttdeci">AP_Float _integGain</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00181">AP_TECS.h:181</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a045b368f51504b33da3916b166908fcc"><div class="ttname"><a href="classAP__TECS.html#a045b368f51504b33da3916b166908fcc">AP_TECS::_hgt_dem_lpf</a></div><div class="ttdeci">float _hgt_dem_lpf</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00281">AP_TECS.h:281</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a07f643564d913cf9020cd4a1b68f139d"><div class="ttname"><a href="classAP__TECS.html#a07f643564d913cf9020cd4a1b68f139d">AP_TECS::_use_synthetic_airspeed_once</a></div><div class="ttdeci">bool _use_synthetic_airspeed_once</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00427">AP_TECS.h:427</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a08f575ea9d3b0a609fc3c359335c5d4a"><div class="ttname"><a href="classAP__TECS.html#a08f575ea9d3b0a609fc3c359335c5d4a">AP_TECS::_landThrottle</a></div><div class="ttdeci">AP_Float _landThrottle</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00188">AP_TECS.h:188</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a09c40b70f25eeac0647626f6b5caf78e"><div class="ttname"><a href="classAP__TECS.html#a09c40b70f25eeac0647626f6b5caf78e">AP_TECS::update_pitch_throttle</a></div><div class="ttdeci">void update_pitch_throttle(int32_t hgt_dem_cm, int32_t EAS_dem_cm, enum AP_FixedWing::FlightStage flight_stage, float distance_beyond_land_wp, int32_t ptchMinCO_cd, int16_t throttle_nudge, float hgt_afe, float load_factor, float pitch_trim_deg)</div><div class="ttdef"><b>Definition</b> <a href="#l01201">AP_TECS.cpp:1201</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a0a2e1747411c60941a678801e9af3178"><div class="ttname"><a href="classAP__TECS.html#a0a2e1747411c60941a678801e9af3178">AP_TECS::_takeoff_start_ms</a></div><div class="ttdeci">uint32_t _takeoff_start_ms</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00310">AP_TECS.h:310</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a0ba5d70bc0549b5226f1fe5179aba1b0"><div class="ttname"><a href="classAP__TECS.html#a0ba5d70bc0549b5226f1fe5179aba1b0">AP_TECS::_land_pitch_max</a></div><div class="ttdeci">AP_Int8 _land_pitch_max</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00194">AP_TECS.h:194</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a0bcda5e4ea0098e10b74105f9bc54b8f"><div class="ttname"><a href="classAP__TECS.html#a0bcda5e4ea0098e10b74105f9bc54b8f">AP_TECS::_integKE</a></div><div class="ttdeci">float _integKE</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00252">AP_TECS.h:252</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a12946b10e5890a34fa74e8f026a3c4d7"><div class="ttname"><a href="classAP__TECS.html#a12946b10e5890a34fa74e8f026a3c4d7">AP_TECS::_throttle_dem</a></div><div class="ttdeci">float _throttle_dem</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00216">AP_TECS.h:216</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a14cbf46b51ab9bcdb52a5b02abf269eb"><div class="ttname"><a href="classAP__TECS.html#a14cbf46b51ab9bcdb52a5b02abf269eb">AP_TECS::_hgt_rate_at_flare_entry</a></div><div class="ttdeci">float _hgt_rate_at_flare_entry</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00388">AP_TECS.h:388</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a1a3a014f36ba7b9fe2cc3d9c4cb75777"><div class="ttname"><a href="classAP__TECS.html#a1a3a014f36ba7b9fe2cc3d9c4cb75777">AP_TECS::_STEdotErrLast</a></div><div class="ttdeci">float _STEdotErrLast</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00307">AP_TECS.h:307</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a1a46eb22cdadf76b7fab1cbc307e6d81"><div class="ttname"><a href="classAP__TECS.html#a1a46eb22cdadf76b7fab1cbc307e6d81">AP_TECS::_thrDamp</a></div><div class="ttdeci">AP_Float _thrDamp</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00179">AP_TECS.h:179</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a1bb8be88bde90cfa5eb9946dc6bf44f8"><div class="ttname"><a href="classAP__TECS.html#a1bb8be88bde90cfa5eb9946dc6bf44f8">AP_TECS::_hgt_rate_dem</a></div><div class="ttdeci">float _hgt_rate_dem</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00289">AP_TECS.h:289</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a1cbc008fde6dba92de34f6250e2fe355"><div class="ttname"><a href="classAP__TECS.html#a1cbc008fde6dba92de34f6250e2fe355">AP_TECS::_options</a></div><div class="ttdeci">AP_Int32 _options</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00196">AP_TECS.h:196</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a2123d3693141c7bc46b31a2cecf0765f"><div class="ttname"><a href="classAP__TECS.html#a2123d3693141c7bc46b31a2cecf0765f">AP_TECS::_STEdot_min</a></div><div class="ttdeci">float _STEdot_min</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00357">AP_TECS.h:357</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a23b1e3cec4d5b7d5d2a16bb8142d2864"><div class="ttname"><a href="classAP__TECS.html#a23b1e3cec4d5b7d5d2a16bb8142d2864">AP_TECS::_TAS_dem</a></div><div class="ttdeci">float _TAS_dem</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00272">AP_TECS.h:272</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a249351ad417274c8081bf344ef2b7e12"><div class="ttname"><a href="classAP__TECS.html#a249351ad417274c8081bf344ef2b7e12">AP_TECS::_SKE_weighting</a></div><div class="ttdeci">float _SKE_weighting</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00422">AP_TECS.h:422</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a2a336bda4da710cfabcc7279902fd6d7"><div class="ttname"><a href="classAP__TECS.html#a2a336bda4da710cfabcc7279902fd6d7">AP_TECS::_TAS_rate_dem</a></div><div class="ttdeci">float _TAS_rate_dem</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00303">AP_TECS.h:303</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a2ecab25bceacdfb0c15694ff8428608f"><div class="ttname"><a href="classAP__TECS.html#a2ecab25bceacdfb0c15694ff8428608f">AP_TECS::_initialise_states</a></div><div class="ttdeci">void _initialise_states(int32_t ptchMinCO_cd, float hgt_afe)</div><div class="ttdef"><b>Definition</b> <a href="#l01117">AP_TECS.cpp:1117</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a334c90dbafe8f184467d58b1e631ca9f"><div class="ttname"><a href="classAP__TECS.html#a334c90dbafe8f184467d58b1e631ca9f">AP_TECS::_STEdot_neg_max</a></div><div class="ttdeci">float _STEdot_neg_max</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00358">AP_TECS.h:358</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a365f9c40b77c29164902b859e2783113"><div class="ttname"><a href="classAP__TECS.html#a365f9c40b77c29164902b859e2783113">AP_TECS::_lag_comp_hgt_offset</a></div><div class="ttdeci">float _lag_comp_hgt_offset</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00295">AP_TECS.h:295</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a372aa3467ce5ffef5b34a1046f6c1392"><div class="ttname"><a href="classAP__TECS.html#a372aa3467ce5ffef5b34a1046f6c1392">AP_TECS::_timeConst</a></div><div class="ttdeci">AP_Float _timeConst</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00174">AP_TECS.h:174</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a376593eecc4ab66559947a144106bdd5"><div class="ttname"><a href="classAP__TECS.html#a376593eecc4ab66559947a144106bdd5">AP_TECS::_update_speed_demand</a></div><div class="ttdeci">void _update_speed_demand(void)</div><div class="ttdef"><b>Definition</b> <a href="#l00459">AP_TECS.cpp:459</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a38c6fa6f9b8cc7c82e594bb494b7f47c"><div class="ttname"><a href="classAP__TECS.html#a38c6fa6f9b8cc7c82e594bb494b7f47c">AP_TECS::_flare_hgt_dem_ideal</a></div><div class="ttdeci">float _flare_hgt_dem_ideal</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00283">AP_TECS.h:283</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a38cefae79f201d04f9543f0163a34b7e"><div class="ttname"><a href="classAP__TECS.html#a38cefae79f201d04f9543f0163a34b7e">AP_TECS::_TAS_dem_adj</a></div><div class="ttdeci">float _TAS_dem_adj</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00299">AP_TECS.h:299</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a3979de95efa8eca22c0890607f5db8f6"><div class="ttname"><a href="classAP__TECS.html#a3979de95efa8eca22c0890607f5db8f6">AP_TECS::_hgt_at_start_of_flare</a></div><div class="ttdeci">float _hgt_at_start_of_flare</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00387">AP_TECS.h:387</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a3bdfd7a87be82e3f38e2b74b11e79328"><div class="ttname"><a href="classAP__TECS.html#a3bdfd7a87be82e3f38e2b74b11e79328">AP_TECS::_THRmaxf</a></div><div class="ttdeci">float _THRmaxf</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00361">AP_TECS.h:361</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a3cfb2f2dede7bb64ddd7f340dea8c4e6"><div class="ttname"><a href="classAP__TECS.html#a3cfb2f2dede7bb64ddd7f340dea8c4e6">AP_TECS::_TASmax</a></div><div class="ttdeci">float _TASmax</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00268">AP_TECS.h:268</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a3d61aa8551482d09712c3bd51bf58c20"><div class="ttname"><a href="classAP__TECS.html#a3d61aa8551482d09712c3bd51bf58c20">AP_TECS::_integTHR_state</a></div><div class="ttdeci">float _integTHR_state</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00246">AP_TECS.h:246</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a3f83a3c0553d099adb949ef55e05fa2e"><div class="ttname"><a href="classAP__TECS.html#a3f83a3c0553d099adb949ef55e05fa2e">AP_TECS::_hgt_dem_prev</a></div><div class="ttdeci">float _hgt_dem_prev</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00285">AP_TECS.h:285</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a41174014c87cbe20f6792779cd5c4fc6"><div class="ttname"><a href="classAP__TECS.html#a41174014c87cbe20f6792779cd5c4fc6">AP_TECS::_pitch_demand_lpf</a></div><div class="ttdeci">LowPassFilterFloat _pitch_demand_lpf</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00434">AP_TECS.h:434</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a41c98d353390a6bb386e5596c5d5a843"><div class="ttname"><a href="classAP__TECS.html#a41c98d353390a6bb386e5596c5d5a843">AP_TECS::_SKEdot</a></div><div class="ttdeci">float _SKEdot</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00384">AP_TECS.h:384</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a4219c1f6f04940016a6232b6bacc36bc"><div class="ttname"><a href="classAP__TECS.html#a4219c1f6f04940016a6232b6bacc36bc">AP_TECS::_climb_rate</a></div><div class="ttdeci">float _climb_rate</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00222">AP_TECS.h:222</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a425d214dcedbca7ea37929cc32eaf58c"><div class="ttname"><a href="classAP__TECS.html#a425d214dcedbca7ea37929cc32eaf58c">AP_TECS::_ptchDamp</a></div><div class="ttdeci">AP_Float _ptchDamp</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00176">AP_TECS.h:176</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a44a3b1b7342744ddb5a9fc88af0b73e5"><div class="ttname"><a href="classAP__TECS.html#a44a3b1b7342744ddb5a9fc88af0b73e5">AP_TECS::_hgtCompFiltOmega</a></div><div class="ttdeci">AP_Float _hgtCompFiltOmega</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00169">AP_TECS.h:169</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a44e826f3ccb606c79a99d09ec1462036"><div class="ttname"><a href="classAP__TECS.html#a44e826f3ccb606c79a99d09ec1462036">AP_TECS::_landing</a></div><div class="ttdeci">const AP_Landing &amp; _landing</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00163">AP_TECS.h:163</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a45ccf2e0cd87b0926fbcbb76963840c9"><div class="ttname"><a href="classAP__TECS.html#a45ccf2e0cd87b0926fbcbb76963840c9">AP_TECS::_PITCHminf</a></div><div class="ttdeci">float _PITCHminf</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00366">AP_TECS.h:366</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a47e06765500c102946f198671232041c"><div class="ttname"><a href="classAP__TECS.html#a47e06765500c102946f198671232041c">AP_TECS::_flare_hgt_dem_adj</a></div><div class="ttdeci">float _flare_hgt_dem_adj</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00282">AP_TECS.h:282</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a4d52e4f283cb0475971dc3ce22597f1c"><div class="ttname"><a href="classAP__TECS.html#a4d52e4f283cb0475971dc3ce22597f1c">AP_TECS::update_50hz</a></div><div class="ttdeci">void update_50hz(void)</div><div class="ttdef"><b>Definition</b> <a href="#l00305">AP_TECS.cpp:305</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a4da8b5a68fcf0769d2200f4038ddebd8"><div class="ttname"><a href="classAP__TECS.html#a4da8b5a68fcf0769d2200f4038ddebd8">AP_TECS::_vel_dot</a></div><div class="ttdeci">float _vel_dot</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00261">AP_TECS.h:261</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a4dc0dac47faf337837f8c47c21494d67"><div class="ttname"><a href="classAP__TECS.html#a4dc0dac47faf337837f8c47c21494d67">AP_TECS::_distance_beyond_land_wp</a></div><div class="ttdeci">float _distance_beyond_land_wp</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00415">AP_TECS.h:415</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a53b44a17eb342bc77c0f6f50491af227"><div class="ttname"><a href="classAP__TECS.html#a53b44a17eb342bc77c0f6f50491af227">AP_TECS::_TAS_rate_dem_lpf</a></div><div class="ttdeci">float _TAS_rate_dem_lpf</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00304">AP_TECS.h:304</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a549342fec91b2243b161346a92762767"><div class="ttname"><a href="classAP__TECS.html#a549342fec91b2243b161346a92762767">AP_TECS::_flare_initialised</a></div><div class="ttdeci">bool _flare_initialised</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00410">AP_TECS.h:410</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a55b1f4cfa9b6cb2beb622316c0089d70"><div class="ttname"><a href="classAP__TECS.html#a55b1f4cfa9b6cb2beb622316c0089d70">AP_TECS::_pitch_max</a></div><div class="ttdeci">AP_Int8 _pitch_max</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00192">AP_TECS.h:192</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a569e77cb66a1f80a50119c5835248b44"><div class="ttname"><a href="classAP__TECS.html#a569e77cb66a1f80a50119c5835248b44">AP_TECS::_using_airspeed_for_throttle</a></div><div class="ttdeci">bool _using_airspeed_for_throttle</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00430">AP_TECS.h:430</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a594b11147d692c51e04a1e9882387537"><div class="ttname"><a href="classAP__TECS.html#a594b11147d692c51e04a1e9882387537">AP_TECS::_vel_dot_lpf</a></div><div class="ttdeci">float _vel_dot_lpf</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00262">AP_TECS.h:262</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a5e1f843d9d5342d181e114adbf2dae48"><div class="ttname"><a href="classAP__TECS.html#a5e1f843d9d5342d181e114adbf2dae48">AP_TECS::_TAS_state</a></div><div class="ttdeci">float _TAS_state</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00243">AP_TECS.h:243</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a5ebe7a314a4a98513748f29fcf58f435"><div class="ttname"><a href="classAP__TECS.html#a5ebe7a314a4a98513748f29fcf58f435">AP_TECS::_hgt_dem</a></div><div class="ttdeci">float _hgt_dem</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00284">AP_TECS.h:284</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a5ff6a926d1c3a14bc88cf9ce974cb18d"><div class="ttname"><a href="classAP__TECS.html#a5ff6a926d1c3a14bc88cf9ce974cb18d">AP_TECS::timeConstant</a></div><div class="ttdeci">float timeConstant(void) const</div><div class="ttdef"><b>Definition</b> <a href="#l00687">AP_TECS.cpp:687</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a620dd7d52dc60fd6914dbd7d98e1b9cd"><div class="ttname"><a href="classAP__TECS.html#a620dd7d52dc60fd6914dbd7d98e1b9cd">AP_TECS::_land_throttle_damp</a></div><div class="ttdeci">AP_Float _land_throttle_damp</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00180">AP_TECS.h:180</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a678202e9f1970ba937da805a9e1f26b1"><div class="ttname"><a href="classAP__TECS.html#a678202e9f1970ba937da805a9e1f26b1">AP_TECS::_integSEBdot</a></div><div class="ttdeci">float _integSEBdot</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00249">AP_TECS.h:249</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a6bc6c5cdb2dbeae5abe4091f50646fde"><div class="ttname"><a href="classAP__TECS.html#a6bc6c5cdb2dbeae5abe4091f50646fde">AP_TECS::_integGain_land</a></div><div class="ttdeci">AP_Float _integGain_land</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00183">AP_TECS.h:183</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a6c1b577ec8587bee338d0751ecd7a6f4"><div class="ttname"><a href="classAP__TECS.html#a6c1b577ec8587bee338d0751ecd7a6f4">AP_TECS::_update_speed</a></div><div class="ttdeci">void _update_speed(float DT)</div><div class="ttdef"><b>Definition</b> <a href="#l00374">AP_TECS.cpp:374</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a6eab6d44faa6a51fbdd7a59279e17035"><div class="ttname"><a href="classAP__TECS.html#a6eab6d44faa6a51fbdd7a59279e17035">AP_TECS::_update_STE_rate_lim</a></div><div class="ttdeci">void _update_STE_rate_lim(void)</div><div class="ttdef"><b>Definition</b> <a href="#l01190">AP_TECS.cpp:1190</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a7318e1b5998b99f4febe0d53040c5744"><div class="ttname"><a href="classAP__TECS.html#a7318e1b5998b99f4febe0d53040c5744">AP_TECS::_detect_underspeed</a></div><div class="ttdeci">void _detect_underspeed(void)</div><div class="ttdef"><b>Definition</b> <a href="#l00632">AP_TECS.cpp:632</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a77974fa2a70b286445ead5271fcf41b5"><div class="ttname"><a href="classAP__TECS.html#a77974fa2a70b286445ead5271fcf41b5">AP_TECS::_height</a></div><div class="ttdeci">float _height</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00213">AP_TECS.h:213</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a7854ecaf0d95d9da406568583f6e287f"><div class="ttname"><a href="classAP__TECS.html#a7854ecaf0d95d9da406568583f6e287f">AP_TECS::_update_pitch</a></div><div class="ttdeci">void _update_pitch(void)</div><div class="ttdef"><b>Definition</b> <a href="#l00941">AP_TECS.cpp:941</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a7c97ba3776836f5760b4b79f4926e452"><div class="ttname"><a href="classAP__TECS.html#a7c97ba3776836f5760b4b79f4926e452">AP_TECS::_maxSinkRate</a></div><div class="ttdeci">AP_Float _maxSinkRate</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00173">AP_TECS.h:173</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a7cd6a7f15461a776d453aebdbc1ba39f"><div class="ttname"><a href="classAP__TECS.html#a7cd6a7f15461a776d453aebdbc1ba39f">AP_TECS::_spdCompFiltOmega</a></div><div class="ttdeci">AP_Float _spdCompFiltOmega</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00170">AP_TECS.h:170</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5"><div class="ttname"><a href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aa26a4b44a837bf97b972628509912b4a5">AP_TECS::clipStatus::MAX</a></div><div class="ttdeci">@ MAX</div></div>
<div class="ttc" id="aclassAP__TECS_html_a830f4c05b0cbcbed3381bc2b3b8da25aab50339a10e1de285ac99d4c3990b8693"><div class="ttname"><a href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aab50339a10e1de285ac99d4c3990b8693">AP_TECS::clipStatus::NONE</a></div><div class="ttdeci">@ NONE</div></div>
<div class="ttc" id="aclassAP__TECS_html_a830f4c05b0cbcbed3381bc2b3b8da25aace31e2a082d17e038fcc6e3006166653"><div class="ttname"><a href="classAP__TECS.html#a830f4c05b0cbcbed3381bc2b3b8da25aace31e2a082d17e038fcc6e3006166653">AP_TECS::clipStatus::MIN</a></div><div class="ttdeci">@ MIN</div></div>
<div class="ttc" id="aclassAP__TECS_html_a8b0d9a0da66f68c57f060720bf2a1014"><div class="ttname"><a href="classAP__TECS.html#a8b0d9a0da66f68c57f060720bf2a1014">AP_TECS::_pitch_min_at_flare_entry</a></div><div class="ttdeci">float _pitch_min_at_flare_entry</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00390">AP_TECS.h:390</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a8cf182de07003d0734293f16cb554cae"><div class="ttname"><a href="classAP__TECS.html#a8cf182de07003d0734293f16cb554cae">AP_TECS::_SKE_est</a></div><div class="ttdeci">float _SKE_est</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00382">AP_TECS.h:382</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a8d23075cf7fd1752877a893bd689a2ab"><div class="ttname"><a href="classAP__TECS.html#a8d23075cf7fd1752877a893bd689a2ab">AP_TECS::_land_sink</a></div><div class="ttdeci">AP_Float _land_sink</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00190">AP_TECS.h:190</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a8db124836a733bfcee48843fb0ff28db"><div class="ttname"><a href="classAP__TECS.html#a8db124836a733bfcee48843fb0ff28db">AP_TECS::_update_pitch_throttle_last_usec</a></div><div class="ttdeci">uint64_t _update_pitch_throttle_last_usec</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00155">AP_TECS.h:155</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a91aeb22f68e2957bfad6285ec41182cf"><div class="ttname"><a href="classAP__TECS.html#a91aeb22f68e2957bfad6285ec41182cf">AP_TECS::_update_height_demand</a></div><div class="ttdeci">void _update_height_demand(void)</div><div class="ttdef"><b>Definition</b> <a href="#l00518">AP_TECS.cpp:518</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a91ce1f5e2d671c0d134997fa9859919e"><div class="ttname"><a href="classAP__TECS.html#a91ce1f5e2d671c0d134997fa9859919e">AP_TECS::_max_climb_scaler</a></div><div class="ttdeci">float _max_climb_scaler</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00393">AP_TECS.h:393</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a91e85bf0a00beec54598231ee0cca7c5"><div class="ttname"><a href="classAP__TECS.html#a91e85bf0a00beec54598231ee0cca7c5">AP_TECS::_hgt_dem_in</a></div><div class="ttdeci">float _hgt_dem_in</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00279">AP_TECS.h:279</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a920b0cf7e46bcdb0a5081a02c8a75c00"><div class="ttname"><a href="classAP__TECS.html#a920b0cf7e46bcdb0a5081a02c8a75c00">AP_TECS::_last_pitch_dem</a></div><div class="ttdeci">float _last_pitch_dem</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00258">AP_TECS.h:258</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a94b18fc8586c008a3b57b1630d222a96"><div class="ttname"><a href="classAP__TECS.html#a94b18fc8586c008a3b57b1630d222a96">AP_TECS::_load_factor</a></div><div class="ttdeci">float _load_factor</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00438">AP_TECS.h:438</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a95645382d976d27216d75bf47a623d32"><div class="ttname"><a href="classAP__TECS.html#a95645382d976d27216d75bf47a623d32">AP_TECS::_get_i_gain</a></div><div class="ttdeci">float _get_i_gain(void)</div><div class="ttdef"><b>Definition</b> <a href="#l00838">AP_TECS.cpp:838</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a9682e4151e22e34446f6ffd066e5f304"><div class="ttname"><a href="classAP__TECS.html#a9682e4151e22e34446f6ffd066e5f304">AP_TECS::_pitch_ff_k</a></div><div class="ttdeci">AP_Float _pitch_ff_k</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00206">AP_TECS.h:206</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a96bc0e6fadbf3202c5e5fc9ee2c01cec"><div class="ttname"><a href="classAP__TECS.html#a96bc0e6fadbf3202c5e5fc9ee2c01cec">AP_TECS::_maxSinkRate_approach</a></div><div class="ttdeci">AP_Float _maxSinkRate_approach</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00195">AP_TECS.h:195</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a984593f4daada614bd626b6550bcb4a7"><div class="ttname"><a href="classAP__TECS.html#a984593f4daada614bd626b6550bcb4a7">AP_TECS::_flare_holdoff_hgt</a></div><div class="ttdeci">AP_Float _flare_holdoff_hgt</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00197">AP_TECS.h:197</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a9bea918bd520e58ad0f9618e48d80894"><div class="ttname"><a href="classAP__TECS.html#a9bea918bd520e58ad0f9618e48d80894">AP_TECS::_thr_clip_status</a></div><div class="ttdeci">clipStatus _thr_clip_status</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00374">AP_TECS.h:374</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_a9f94dc1aaf643448d9f0f056bb10137c"><div class="ttname"><a href="classAP__TECS.html#a9f94dc1aaf643448d9f0f056bb10137c">AP_TECS::_landDamp</a></div><div class="ttdeci">AP_Float _landDamp</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00178">AP_TECS.h:178</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_aa6b37a801da411b61ba0a9fee93940cb"><div class="ttname"><a href="classAP__TECS.html#aa6b37a801da411b61ba0a9fee93940cb">AP_TECS::_landTimeConst</a></div><div class="ttdeci">AP_Float _landTimeConst</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00175">AP_TECS.h:175</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_aa6eefe49a8513c2cfb8f638873e96a9b"><div class="ttname"><a href="classAP__TECS.html#aa6eefe49a8513c2cfb8f638873e96a9b">AP_TECS::_log_bitmask</a></div><div class="ttdeci">const uint32_t _log_bitmask</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00166">AP_TECS.h:166</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_aa7b382d5c5f219be2fe639173654fbda"><div class="ttname"><a href="classAP__TECS.html#aa7b382d5c5f219be2fe639173654fbda">AP_TECS::_underspeed_start_ms</a></div><div class="ttdeci">uint32_t _underspeed_start_ms</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00347">AP_TECS.h:347</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_aa85725f73abc62c34534a631c650731f"><div class="ttname"><a href="classAP__TECS.html#aa85725f73abc62c34534a631c650731f">AP_TECS::_DT</a></div><div class="ttdeci">float _DT</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00406">AP_TECS.h:406</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_aab5acbcc71c36ff1efd9235d643ad4de"><div class="ttname"><a href="classAP__TECS.html#aab5acbcc71c36ff1efd9235d643ad4de">AP_TECS::_height_filter</a></div><div class="ttdeci">struct AP_TECS::@209 _height_filter</div></div>
<div class="ttc" id="aclassAP__TECS_html_aabf43104f81a4de93b6b21dff03fce37"><div class="ttname"><a href="classAP__TECS.html#aabf43104f81a4de93b6b21dff03fce37">AP_TECS::_rollComp</a></div><div class="ttdeci">AP_Float _rollComp</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00185">AP_TECS.h:185</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_aaf33c63f1727d62dbe00fa4ca98ad567"><div class="ttname"><a href="classAP__TECS.html#aaf33c63f1727d62dbe00fa4ca98ad567">AP_TECS::_hgt_dem_in_raw</a></div><div class="ttdeci">float _hgt_dem_in_raw</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00278">AP_TECS.h:278</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ab09e31937002d75d0bb3c2b487cd6351"><div class="ttname"><a href="classAP__TECS.html#ab09e31937002d75d0bb3c2b487cd6351">AP_TECS::_last_throttle_dem</a></div><div class="ttdeci">float _last_throttle_dem</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00255">AP_TECS.h:255</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ab1d7e52ac8d8c6aa305275a30ba72a93"><div class="ttname"><a href="classAP__TECS.html#ab1d7e52ac8d8c6aa305275a30ba72a93">AP_TECS::_land_sink_rate_change</a></div><div class="ttdeci">AP_Float _land_sink_rate_change</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00191">AP_TECS.h:191</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ab40a7ba8b52a3746d49f0bb1f3ceb197"><div class="ttname"><a href="classAP__TECS.html#ab40a7ba8b52a3746d49f0bb1f3ceb197">AP_TECS::_pitch_dem_unc</a></div><div class="ttdeci">float _pitch_dem_unc</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00353">AP_TECS.h:353</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ab4e43605acf8d36a5837334710d9c104"><div class="ttname"><a href="classAP__TECS.html#ab4e43605acf8d36a5837334710d9c104">AP_TECS::_update_50hz_last_usec</a></div><div class="ttdeci">uint64_t _update_50hz_last_usec</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00152">AP_TECS.h:152</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ab5ab1cc93f631786bb0c9df8596eef44"><div class="ttname"><a href="classAP__TECS.html#ab5ab1cc93f631786bb0c9df8596eef44">AP_TECS::_detect_bad_descent</a></div><div class="ttdeci">void _detect_bad_descent(void)</div><div class="ttdef"><b>Definition</b> <a href="#l00919">AP_TECS.cpp:919</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ab65f6851177f49401c2d8ee204603641"><div class="ttname"><a href="classAP__TECS.html#ab65f6851177f49401c2d8ee204603641">AP_TECS::_update_throttle_without_airspeed</a></div><div class="ttdeci">void _update_throttle_without_airspeed(int16_t throttle_nudge, float pitch_trim_deg)</div><div class="ttdef"><b>Definition</b> <a href="#l00856">AP_TECS.cpp:856</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ab764ce341c82c93d3ab6fb1a20539213a694225bd41c366bb88c0c0139d7e66c2"><div class="ttname"><a href="classAP__TECS.html#ab764ce341c82c93d3ab6fb1a20539213a694225bd41c366bb88c0c0139d7e66c2">AP_TECS::OPTION_GLIDER_ONLY</a></div><div class="ttdeci">@ OPTION_GLIDER_ONLY</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00201">AP_TECS.h:201</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ab764ce341c82c93d3ab6fb1a20539213add71e487a40ead35e37526a3d702cfd7"><div class="ttname"><a href="classAP__TECS.html#ab764ce341c82c93d3ab6fb1a20539213add71e487a40ead35e37526a3d702cfd7">AP_TECS::OPTION_DESCENT_SPEEDUP</a></div><div class="ttdeci">@ OPTION_DESCENT_SPEEDUP</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00203">AP_TECS.h:202</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ab8413b71612f09140b6ce14120ca740b"><div class="ttname"><a href="classAP__TECS.html#ab8413b71612f09140b6ce14120ca740b">AP_TECS::_update_throttle_with_airspeed</a></div><div class="ttdeci">void _update_throttle_with_airspeed(void)</div><div class="ttdef"><b>Definition</b> <a href="#l00704">AP_TECS.cpp:704</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_abcf8efaf10d02b61998c9fbdc4b83d0b"><div class="ttname"><a href="classAP__TECS.html#abcf8efaf10d02b61998c9fbdc4b83d0b">AP_TECS::_STE_error</a></div><div class="ttdeci">float _STE_error</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00398">AP_TECS.h:398</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_abdc88637f15f20df5e282bf2052940c2"><div class="ttname"><a href="classAP__TECS.html#abdc88637f15f20df5e282bf2052940c2">AP_TECS::_vdot_filter</a></div><div class="ttdeci">AverageFilterFloat_Size5 _vdot_filter</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00477">AP_TECS.h:477</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_abef22d8ca912f65ae8abdff6e54d8d3c"><div class="ttname"><a href="classAP__TECS.html#abef22d8ca912f65ae8abdff6e54d8d3c">AP_TECS::_EAS</a></div><div class="ttdeci">float _EAS</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00265">AP_TECS.h:265</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ac068b4c20d6a91be0dce44f2ed7363a9"><div class="ttname"><a href="classAP__TECS.html#ac068b4c20d6a91be0dce44f2ed7363a9">AP_TECS::_climb_rate_limit</a></div><div class="ttdeci">float _climb_rate_limit</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00225">AP_TECS.h:225</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ac4c57b27adc7dc7e2edc7bcfc3e59de0"><div class="ttname"><a href="classAP__TECS.html#ac4c57b27adc7dc7e2edc7bcfc3e59de0">AP_TECS::_SPE_est</a></div><div class="ttdeci">float _SPE_est</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00381">AP_TECS.h:381</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ac4ef736b39412013b47c62b8fbd65668"><div class="ttname"><a href="classAP__TECS.html#ac4ef736b39412013b47c62b8fbd65668">AP_TECS::_land_pitch_damp</a></div><div class="ttdeci">AP_Float _land_pitch_damp</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00177">AP_TECS.h:177</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ac53298961dc0d4983cc0934174ab7222"><div class="ttname"><a href="classAP__TECS.html#ac53298961dc0d4983cc0934174ab7222">AP_TECS::_hgt_afe</a></div><div class="ttdeci">float _hgt_afe</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00389">AP_TECS.h:389</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ac5836e7e185100808a4bb2ba8c18e8b5"><div class="ttname"><a href="classAP__TECS.html#ac5836e7e185100808a4bb2ba8c18e8b5">AP_TECS::_minSinkRate</a></div><div class="ttdeci">AP_Float _minSinkRate</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00172">AP_TECS.h:172</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ac78f1d3d1bb76bcae15b87bb0f8f71d6"><div class="ttname"><a href="classAP__TECS.html#ac78f1d3d1bb76bcae15b87bb0f8f71d6">AP_TECS::_PITCHmaxf</a></div><div class="ttdeci">float _PITCHmaxf</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00365">AP_TECS.h:365</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ac94ec1f860105c16d714eeb2f62fade7"><div class="ttname"><a href="classAP__TECS.html#ac94ec1f860105c16d714eeb2f62fade7">AP_TECS::_path_proportion</a></div><div class="ttdeci">float _path_proportion</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00413">AP_TECS.h:413</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_acd76a5444bb0f89fcaa5a296ff824edb"><div class="ttname"><a href="classAP__TECS.html#acd76a5444bb0f89fcaa5a296ff824edb">AP_TECS::_pitch_measured_lpf</a></div><div class="ttdeci">LowPassFilterFloat _pitch_measured_lpf</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00435">AP_TECS.h:435</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_aceeb5b086fc333e84f45afea2a9fbe0c"><div class="ttname"><a href="classAP__TECS.html#aceeb5b086fc333e84f45afea2a9fbe0c">AP_TECS::_SPEdot_dem</a></div><div class="ttdeci">float _SPEdot_dem</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00379">AP_TECS.h:379</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_acf4aed1a469a3bce5d1f68ee8a73fed6"><div class="ttname"><a href="classAP__TECS.html#acf4aed1a469a3bce5d1f68ee8a73fed6">AP_TECS::_update_energies</a></div><div class="ttdeci">void _update_energies(void)</div><div class="ttdef"><b>Definition</b> <a href="#l00663">AP_TECS.cpp:663</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ad2491f34594ebea479ce92259a36cce3"><div class="ttname"><a href="classAP__TECS.html#ad2491f34594ebea479ce92259a36cce3">AP_TECS::_THRminf</a></div><div class="ttdeci">float _THRminf</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00362">AP_TECS.h:362</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ad389410d7cdfeb64006760ea718ef325"><div class="ttname"><a href="classAP__TECS.html#ad389410d7cdfeb64006760ea718ef325">AP_TECS::_pitch_ff_v0</a></div><div class="ttdeci">AP_Float _pitch_ff_v0</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00205">AP_TECS.h:205</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ad483df34b0acfb5b06bb97826f6aa55f"><div class="ttname"><a href="classAP__TECS.html#ad483df34b0acfb5b06bb97826f6aa55f">AP_TECS::_pitch_min</a></div><div class="ttdeci">AP_Int8 _pitch_min</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00193">AP_TECS.h:193</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ad5f8c48c5d674e0b4d2d289e8acfea2a"><div class="ttname"><a href="classAP__TECS.html#ad5f8c48c5d674e0b4d2d289e8acfea2a">AP_TECS::_TASmin</a></div><div class="ttdeci">float _TASmin</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00269">AP_TECS.h:269</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ad6f0fd12653837e232d71ae0f5755c23"><div class="ttname"><a href="classAP__TECS.html#ad6f0fd12653837e232d71ae0f5755c23">AP_TECS::_land_pitch_min</a></div><div class="ttdeci">float _land_pitch_min</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00417">AP_TECS.h:417</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ad838b3ab01f1d007aff6483c5164dd32"><div class="ttname"><a href="classAP__TECS.html#ad838b3ab01f1d007aff6483c5164dd32">AP_TECS::_hgt_dem_rate_ltd</a></div><div class="ttdeci">float _hgt_dem_rate_ltd</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00288">AP_TECS.h:288</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ad854305ea3b2e02af2c63a29529652ac"><div class="ttname"><a href="classAP__TECS.html#ad854305ea3b2e02af2c63a29529652ac">AP_TECS::_flags</a></div><div class="ttdeci">struct flags _flags</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00342">AP_TECS.h:342</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ad9ffe375b8f411a6ad60f5e38a47b7a1"><div class="ttname"><a href="classAP__TECS.html#ad9ffe375b8f411a6ad60f5e38a47b7a1">AP_TECS::_max_sink_scaler</a></div><div class="ttdeci">float _max_sink_scaler</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00394">AP_TECS.h:394</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ada65aa88ad9ecd6db58d55dd783b7a1f"><div class="ttname"><a href="classAP__TECS.html#ada65aa88ad9ecd6db58d55dd783b7a1f">AP_TECS::_use_synthetic_airspeed</a></div><div class="ttdeci">AP_Int8 _use_synthetic_airspeed</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00424">AP_TECS.h:424</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_adaae33ce3130a875fa9afb1cef61c725"><div class="ttname"><a href="classAP__TECS.html#adaae33ce3130a875fa9afb1cef61c725">AP_TECS::_hgt_dem_in_prev</a></div><div class="ttdeci">float _hgt_dem_in_prev</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00280">AP_TECS.h:280</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_adb53c053feaac9e2b5fa7704cfd95d2c"><div class="ttname"><a href="classAP__TECS.html#adb53c053feaac9e2b5fa7704cfd95d2c">AP_TECS::_pitch_max_limit</a></div><div class="ttdeci">int8_t _pitch_max_limit</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00210">AP_TECS.h:210</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_aded3898ca3e6b3b43fc9b2cec12dacd5"><div class="ttname"><a href="classAP__TECS.html#aded3898ca3e6b3b43fc9b2cec12dacd5">AP_TECS::_flight_stage</a></div><div class="ttdeci">enum AP_FixedWing::FlightStage _flight_stage</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00350">AP_TECS.h:350</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ae0d43e99acc9993178e795b9a0ff6d32"><div class="ttname"><a href="classAP__TECS.html#ae0d43e99acc9993178e795b9a0ff6d32">AP_TECS::_SEBdot_dem_clip</a></div><div class="ttdeci">clipStatus _SEBdot_dem_clip</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00403">AP_TECS.h:403</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ae12cafab2952c95615de86f723fc0d61"><div class="ttname"><a href="classAP__TECS.html#ae12cafab2952c95615de86f723fc0d61">AP_TECS::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00019">AP_TECS.h:19</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ae160176b8170eb74b19b37db1413c70c"><div class="ttname"><a href="classAP__TECS.html#ae160176b8170eb74b19b37db1413c70c">AP_TECS::_spdWeightLand</a></div><div class="ttdeci">AP_Float _spdWeightLand</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00187">AP_TECS.h:187</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ae1b9ac9075a77848f261c56f9083e314"><div class="ttname"><a href="classAP__TECS.html#ae1b9ac9075a77848f261c56f9083e314">AP_TECS::_post_TO_hgt_offset</a></div><div class="ttdeci">float _post_TO_hgt_offset</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00292">AP_TECS.h:292</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ae23c577644577aaabc247ea3c42da36a"><div class="ttname"><a href="classAP__TECS.html#ae23c577644577aaabc247ea3c42da36a">AP_TECS::_SPE_dem</a></div><div class="ttdeci">float _SPE_dem</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00377">AP_TECS.h:377</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ae466e45747e9b2eddb0ca00cbf8f5a7f"><div class="ttname"><a href="classAP__TECS.html#ae466e45747e9b2eddb0ca00cbf8f5a7f">AP_TECS::_hgt_dem_tconst</a></div><div class="ttdeci">AP_Float _hgt_dem_tconst</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00198">AP_TECS.h:198</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ae4afaa108f4629b08efb5c19d3119233"><div class="ttname"><a href="classAP__TECS.html#ae4afaa108f4629b08efb5c19d3119233">AP_TECS::_integDTAS_state</a></div><div class="ttdeci">float _integDTAS_state</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00240">AP_TECS.h:240</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ae52e17111e872c29d269209efb7d5989"><div class="ttname"><a href="classAP__TECS.html#ae52e17111e872c29d269209efb7d5989">AP_TECS::_EAS_dem</a></div><div class="ttdeci">float _EAS_dem</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00275">AP_TECS.h:275</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_ae8327f2367078272adce7f8f25c605f4"><div class="ttname"><a href="classAP__TECS.html#ae8327f2367078272adce7f8f25c605f4">AP_TECS::_SPEdot</a></div><div class="ttdeci">float _SPEdot</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00383">AP_TECS.h:383</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_aea49e5788e0f7a244a7c17f2eabdc65d"><div class="ttname"><a href="classAP__TECS.html#aea49e5788e0f7a244a7c17f2eabdc65d">AP_TECS::_sink_rate_limit</a></div><div class="ttdeci">float _sink_rate_limit</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00226">AP_TECS.h:226</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_aea68f106f8f04f199c8470e52532e6a5"><div class="ttname"><a href="classAP__TECS.html#aea68f106f8f04f199c8470e52532e6a5">AP_TECS::_maxClimbRate</a></div><div class="ttdeci">AP_Float _maxClimbRate</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00171">AP_TECS.h:171</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_aea6abce622dc2d63d55351a2bc4a03de"><div class="ttname"><a href="classAP__TECS.html#aea6abce622dc2d63d55351a2bc4a03de">AP_TECS::_vertAccLim</a></div><div class="ttdeci">AP_Float _vertAccLim</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00184">AP_TECS.h:184</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_aeb462e3d18b68be11a13429cbe685bf7"><div class="ttname"><a href="classAP__TECS.html#aeb462e3d18b68be11a13429cbe685bf7">AP_TECS::_sink_fraction</a></div><div class="ttdeci">float _sink_fraction</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00395">AP_TECS.h:395</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_aeeaec3c74afc3770ced444525805028d"><div class="ttname"><a href="classAP__TECS.html#aeeaec3c74afc3770ced444525805028d">AP_TECS::_pitch_dem</a></div><div class="ttdeci">float _pitch_dem</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00219">AP_TECS.h:219</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_aeebe79e85106c8096f2902bad5478cc5"><div class="ttname"><a href="classAP__TECS.html#aeebe79e85106c8096f2902bad5478cc5">AP_TECS::_SKE_dem</a></div><div class="ttdeci">float _SKE_dem</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00378">AP_TECS.h:378</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_af328e7107be4e75cf496abd5f42a7e05"><div class="ttname"><a href="classAP__TECS.html#af328e7107be4e75cf496abd5f42a7e05">AP_TECS::_need_reset</a></div><div class="ttdeci">bool _need_reset</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00420">AP_TECS.h:420</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_af345f0190f5c67d2b0bfb46613e4893d"><div class="ttname"><a href="classAP__TECS.html#af345f0190f5c67d2b0bfb46613e4893d">AP_TECS::_integGain_takeoff</a></div><div class="ttdeci">AP_Float _integGain_takeoff</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00182">AP_TECS.h:182</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_af56a4ac86036ce9aad7063d5838eff6d"><div class="ttname"><a href="classAP__TECS.html#af56a4ac86036ce9aad7063d5838eff6d">AP_TECS::_spdWeight</a></div><div class="ttdeci">AP_Float _spdWeight</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00186">AP_TECS.h:186</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_af61e93b060aeade818382323b9430daa"><div class="ttname"><a href="classAP__TECS.html#af61e93b060aeade818382323b9430daa">AP_TECS::_flags_byte</a></div><div class="ttdeci">uint8_t _flags_byte</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00343">AP_TECS.h:343</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_af620e4427095f25219c46be7f75201fb"><div class="ttname"><a href="classAP__TECS.html#af620e4427095f25219c46be7f75201fb">AP_TECS::_STEdot_max</a></div><div class="ttdeci">float _STEdot_max</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00356">AP_TECS.h:356</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_afd0a59f9806d7b2521dfb688ffc37553"><div class="ttname"><a href="classAP__TECS.html#afd0a59f9806d7b2521dfb688ffc37553">AP_TECS::aparm</a></div><div class="ttdeci">const AP_FixedWing &amp; aparm</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00160">AP_TECS.h:160</a></div></div>
<div class="ttc" id="aclassAP__TECS_html_afdffa63c3526767ad499609492c57b70"><div class="ttname"><a href="classAP__TECS.html#afdffa63c3526767ad499609492c57b70">AP_TECS::_ahrs</a></div><div class="ttdeci">AP_AHRS &amp; _ahrs</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00158">AP_TECS.h:158</a></div></div>
<div class="ttc" id="aclassAverageFilter_html_a58f3da49063db38d512b15b8a0fc0995"><div class="ttname"><a href="classAverageFilter.html#a58f3da49063db38d512b15b8a0fc0995">AverageFilter::apply</a></div><div class="ttdeci">virtual T apply(T sample) override</div><div class="ttdef"><b>Definition</b> <a href="AverageFilter_8h_source.html#l00079">AverageFilter.h:79</a></div></div>
<div class="ttc" id="aclassAverageFilter_html_a63c63f0e484476da1204319b88e3a24c"><div class="ttname"><a href="classAverageFilter.html#a63c63f0e484476da1204319b88e3a24c">AverageFilter::reset</a></div><div class="ttdeci">virtual void reset() override</div><div class="ttdef"><b>Definition</b> <a href="AverageFilter_8h_source.html#l00100">AverageFilter.h:100</a></div></div>
<div class="ttc" id="aclassLowPassFilter_html_a1cc5016de137b01080fa0a6fa7fe53cd"><div class="ttname"><a href="classLowPassFilter.html#a1cc5016de137b01080fa0a6fa7fe53cd">LowPassFilter::set_cutoff_frequency</a></div><div class="ttdeci">void set_cutoff_frequency(float cutoff_freq)</div><div class="ttdef"><b>Definition</b> <a href="LowPassFilter_8cpp_source.html#l00101">LowPassFilter.cpp:101</a></div></div>
<div class="ttc" id="aclassLowPassFilter_html_a34bc75aa770bc6cc0facee3b43a05bec"><div class="ttname"><a href="classLowPassFilter.html#a34bc75aa770bc6cc0facee3b43a05bec">LowPassFilter::get</a></div><div class="ttdeci">const T &amp; get() const</div><div class="ttdef"><b>Definition</b> <a href="LowPassFilter_8cpp_source.html#l00128">LowPassFilter.cpp:128</a></div></div>
<div class="ttc" id="aclassLowPassFilter_html_aa390849d2e18ff3287f92b89d8657841"><div class="ttname"><a href="classLowPassFilter.html#aa390849d2e18ff3287f92b89d8657841">LowPassFilter::apply</a></div><div class="ttdeci">T apply(T sample, float dt)</div><div class="ttdef"><b>Definition</b> <a href="LowPassFilter_8cpp_source.html#l00118">LowPassFilter.cpp:118</a></div></div>
<div class="ttc" id="aclassLowPassFilter_html_adad51ea3b156f167fff0fb586a912cb5"><div class="ttname"><a href="classLowPassFilter.html#adad51ea3b156f167fff0fb586a912cb5">LowPassFilter::reset</a></div><div class="ttdeci">void reset(T value)</div><div class="ttdef"><b>Definition</b> <a href="LowPassFilter_8cpp_source.html#l00133">LowPassFilter.cpp:133</a></div></div>
<div class="ttc" id="aclassMatrix3_html"><div class="ttname"><a href="classMatrix3.html">Matrix3&lt; float &gt;</a></div></div>
<div class="ttc" id="aclassMatrix3_html_a7efa0e7bd4c621a7fe76cd9168960b94"><div class="ttname"><a href="classMatrix3.html#a7efa0e7bd4c621a7fe76cd9168960b94">Matrix3::c</a></div><div class="ttdeci">Vector3&lt; T &gt; c</div><div class="ttdef"><b>Definition</b> <a href="matrix3_8h_source.html#l00054">matrix3.h:54</a></div></div>
<div class="ttc" id="aclassMatrix3_html_acd7bf3421047fa155168a9c8e5164a2b"><div class="ttname"><a href="classMatrix3.html#acd7bf3421047fa155168a9c8e5164a2b">Matrix3::a</a></div><div class="ttdeci">Vector3&lt; T &gt; a</div><div class="ttdef"><b>Definition</b> <a href="matrix3_8h_source.html#l00054">matrix3.h:54</a></div></div>
<div class="ttc" id="aclassMatrix3_html_ae16bed039ad87c3337f15837c33fe2fb"><div class="ttname"><a href="classMatrix3.html#ae16bed039ad87c3337f15837c33fe2fb">Matrix3::b</a></div><div class="ttdeci">Vector3&lt; T &gt; b</div><div class="ttdef"><b>Definition</b> <a href="matrix3_8h_source.html#l00054">matrix3.h:54</a></div></div>
<div class="ttc" id="aclassVector3_html"><div class="ttname"><a href="classVector3.html">Vector3&lt; float &gt;</a></div></div>
<div class="ttc" id="aclassVector3_html_a1a0f7e168c71ca798099f0ba8a444244"><div class="ttname"><a href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">Vector3::x</a></div><div class="ttdeci">T x</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00076">vector3.h:76</a></div></div>
<div class="ttc" id="aclassVector3_html_a561df88b28e106e337a25bb86554a569"><div class="ttname"><a href="classVector3.html#a561df88b28e106e337a25bb86554a569">Vector3::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00076">vector3.h:76</a></div></div>
<div class="ttc" id="aclassVector3_html_ab3e7f5401dd6e951978bfa746809f74f"><div class="ttname"><a href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">Vector3::z</a></div><div class="ttdeci">T z</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00076">vector3.h:76</a></div></div>
<div class="ttc" id="adefinitions_8h_html_a4aa2c43b09c1300c334821f5507d6f71"><div class="ttname"><a href="definitions_8h.html#a4aa2c43b09c1300c334821f5507d6f71">M_2PI</a></div><div class="ttdeci">#define M_2PI</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00019">definitions.h:19</a></div></div>
<div class="ttc" id="adefinitions_8h_html_aea8758bf61b23b46507902b46060ebfd"><div class="ttname"><a href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a></div><div class="ttdeci">#define GRAVITY_MSS</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00047">definitions.h:47</a></div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a77dffbb18891996280308e21316ec186"><div class="ttname"><a href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a></div><div class="ttdeci">uint32_t millis()</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2system_8cpp_source.html#l00377">system.cpp:377</a></div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a7aa0ce7625c9680e30ff4a99940907a5"><div class="ttname"><a href="namespaceAP__HAL.html#a7aa0ce7625c9680e30ff4a99940907a5">AP_HAL::micros64</a></div><div class="ttdeci">uint64_t micros64()</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2system_8cpp_source.html#l00387">system.cpp:387</a></div></div>
<div class="ttc" id="anamespaceAP_html_a8aec57eb0b7a79044cbc1f0ca4b75bcf"><div class="ttname"><a href="namespaceAP.html#a8aec57eb0b7a79044cbc1f0ca4b75bcf">AP::baro</a></div><div class="ttdeci">AP_Baro &amp; baro()</div><div class="ttdef"><b>Definition</b> <a href="AP__Baro_8cpp_source.html#l01146">AP_Baro.cpp:1146</a></div></div>
<div class="ttc" id="anamespaceAP_html_aa35bfac1ea2da16f110e8e72db7b3b20"><div class="ttname"><a href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a></div><div class="ttdeci">AP_Logger &amp; logger()</div><div class="ttdef"><b>Definition</b> <a href="AP__Logger_8cpp_source.html#l01740">AP_Logger.cpp:1740</a></div></div>
<div class="ttc" id="anamespaceAP_html_ac571aa5a2ef71b7f4b4b2bfa09143fb9"><div class="ttname"><a href="namespaceAP.html#ac571aa5a2ef71b7f4b4b2bfa09143fb9">AP::ins</a></div><div class="ttdeci">AP_InertialSensor &amp; ins()</div><div class="ttdef"><b>Definition</b> <a href="AP__InertialSensor_8cpp_source.html#l02780">AP_InertialSensor.cpp:2780</a></div></div>
<div class="ttc" id="astdio_8h_html"><div class="ttname"><a href="stdio_8h.html">stdio.h</a></div></div>
<div class="ttc" id="astructAP__FixedWing_html_a2077bf8bbf9fc486c81be9b3f5b84500"><div class="ttname"><a href="structAP__FixedWing.html#a2077bf8bbf9fc486c81be9b3f5b84500">AP_FixedWing::airspeed_min</a></div><div class="ttdeci">AP_Int16 airspeed_min</div><div class="ttdef"><b>Definition</b> <a href="AP__FixedWing_8h_source.html#l00014">AP_FixedWing.h:14</a></div></div>
<div class="ttc" id="astructAP__FixedWing_html_a2b9a5e70b886a6cdd9467a25a3e79299"><div class="ttname"><a href="structAP__FixedWing.html#a2b9a5e70b886a6cdd9467a25a3e79299">AP_FixedWing::throttle_min</a></div><div class="ttdeci">AP_Int8 throttle_min</div><div class="ttdef"><b>Definition</b> <a href="AP__FixedWing_8h_source.html#l00009">AP_FixedWing.h:9</a></div></div>
<div class="ttc" id="astructAP__FixedWing_html_a4314bf4f1e3814e97a941e0c23f41f62"><div class="ttname"><a href="structAP__FixedWing.html#a4314bf4f1e3814e97a941e0c23f41f62">AP_FixedWing::throttle_slewrate</a></div><div class="ttdeci">AP_Int8 throttle_slewrate</div><div class="ttdef"><b>Definition</b> <a href="AP__FixedWing_8h_source.html#l00011">AP_FixedWing.h:11</a></div></div>
<div class="ttc" id="astructAP__FixedWing_html_a47294736b4f6b3cf4498ee7fa134652f"><div class="ttname"><a href="structAP__FixedWing.html#a47294736b4f6b3cf4498ee7fa134652f">AP_FixedWing::pitch_limit_min</a></div><div class="ttdeci">AP_Float pitch_limit_min</div><div class="ttdef"><b>Definition</b> <a href="AP__FixedWing_8h_source.html#l00021">AP_FixedWing.h:21</a></div></div>
<div class="ttc" id="astructAP__FixedWing_html_a4edf56fb0db6b278bfa857481f8e7e6b"><div class="ttname"><a href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6b">AP_FixedWing::FlightStage</a></div><div class="ttdeci">FlightStage</div><div class="ttdef"><b>Definition</b> <a href="AP__FixedWing_8h_source.html#l00044">AP_FixedWing.h:44</a></div></div>
<div class="ttc" id="astructAP__FixedWing_html_a4edf56fb0db6b278bfa857481f8e7e6ba479a809c0b6eaaefd3b1df16f976df06"><div class="ttname"><a href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6ba479a809c0b6eaaefd3b1df16f976df06">AP_FixedWing::FlightStage::LAND</a></div><div class="ttdeci">@ LAND</div></div>
<div class="ttc" id="astructAP__FixedWing_html_a4edf56fb0db6b278bfa857481f8e7e6ba8fabc74a4ed0781d663336cbf8c9c53d"><div class="ttname"><a href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6ba8fabc74a4ed0781d663336cbf8c9c53d">AP_FixedWing::FlightStage::TAKEOFF</a></div><div class="ttdeci">@ TAKEOFF</div></div>
<div class="ttc" id="astructAP__FixedWing_html_a4edf56fb0db6b278bfa857481f8e7e6baa1ef2e72eb7f85ac2f96f20d1d49ba2c"><div class="ttname"><a href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6baa1ef2e72eb7f85ac2f96f20d1d49ba2c">AP_FixedWing::FlightStage::VTOL</a></div><div class="ttdeci">@ VTOL</div></div>
<div class="ttc" id="astructAP__FixedWing_html_a4edf56fb0db6b278bfa857481f8e7e6bae9f1c207fb0d669ee1d8ce8b8ef601e3"><div class="ttname"><a href="structAP__FixedWing.html#a4edf56fb0db6b278bfa857481f8e7e6bae9f1c207fb0d669ee1d8ce8b8ef601e3">AP_FixedWing::FlightStage::ABORT_LANDING</a></div><div class="ttdeci">@ ABORT_LANDING</div></div>
<div class="ttc" id="astructAP__FixedWing_html_a5d7e8ce2b3ffd287a1d62a478f25886e"><div class="ttname"><a href="structAP__FixedWing.html#a5d7e8ce2b3ffd287a1d62a478f25886e">AP_FixedWing::pitch_limit_max</a></div><div class="ttdeci">AP_Float pitch_limit_max</div><div class="ttdef"><b>Definition</b> <a href="AP__FixedWing_8h_source.html#l00020">AP_FixedWing.h:20</a></div></div>
<div class="ttc" id="astructAP__FixedWing_html_a5ecfa2480411bccfd392a771d56988d1"><div class="ttname"><a href="structAP__FixedWing.html#a5ecfa2480411bccfd392a771d56988d1">AP_FixedWing::throttle_max</a></div><div class="ttdeci">AP_Int8 throttle_max</div><div class="ttdef"><b>Definition</b> <a href="AP__FixedWing_8h_source.html#l00010">AP_FixedWing.h:10</a></div></div>
<div class="ttc" id="astructAP__FixedWing_html_a70597e95dd49631eb0f9ad9aad997282"><div class="ttname"><a href="structAP__FixedWing.html#a70597e95dd49631eb0f9ad9aad997282">AP_FixedWing::takeoff_throttle_max</a></div><div class="ttdeci">AP_Int8 takeoff_throttle_max</div><div class="ttdef"><b>Definition</b> <a href="AP__FixedWing_8h_source.html#l00013">AP_FixedWing.h:13</a></div></div>
<div class="ttc" id="astructAP__FixedWing_html_a9787530264fe0198ac8e12d5923e5f20"><div class="ttname"><a href="structAP__FixedWing.html#a9787530264fe0198ac8e12d5923e5f20">AP_FixedWing::airspeed_cruise</a></div><div class="ttdeci">AP_Float airspeed_cruise</div><div class="ttdef"><b>Definition</b> <a href="AP__FixedWing_8h_source.html#l00016">AP_FixedWing.h:16</a></div></div>
<div class="ttc" id="astructAP__FixedWing_html_aa0b3ceea01732f41fb1ab2122f775a01"><div class="ttname"><a href="structAP__FixedWing.html#aa0b3ceea01732f41fb1ab2122f775a01">AP_FixedWing::stall_prevention</a></div><div class="ttdeci">AP_Int8 stall_prevention</div><div class="ttdef"><b>Definition</b> <a href="AP__FixedWing_8h_source.html#l00024">AP_FixedWing.h:24</a></div></div>
<div class="ttc" id="astructAP__FixedWing_html_ab3628cdc8abbecf0634d7e699853bc7a"><div class="ttname"><a href="structAP__FixedWing.html#ab3628cdc8abbecf0634d7e699853bc7a">AP_FixedWing::airspeed_max</a></div><div class="ttdeci">AP_Int16 airspeed_max</div><div class="ttdef"><b>Definition</b> <a href="AP__FixedWing_8h_source.html#l00015">AP_FixedWing.h:15</a></div></div>
<div class="ttc" id="astructAP__FixedWing_html_ac946bfe2f77ff45006af53ca5e0ac70e"><div class="ttname"><a href="structAP__FixedWing.html#ac946bfe2f77ff45006af53ca5e0ac70e">AP_FixedWing::takeoff_throttle_max_t</a></div><div class="ttdeci">AP_Float takeoff_throttle_max_t</div><div class="ttdef"><b>Definition</b> <a href="AP__FixedWing_8h_source.html#l00026">AP_FixedWing.h:26</a></div></div>
<div class="ttc" id="astructAP__FixedWing_html_af95e2dea4aee3c0a039d842db96028ef"><div class="ttname"><a href="structAP__FixedWing.html#af95e2dea4aee3c0a039d842db96028ef">AP_FixedWing::throttle_cruise</a></div><div class="ttdeci">AP_Int8 throttle_cruise</div><div class="ttdef"><b>Definition</b> <a href="AP__FixedWing_8h_source.html#l00012">AP_FixedWing.h:12</a></div></div>
<div class="ttc" id="astructAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00199">AP_Param.h:199</a></div></div>
<div class="ttc" id="astructAP__TECS_1_1flags_html_a2bcfa703099ac31a48e80d95d19bf003"><div class="ttname"><a href="structAP__TECS_1_1flags.html#a2bcfa703099ac31a48e80d95d19bf003">AP_TECS::flags::reset</a></div><div class="ttdeci">bool reset</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00338">AP_TECS.h:338</a></div></div>
<div class="ttc" id="astructAP__TECS_1_1flags_html_a83fb08f23acbfcfae39d614c5030eb78"><div class="ttname"><a href="structAP__TECS_1_1flags.html#a83fb08f23acbfcfae39d614c5030eb78">AP_TECS::flags::reached_speed_takeoff</a></div><div class="ttdeci">bool reached_speed_takeoff</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00323">AP_TECS.h:323</a></div></div>
<div class="ttc" id="astructAP__TECS_1_1flags_html_a9ba42eac2b8b0ddf8f0c36516f6a828d"><div class="ttname"><a href="structAP__TECS_1_1flags.html#a9ba42eac2b8b0ddf8f0c36516f6a828d">AP_TECS::flags::is_doing_auto_land</a></div><div class="ttdeci">bool is_doing_auto_land</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00320">AP_TECS.h:320</a></div></div>
<div class="ttc" id="astructAP__TECS_1_1flags_html_aa01b6ef92c0cefa56836bb0095e56a61"><div class="ttname"><a href="structAP__TECS_1_1flags.html#aa01b6ef92c0cefa56836bb0095e56a61">AP_TECS::flags::underspeed</a></div><div class="ttdeci">bool underspeed</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00314">AP_TECS.h:314</a></div></div>
<div class="ttc" id="astructAP__TECS_1_1flags_html_ad5cf6c80c998986a106ec709f7a644c9"><div class="ttname"><a href="structAP__TECS_1_1flags.html#ad5cf6c80c998986a106ec709f7a644c9">AP_TECS::flags::badDescent</a></div><div class="ttdeci">bool badDescent</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00317">AP_TECS.h:317</a></div></div>
<div class="ttc" id="astructAP__TECS_1_1flags_html_ae16dc10bcc947d81c729e030bd200a80"><div class="ttname"><a href="structAP__TECS_1_1flags.html#ae16dc10bcc947d81c729e030bd200a80">AP_TECS::flags::is_gliding</a></div><div class="ttdeci">bool is_gliding</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00332">AP_TECS.h:332</a></div></div>
<div class="ttc" id="astructAP__TECS_1_1flags_html_ae76491c5502bc87945e7ef5ee9a5b521"><div class="ttname"><a href="structAP__TECS_1_1flags.html#ae76491c5502bc87945e7ef5ee9a5b521">AP_TECS::flags::propulsion_failed</a></div><div class="ttdeci">bool propulsion_failed</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00335">AP_TECS.h:335</a></div></div>
<div class="ttc" id="astructAP__TECS_1_1flags_html_ae857503d52c95f7f2290290e229ee1d5"><div class="ttname"><a href="structAP__TECS_1_1flags.html#ae857503d52c95f7f2290290e229ee1d5">AP_TECS::flags::gliding_requested</a></div><div class="ttdeci">bool gliding_requested</div><div class="ttdef"><b>Definition</b> <a href="AP__TECS_8h_source.html#l00326">AP_TECS.h:326</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 22 2024 16:14:15 for APM:Libraries by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
