<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APM:Libraries: libraries/AP_AHRS/AP_AHRS.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_85ad937bf7c11de5c2907a482c9c56bd.html">AP_AHRS</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">AP_AHRS.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="AP__AHRS_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">   This program is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">   it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">   the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">   (at your option) any later version.</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"></span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">   This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">   GNU General Public License for more details.</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"></span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">   You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"> */</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="comment">/*</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="comment"> *  NavEKF based AHRS (Attitude Heading Reference System) interface for</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="comment"> *  ArduPilot</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="comment"> *</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="comment"> */</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span> </div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &quot;<a class="code" href="AP__AHRS__config_8h.html">AP_AHRS_config.h</a>&quot;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span> </div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#if AP_AHRS_ENABLED</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span> </div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &lt;<a class="code" href="AP__HAL_8h.html">AP_HAL/AP_HAL.h</a>&gt;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &quot;<a class="code" href="AP__AHRS_8h.html">AP_AHRS.h</a>&quot;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &quot;<a class="code" href="AP__AHRS__View_8h.html">AP_AHRS_View.h</a>&quot;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &lt;<a class="code" href="AP__BoardConfig_8h.html">AP_BoardConfig/AP_BoardConfig.h</a>&gt;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span><span class="preprocessor">#include &lt;<a class="code" href="AP__ExternalAHRS_8h.html">AP_ExternalAHRS/AP_ExternalAHRS.h</a>&gt;</span></div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Module_8h.html">AP_Module/AP_Module.h</a>&gt;</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span><span class="preprocessor">#include &lt;<a class="code" href="AP__GPS_8h.html">AP_GPS/AP_GPS.h</a>&gt;</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Baro_8h.html">AP_Baro/AP_Baro.h</a>&gt;</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Compass_8h.html">AP_Compass/AP_Compass.h</a>&gt;</span></div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#include &lt;<a class="code" href="AP__InternalError_8h.html">AP_InternalError/AP_InternalError.h</a>&gt;</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Logger_8h.html">AP_Logger/AP_Logger.h</a>&gt;</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Notify_8h.html">AP_Notify/AP_Notify.h</a>&gt;</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Vehicle__Type_8h.html">AP_Vehicle/AP_Vehicle_Type.h</a>&gt;</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="preprocessor">#include &lt;<a class="code" href="GCS_8h.html">GCS_MAVLink/GCS.h</a>&gt;</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span><span class="preprocessor">#include &lt;<a class="code" href="AP__InertialSensor_8h.html">AP_InertialSensor/AP_InertialSensor.h</a>&gt;</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span><span class="preprocessor">#include &lt;<a class="code" href="AP__CustomRotations_8h.html">AP_CustomRotations/AP_CustomRotations.h</a>&gt;</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span><span class="preprocessor">#if CONFIG_HAL_BOARD == HAL_BOARD_SITL</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span><span class="preprocessor">#include &lt;<a class="code" href="SITL_8h.html">SITL/SITL.h</a>&gt;</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span> </div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno"><a class="line" href="AP__AHRS_8cpp.html#aa001f83eac61ed153d8ecf8252ce23cd">   46</a></span><span class="preprocessor">#define ATTITUDE_CHECK_THRESH_ROLL_PITCH_RAD radians(10)</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno"><a class="line" href="AP__AHRS_8cpp.html#add3f02562dfbb7df7d4bd29444d9897e">   47</a></span><span class="preprocessor">#define ATTITUDE_CHECK_THRESH_YAW_RAD radians(20)</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span> </div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span><span class="preprocessor">#ifndef HAL_AHRS_EKF_TYPE_DEFAULT</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno"><a class="line" href="AP__AHRS_8cpp.html#a965816a73b6f15fda602e6436414e9ff">   50</a></span><span class="preprocessor">#define HAL_AHRS_EKF_TYPE_DEFAULT 3</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span> </div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span><span class="comment">// table of user settable parameters</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span><span class="keyword">const</span> <a class="code hl_struct" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code hl_variable" href="classAP__AHRS.html#ac88d8ea5756954941e568cc76670a674">AP_AHRS::var_info</a>[] = {</div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    <span class="comment">// index 0 and 1 are for old parameters that are no longer not used</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span> </div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>    <span class="comment">// @Param: GPS_GAIN</span></div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    <span class="comment">// @DisplayName: AHRS GPS gain</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    <span class="comment">// @Description: This controls how much to use the GPS to correct the attitude. This should never be set to zero for a plane as it would result in the plane losing control in turns. For a plane please use the default value of 1.0.</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <span class="comment">// @Range: 0.0 1.0</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    <span class="comment">// @Increment: .01</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GPS_GAIN&quot;</span>,  2, <a class="code hl_class" href="classAP__AHRS.html">AP_AHRS</a>, gps_gain, 1.0f),</div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span> </div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    <span class="comment">// @Param: GPS_USE</span></div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    <span class="comment">// @DisplayName: AHRS use GPS for DCM navigation and position-down</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    <span class="comment">// @Description: This controls whether to use dead-reckoning or GPS based navigation. If set to 0 then the GPS won&#39;t be used for navigation, and only dead reckoning will be used. A value of zero should never be used for normal flight. Currently this affects only the DCM-based AHRS: the EKF uses GPS according to its own parameters. A value of 2 means to use GPS for height as well as position - both in DCM estimation and when determining altitude-above-home.</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <span class="comment">// @Values: 0:Disabled,1:Use GPS for DCM position,2:Use GPS for DCM position and height</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GPS_USE&quot;</span>,  3, <a class="code hl_class" href="classAP__AHRS.html">AP_AHRS</a>, _gps_use, <span class="keywordtype">float</span>(<a class="code hl_enumvalue" href="AP__AHRS__Backend_8h.html#abb4caec8fb8ae46a29b81a5304fd20b6a2faec1f9f8cc7f8f40d521c4dd574f49">GPSUse::Enable</a>)),</div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span> </div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    <span class="comment">// @Param: YAW_P</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    <span class="comment">// @DisplayName: Yaw P</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    <span class="comment">// @Description: This controls the weight the compass or GPS has on the heading. A higher value means the heading will track the yaw source (GPS or compass) more rapidly.</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    <span class="comment">// @Range: 0.1 0.4</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    <span class="comment">// @Increment: .01</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;YAW_P&quot;</span>, 4,    <a class="code hl_class" href="classAP__AHRS.html">AP_AHRS</a>, _kp_yaw, 0.2f),</div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span> </div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    <span class="comment">// @Param: RP_P</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    <span class="comment">// @DisplayName: AHRS RP_P</span></div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    <span class="comment">// @Description: This controls how fast the accelerometers correct the attitude</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    <span class="comment">// @Range: 0.1 0.4</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    <span class="comment">// @Increment: .01</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RP_P&quot;</span>,  5,    <a class="code hl_class" href="classAP__AHRS.html">AP_AHRS</a>, _kp, 0.2f),</div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span> </div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    <span class="comment">// @Param: WIND_MAX</span></div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span>    <span class="comment">// @DisplayName: Maximum wind</span></div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <span class="comment">// @Description: This sets the maximum allowable difference between ground speed and airspeed. A value of zero means to use the airspeed as is. This allows the plane to cope with a failing airspeed sensor by clipping it to groundspeed plus/minus this limit. See ARSPD_OPTIONS and ARSPD_WIND_MAX to disable airspeed sensors.</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="comment">// @Range: 0 127</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    <span class="comment">// @Units: m/s</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;WIND_MAX&quot;</span>,  6,    <a class="code hl_class" href="classAP__AHRS.html">AP_AHRS</a>, _wind_max, 0.0f),</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span> </div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    <span class="comment">// NOTE: 7 was BARO_USE</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span> </div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <span class="comment">// @Param: TRIM_X</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    <span class="comment">// @DisplayName: AHRS Trim Roll</span></div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    <span class="comment">// @Description: Compensates for the roll angle difference between the control board and the frame. Positive values make the vehicle roll right.</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    <span class="comment">// @Units: rad</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    <span class="comment">// @Range: -0.1745 +0.1745</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    <span class="comment">// @Increment: 0.01</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span> </div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>    <span class="comment">// @Param: TRIM_Y</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    <span class="comment">// @DisplayName: AHRS Trim Pitch</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    <span class="comment">// @Description: Compensates for the pitch angle difference between the control board and the frame. Positive values make the vehicle pitch up/back.</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    <span class="comment">// @Units: rad</span></div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    <span class="comment">// @Range: -0.1745 +0.1745</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>    <span class="comment">// @Increment: 0.01</span></div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span> </div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    <span class="comment">// @Param: TRIM_Z</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <span class="comment">// @DisplayName: AHRS Trim Yaw</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    <span class="comment">// @Description: Not Used</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    <span class="comment">// @Units: rad</span></div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span>    <span class="comment">// @Range: -0.1745 +0.1745</span></div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    <span class="comment">// @Increment: 0.01</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;TRIM&quot;</span>, 8, <a class="code hl_class" href="classAP__AHRS.html">AP_AHRS</a>, _trim, 0),</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span> </div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    <span class="comment">// @Param: ORIENTATION</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    <span class="comment">// @DisplayName: Board Orientation</span></div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span>    <span class="comment">// @Description: Overall board orientation relative to the standard orientation for the board type. This rotates the IMU and compass readings to allow the board to be oriented in your vehicle at any 90 or 45 degree angle. The label for each option is specified in the order of rotations for that orientation. This option takes affect on next boot. After changing you will need to re-level your vehicle. Firmware versions 4.2 and prior can use a CUSTOM (100) rotation to set the AHRS_CUSTOM_ROLL/PIT/YAW angles for AHRS orientation. Later versions provide two general custom rotations which can be used, Custom 1 and Custom 2, with CUST_ROT1_ROLL/PIT/YAW or CUST_ROT2_ROLL/PIT/YAW angles.</span></div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    <span class="comment">// @Values: 0:None,1:Yaw45,2:Yaw90,3:Yaw135,4:Yaw180,5:Yaw225,6:Yaw270,7:Yaw315,8:Roll180,9:Yaw45Roll180,10:Yaw90Roll180,11:Yaw135Roll180,12:Pitch180,13:Yaw225Roll180,14:Yaw270Roll180,15:Yaw315Roll180,16:Roll90,17:Yaw45Roll90,18:Yaw90Roll90,19:Yaw135Roll90,20:Roll270,21:Yaw45Roll270,22:Yaw90Roll270,23:Yaw135Roll270,24:Pitch90,25:Pitch270,26:Yaw90Pitch180,27:Yaw270Pitch180,28:Pitch90Roll90,29:Pitch90Roll180,30:Pitch90Roll270,31:Pitch180Roll90,32:Pitch180Roll270,33:Pitch270Roll90,34:Pitch270Roll180,35:Pitch270Roll270,36:Yaw90Pitch180Roll90,37:Yaw270Roll90,38:Yaw293Pitch68Roll180,39:Pitch315,40:Pitch315Roll90,42:Roll45,43:Roll315,100:Custom 4.1 and older,101:Custom 1,102:Custom 2</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;ORIENTATION&quot;</span>, 9, <a class="code hl_class" href="classAP__AHRS.html">AP_AHRS</a>, _board_orientation, 0),</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span> </div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <span class="comment">// @Param: COMP_BETA</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <span class="comment">// @DisplayName: AHRS Velocity Complementary Filter Beta Coefficient</span></div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>    <span class="comment">// @Description: This controls the time constant for the cross-over frequency used to fuse AHRS (airspeed and heading) and GPS data to estimate ground velocity. Time constant is 0.1/beta. A larger time constant will use GPS data less and a small time constant will use air data less.</span></div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <span class="comment">// @Range: 0.001 0.5</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    <span class="comment">// @Increment: .01</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;COMP_BETA&quot;</span>,  10, <a class="code hl_class" href="classAP__AHRS.html">AP_AHRS</a>, beta, 0.1f),</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span> </div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <span class="comment">// @Param: GPS_MINSATS</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="comment">// @DisplayName: AHRS GPS Minimum satellites</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    <span class="comment">// @Description: Minimum number of satellites visible to use GPS for velocity based corrections attitude correction. This defaults to 6, which is about the point at which the velocity numbers from a GPS become too unreliable for accurate correction of the accelerometers.</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <span class="comment">// @Range: 0 10</span></div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;GPS_MINSATS&quot;</span>, 11, <a class="code hl_class" href="classAP__AHRS.html">AP_AHRS</a>, _gps_minsats, 6),</div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span> </div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    <span class="comment">// NOTE: index 12 was for GPS_DELAY, but now removed, fixed delay</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    <span class="comment">// of 1 was found to be the best choice</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span> </div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    <span class="comment">// 13 was the old EKF_USE</span></div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span> </div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <span class="comment">// @Param: EKF_TYPE</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    <span class="comment">// @DisplayName: Use NavEKF Kalman filter for attitude and position estimation</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <span class="comment">// @Description: This controls which NavEKF Kalman filter version is used for attitude and position estimation</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    <span class="comment">// @Values: 0:Disabled,2:Enable EKF2,3:Enable EKF3,11:ExternalAHRS</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;EKF_TYPE&quot;</span>,  14, <a class="code hl_class" href="classAP__AHRS.html">AP_AHRS</a>, _ekf_type, <a class="code hl_define" href="AP__AHRS_8cpp.html#a965816a73b6f15fda602e6436414e9ff">HAL_AHRS_EKF_TYPE_DEFAULT</a>),</div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span> </div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    <span class="comment">// @Param: CUSTOM_ROLL</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="comment">// @DisplayName: Board orientation roll offset</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <span class="comment">// @Description: Autopilot mounting position roll offset. Positive values = roll right, negative values = roll left. This parameter is only used when AHRS_ORIENTATION is set to CUSTOM.</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    <span class="comment">// @Range: -180 180</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>    <span class="comment">// @Units: deg</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span> </div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    <span class="comment">// index 15</span></div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span> </div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    <span class="comment">// @Param: CUSTOM_PIT</span></div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    <span class="comment">// @DisplayName: Board orientation pitch offset</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <span class="comment">// @Description: Autopilot mounting position pitch offset. Positive values = pitch up, negative values = pitch down. This parameter is only used when AHRS_ORIENTATION is set to CUSTOM.</span></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>    <span class="comment">// @Range: -180 180</span></div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    <span class="comment">// @Units: deg</span></div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span> </div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    <span class="comment">// index 16</span></div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span> </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    <span class="comment">// @Param: CUSTOM_YAW</span></div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>    <span class="comment">// @DisplayName: Board orientation yaw offset</span></div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    <span class="comment">// @Description: Autopilot mounting position yaw offset. Positive values = yaw right, negative values = yaw left. This parameter is only used when AHRS_ORIENTATION is set to CUSTOM.</span></div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <span class="comment">// @Range: -180 180</span></div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>    <span class="comment">// @Units: deg</span></div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span> </div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    <span class="comment">// index 17</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span> </div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    <span class="comment">// @Param: OPTIONS</span></div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>    <span class="comment">// @DisplayName: Optional AHRS behaviour</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>    <span class="comment">// @Description: This controls optional AHRS behaviour. Setting DisableDCMFallbackFW will change the AHRS behaviour for fixed wing aircraft in fly-forward flight to not fall back to DCM when the EKF stops navigating. Setting DisableDCMFallbackVTOL will change the AHRS behaviour for fixed wing aircraft in non fly-forward (VTOL) flight to not fall back to DCM when the EKF stops navigating. </span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>    <span class="comment">// @Bitmask: 0:DisableDCMFallbackFW, 1:DisableDCMFallbackVTOL</span></div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;OPTIONS&quot;</span>,  18, <a class="code hl_class" href="classAP__AHRS.html">AP_AHRS</a>, _options, 0),</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    </div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>    <a class="code hl_define" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>};</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span><span class="keyword">extern</span> <span class="keyword">const</span> <a class="code hl_class" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code hl_variable" href="AP__AHRS_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span> </div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span><span class="comment">// constructor</span></div>
<div class="foldopen" id="foldopen00202" data-start="{" data-end="}">
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#af532a93735e1f2496acf5002028be6e3">  202</a></span><a class="code hl_function" href="classAP__AHRS.html#af532a93735e1f2496acf5002028be6e3">AP_AHRS::AP_AHRS</a>(uint8_t flags) :</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>    _ekf_flags(flags)</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>{</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>    <a class="code hl_variable" href="classAP__AHRS.html#a2e78db63454dfa1e2ef3baa6f7be7b6c">_singleton</a> = <span class="keyword">this</span>;</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span> </div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>    <span class="comment">// load default values from var_info table</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span>    <a class="code hl_function" href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a>(<span class="keyword">this</span>, var_info);</div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span> </div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span><span class="preprocessor">#if APM_BUILD_COPTER_OR_HELI || APM_BUILD_TYPE(APM_BUILD_ArduSub)</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <span class="comment">// Copter and Sub force the use of EKF</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    <a class="code hl_variable" href="classAP__AHRS.html#acd87e22e4768b840151da63fdf168dc6">_ekf_flags</a> |= <a class="code hl_enumvalue" href="classAP__AHRS.html#a1ccb16b090fdbe84c6a2afa14b612bd9a41dee249d4015a8e4874f258c41130c3">AP_AHRS::FLAG_ALWAYS_USE_EKF</a>;</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.dcm_matrix.identity();</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span> </div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>    <span class="comment">// initialise the controller-to-autopilot-body trim state:</span></div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>    <a class="code hl_variable" href="classAP__AHRS.html#a2b1eae408a12feccfe34308ef0608e21">_last_trim</a> = <a class="code hl_variable" href="classAP__AHRS.html#aa6a48349ade83ef20981f85bf5364cb5">_trim</a>.get();</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    <a class="code hl_variable" href="classAP__AHRS.html#a5286f1508ed0f81d4a81086c9bc88d7e">_rotation_autopilot_body_to_vehicle_body</a>.<a class="code hl_function" href="classMatrix3.html#ace756290a0d39528992ead334c038de2">from_euler</a>(<a class="code hl_variable" href="classAP__AHRS.html#a2b1eae408a12feccfe34308ef0608e21">_last_trim</a>.<a class="code hl_variable" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>, <a class="code hl_variable" href="classAP__AHRS.html#a2b1eae408a12feccfe34308ef0608e21">_last_trim</a>.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>, <a class="code hl_variable" href="classAP__AHRS.html#a2b1eae408a12feccfe34308ef0608e21">_last_trim</a>.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>);</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    <a class="code hl_variable" href="classAP__AHRS.html#a641b4bea4de708dbfa1d01039bfde2e8">_rotation_vehicle_body_to_autopilot_body</a> = <a class="code hl_variable" href="classAP__AHRS.html#a5286f1508ed0f81d4a81086c9bc88d7e">_rotation_autopilot_body_to_vehicle_body</a>.<a class="code hl_function" href="classMatrix3.html#a5a186dbb48d5cb5ecd40924578478b2e">transposed</a>();</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>}</div>
</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span> </div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span><span class="comment">// init sets up INS board orientation</span></div>
<div class="foldopen" id="foldopen00223" data-start="{" data-end="}">
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#afa34da6c3a97b6d0fc469ca1e510fe97">  223</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#afa34da6c3a97b6d0fc469ca1e510fe97">AP_AHRS::init</a>()</div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>{</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    <span class="comment">// EKF1 is no longer supported - handle case where it is selected</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#a49af3c66fd17d4a7f061cb9e90933013">_ekf_type</a>.get() == 1) {</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>        <a class="code hl_function" href="classAP__BoardConfig.html#a063de6b157f88ddef383ef3930bdbf84">AP_BoardConfig::config_error</a>(<span class="stringliteral">&quot;EKF1 not available&quot;</span>);</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>    }</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span><span class="preprocessor">#if !HAL_NAVEKF2_AVAILABLE &amp;&amp; HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#a49af3c66fd17d4a7f061cb9e90933013">_ekf_type</a>.get() == 2) {</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>        <a class="code hl_variable" href="classAP__AHRS.html#a49af3c66fd17d4a7f061cb9e90933013">_ekf_type</a>.<a class="code hl_function" href="classAP__Enum.html#a33baca3301d3973d46a4f04ffa614362">set</a>(EKFType::THREE);</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>        EKF3.set_enable(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span>    }</div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span><span class="preprocessor">#elif !HAL_NAVEKF3_AVAILABLE &amp;&amp; HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#a49af3c66fd17d4a7f061cb9e90933013">_ekf_type</a>.get() == 3) {</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>        <a class="code hl_variable" href="classAP__AHRS.html#a49af3c66fd17d4a7f061cb9e90933013">_ekf_type</a>.<a class="code hl_function" href="classAP__Enum.html#a33baca3301d3973d46a4f04ffa614362">set</a>(EKFType::TWO);</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>        EKF2.set_enable(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    }</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE &amp;&amp; HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    <span class="comment">// a special case to catch users who had AHRS_EKF_TYPE=2 saved and</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <span class="comment">// updated to a version where EK2_ENABLE=0</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#a49af3c66fd17d4a7f061cb9e90933013">_ekf_type</a>.get() == 2 &amp;&amp; !EKF2.get_enable() &amp;&amp; EKF3.get_enable()) {</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>        <a class="code hl_variable" href="classAP__AHRS.html#a49af3c66fd17d4a7f061cb9e90933013">_ekf_type</a>.<a class="code hl_function" href="classAP__Enum.html#a33baca3301d3973d46a4f04ffa614362">set</a>(EKFType::THREE);</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    }</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span> </div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>    <a class="code hl_variable" href="classAP__AHRS.html#ad1492f040ceaf1183de326d063177efe">last_active_ekf_type</a> = (<a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">EKFType</a>)<a class="code hl_variable" href="classAP__AHRS.html#a49af3c66fd17d4a7f061cb9e90933013">_ekf_type</a>.get();</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span> </div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>    <span class="comment">// init backends</span></div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>    dcm.init();</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>    external.init();</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span><span class="preprocessor">#if AP_CUSTOMROTATIONS_ENABLED</span></div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>    <span class="comment">// convert to new custom rotation</span></div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>    <span class="comment">// PARAMETER_CONVERSION - Added: Nov-2021</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#a5c987313ac84c5548c4b0c1c387ea933">_board_orientation</a> == <a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681ae7d6d0015028e041def96e2ba339bba7">ROTATION_CUSTOM_OLD</a>) {</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>        <a class="code hl_variable" href="classAP__AHRS.html#a5c987313ac84c5548c4b0c1c387ea933">_board_orientation</a>.set_and_save(<a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a75ddb15fe7c87cf749dc2b82fcc99fbb">ROTATION_CUSTOM_1</a>);</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>        <a class="code hl_struct" href="structAP__Param_1_1ConversionInfo.html">AP_Param::ConversionInfo</a> info;</div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__Param.html#a97a7b5f898c84c99cb57c76d4ddc870c">AP_Param::find_top_level_key_by_pointer</a>(<span class="keyword">this</span>, info.<a class="code hl_variable" href="structAP__Param_1_1ConversionInfo.html#a75ff5c9be71f27763a405bb41e0c0aff">old_key</a>)) {</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>            info.<a class="code hl_variable" href="structAP__Param_1_1ConversionInfo.html#aefe1f37268bb6e4cdb0920db26127a7f">type</a> = <a class="code hl_enumvalue" href="AP__Param_8h.html#ad9ca22a1e508dceea20feda89a344f9aa6b298bc938d9667ff3d25c0e8b94c349">AP_PARAM_FLOAT</a>;</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>            <span class="keywordtype">float</span> rpy[3] = {};</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>            AP_Float rpy_param;</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>            <span class="keywordflow">for</span> (info.<a class="code hl_variable" href="structAP__Param_1_1ConversionInfo.html#ac734a9afbd723a353dd23e05006c8f90">old_group_element</a>=15; info.<a class="code hl_variable" href="structAP__Param_1_1ConversionInfo.html#ac734a9afbd723a353dd23e05006c8f90">old_group_element</a>&lt;=17; info.<a class="code hl_variable" href="structAP__Param_1_1ConversionInfo.html#ac734a9afbd723a353dd23e05006c8f90">old_group_element</a>++) {</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>                <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__Param.html#a857c14c819b6d550957d0f9c56c379d0">AP_Param::find_old_parameter</a>(&amp;info, &amp;rpy_param)) {</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>                    rpy[info.<a class="code hl_variable" href="structAP__Param_1_1ConversionInfo.html#ac734a9afbd723a353dd23e05006c8f90">old_group_element</a>-15] = rpy_param.get();</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>                }</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>            }</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>            <a class="code hl_function" href="namespaceAP.html#a1a3d63c4a3dd8a0bd9a17a0e500ead31">AP::custom_rotations</a>().<a class="code hl_function" href="classAP__CustomRotations.html#a55d430e886478ffd871f38686b216c5d">convert</a>(<a class="code hl_enumvalue" href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a75ddb15fe7c87cf749dc2b82fcc99fbb">ROTATION_CUSTOM_1</a>, rpy[0], rpy[1], rpy[2]);</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>        }</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    }</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span><span class="preprocessor">#endif  </span><span class="comment">// AP_CUSTOMROTATIONS_ENABLED</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>}</div>
</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span> </div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span><span class="comment">// updates matrices responsible for rotating vectors from vehicle body</span></div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span><span class="comment">// frame to autopilot body frame from _trim variables</span></div>
<div class="foldopen" id="foldopen00282" data-start="{" data-end="}">
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#adfda8756478db1ed55283e3b4af91065">  282</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#adfda8756478db1ed55283e3b4af91065">AP_AHRS::update_trim_rotation_matrices</a>()</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>{</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#a2b1eae408a12feccfe34308ef0608e21">_last_trim</a> == <a class="code hl_variable" href="classAP__AHRS.html#aa6a48349ade83ef20981f85bf5364cb5">_trim</a>.get()) {</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>        <span class="comment">// nothing to do</span></div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>    }</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span> </div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    <a class="code hl_variable" href="classAP__AHRS.html#a2b1eae408a12feccfe34308ef0608e21">_last_trim</a> = <a class="code hl_variable" href="classAP__AHRS.html#aa6a48349ade83ef20981f85bf5364cb5">_trim</a>.get();</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>    <a class="code hl_variable" href="classAP__AHRS.html#a5286f1508ed0f81d4a81086c9bc88d7e">_rotation_autopilot_body_to_vehicle_body</a>.<a class="code hl_function" href="classMatrix3.html#ace756290a0d39528992ead334c038de2">from_euler</a>(<a class="code hl_variable" href="classAP__AHRS.html#a2b1eae408a12feccfe34308ef0608e21">_last_trim</a>.<a class="code hl_variable" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>, <a class="code hl_variable" href="classAP__AHRS.html#a2b1eae408a12feccfe34308ef0608e21">_last_trim</a>.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>, <a class="code hl_variable" href="classAP__AHRS.html#a2b1eae408a12feccfe34308ef0608e21">_last_trim</a>.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>);</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>    <a class="code hl_variable" href="classAP__AHRS.html#a641b4bea4de708dbfa1d01039bfde2e8">_rotation_vehicle_body_to_autopilot_body</a> = <a class="code hl_variable" href="classAP__AHRS.html#a5286f1508ed0f81d4a81086c9bc88d7e">_rotation_autopilot_body_to_vehicle_body</a>.<a class="code hl_function" href="classMatrix3.html#a5a186dbb48d5cb5ecd40924578478b2e">transposed</a>();</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>}</div>
</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span> </div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span><span class="comment">// return a Quaternion representing our current attitude in NED frame</span></div>
<div class="foldopen" id="foldopen00295" data-start="{" data-end="}">
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a643071d85841345dc40f0da8b1ecd1c8">  295</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a643071d85841345dc40f0da8b1ecd1c8">AP_AHRS::get_quat_body_to_ned</a>(<a class="code hl_class" href="classQuaternionT.html">Quaternion</a> &amp;quat)<span class="keyword"> const</span></div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>    <a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a>.<a class="code hl_function" href="classQuaternionT.html#ab12c50ad4b582277deda302ff9109adf">from_rotation_matrix</a>(<a class="code hl_function" href="classAP__AHRS.html#a00b2b4af62a91a50e14d8cf114b78639">get_rotation_body_to_ned</a>());</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>}</div>
</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span> </div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span><span class="comment">// convert a vector from body to earth frame</span></div>
<div class="foldopen" id="foldopen00301" data-start="{" data-end="}">
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a8aacdd3ef702934629571099981f6379">  301</a></span><a class="code hl_class" href="classVector3.html">Vector3f</a> <a class="code hl_function" href="classAP__AHRS.html#a8aacdd3ef702934629571099981f6379">AP_AHRS::body_to_earth</a>(<span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;<a class="code hl_variable" href="Printf_8cpp.html#a48d9522e58fa05906c6dba23e5745a72">v</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classAP__AHRS.html#a00b2b4af62a91a50e14d8cf114b78639">get_rotation_body_to_ned</a>() * <a class="code hl_variable" href="Printf_8cpp.html#a48d9522e58fa05906c6dba23e5745a72">v</a>;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>}</div>
</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span> </div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span><span class="comment">// convert a vector from earth to body frame</span></div>
<div class="foldopen" id="foldopen00307" data-start="{" data-end="}">
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a064ea660e27536417d12b619fd7594e3">  307</a></span><a class="code hl_class" href="classVector3.html">Vector3f</a> <a class="code hl_function" href="classAP__AHRS.html#a064ea660e27536417d12b619fd7594e3">AP_AHRS::earth_to_body</a>(<span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;<a class="code hl_variable" href="Printf_8cpp.html#a48d9522e58fa05906c6dba23e5745a72">v</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classAP__AHRS.html#a00b2b4af62a91a50e14d8cf114b78639">get_rotation_body_to_ned</a>().<a class="code hl_function" href="classMatrix3.html#aa39c6a81d6ba09446739ec82c168556b">mul_transpose</a>(<a class="code hl_variable" href="Printf_8cpp.html#a48d9522e58fa05906c6dba23e5745a72">v</a>);</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>}</div>
</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span> </div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span> </div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span><span class="comment">// reset the current gyro drift estimate</span></div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span><span class="comment">//  should be called if gyro offsets are recalculated</span></div>
<div class="foldopen" id="foldopen00315" data-start="{" data-end="}">
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#aed12488ace22c3d5ccb739245d37b0b5">  315</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#aed12488ace22c3d5ccb739245d37b0b5">AP_AHRS::reset_gyro_drift</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>{</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>    <span class="comment">// support locked access functions to AHRS data</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>    <a class="code hl_define" href="AP__HAL_2Semaphores_8h.html#a819dd9ac6de800cdf1014b0a922b67d4">WITH_SEMAPHORE</a>(<a class="code hl_variable" href="classAP__AHRS.html#a38d0378ea83c46d1edb53fb6f578beaf">_rsem</a>);</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    </div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>    <span class="comment">// update DCM</span></div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>    dcm.reset_gyro_drift();</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    external.reset_gyro_drift();</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span> </div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>    <span class="comment">// reset the EKF gyro bias states</span></div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>    EKF2.resetGyroBias();</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>    EKF3.resetGyroBias();</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>}</div>
</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span> </div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span><span class="comment">/*</span></div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span><span class="comment">  update state structure after each update()</span></div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00340" data-start="{" data-end="}">
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a7fb314b5977fea695ce9ee9611d867b0">  340</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a7fb314b5977fea695ce9ee9611d867b0">AP_AHRS::update_state</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>{</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.primary_IMU = <a class="code hl_function" href="classAP__AHRS.html#a44b2873fb508f655a14ec562bab4be12">_get_primary_IMU_index</a>();</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.primary_gyro = <a class="code hl_function" href="classAP__AHRS.html#a4edff861ea2d775757a388c158fa9e8c">_get_primary_gyro_index</a>();</div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.primary_accel = <a class="code hl_function" href="classAP__AHRS.html#a267a928eb963f170b58141a10670654f">_get_primary_accel_index</a>();</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.primary_core = <a class="code hl_function" href="classAP__AHRS.html#a646f98af1ebb26d8f6d2bcde910f9c04">_get_primary_core_index</a>();</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.wind_estimate_ok = <a class="code hl_function" href="classAP__AHRS.html#a5e12a1b644ef090f6bef12118ccfdc45">_wind_estimate</a>(<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.wind_estimate);</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.EAS2TAS = <a class="code hl_function" href="classAP__AHRS__Backend.html#a54021e492180c40343aca0f8b4b0022c">AP_AHRS_Backend::get_EAS2TAS</a>();</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed_ok = <a class="code hl_function" href="classAP__AHRS.html#a6532311731210cc5f5f26b5c5f702132">_airspeed_estimate</a>(<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed, <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed_estimate_type);</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed_true_ok = <a class="code hl_function" href="classAP__AHRS.html#a2da37c111a5ece04f0aae23fe9706bbe">_airspeed_estimate_true</a>(<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed_true);</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed_vec_ok = <a class="code hl_function" href="classAP__AHRS.html#a32185e96affb89981a012d83a0a604a0">_airspeed_vector_true</a>(<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed_vec);</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.quat_ok = <a class="code hl_function" href="classAP__AHRS.html#a5ac76f49a420c38807a7076693906ff9">_get_quaternion</a>(<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.quat);</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.secondary_attitude_ok = <a class="code hl_function" href="classAP__AHRS.html#a75f0a23d4fde6c4fd8d76db586380e0e">_get_secondary_attitude</a>(<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.secondary_attitude);</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.secondary_quat_ok = <a class="code hl_function" href="classAP__AHRS.html#a437923af71a9e14a40fe2d07706603b2">_get_secondary_quaternion</a>(<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.secondary_quat);</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.location_ok = <a class="code hl_function" href="classAP__AHRS.html#a3f21a794d38053d54165b7cb4c862b5e">_get_location</a>(<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.location);</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.secondary_pos_ok = <a class="code hl_function" href="classAP__AHRS.html#ac1a399eb71c50c91044518c754c72846">_get_secondary_position</a>(<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.secondary_pos);</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.ground_speed_vec = <a class="code hl_function" href="classAP__AHRS.html#aa7cca27b944af662728a34e241f2c0fa">_groundspeed_vector</a>();</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.ground_speed = <a class="code hl_function" href="classAP__AHRS.html#a9a52ca012478b371f6fd5c91d0b891be">_groundspeed</a>();</div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span>    <a class="code hl_function" href="classAP__AHRS.html#ac5cf80db6af4db115d495605fd3254f3">_getCorrectedDeltaVelocityNED</a>(<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.corrected_dv, <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.corrected_dv_dt);</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.origin_ok = <a class="code hl_function" href="classAP__AHRS.html#ace0f7b506770c77053e0c46fc6bf95f9">_get_origin</a>(<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.origin);</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.velocity_NED_ok = <a class="code hl_function" href="classAP__AHRS.html#ac2af58fc58cc012fcb11d8ffd60a7d6b">_get_velocity_NED</a>(<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.velocity_NED);</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>}</div>
</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span> </div>
<div class="foldopen" id="foldopen00363" data-start="{" data-end="}">
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a9969f325139cc43ff49fc76904d3f0a2">  363</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a9969f325139cc43ff49fc76904d3f0a2">AP_AHRS::update</a>(<span class="keywordtype">bool</span> skip_ins_update)</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>{</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    <span class="comment">// periodically checks to see if we should update the AHRS</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>    <span class="comment">// orientation (e.g. based on the AHRS_ORIENTATION parameter)</span></div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>    <span class="comment">// allow for runtime change of orientation</span></div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>    <span class="comment">// this makes initial config easier</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>    <a class="code hl_function" href="classAP__AHRS.html#a7284d5e65c5863f5678b4d93000b116e">update_orientation</a>();</div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span> </div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>    <span class="keywordflow">if</span> (!skip_ins_update) {</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>        <span class="comment">// tell the IMU to grab some data</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>        <a class="code hl_function" href="namespaceAP.html#ac571aa5a2ef71b7f4b4b2bfa09143fb9">AP::ins</a>().<a class="code hl_function" href="classAP__InertialSensor.html#a1892346e6bf136a9d7683e032da12f01">update</a>();</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>    }</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span> </div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>    <span class="comment">// support locked access functions to AHRS data</span></div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    <a class="code hl_define" href="AP__HAL_2Semaphores_8h.html#a819dd9ac6de800cdf1014b0a922b67d4">WITH_SEMAPHORE</a>(<a class="code hl_variable" href="classAP__AHRS.html#a38d0378ea83c46d1edb53fb6f578beaf">_rsem</a>);</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span> </div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span>    <span class="comment">// see if we have to restore home after a watchdog reset:</span></div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__AHRS.html#a1462a4a27a7c1ca619a4039d18387fb6">_checked_watchdog_home</a>) {</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>        <a class="code hl_function" href="classAP__AHRS.html#a12e4314ea3b442611a838f4844d27920">load_watchdog_home</a>();</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>        <a class="code hl_variable" href="classAP__AHRS.html#a1462a4a27a7c1ca619a4039d18387fb6">_checked_watchdog_home</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    }</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span> </div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    <span class="comment">// drop back to normal priority if we were boosted by the INS</span></div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    <span class="comment">// calling delay_microseconds_boost()</span></div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Scheduler.html#ae7fbbe8ddf102d5f5c0f1502909d0af1">boost_end</a>();</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span> </div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>    <span class="comment">// update autopilot-body-to-vehicle-body from _trim parameters:</span></div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <a class="code hl_function" href="classAP__AHRS.html#adfda8756478db1ed55283e3b4af91065">update_trim_rotation_matrices</a>();</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span> </div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    <a class="code hl_function" href="classAP__AHRS.html#a3e17de9d30ca999a6921306ba5d84d16">update_DCM</a>();</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span> </div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    <span class="comment">// update takeoff/touchdown flags</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>    <a class="code hl_function" href="classAP__AHRS.html#a8e585d137f8f1b4e008bd1f38f55d9b7">update_flags</a>();</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span> </div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>    update_SITL();</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span> </div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>    update_external();</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    </div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#a49af3c66fd17d4a7f061cb9e90933013">_ekf_type</a> == 2) {</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>        <span class="comment">// if EK2 is primary then run EKF2 first to give it CPU</span></div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>        <span class="comment">// priority</span></div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>        update_EKF2();</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span>        update_EKF3();</div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>        <span class="comment">// otherwise run EKF3 first</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>        update_EKF3();</div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>        update_EKF2();</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>    }</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span> </div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span><span class="preprocessor">#if AP_MODULE_SUPPORTED</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>    <span class="comment">// call AHRS_update hook if any</span></div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>    AP_Module::call_hook_AHRS_update(*<span class="keyword">this</span>);</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span> </div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>    <span class="comment">// push gyros if optical flow present</span></div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#ad7f95fa7f6e04a7d6faefa3b5b3a3443">opticalflow</a>) {</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>        <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;exported_gyro_bias = <a class="code hl_function" href="classAP__AHRS.html#a3402dc7d74d2360c85f8d8f3dec03287">get_gyro_drift</a>();</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#ad7f95fa7f6e04a7d6faefa3b5b3a3443">opticalflow</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1OpticalFlow.html#ac34f04153fbcec6c22296397fc7fc1cc">push_gyro_bias</a>(exported_gyro_bias.<a class="code hl_variable" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>, exported_gyro_bias.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>);</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>    }</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span> </div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#ad3ac110b7f3e2e6c8eaca68fad92090e">_view</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>        <span class="comment">// update optional alternative attitude view</span></div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span>        <a class="code hl_variable" href="classAP__AHRS.html#ad3ac110b7f3e2e6c8eaca68fad92090e">_view</a>-&gt;<a class="code hl_function" href="classAP__AHRS__View.html#a8a13fdc6ad98352197979e3a88cc564d">update</a>();</div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>    }</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span> </div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>    <span class="comment">// update AOA and SSA</span></div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    <a class="code hl_function" href="classAP__AHRS.html#a7328e4bc4caf3cb87a16915edcde932e">update_AOA_SSA</a>();</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span> </div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span><span class="preprocessor">#if HAL_GCS_ENABLED</span></div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.active_EKF = <a class="code hl_function" href="classAP__AHRS.html#a697d03969b30e69c38757247027e4656">_active_EKF_type</a>();</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.active_EKF != <a class="code hl_variable" href="classAP__AHRS.html#ad1492f040ceaf1183de326d063177efe">last_active_ekf_type</a>) {</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>        <a class="code hl_variable" href="classAP__AHRS.html#ad1492f040ceaf1183de326d063177efe">last_active_ekf_type</a> = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.active_EKF;</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *shortname = <span class="stringliteral">&quot;???&quot;</span>;</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>        <span class="keywordflow">switch</span> ((<a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">EKFType</a>)<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.active_EKF) {</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>        <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>            shortname = <span class="stringliteral">&quot;DCM&quot;</span>;</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>        <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>            shortname = <span class="stringliteral">&quot;SIM&quot;</span>;</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>        <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>            shortname = <span class="stringliteral">&quot;External&quot;</span>;</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>        <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>            shortname = <span class="stringliteral">&quot;EKF3&quot;</span>;</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>        <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span>            shortname = <span class="stringliteral">&quot;EKF2&quot;</span>;</div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>        }</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>        <a class="code hl_define" href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;AHRS: %s active&quot;</span>, shortname);</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>    }</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span><span class="preprocessor">#endif </span><span class="comment">// HAL_GCS_ENABLED</span></div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span> </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    <span class="comment">// update published state</span></div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>    <a class="code hl_function" href="classAP__AHRS.html#a7fb314b5977fea695ce9ee9611d867b0">update_state</a>();</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span> </div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span><span class="preprocessor">#if CONFIG_HAL_BOARD == HAL_BOARD_SITL</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span>    <span class="comment">/*</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span><span class="comment">      add timing jitter to simulate slow EKF response</span></div>
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno">  487</span><span class="comment">     */</span></div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>    <span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code hl_variable" href="BARO__generic_8cpp.html#a83c33c2542db9ae7ca46bf548b52de7a">sitl</a> = AP::sitl();</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="BARO__generic_8cpp.html#a83c33c2542db9ae7ca46bf548b52de7a">sitl</a>-&gt;loop_time_jitter_us &gt; 0) {</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">scheduler</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Scheduler.html#a78c4f1b1f192ac1c99544b6cc8f099b0">delay_microseconds</a>(random() % <a class="code hl_variable" href="BARO__generic_8cpp.html#a83c33c2542db9ae7ca46bf548b52de7a">sitl</a>-&gt;loop_time_jitter_us);</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    }</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>}</div>
</div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span> </div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span><span class="comment">/*</span></div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span><span class="comment"> * copy results from a backend over AP_AHRS canonical results.</span></div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span><span class="comment"> * This updates member variables like roll and pitch, as well as</span></div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span><span class="comment"> * updating derived values like sin_roll and sin_pitch.</span></div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00500" data-start="{" data-end="}">
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a87bf306f55bea39a4fc5b41179961c01">  500</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a87bf306f55bea39a4fc5b41179961c01">AP_AHRS::copy_estimates_from_backend_estimates</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structAP__AHRS__Backend_1_1Estimates.html">AP_AHRS_Backend::Estimates</a> &amp;results)</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>{</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>    <a class="code hl_variable" href="classAP__AHRS.html#a384a23e205126cf43e91bec9668b7ed0">roll</a> = results.<a class="code hl_variable" href="structAP__AHRS__Backend_1_1Estimates.html#afea4d65fe81ef4e8c1bfee86cc119570">roll_rad</a>;</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>    <a class="code hl_variable" href="classAP__AHRS.html#a2aa61744614d8e0ef64803583359a56e">pitch</a> = results.<a class="code hl_variable" href="structAP__AHRS__Backend_1_1Estimates.html#a919bd2e6470f7b84d9491c25620376af">pitch_rad</a>;</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>    <a class="code hl_variable" href="classAP__AHRS.html#a63359ca9325c63642050bcf1c3e1cd63">yaw</a> = results.<a class="code hl_variable" href="structAP__AHRS__Backend_1_1Estimates.html#a3c9de4e8d6c1f5e9ca4d1ae07f1fb124">yaw_rad</a>;</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span> </div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.dcm_matrix = results.<a class="code hl_variable" href="structAP__AHRS__Backend_1_1Estimates.html#a5cdd53e31088bd74931a5c3dc8194d14">dcm_matrix</a>;</div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span> </div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.gyro_estimate = results.<a class="code hl_variable" href="structAP__AHRS__Backend_1_1Estimates.html#af9a8c54de0afd5b5065e337e34101e77">gyro_estimate</a>;</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.gyro_drift = results.<a class="code hl_variable" href="structAP__AHRS__Backend_1_1Estimates.html#a7da0f875a99b436c77ff128ded5fca53">gyro_drift</a>;</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span> </div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.accel_ef = results.<a class="code hl_variable" href="structAP__AHRS__Backend_1_1Estimates.html#aadbafe8393da44d9d3dc8c7501fc9484">accel_ef</a>;</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>    <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.accel_bias = results.<a class="code hl_variable" href="structAP__AHRS__Backend_1_1Estimates.html#a358b9633edbb589893a2e2f7fec358cc">accel_bias</a>;</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span> </div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>    <a class="code hl_function" href="classAP__AHRS.html#a8bf3f8d2410b5456bc43b937c872e6bb">update_cd_values</a>();</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>    <a class="code hl_function" href="classAP__AHRS.html#a34c0a28db3bc87426f69e34e5949bd8b">update_trig</a>();</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>}</div>
</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span> </div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a3e17de9d30ca999a6921306ba5d84d16">AP_AHRS::update_DCM</a>()</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>{</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>    dcm.update();</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>    dcm.get_results(dcm_estimates);</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span> </div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span>    <span class="comment">// we always update the vehicle&#39;s canonical roll/pitch/yaw from</span></div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>    <span class="comment">// DCM.  In normal operation this will usually be over-written by</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>    <span class="comment">// an EKF or external AHRS.  This is long-held behaviour, but this</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span>    <span class="comment">// really shouldn&#39;t be doing this.</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span> </div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>    <span class="comment">// if (active_EKF_type() == EKFType::DCM) {</span></div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>        <a class="code hl_function" href="classAP__AHRS.html#a87bf306f55bea39a4fc5b41179961c01">copy_estimates_from_backend_estimates</a>(dcm_estimates);</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>    <span class="comment">// }</span></div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>}</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span> </div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span><span class="keywordtype">void</span> AP_AHRS::update_SITL(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>{</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>    sim.update();</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>    sim.get_results(sim_estimates);</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span> </div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__AHRS.html#a697d03969b30e69c38757247027e4656">_active_EKF_type</a>() == EKFType::SIM) {</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>        <a class="code hl_function" href="classAP__AHRS.html#a87bf306f55bea39a4fc5b41179961c01">copy_estimates_from_backend_estimates</a>(sim_estimates);</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>    }</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>}</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span> </div>
<div class="foldopen" id="foldopen00547" data-start="{" data-end="}">
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a0c57bdc4738bc94b08bcefb275598fdb">  547</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a0c57bdc4738bc94b08bcefb275598fdb">AP_AHRS::update_notify_from_filter_status</a>(<span class="keyword">const</span> <a class="code hl_union" href="unionnav__filter__status.html">nav_filter_status</a> &amp;<a class="code hl_variable" href="routing_8cpp.html#acdef7b92239f1e607ef6caa33a16d2ed">status</a>)</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>{</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>    <a class="code hl_variable" href="classAP__Notify.html#a724dd074a094de26e17c72c38ac499e9">AP_Notify::flags</a>.<a class="code hl_variable" href="structAP__Notify_1_1notify__flags__and__values__type.html#a9303e217bc3b47f14dadb648d1f830a2">gps_fusion</a> = <a class="code hl_variable" href="routing_8cpp.html#acdef7b92239f1e607ef6caa33a16d2ed">status</a>.flags.using_gps; <span class="comment">// Drives AP_Notify flag for usable GPS.</span></div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>    <a class="code hl_variable" href="classAP__Notify.html#a724dd074a094de26e17c72c38ac499e9">AP_Notify::flags</a>.<a class="code hl_variable" href="structAP__Notify_1_1notify__flags__and__values__type.html#a3ba536807224307e3ae12ff8fc5820e4">gps_glitching</a> = <a class="code hl_variable" href="routing_8cpp.html#acdef7b92239f1e607ef6caa33a16d2ed">status</a>.flags.gps_glitching;</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>    <a class="code hl_variable" href="classAP__Notify.html#a724dd074a094de26e17c72c38ac499e9">AP_Notify::flags</a>.<a class="code hl_variable" href="structAP__Notify_1_1notify__flags__and__values__type.html#a04ab5915d8f9910d4c1c098f47cd4e25">have_pos_abs</a> = <a class="code hl_variable" href="routing_8cpp.html#acdef7b92239f1e607ef6caa33a16d2ed">status</a>.flags.horiz_pos_abs;</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span>}</div>
</div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span> </div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span><span class="keywordtype">void</span> AP_AHRS::update_EKF2(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>{</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>    <span class="keywordflow">if</span> (!_ekf2_started) {</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>        <span class="comment">// wait 1 second for DCM to output a valid tilt error estimate</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#aabe74303db6c3bada267e646efb1e32c">start_time_ms</a> == 0) {</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>            <a class="code hl_variable" href="classAP__AHRS.html#aabe74303db6c3bada267e646efb1e32c">start_time_ms</a> = <a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>        }</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span><span class="preprocessor">#if HAL_LOGGING_ENABLED</span></div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>        <span class="comment">// if we&#39;re doing Replay logging then don&#39;t allow any data</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>        <span class="comment">// into the EKF yet.  Don&#39;t allow it to block us for long.</span></div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a19cbaa06e0e8804d1669deacf5ad6081">was_watchdog_reset</a>()) {</div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>() - <a class="code hl_variable" href="classAP__AHRS.html#aabe74303db6c3bada267e646efb1e32c">start_time_ms</a> &lt; 5000) {</div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>                <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().allow_start_ekf()) {</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>                }</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span>            }</div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>        }</div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span> </div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>() - <a class="code hl_variable" href="classAP__AHRS.html#aabe74303db6c3bada267e646efb1e32c">start_time_ms</a> &gt; <a class="code hl_variable" href="classAP__AHRS.html#aace59e4b88b49d0c25780545a6f6a872">startup_delay_ms</a>) {</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span>            _ekf2_started = EKF2.InitialiseFilter();</div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>        }</div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>    }</div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>    <span class="keywordflow">if</span> (_ekf2_started) {</div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>        EKF2.UpdateFilter();</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__AHRS.html#a697d03969b30e69c38757247027e4656">_active_EKF_type</a>() == EKFType::TWO) {</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>            <a class="code hl_class" href="classVector3.html">Vector3f</a> eulers;</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span>            EKF2.getRotationBodyToNED(<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.dcm_matrix);</div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>            EKF2.getEulerAngles(eulers);</div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>            <a class="code hl_variable" href="classAP__AHRS.html#a384a23e205126cf43e91bec9668b7ed0">roll</a>  = eulers.<a class="code hl_variable" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span>            <a class="code hl_variable" href="classAP__AHRS.html#a2aa61744614d8e0ef64803583359a56e">pitch</a> = eulers.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>            <a class="code hl_variable" href="classAP__AHRS.html#a63359ca9325c63642050bcf1c3e1cd63">yaw</a>   = eulers.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span> </div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>            <a class="code hl_function" href="classAP__AHRS.html#a8bf3f8d2410b5456bc43b937c872e6bb">update_cd_values</a>();</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>            <a class="code hl_function" href="classAP__AHRS.html#a34c0a28db3bc87426f69e34e5949bd8b">update_trig</a>();</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span> </div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>            <span class="comment">// Use the primary EKF to select the primary gyro</span></div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span>            <span class="keyword">const</span> <a class="code hl_class" href="classAP__InertialSensor.html">AP_InertialSensor</a> &amp;_ins = <a class="code hl_function" href="namespaceAP.html#ac571aa5a2ef71b7f4b4b2bfa09143fb9">AP::ins</a>();</div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>            <span class="keyword">const</span> int8_t primary_imu = EKF2.getPrimaryCoreIMUIndex();</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span>            <span class="keyword">const</span> uint8_t <a class="code hl_variable" href="classAP__AHRS.html#a23be63851ece875ddc864babfbfafc42">primary_gyro</a> = primary_imu&gt;=0?primary_imu:_ins.<a class="code hl_function" href="classAP__InertialSensor.html#a5e8d3dd482fa7719aac4e1a65def9b81">get_primary_gyro</a>();</div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>            <span class="keyword">const</span> uint8_t <a class="code hl_variable" href="classAP__AHRS.html#ace32b3722ca6b7884a65333f0df9c372">primary_accel</a> = primary_imu&gt;=0?primary_imu:_ins.<a class="code hl_function" href="classAP__InertialSensor.html#aba8e3e520625bd93b18208f008bb7c36">get_primary_accel</a>();</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span> </div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>            <span class="comment">// get gyro bias for primary EKF and change sign to give gyro drift</span></div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span>            <span class="comment">// Note sign convention used by EKF is bias = measurement - truth</span></div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span>            <a class="code hl_class" href="classVector3.html">Vector3f</a> drift;</div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span>            EKF2.getGyroBias(drift);</div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span>            <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.gyro_drift = -drift;</div>
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno">  602</span> </div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>            <span class="comment">// use the same IMU as the primary EKF and correct for gyro drift</span></div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>            <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.gyro_estimate = _ins.<a class="code hl_function" href="classAP__InertialSensor.html#aa4ab03d6166ffbbcdd763e45eeb8bb44">get_gyro</a>(<a class="code hl_variable" href="classAP__AHRS.html#a23be63851ece875ddc864babfbfafc42">primary_gyro</a>) + <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.gyro_drift;</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span> </div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span>            <span class="comment">// get z accel bias estimate from active EKF (this is usually for the primary IMU)</span></div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>            <span class="keywordtype">float</span> &amp;abias = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.accel_bias.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>            EKF2.getAccelZBias(abias);</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span> </div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>            <span class="comment">// This EKF is currently using primary_imu, and a bias applies to only that IMU</span></div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>            <a class="code hl_class" href="classVector3.html">Vector3f</a> accel = _ins.<a class="code hl_function" href="classAP__InertialSensor.html#a707bc3f8ef8270db68ceeec36171d6ac">get_accel</a>(<a class="code hl_variable" href="classAP__AHRS.html#ace32b3722ca6b7884a65333f0df9c372">primary_accel</a>);</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span>            accel.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> -= abias;</div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>            <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.accel_ef = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.dcm_matrix * <a class="code hl_function" href="classAP__AHRS.html#aad11f5ece3c65e8f15ec46f7f7eb6ce3">get_rotation_autopilot_body_to_vehicle_body</a>() * accel;</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span> </div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>            <a class="code hl_union" href="unionnav__filter__status.html">nav_filter_status</a> filt_state;</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>            EKF2.getFilterStatus(filt_state);</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>            <a class="code hl_function" href="classAP__AHRS.html#a0c57bdc4738bc94b08bcefb275598fdb">update_notify_from_filter_status</a>(filt_state);</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>        }</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>    }</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>}</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span> </div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span><span class="keywordtype">void</span> AP_AHRS::update_EKF3(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span>{</div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span>    <span class="keywordflow">if</span> (!_ekf3_started) {</div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>        <span class="comment">// wait 1 second for DCM to output a valid tilt error estimate</span></div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#aabe74303db6c3bada267e646efb1e32c">start_time_ms</a> == 0) {</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>            <a class="code hl_variable" href="classAP__AHRS.html#aabe74303db6c3bada267e646efb1e32c">start_time_ms</a> = <a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>        }</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span><span class="preprocessor">#if HAL_LOGGING_ENABLED</span></div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>        <span class="comment">// if we&#39;re doing Replay logging then don&#39;t allow any data</span></div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span>        <span class="comment">// into the EKF yet.  Don&#39;t allow it to block us for long.</span></div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span>        <span class="keywordflow">if</span> (!<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a19cbaa06e0e8804d1669deacf5ad6081">was_watchdog_reset</a>()) {</div>
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno">  635</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>() - <a class="code hl_variable" href="classAP__AHRS.html#aabe74303db6c3bada267e646efb1e32c">start_time_ms</a> &lt; 5000) {</div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span>                <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().allow_start_ekf()) {</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>                    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>                }</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>            }</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span>        }</div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>() - <a class="code hl_variable" href="classAP__AHRS.html#aabe74303db6c3bada267e646efb1e32c">start_time_ms</a> &gt; <a class="code hl_variable" href="classAP__AHRS.html#aace59e4b88b49d0c25780545a6f6a872">startup_delay_ms</a>) {</div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>            _ekf3_started = EKF3.InitialiseFilter();</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>        }</div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>    }</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>    <span class="keywordflow">if</span> (_ekf3_started) {</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>        EKF3.UpdateFilter();</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__AHRS.html#a697d03969b30e69c38757247027e4656">_active_EKF_type</a>() == EKFType::THREE) {</div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>            <a class="code hl_class" href="classVector3.html">Vector3f</a> eulers;</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>            EKF3.getRotationBodyToNED(<a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.dcm_matrix);</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>            EKF3.getEulerAngles(eulers);</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span>            <a class="code hl_variable" href="classAP__AHRS.html#a384a23e205126cf43e91bec9668b7ed0">roll</a>  = eulers.<a class="code hl_variable" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a>;</div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span>            <a class="code hl_variable" href="classAP__AHRS.html#a2aa61744614d8e0ef64803583359a56e">pitch</a> = eulers.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a>;</div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span>            <a class="code hl_variable" href="classAP__AHRS.html#a63359ca9325c63642050bcf1c3e1cd63">yaw</a>   = eulers.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span> </div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span>            <a class="code hl_function" href="classAP__AHRS.html#a8bf3f8d2410b5456bc43b937c872e6bb">update_cd_values</a>();</div>
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno">  657</span>            <a class="code hl_function" href="classAP__AHRS.html#a34c0a28db3bc87426f69e34e5949bd8b">update_trig</a>();</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span> </div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>            <span class="keyword">const</span> <a class="code hl_class" href="classAP__InertialSensor.html">AP_InertialSensor</a> &amp;_ins = <a class="code hl_function" href="namespaceAP.html#ac571aa5a2ef71b7f4b4b2bfa09143fb9">AP::ins</a>();</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span> </div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span>            <span class="comment">// Use the primary EKF to select the primary gyro</span></div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span>            <span class="keyword">const</span> int8_t primary_imu = EKF3.getPrimaryCoreIMUIndex();</div>
<div class="line"><a id="l00663" name="l00663"></a><span class="lineno">  663</span>            <span class="keyword">const</span> uint8_t <a class="code hl_variable" href="classAP__AHRS.html#a23be63851ece875ddc864babfbfafc42">primary_gyro</a> = primary_imu&gt;=0?primary_imu:_ins.<a class="code hl_function" href="classAP__InertialSensor.html#a5e8d3dd482fa7719aac4e1a65def9b81">get_primary_gyro</a>();</div>
<div class="line"><a id="l00664" name="l00664"></a><span class="lineno">  664</span>            <span class="keyword">const</span> uint8_t <a class="code hl_variable" href="classAP__AHRS.html#ace32b3722ca6b7884a65333f0df9c372">primary_accel</a> = primary_imu&gt;=0?primary_imu:_ins.<a class="code hl_function" href="classAP__InertialSensor.html#aba8e3e520625bd93b18208f008bb7c36">get_primary_accel</a>();</div>
<div class="line"><a id="l00665" name="l00665"></a><span class="lineno">  665</span> </div>
<div class="line"><a id="l00666" name="l00666"></a><span class="lineno">  666</span>            <span class="comment">// get gyro bias for primary EKF and change sign to give gyro drift</span></div>
<div class="line"><a id="l00667" name="l00667"></a><span class="lineno">  667</span>            <span class="comment">// Note sign convention used by EKF is bias = measurement - truth</span></div>
<div class="line"><a id="l00668" name="l00668"></a><span class="lineno">  668</span>            <a class="code hl_class" href="classVector3.html">Vector3f</a> drift;</div>
<div class="line"><a id="l00669" name="l00669"></a><span class="lineno">  669</span>            EKF3.getGyroBias(-1, drift);</div>
<div class="line"><a id="l00670" name="l00670"></a><span class="lineno">  670</span>            <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.gyro_drift = -drift;</div>
<div class="line"><a id="l00671" name="l00671"></a><span class="lineno">  671</span> </div>
<div class="line"><a id="l00672" name="l00672"></a><span class="lineno">  672</span>            <span class="comment">// use the same IMU as the primary EKF and correct for gyro drift</span></div>
<div class="line"><a id="l00673" name="l00673"></a><span class="lineno">  673</span>            <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.gyro_estimate = _ins.<a class="code hl_function" href="classAP__InertialSensor.html#aa4ab03d6166ffbbcdd763e45eeb8bb44">get_gyro</a>(<a class="code hl_variable" href="classAP__AHRS.html#a23be63851ece875ddc864babfbfafc42">primary_gyro</a>) + <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.gyro_drift;</div>
<div class="line"><a id="l00674" name="l00674"></a><span class="lineno">  674</span> </div>
<div class="line"><a id="l00675" name="l00675"></a><span class="lineno">  675</span>            <span class="comment">// get 3-axis accel bias estimates for active EKF (this is usually for the primary IMU)</span></div>
<div class="line"><a id="l00676" name="l00676"></a><span class="lineno">  676</span>            <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;abias = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.accel_bias;</div>
<div class="line"><a id="l00677" name="l00677"></a><span class="lineno">  677</span>            EKF3.getAccelBias(-1,abias);</div>
<div class="line"><a id="l00678" name="l00678"></a><span class="lineno">  678</span> </div>
<div class="line"><a id="l00679" name="l00679"></a><span class="lineno">  679</span>            <span class="comment">// use the primary IMU for accel earth frame</span></div>
<div class="line"><a id="l00680" name="l00680"></a><span class="lineno">  680</span>            <a class="code hl_class" href="classVector3.html">Vector3f</a> accel = _ins.<a class="code hl_function" href="classAP__InertialSensor.html#a707bc3f8ef8270db68ceeec36171d6ac">get_accel</a>(<a class="code hl_variable" href="classAP__AHRS.html#ace32b3722ca6b7884a65333f0df9c372">primary_accel</a>);</div>
<div class="line"><a id="l00681" name="l00681"></a><span class="lineno">  681</span>            accel -= abias;</div>
<div class="line"><a id="l00682" name="l00682"></a><span class="lineno">  682</span>            <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.accel_ef = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.dcm_matrix * <a class="code hl_function" href="classAP__AHRS.html#aad11f5ece3c65e8f15ec46f7f7eb6ce3">get_rotation_autopilot_body_to_vehicle_body</a>() * accel;</div>
<div class="line"><a id="l00683" name="l00683"></a><span class="lineno">  683</span> </div>
<div class="line"><a id="l00684" name="l00684"></a><span class="lineno">  684</span>            <a class="code hl_union" href="unionnav__filter__status.html">nav_filter_status</a> filt_state;</div>
<div class="line"><a id="l00685" name="l00685"></a><span class="lineno">  685</span>            EKF3.getFilterStatus(filt_state);</div>
<div class="line"><a id="l00686" name="l00686"></a><span class="lineno">  686</span>            <a class="code hl_function" href="classAP__AHRS.html#a0c57bdc4738bc94b08bcefb275598fdb">update_notify_from_filter_status</a>(filt_state);</div>
<div class="line"><a id="l00687" name="l00687"></a><span class="lineno">  687</span>        }</div>
<div class="line"><a id="l00688" name="l00688"></a><span class="lineno">  688</span>    }</div>
<div class="line"><a id="l00689" name="l00689"></a><span class="lineno">  689</span>}</div>
<div class="line"><a id="l00690" name="l00690"></a><span class="lineno">  690</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00691" name="l00691"></a><span class="lineno">  691</span> </div>
<div class="line"><a id="l00692" name="l00692"></a><span class="lineno">  692</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l00693" name="l00693"></a><span class="lineno">  693</span><span class="keywordtype">void</span> AP_AHRS::update_external(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00694" name="l00694"></a><span class="lineno">  694</span>{</div>
<div class="line"><a id="l00695" name="l00695"></a><span class="lineno">  695</span>    external.update();</div>
<div class="line"><a id="l00696" name="l00696"></a><span class="lineno">  696</span>    external.get_results(external_estimates);</div>
<div class="line"><a id="l00697" name="l00697"></a><span class="lineno">  697</span> </div>
<div class="line"><a id="l00698" name="l00698"></a><span class="lineno">  698</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__AHRS.html#a697d03969b30e69c38757247027e4656">_active_EKF_type</a>() == EKFType::EXTERNAL) {</div>
<div class="line"><a id="l00699" name="l00699"></a><span class="lineno">  699</span>        <a class="code hl_function" href="classAP__AHRS.html#a87bf306f55bea39a4fc5b41179961c01">copy_estimates_from_backend_estimates</a>(external_estimates);</div>
<div class="line"><a id="l00700" name="l00700"></a><span class="lineno">  700</span>    }</div>
<div class="line"><a id="l00701" name="l00701"></a><span class="lineno">  701</span>}</div>
<div class="line"><a id="l00702" name="l00702"></a><span class="lineno">  702</span><span class="preprocessor">#endif </span><span class="comment">// AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l00703" name="l00703"></a><span class="lineno">  703</span> </div>
<div class="foldopen" id="foldopen00704" data-start="{" data-end="}">
<div class="line"><a id="l00704" name="l00704"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a907147b77397e9d66f08bc5bdde26627">  704</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a907147b77397e9d66f08bc5bdde26627">AP_AHRS::reset</a>()</div>
<div class="line"><a id="l00705" name="l00705"></a><span class="lineno">  705</span>{</div>
<div class="line"><a id="l00706" name="l00706"></a><span class="lineno">  706</span>    <span class="comment">// support locked access functions to AHRS data</span></div>
<div class="line"><a id="l00707" name="l00707"></a><span class="lineno">  707</span>    <a class="code hl_define" href="AP__HAL_2Semaphores_8h.html#a819dd9ac6de800cdf1014b0a922b67d4">WITH_SEMAPHORE</a>(<a class="code hl_variable" href="classAP__AHRS.html#a38d0378ea83c46d1edb53fb6f578beaf">_rsem</a>);</div>
<div class="line"><a id="l00708" name="l00708"></a><span class="lineno">  708</span> </div>
<div class="line"><a id="l00709" name="l00709"></a><span class="lineno">  709</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00710" name="l00710"></a><span class="lineno">  710</span>    dcm.reset();</div>
<div class="line"><a id="l00711" name="l00711"></a><span class="lineno">  711</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00712" name="l00712"></a><span class="lineno">  712</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l00713" name="l00713"></a><span class="lineno">  713</span>    sim.reset();</div>
<div class="line"><a id="l00714" name="l00714"></a><span class="lineno">  714</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00715" name="l00715"></a><span class="lineno">  715</span> </div>
<div class="line"><a id="l00716" name="l00716"></a><span class="lineno">  716</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l00717" name="l00717"></a><span class="lineno">  717</span>    external.reset();</div>
<div class="line"><a id="l00718" name="l00718"></a><span class="lineno">  718</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00719" name="l00719"></a><span class="lineno">  719</span> </div>
<div class="line"><a id="l00720" name="l00720"></a><span class="lineno">  720</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l00721" name="l00721"></a><span class="lineno">  721</span>    <span class="keywordflow">if</span> (_ekf2_started) {</div>
<div class="line"><a id="l00722" name="l00722"></a><span class="lineno">  722</span>        _ekf2_started = EKF2.InitialiseFilter();</div>
<div class="line"><a id="l00723" name="l00723"></a><span class="lineno">  723</span>    }</div>
<div class="line"><a id="l00724" name="l00724"></a><span class="lineno">  724</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00725" name="l00725"></a><span class="lineno">  725</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l00726" name="l00726"></a><span class="lineno">  726</span>    <span class="keywordflow">if</span> (_ekf3_started) {</div>
<div class="line"><a id="l00727" name="l00727"></a><span class="lineno">  727</span>        _ekf3_started = EKF3.InitialiseFilter();</div>
<div class="line"><a id="l00728" name="l00728"></a><span class="lineno">  728</span>    }</div>
<div class="line"><a id="l00729" name="l00729"></a><span class="lineno">  729</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00730" name="l00730"></a><span class="lineno">  730</span>}</div>
</div>
<div class="line"><a id="l00731" name="l00731"></a><span class="lineno">  731</span> </div>
<div class="line"><a id="l00732" name="l00732"></a><span class="lineno">  732</span><span class="comment">// dead-reckoning support</span></div>
<div class="foldopen" id="foldopen00733" data-start="{" data-end="}">
<div class="line"><a id="l00733" name="l00733"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a3f21a794d38053d54165b7cb4c862b5e">  733</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a3f21a794d38053d54165b7cb4c862b5e">AP_AHRS::_get_location</a>(<a class="code hl_class" href="classLocation.html">Location</a> &amp;loc)<span class="keyword"> const</span></div>
<div class="line"><a id="l00734" name="l00734"></a><span class="lineno">  734</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00735" name="l00735"></a><span class="lineno">  735</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l00736" name="l00736"></a><span class="lineno">  736</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00737" name="l00737"></a><span class="lineno">  737</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l00738" name="l00738"></a><span class="lineno">  738</span>        <span class="keywordflow">return</span> dcm_estimates.get_location(loc);</div>
<div class="line"><a id="l00739" name="l00739"></a><span class="lineno">  739</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00740" name="l00740"></a><span class="lineno">  740</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l00741" name="l00741"></a><span class="lineno">  741</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l00742" name="l00742"></a><span class="lineno">  742</span>        <span class="keywordflow">if</span> (EKF2.getLLH(loc)) {</div>
<div class="line"><a id="l00743" name="l00743"></a><span class="lineno">  743</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00744" name="l00744"></a><span class="lineno">  744</span>        }</div>
<div class="line"><a id="l00745" name="l00745"></a><span class="lineno">  745</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00746" name="l00746"></a><span class="lineno">  746</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00747" name="l00747"></a><span class="lineno">  747</span> </div>
<div class="line"><a id="l00748" name="l00748"></a><span class="lineno">  748</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l00749" name="l00749"></a><span class="lineno">  749</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l00750" name="l00750"></a><span class="lineno">  750</span>        <span class="keywordflow">if</span> (EKF3.getLLH(loc)) {</div>
<div class="line"><a id="l00751" name="l00751"></a><span class="lineno">  751</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00752" name="l00752"></a><span class="lineno">  752</span>        }</div>
<div class="line"><a id="l00753" name="l00753"></a><span class="lineno">  753</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00754" name="l00754"></a><span class="lineno">  754</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00755" name="l00755"></a><span class="lineno">  755</span> </div>
<div class="line"><a id="l00756" name="l00756"></a><span class="lineno">  756</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l00757" name="l00757"></a><span class="lineno">  757</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l00758" name="l00758"></a><span class="lineno">  758</span>        <span class="keywordflow">return</span> sim_estimates.get_location(loc);</div>
<div class="line"><a id="l00759" name="l00759"></a><span class="lineno">  759</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00760" name="l00760"></a><span class="lineno">  760</span> </div>
<div class="line"><a id="l00761" name="l00761"></a><span class="lineno">  761</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l00762" name="l00762"></a><span class="lineno">  762</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l00763" name="l00763"></a><span class="lineno">  763</span>        <span class="keywordflow">return</span> external_estimates.get_location(loc);</div>
<div class="line"><a id="l00764" name="l00764"></a><span class="lineno">  764</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00765" name="l00765"></a><span class="lineno">  765</span>    }</div>
<div class="line"><a id="l00766" name="l00766"></a><span class="lineno">  766</span> </div>
<div class="line"><a id="l00767" name="l00767"></a><span class="lineno">  767</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00768" name="l00768"></a><span class="lineno">  768</span>    <span class="comment">// fall back to position from DCM</span></div>
<div class="line"><a id="l00769" name="l00769"></a><span class="lineno">  769</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__AHRS.html#ab6e2d39bc4cee69c6532549694d694cd">always_use_EKF</a>()) {</div>
<div class="line"><a id="l00770" name="l00770"></a><span class="lineno">  770</span>        <span class="keywordflow">return</span> dcm_estimates.get_location(loc);</div>
<div class="line"><a id="l00771" name="l00771"></a><span class="lineno">  771</span>    }</div>
<div class="line"><a id="l00772" name="l00772"></a><span class="lineno">  772</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00773" name="l00773"></a><span class="lineno">  773</span> </div>
<div class="line"><a id="l00774" name="l00774"></a><span class="lineno">  774</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00775" name="l00775"></a><span class="lineno">  775</span>}</div>
</div>
<div class="line"><a id="l00776" name="l00776"></a><span class="lineno">  776</span> </div>
<div class="line"><a id="l00777" name="l00777"></a><span class="lineno">  777</span><span class="comment">// status reporting of estimated errors</span></div>
<div class="foldopen" id="foldopen00778" data-start="{" data-end="}">
<div class="line"><a id="l00778" name="l00778"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#af4ece8588b56022e42b88d434486a882">  778</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classAP__AHRS.html#af4ece8588b56022e42b88d434486a882">AP_AHRS::get_error_rp</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00779" name="l00779"></a><span class="lineno">  779</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00780" name="l00780"></a><span class="lineno">  780</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00781" name="l00781"></a><span class="lineno">  781</span>    <span class="keywordflow">return</span> dcm.get_error_rp();</div>
<div class="line"><a id="l00782" name="l00782"></a><span class="lineno">  782</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00783" name="l00783"></a><span class="lineno">  783</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00784" name="l00784"></a><span class="lineno">  784</span>}</div>
</div>
<div class="line"><a id="l00785" name="l00785"></a><span class="lineno">  785</span> </div>
<div class="foldopen" id="foldopen00786" data-start="{" data-end="}">
<div class="line"><a id="l00786" name="l00786"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#abeec4245d68965fa8a4c4397311efc69">  786</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classAP__AHRS.html#abeec4245d68965fa8a4c4397311efc69">AP_AHRS::get_error_yaw</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00787" name="l00787"></a><span class="lineno">  787</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00788" name="l00788"></a><span class="lineno">  788</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00789" name="l00789"></a><span class="lineno">  789</span>    <span class="keywordflow">return</span> dcm.get_error_yaw();</div>
<div class="line"><a id="l00790" name="l00790"></a><span class="lineno">  790</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00791" name="l00791"></a><span class="lineno">  791</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00792" name="l00792"></a><span class="lineno">  792</span>}</div>
</div>
<div class="line"><a id="l00793" name="l00793"></a><span class="lineno">  793</span> </div>
<div class="line"><a id="l00794" name="l00794"></a><span class="lineno">  794</span><span class="comment">// return a wind estimation vector, in m/s</span></div>
<div class="foldopen" id="foldopen00795" data-start="{" data-end="}">
<div class="line"><a id="l00795" name="l00795"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a5e12a1b644ef090f6bef12118ccfdc45">  795</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a5e12a1b644ef090f6bef12118ccfdc45">AP_AHRS::_wind_estimate</a>(<a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;<a class="code hl_variable" href="ardupilot__SITL__QUAD_8h.html#ae4ebf6c3b1fa52d71d50bf1064a7eb14">wind</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00796" name="l00796"></a><span class="lineno">  796</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00797" name="l00797"></a><span class="lineno">  797</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l00798" name="l00798"></a><span class="lineno">  798</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00799" name="l00799"></a><span class="lineno">  799</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l00800" name="l00800"></a><span class="lineno">  800</span>        <span class="keywordflow">return</span> dcm.wind_estimate(<a class="code hl_variable" href="ardupilot__SITL__QUAD_8h.html#ae4ebf6c3b1fa52d71d50bf1064a7eb14">wind</a>);</div>
<div class="line"><a id="l00801" name="l00801"></a><span class="lineno">  801</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00802" name="l00802"></a><span class="lineno">  802</span> </div>
<div class="line"><a id="l00803" name="l00803"></a><span class="lineno">  803</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l00804" name="l00804"></a><span class="lineno">  804</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l00805" name="l00805"></a><span class="lineno">  805</span>        <span class="keywordflow">return</span> sim.wind_estimate(<a class="code hl_variable" href="ardupilot__SITL__QUAD_8h.html#ae4ebf6c3b1fa52d71d50bf1064a7eb14">wind</a>);</div>
<div class="line"><a id="l00806" name="l00806"></a><span class="lineno">  806</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00807" name="l00807"></a><span class="lineno">  807</span> </div>
<div class="line"><a id="l00808" name="l00808"></a><span class="lineno">  808</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l00809" name="l00809"></a><span class="lineno">  809</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l00810" name="l00810"></a><span class="lineno">  810</span>        EKF2.getWind(<a class="code hl_variable" href="ardupilot__SITL__QUAD_8h.html#ae4ebf6c3b1fa52d71d50bf1064a7eb14">wind</a>);</div>
<div class="line"><a id="l00811" name="l00811"></a><span class="lineno">  811</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00812" name="l00812"></a><span class="lineno">  812</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00813" name="l00813"></a><span class="lineno">  813</span> </div>
<div class="line"><a id="l00814" name="l00814"></a><span class="lineno">  814</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l00815" name="l00815"></a><span class="lineno">  815</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l00816" name="l00816"></a><span class="lineno">  816</span>        <span class="keywordflow">return</span> EKF3.getWind(<a class="code hl_variable" href="ardupilot__SITL__QUAD_8h.html#ae4ebf6c3b1fa52d71d50bf1064a7eb14">wind</a>);</div>
<div class="line"><a id="l00817" name="l00817"></a><span class="lineno">  817</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00818" name="l00818"></a><span class="lineno">  818</span> </div>
<div class="line"><a id="l00819" name="l00819"></a><span class="lineno">  819</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l00820" name="l00820"></a><span class="lineno">  820</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l00821" name="l00821"></a><span class="lineno">  821</span>        <span class="keywordflow">return</span> external.wind_estimate(<a class="code hl_variable" href="ardupilot__SITL__QUAD_8h.html#ae4ebf6c3b1fa52d71d50bf1064a7eb14">wind</a>);</div>
<div class="line"><a id="l00822" name="l00822"></a><span class="lineno">  822</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00823" name="l00823"></a><span class="lineno">  823</span>    }</div>
<div class="line"><a id="l00824" name="l00824"></a><span class="lineno">  824</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00825" name="l00825"></a><span class="lineno">  825</span>}</div>
</div>
<div class="line"><a id="l00826" name="l00826"></a><span class="lineno">  826</span> </div>
<div class="line"><a id="l00827" name="l00827"></a><span class="lineno">  827</span> </div>
<div class="line"><a id="l00828" name="l00828"></a><span class="lineno">  828</span><span class="comment">/*</span></div>
<div class="line"><a id="l00829" name="l00829"></a><span class="lineno">  829</span><span class="comment"> * Determine how aligned heading_deg is with the wind. Return result</span></div>
<div class="line"><a id="l00830" name="l00830"></a><span class="lineno">  830</span><span class="comment"> * is 1.0 when perfectly aligned heading into wind, -1 when perfectly</span></div>
<div class="line"><a id="l00831" name="l00831"></a><span class="lineno">  831</span><span class="comment"> * aligned with-wind, and zero when perfect cross-wind. There is no</span></div>
<div class="line"><a id="l00832" name="l00832"></a><span class="lineno">  832</span><span class="comment"> * distinction between a left or right cross-wind. Wind speed is ignored</span></div>
<div class="line"><a id="l00833" name="l00833"></a><span class="lineno">  833</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00834" data-start="{" data-end="}">
<div class="line"><a id="l00834" name="l00834"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a6fae501cf684edb9174bd985998d0aa1">  834</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classAP__AHRS.html#a6fae501cf684edb9174bd985998d0aa1">AP_AHRS::wind_alignment</a>(<span class="keyword">const</span> <span class="keywordtype">float</span> heading_deg)<span class="keyword"> const</span></div>
<div class="line"><a id="l00835" name="l00835"></a><span class="lineno">  835</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00836" name="l00836"></a><span class="lineno">  836</span>    <a class="code hl_class" href="classVector3.html">Vector3f</a> <a class="code hl_variable" href="ardupilot__SITL__QUAD_8h.html#ae4ebf6c3b1fa52d71d50bf1064a7eb14">wind</a>;</div>
<div class="line"><a id="l00837" name="l00837"></a><span class="lineno">  837</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__AHRS.html#ab5c7311347bff1f1007b84ba94245e00">wind_estimate</a>(<a class="code hl_variable" href="ardupilot__SITL__QUAD_8h.html#ae4ebf6c3b1fa52d71d50bf1064a7eb14">wind</a>)) {</div>
<div class="line"><a id="l00838" name="l00838"></a><span class="lineno">  838</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l00839" name="l00839"></a><span class="lineno">  839</span>    }</div>
<div class="line"><a id="l00840" name="l00840"></a><span class="lineno">  840</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> wind_heading_rad = atan2f(-<a class="code hl_variable" href="ardupilot__SITL__QUAD_8h.html#ae4ebf6c3b1fa52d71d50bf1064a7eb14">wind</a>.<a class="code hl_variable" href="structvector4f.html#af4c3cb7fd2391987e9b380120d8fde2c">y</a>, -<a class="code hl_variable" href="ardupilot__SITL__QUAD_8h.html#ae4ebf6c3b1fa52d71d50bf1064a7eb14">wind</a>.<a class="code hl_variable" href="structvector4f.html#a486b8c1fdea4f2e325ce9dfd6ffeac10">x</a>);</div>
<div class="line"><a id="l00841" name="l00841"></a><span class="lineno">  841</span>    <span class="keywordflow">return</span> cosf(wind_heading_rad - <a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>(heading_deg));</div>
<div class="line"><a id="l00842" name="l00842"></a><span class="lineno">  842</span>}</div>
</div>
<div class="line"><a id="l00843" name="l00843"></a><span class="lineno">  843</span> </div>
<div class="line"><a id="l00844" name="l00844"></a><span class="lineno">  844</span><span class="comment">/*</span></div>
<div class="line"><a id="l00845" name="l00845"></a><span class="lineno">  845</span><span class="comment"> * returns forward head-wind component in m/s. Negative means tail-wind.</span></div>
<div class="line"><a id="l00846" name="l00846"></a><span class="lineno">  846</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00847" data-start="{" data-end="}">
<div class="line"><a id="l00847" name="l00847"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a71b7d8dd78fe4331472534a4d5b6b95d">  847</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classAP__AHRS.html#a71b7d8dd78fe4331472534a4d5b6b95d">AP_AHRS::head_wind</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l00848" name="l00848"></a><span class="lineno">  848</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00849" name="l00849"></a><span class="lineno">  849</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> alignment = <a class="code hl_function" href="classAP__AHRS.html#a6fae501cf684edb9174bd985998d0aa1">wind_alignment</a>(<a class="code hl_variable" href="classAP__AHRS.html#a8a160130dd99016a19abab9d85917261">yaw_sensor</a>*0.01f);</div>
<div class="line"><a id="l00850" name="l00850"></a><span class="lineno">  850</span>    <span class="keywordflow">return</span> alignment * <a class="code hl_variable" href="classAP__AHRS.html#ab5c7311347bff1f1007b84ba94245e00">wind_estimate</a>().<a class="code hl_function" href="classVector3.html#abcf8b89285b9966932d1aceeeadb21d3">xy</a>().<a class="code hl_function" href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">length</a>();</div>
<div class="line"><a id="l00851" name="l00851"></a><span class="lineno">  851</span>}</div>
</div>
<div class="line"><a id="l00852" name="l00852"></a><span class="lineno">  852</span> </div>
<div class="line"><a id="l00853" name="l00853"></a><span class="lineno">  853</span><span class="comment">/*</span></div>
<div class="line"><a id="l00854" name="l00854"></a><span class="lineno">  854</span><span class="comment">  return true if the current AHRS airspeed estimate is directly derived from an airspeed sensor</span></div>
<div class="line"><a id="l00855" name="l00855"></a><span class="lineno">  855</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00856" data-start="{" data-end="}">
<div class="line"><a id="l00856" name="l00856"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a4a17a0fa828d3250fef15bee06459418">  856</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a4a17a0fa828d3250fef15bee06459418">AP_AHRS::using_airspeed_sensor</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00857" name="l00857"></a><span class="lineno">  857</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00858" name="l00858"></a><span class="lineno">  858</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed_estimate_type == <a class="code hl_enumvalue" href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8a0ad871f88be8264be50fb693d51d0e28">AirspeedEstimateType::AIRSPEED_SENSOR</a>;</div>
<div class="line"><a id="l00859" name="l00859"></a><span class="lineno">  859</span>}</div>
</div>
<div class="line"><a id="l00860" name="l00860"></a><span class="lineno">  860</span> </div>
<div class="line"><a id="l00861" name="l00861"></a><span class="lineno">  861</span><span class="comment">/*</span></div>
<div class="line"><a id="l00862" name="l00862"></a><span class="lineno">  862</span><span class="comment">    Return true if a airspeed sensor should be used for the AHRS airspeed estimate</span></div>
<div class="line"><a id="l00863" name="l00863"></a><span class="lineno">  863</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00864" data-start="{" data-end="}">
<div class="line"><a id="l00864" name="l00864"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a5fc93e602ca980cb4fb860779f118329">  864</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a5fc93e602ca980cb4fb860779f118329">AP_AHRS::_should_use_airspeed_sensor</a>(uint8_t airspeed_index)<span class="keyword"> const</span></div>
<div class="line"><a id="l00865" name="l00865"></a><span class="lineno">  865</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00866" name="l00866"></a><span class="lineno">  866</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__AHRS.html#a47ea335b3b317f0c5e54320f59d5ca8a">airspeed_sensor_enabled</a>(airspeed_index)) {</div>
<div class="line"><a id="l00867" name="l00867"></a><span class="lineno">  867</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00868" name="l00868"></a><span class="lineno">  868</span>    }</div>
<div class="line"><a id="l00869" name="l00869"></a><span class="lineno">  869</span>    <a class="code hl_union" href="unionnav__filter__status.html">nav_filter_status</a> filter_status;</div>
<div class="line"><a id="l00870" name="l00870"></a><span class="lineno">  870</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#a9ae31db83d66c1fe4d11125a34a1163b">fly_forward</a> &amp;&amp;</div>
<div class="line"><a id="l00871" name="l00871"></a><span class="lineno">  871</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">get_soft_armed</a>() &amp;&amp;</div>
<div class="line"><a id="l00872" name="l00872"></a><span class="lineno">  872</span>        <a class="code hl_function" href="classAP__AHRS.html#a263904852f9b6e65cf7a082e5d999131">get_filter_status</a>(filter_status) &amp;&amp;</div>
<div class="line"><a id="l00873" name="l00873"></a><span class="lineno">  873</span>        (filter_status.<a class="code hl_variable" href="unionnav__filter__status.html#a89bf33e625b9d55f4d878c29fd8b0e98">flags</a>.<a class="code hl_variable" href="unionnav__filter__status.html#ad92aec0d08b311e5000b2b5359bafa10">rejecting_airspeed</a> &amp;&amp; !filter_status.<a class="code hl_variable" href="unionnav__filter__status.html#a89bf33e625b9d55f4d878c29fd8b0e98">flags</a>.<a class="code hl_variable" href="unionnav__filter__status.html#a5970d586986baabc5c3baaa8c5af32a6">dead_reckoning</a>)) {</div>
<div class="line"><a id="l00874" name="l00874"></a><span class="lineno">  874</span>        <span class="comment">// special case for when backend is rejecting airspeed data in</span></div>
<div class="line"><a id="l00875" name="l00875"></a><span class="lineno">  875</span>        <span class="comment">// an armed fly_forward state and not dead reckoning. Then the</span></div>
<div class="line"><a id="l00876" name="l00876"></a><span class="lineno">  876</span>        <span class="comment">// airspeed data is highly suspect and will be rejected. We</span></div>
<div class="line"><a id="l00877" name="l00877"></a><span class="lineno">  877</span>        <span class="comment">// will use the synthetic airspeed instead</span></div>
<div class="line"><a id="l00878" name="l00878"></a><span class="lineno">  878</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00879" name="l00879"></a><span class="lineno">  879</span>    }</div>
<div class="line"><a id="l00880" name="l00880"></a><span class="lineno">  880</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00881" name="l00881"></a><span class="lineno">  881</span>}</div>
</div>
<div class="line"><a id="l00882" name="l00882"></a><span class="lineno">  882</span> </div>
<div class="line"><a id="l00883" name="l00883"></a><span class="lineno">  883</span><span class="comment">// return an airspeed estimate if available. return true</span></div>
<div class="line"><a id="l00884" name="l00884"></a><span class="lineno">  884</span><span class="comment">// if we have an estimate</span></div>
<div class="foldopen" id="foldopen00885" data-start="{" data-end="}">
<div class="line"><a id="l00885" name="l00885"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a6532311731210cc5f5f26b5c5f702132">  885</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a6532311731210cc5f5f26b5c5f702132">AP_AHRS::_airspeed_estimate</a>(<span class="keywordtype">float</span> &amp;airspeed_ret, <a class="code hl_enumeration" href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8">AirspeedEstimateType</a> &amp;airspeed_estimate_type)<span class="keyword"> const</span></div>
<div class="line"><a id="l00886" name="l00886"></a><span class="lineno">  886</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00887" name="l00887"></a><span class="lineno">  887</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED || (AP_AIRSPEED_ENABLED &amp;&amp; AP_GPS_ENABLED)</span></div>
<div class="line"><a id="l00888" name="l00888"></a><span class="lineno">  888</span>    <span class="keyword">const</span> uint8_t idx = <a class="code hl_function" href="classAP__AHRS.html#adc37d9d0be559afc90e704cc747a9bf5">get_active_airspeed_index</a>();</div>
<div class="line"><a id="l00889" name="l00889"></a><span class="lineno">  889</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00890" name="l00890"></a><span class="lineno">  890</span><span class="preprocessor">#if AP_AIRSPEED_ENABLED &amp;&amp; AP_GPS_ENABLED</span></div>
<div class="line"><a id="l00891" name="l00891"></a><span class="lineno">  891</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__AHRS.html#a5fc93e602ca980cb4fb860779f118329">_should_use_airspeed_sensor</a>(idx)) {</div>
<div class="line"><a id="l00892" name="l00892"></a><span class="lineno">  892</span>        airspeed_ret = <a class="code hl_function" href="namespaceAP.html#a8d01caed65921a37d8d68f70ac255aa5">AP::airspeed</a>()-&gt;<a class="code hl_function" href="classAP__Airspeed.html#a02885c320f3cedbc08c02bc8894aba04">get_airspeed</a>(idx);</div>
<div class="line"><a id="l00893" name="l00893"></a><span class="lineno">  893</span> </div>
<div class="line"><a id="l00894" name="l00894"></a><span class="lineno">  894</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#acad24c37755823c587a684969b1cbf22">_wind_max</a> &gt; 0 &amp;&amp; <a class="code hl_function" href="namespaceAP.html#ae6eeec356455220f913e47e323057cd5">AP::gps</a>().<a class="code hl_variable" href="routing_8cpp.html#acdef7b92239f1e607ef6caa33a16d2ed">status</a>() &gt;= <a class="code hl_enumvalue" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff">AP_GPS::GPS_OK_FIX_2D</a>) {</div>
<div class="line"><a id="l00895" name="l00895"></a><span class="lineno">  895</span>            <span class="comment">// constrain the airspeed by the ground speed</span></div>
<div class="line"><a id="l00896" name="l00896"></a><span class="lineno">  896</span>            <span class="comment">// and AHRS_WIND_MAX</span></div>
<div class="line"><a id="l00897" name="l00897"></a><span class="lineno">  897</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> gnd_speed = <a class="code hl_function" href="namespaceAP.html#ae6eeec356455220f913e47e323057cd5">AP::gps</a>().<a class="code hl_function" href="classAP__GPS.html#ae7f097588dd863d4624f6fec1509e0e6">ground_speed</a>();</div>
<div class="line"><a id="l00898" name="l00898"></a><span class="lineno">  898</span>            <span class="keywordtype">float</span> true_airspeed = airspeed_ret * <a class="code hl_function" href="classAP__AHRS.html#a64786b58a1607ee420ed4f0696c755b6">get_EAS2TAS</a>();</div>
<div class="line"><a id="l00899" name="l00899"></a><span class="lineno">  899</span>            true_airspeed = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(true_airspeed,</div>
<div class="line"><a id="l00900" name="l00900"></a><span class="lineno">  900</span>                                            gnd_speed - <a class="code hl_variable" href="classAP__AHRS.html#acad24c37755823c587a684969b1cbf22">_wind_max</a>,</div>
<div class="line"><a id="l00901" name="l00901"></a><span class="lineno">  901</span>                                            gnd_speed + <a class="code hl_variable" href="classAP__AHRS.html#acad24c37755823c587a684969b1cbf22">_wind_max</a>);</div>
<div class="line"><a id="l00902" name="l00902"></a><span class="lineno">  902</span>            airspeed_ret = true_airspeed / <a class="code hl_function" href="classAP__AHRS.html#a64786b58a1607ee420ed4f0696c755b6">get_EAS2TAS</a>();</div>
<div class="line"><a id="l00903" name="l00903"></a><span class="lineno">  903</span>        }</div>
<div class="line"><a id="l00904" name="l00904"></a><span class="lineno">  904</span>        <a class="code hl_variable" href="classAP__AHRS.html#aa3dd7d322825c6c714a59d7378e6c29b">airspeed_estimate_type</a> = <a class="code hl_enumvalue" href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8a0ad871f88be8264be50fb693d51d0e28">AirspeedEstimateType::AIRSPEED_SENSOR</a>;</div>
<div class="line"><a id="l00905" name="l00905"></a><span class="lineno">  905</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00906" name="l00906"></a><span class="lineno">  906</span>    }</div>
<div class="line"><a id="l00907" name="l00907"></a><span class="lineno">  907</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00908" name="l00908"></a><span class="lineno">  908</span> </div>
<div class="line"><a id="l00909" name="l00909"></a><span class="lineno">  909</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__AHRS.html#a39ee4a9201a1d3ecea35eaba1547c4a8">get_wind_estimation_enabled</a>()) {</div>
<div class="line"><a id="l00910" name="l00910"></a><span class="lineno">  910</span>        <a class="code hl_variable" href="classAP__AHRS.html#aa3dd7d322825c6c714a59d7378e6c29b">airspeed_estimate_type</a> = <a class="code hl_enumvalue" href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8a4b2acc1e77a0ddd8580f20c792bc48fb">AirspeedEstimateType::NO_NEW_ESTIMATE</a>;</div>
<div class="line"><a id="l00911" name="l00911"></a><span class="lineno">  911</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00912" name="l00912"></a><span class="lineno">  912</span>    }</div>
<div class="line"><a id="l00913" name="l00913"></a><span class="lineno">  913</span> </div>
<div class="line"><a id="l00914" name="l00914"></a><span class="lineno">  914</span>    <span class="comment">// estimate it via nav velocity and wind estimates</span></div>
<div class="line"><a id="l00915" name="l00915"></a><span class="lineno">  915</span> </div>
<div class="line"><a id="l00916" name="l00916"></a><span class="lineno">  916</span>    <span class="comment">// get wind estimates</span></div>
<div class="line"><a id="l00917" name="l00917"></a><span class="lineno">  917</span>    <a class="code hl_class" href="classVector3.html">Vector3f</a> wind_vel;</div>
<div class="line"><a id="l00918" name="l00918"></a><span class="lineno">  918</span>    <span class="keywordtype">bool</span> have_wind = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00919" name="l00919"></a><span class="lineno">  919</span> </div>
<div class="line"><a id="l00920" name="l00920"></a><span class="lineno">  920</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l00921" name="l00921"></a><span class="lineno">  921</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00922" name="l00922"></a><span class="lineno">  922</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l00923" name="l00923"></a><span class="lineno">  923</span>        <a class="code hl_variable" href="classAP__AHRS.html#aa3dd7d322825c6c714a59d7378e6c29b">airspeed_estimate_type</a> = <a class="code hl_enumvalue" href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8a2532db9cf7deeaf307b6bb461c4507f6">AirspeedEstimateType::DCM_SYNTHETIC</a>;</div>
<div class="line"><a id="l00924" name="l00924"></a><span class="lineno">  924</span>        <span class="keywordflow">return</span> dcm.airspeed_estimate(idx, airspeed_ret);</div>
<div class="line"><a id="l00925" name="l00925"></a><span class="lineno">  925</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00926" name="l00926"></a><span class="lineno">  926</span> </div>
<div class="line"><a id="l00927" name="l00927"></a><span class="lineno">  927</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l00928" name="l00928"></a><span class="lineno">  928</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l00929" name="l00929"></a><span class="lineno">  929</span>        <a class="code hl_variable" href="classAP__AHRS.html#aa3dd7d322825c6c714a59d7378e6c29b">airspeed_estimate_type</a> = <a class="code hl_enumvalue" href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8a7863d7b3a5189647a1cc2bb4c584c295">AirspeedEstimateType::SIM</a>;</div>
<div class="line"><a id="l00930" name="l00930"></a><span class="lineno">  930</span>        <span class="keywordflow">return</span> sim.airspeed_estimate(airspeed_ret);</div>
<div class="line"><a id="l00931" name="l00931"></a><span class="lineno">  931</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00932" name="l00932"></a><span class="lineno">  932</span> </div>
<div class="line"><a id="l00933" name="l00933"></a><span class="lineno">  933</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l00934" name="l00934"></a><span class="lineno">  934</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l00935" name="l00935"></a><span class="lineno">  935</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00936" name="l00936"></a><span class="lineno">  936</span>        <a class="code hl_variable" href="classAP__AHRS.html#aa3dd7d322825c6c714a59d7378e6c29b">airspeed_estimate_type</a> = <a class="code hl_enumvalue" href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8a2532db9cf7deeaf307b6bb461c4507f6">AirspeedEstimateType::DCM_SYNTHETIC</a>;</div>
<div class="line"><a id="l00937" name="l00937"></a><span class="lineno">  937</span>        <span class="keywordflow">return</span> dcm.airspeed_estimate(idx, airspeed_ret);</div>
<div class="line"><a id="l00938" name="l00938"></a><span class="lineno">  938</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00939" name="l00939"></a><span class="lineno">  939</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00940" name="l00940"></a><span class="lineno">  940</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00941" name="l00941"></a><span class="lineno">  941</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00942" name="l00942"></a><span class="lineno">  942</span> </div>
<div class="line"><a id="l00943" name="l00943"></a><span class="lineno">  943</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l00944" name="l00944"></a><span class="lineno">  944</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l00945" name="l00945"></a><span class="lineno">  945</span>        have_wind = EKF3.getWind(wind_vel);</div>
<div class="line"><a id="l00946" name="l00946"></a><span class="lineno">  946</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00947" name="l00947"></a><span class="lineno">  947</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00948" name="l00948"></a><span class="lineno">  948</span> </div>
<div class="line"><a id="l00949" name="l00949"></a><span class="lineno">  949</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l00950" name="l00950"></a><span class="lineno">  950</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l00951" name="l00951"></a><span class="lineno">  951</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00952" name="l00952"></a><span class="lineno">  952</span>        <a class="code hl_variable" href="classAP__AHRS.html#aa3dd7d322825c6c714a59d7378e6c29b">airspeed_estimate_type</a> = <a class="code hl_enumvalue" href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8a2532db9cf7deeaf307b6bb461c4507f6">AirspeedEstimateType::DCM_SYNTHETIC</a>;</div>
<div class="line"><a id="l00953" name="l00953"></a><span class="lineno">  953</span>        <span class="keywordflow">return</span> dcm.airspeed_estimate(idx, airspeed_ret);</div>
<div class="line"><a id="l00954" name="l00954"></a><span class="lineno">  954</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00955" name="l00955"></a><span class="lineno">  955</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00956" name="l00956"></a><span class="lineno">  956</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00957" name="l00957"></a><span class="lineno">  957</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00958" name="l00958"></a><span class="lineno">  958</span>    }</div>
<div class="line"><a id="l00959" name="l00959"></a><span class="lineno">  959</span> </div>
<div class="line"><a id="l00960" name="l00960"></a><span class="lineno">  960</span>    <span class="comment">// estimate it via nav velocity and wind estimates</span></div>
<div class="line"><a id="l00961" name="l00961"></a><span class="lineno">  961</span>    <a class="code hl_class" href="classVector3.html">Vector3f</a> nav_vel;</div>
<div class="line"><a id="l00962" name="l00962"></a><span class="lineno">  962</span>    <span class="keywordflow">if</span> (have_wind &amp;&amp; <a class="code hl_function" href="classAP__AHRS.html#a9bf7361f77c132adec1b00f52dc78980">have_inertial_nav</a>() &amp;&amp; <a class="code hl_function" href="classAP__AHRS.html#a2bf7783e49e2237685ac740055a20866">get_velocity_NED</a>(nav_vel)) {</div>
<div class="line"><a id="l00963" name="l00963"></a><span class="lineno">  963</span>        <a class="code hl_class" href="classVector3.html">Vector3f</a> true_airspeed_vec = nav_vel - wind_vel;</div>
<div class="line"><a id="l00964" name="l00964"></a><span class="lineno">  964</span>        <span class="keywordtype">float</span> true_airspeed = true_airspeed_vec.<a class="code hl_function" href="classVector3.html#aaa6419ecd36a969d2eaecd9a1b1edd12">length</a>();</div>
<div class="line"><a id="l00965" name="l00965"></a><span class="lineno">  965</span>        <span class="keywordtype">float</span> gnd_speed = nav_vel.<a class="code hl_function" href="classVector3.html#aaa6419ecd36a969d2eaecd9a1b1edd12">length</a>();</div>
<div class="line"><a id="l00966" name="l00966"></a><span class="lineno">  966</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#acad24c37755823c587a684969b1cbf22">_wind_max</a> &gt; 0) {</div>
<div class="line"><a id="l00967" name="l00967"></a><span class="lineno">  967</span>            <span class="keywordtype">float</span> tas_lim_lower = <a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(0.0f, (gnd_speed - <a class="code hl_variable" href="classAP__AHRS.html#acad24c37755823c587a684969b1cbf22">_wind_max</a>));</div>
<div class="line"><a id="l00968" name="l00968"></a><span class="lineno">  968</span>            <span class="keywordtype">float</span> tas_lim_upper = <a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(tas_lim_lower, (gnd_speed + <a class="code hl_variable" href="classAP__AHRS.html#acad24c37755823c587a684969b1cbf22">_wind_max</a>));</div>
<div class="line"><a id="l00969" name="l00969"></a><span class="lineno">  969</span>            true_airspeed = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(true_airspeed, tas_lim_lower, tas_lim_upper);</div>
<div class="line"><a id="l00970" name="l00970"></a><span class="lineno">  970</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00971" name="l00971"></a><span class="lineno">  971</span>            true_airspeed = <a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(0.0f, true_airspeed);</div>
<div class="line"><a id="l00972" name="l00972"></a><span class="lineno">  972</span>        }</div>
<div class="line"><a id="l00973" name="l00973"></a><span class="lineno">  973</span>        airspeed_ret = true_airspeed / <a class="code hl_function" href="classAP__AHRS.html#a64786b58a1607ee420ed4f0696c755b6">get_EAS2TAS</a>();</div>
<div class="line"><a id="l00974" name="l00974"></a><span class="lineno">  974</span>        <a class="code hl_variable" href="classAP__AHRS.html#aa3dd7d322825c6c714a59d7378e6c29b">airspeed_estimate_type</a> = <a class="code hl_enumvalue" href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8a35b9f702263d352193bbe6273d0a0ecd">AirspeedEstimateType::EKF3_SYNTHETIC</a>;</div>
<div class="line"><a id="l00975" name="l00975"></a><span class="lineno">  975</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00976" name="l00976"></a><span class="lineno">  976</span>    }</div>
<div class="line"><a id="l00977" name="l00977"></a><span class="lineno">  977</span> </div>
<div class="line"><a id="l00978" name="l00978"></a><span class="lineno">  978</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00979" name="l00979"></a><span class="lineno">  979</span>    <span class="comment">// fallback to DCM</span></div>
<div class="line"><a id="l00980" name="l00980"></a><span class="lineno">  980</span>    <a class="code hl_variable" href="classAP__AHRS.html#aa3dd7d322825c6c714a59d7378e6c29b">airspeed_estimate_type</a> = <a class="code hl_enumvalue" href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8a2532db9cf7deeaf307b6bb461c4507f6">AirspeedEstimateType::DCM_SYNTHETIC</a>;</div>
<div class="line"><a id="l00981" name="l00981"></a><span class="lineno">  981</span>    <span class="keywordflow">return</span> dcm.airspeed_estimate(idx, airspeed_ret);</div>
<div class="line"><a id="l00982" name="l00982"></a><span class="lineno">  982</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00983" name="l00983"></a><span class="lineno">  983</span> </div>
<div class="line"><a id="l00984" name="l00984"></a><span class="lineno">  984</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00985" name="l00985"></a><span class="lineno">  985</span>}</div>
</div>
<div class="line"><a id="l00986" name="l00986"></a><span class="lineno">  986</span> </div>
<div class="foldopen" id="foldopen00987" data-start="{" data-end="}">
<div class="line"><a id="l00987" name="l00987"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a2da37c111a5ece04f0aae23fe9706bbe">  987</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a2da37c111a5ece04f0aae23fe9706bbe">AP_AHRS::_airspeed_estimate_true</a>(<span class="keywordtype">float</span> &amp;airspeed_ret)<span class="keyword"> const</span></div>
<div class="line"><a id="l00988" name="l00988"></a><span class="lineno">  988</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00989" name="l00989"></a><span class="lineno">  989</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l00990" name="l00990"></a><span class="lineno">  990</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l00991" name="l00991"></a><span class="lineno">  991</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l00992" name="l00992"></a><span class="lineno">  992</span>        <span class="keywordflow">return</span> dcm.airspeed_estimate_true(airspeed_ret);</div>
<div class="line"><a id="l00993" name="l00993"></a><span class="lineno">  993</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00994" name="l00994"></a><span class="lineno">  994</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l00995" name="l00995"></a><span class="lineno">  995</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l00996" name="l00996"></a><span class="lineno">  996</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00997" name="l00997"></a><span class="lineno">  997</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l00998" name="l00998"></a><span class="lineno">  998</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l00999" name="l00999"></a><span class="lineno">  999</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01000" name="l01000"></a><span class="lineno"> 1000</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01001" name="l01001"></a><span class="lineno"> 1001</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01002" name="l01002"></a><span class="lineno"> 1002</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01003" name="l01003"></a><span class="lineno"> 1003</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01004" name="l01004"></a><span class="lineno"> 1004</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01005" name="l01005"></a><span class="lineno"> 1005</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01006" name="l01006"></a><span class="lineno"> 1006</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01007" name="l01007"></a><span class="lineno"> 1007</span>    }</div>
<div class="line"><a id="l01008" name="l01008"></a><span class="lineno"> 1008</span> </div>
<div class="line"><a id="l01009" name="l01009"></a><span class="lineno"> 1009</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__AHRS.html#a69088a3b05155cc99c84feca718dd6cb">airspeed_estimate</a>(airspeed_ret)) {</div>
<div class="line"><a id="l01010" name="l01010"></a><span class="lineno"> 1010</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01011" name="l01011"></a><span class="lineno"> 1011</span>    }</div>
<div class="line"><a id="l01012" name="l01012"></a><span class="lineno"> 1012</span>    airspeed_ret *= <a class="code hl_function" href="classAP__AHRS.html#a64786b58a1607ee420ed4f0696c755b6">get_EAS2TAS</a>();</div>
<div class="line"><a id="l01013" name="l01013"></a><span class="lineno"> 1013</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01014" name="l01014"></a><span class="lineno"> 1014</span>}</div>
</div>
<div class="line"><a id="l01015" name="l01015"></a><span class="lineno"> 1015</span> </div>
<div class="line"><a id="l01016" name="l01016"></a><span class="lineno"> 1016</span><span class="comment">// return estimate of true airspeed vector in body frame in m/s</span></div>
<div class="line"><a id="l01017" name="l01017"></a><span class="lineno"> 1017</span><span class="comment">// returns false if estimate is unavailable</span></div>
<div class="foldopen" id="foldopen01018" data-start="{" data-end="}">
<div class="line"><a id="l01018" name="l01018"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a32185e96affb89981a012d83a0a604a0"> 1018</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a32185e96affb89981a012d83a0a604a0">AP_AHRS::_airspeed_vector_true</a>(<a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;vec)<span class="keyword"> const</span></div>
<div class="line"><a id="l01019" name="l01019"></a><span class="lineno"> 1019</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01020" name="l01020"></a><span class="lineno"> 1020</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01021" name="l01021"></a><span class="lineno"> 1021</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01022" name="l01022"></a><span class="lineno"> 1022</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01023" name="l01023"></a><span class="lineno"> 1023</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01024" name="l01024"></a><span class="lineno"> 1024</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01025" name="l01025"></a><span class="lineno"> 1025</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01026" name="l01026"></a><span class="lineno"> 1026</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01027" name="l01027"></a><span class="lineno"> 1027</span>        <span class="keywordflow">return</span> EKF2.getAirSpdVec(vec);</div>
<div class="line"><a id="l01028" name="l01028"></a><span class="lineno"> 1028</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01029" name="l01029"></a><span class="lineno"> 1029</span> </div>
<div class="line"><a id="l01030" name="l01030"></a><span class="lineno"> 1030</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01031" name="l01031"></a><span class="lineno"> 1031</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01032" name="l01032"></a><span class="lineno"> 1032</span>        <span class="keywordflow">return</span> EKF3.getAirSpdVec(vec);</div>
<div class="line"><a id="l01033" name="l01033"></a><span class="lineno"> 1033</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01034" name="l01034"></a><span class="lineno"> 1034</span> </div>
<div class="line"><a id="l01035" name="l01035"></a><span class="lineno"> 1035</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01036" name="l01036"></a><span class="lineno"> 1036</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01037" name="l01037"></a><span class="lineno"> 1037</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01038" name="l01038"></a><span class="lineno"> 1038</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01039" name="l01039"></a><span class="lineno"> 1039</span> </div>
<div class="line"><a id="l01040" name="l01040"></a><span class="lineno"> 1040</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01041" name="l01041"></a><span class="lineno"> 1041</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01042" name="l01042"></a><span class="lineno"> 1042</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01043" name="l01043"></a><span class="lineno"> 1043</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01044" name="l01044"></a><span class="lineno"> 1044</span>    }</div>
<div class="line"><a id="l01045" name="l01045"></a><span class="lineno"> 1045</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01046" name="l01046"></a><span class="lineno"> 1046</span>}</div>
</div>
<div class="line"><a id="l01047" name="l01047"></a><span class="lineno"> 1047</span> </div>
<div class="line"><a id="l01048" name="l01048"></a><span class="lineno"> 1048</span><span class="comment">// return the innovation in m/s, innovation variance in (m/s)^2 and age in msec of the last TAS measurement processed</span></div>
<div class="line"><a id="l01049" name="l01049"></a><span class="lineno"> 1049</span><span class="comment">// returns false if the data is unavailable</span></div>
<div class="foldopen" id="foldopen01050" data-start="{" data-end="}">
<div class="line"><a id="l01050" name="l01050"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#acc8e4d93f28e051715cb5da056d9f1a7"> 1050</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#acc8e4d93f28e051715cb5da056d9f1a7">AP_AHRS::airspeed_health_data</a>(<span class="keywordtype">float</span> &amp;innovation, <span class="keywordtype">float</span> &amp;innovationVariance, uint32_t &amp;age_ms)<span class="keyword"> const</span></div>
<div class="line"><a id="l01051" name="l01051"></a><span class="lineno"> 1051</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01052" name="l01052"></a><span class="lineno"> 1052</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01053" name="l01053"></a><span class="lineno"> 1053</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01054" name="l01054"></a><span class="lineno"> 1054</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01055" name="l01055"></a><span class="lineno"> 1055</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01056" name="l01056"></a><span class="lineno"> 1056</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01057" name="l01057"></a><span class="lineno"> 1057</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01058" name="l01058"></a><span class="lineno"> 1058</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01059" name="l01059"></a><span class="lineno"> 1059</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01060" name="l01060"></a><span class="lineno"> 1060</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01061" name="l01061"></a><span class="lineno"> 1061</span> </div>
<div class="line"><a id="l01062" name="l01062"></a><span class="lineno"> 1062</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01063" name="l01063"></a><span class="lineno"> 1063</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01064" name="l01064"></a><span class="lineno"> 1064</span>        <span class="keywordflow">return</span> EKF3.getAirSpdHealthData(innovation, innovationVariance, age_ms);</div>
<div class="line"><a id="l01065" name="l01065"></a><span class="lineno"> 1065</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01066" name="l01066"></a><span class="lineno"> 1066</span> </div>
<div class="line"><a id="l01067" name="l01067"></a><span class="lineno"> 1067</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01068" name="l01068"></a><span class="lineno"> 1068</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01069" name="l01069"></a><span class="lineno"> 1069</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01070" name="l01070"></a><span class="lineno"> 1070</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span> </div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01074" name="l01074"></a><span class="lineno"> 1074</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>    }</div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>}</div>
</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span> </div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span><span class="comment">// return a synthetic airspeed estimate (one derived from sensors</span></div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span><span class="comment">// other than an actual airspeed sensor), if available. return</span></div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span><span class="comment">// true if we have a synthetic airspeed.  ret will not be modified</span></div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span><span class="comment">// on failure.</span></div>
<div class="foldopen" id="foldopen01084" data-start="{" data-end="}">
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a0cfd0a7c2590aeab6494df7a50db97b7"> 1084</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a0cfd0a7c2590aeab6494df7a50db97b7">AP_AHRS::synthetic_airspeed</a>(<span class="keywordtype">float</span> &amp;ret)<span class="keyword"> const</span></div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>    <span class="keywordflow">return</span> dcm.synthetic_airspeed(ret);</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>}</div>
</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span> </div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span><span class="comment">// true if compass is being used</span></div>
<div class="foldopen" id="foldopen01093" data-start="{" data-end="}">
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#abfb7999a03395d3623610c12aa78b714"> 1093</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#abfb7999a03395d3623610c12aa78b714">AP_AHRS::use_compass</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>{</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01097" name="l01097"></a><span class="lineno"> 1097</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>        <span class="keywordflow">return</span> EKF2.use_compass();</div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span> </div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span>        <span class="keywordflow">return</span> EKF3.use_compass();</div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span> </div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>        <span class="keywordflow">return</span> sim.use_compass();</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span> </div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01119" name="l01119"></a><span class="lineno"> 1119</span>    }</div>
<div class="line"><a id="l01120" name="l01120"></a><span class="lineno"> 1120</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01121" name="l01121"></a><span class="lineno"> 1121</span>    <span class="keywordflow">return</span> dcm.use_compass();</div>
<div class="line"><a id="l01122" name="l01122"></a><span class="lineno"> 1122</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>}</div>
</div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span> </div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span><span class="comment">// return the quaternion defining the rotation from NED to XYZ (body) axes</span></div>
<div class="foldopen" id="foldopen01127" data-start="{" data-end="}">
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a5ac76f49a420c38807a7076693906ff9"> 1127</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a5ac76f49a420c38807a7076693906ff9">AP_AHRS::_get_quaternion</a>(<a class="code hl_class" href="classQuaternionT.html">Quaternion</a> &amp;quat)<span class="keyword"> const</span></div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span>    <span class="comment">// backends always return in autopilot XYZ frame; rotate result</span></div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>    <span class="comment">// according to trim</span></div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span>        <span class="keywordflow">if</span> (!dcm.get_quaternion(<a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a>)) {</div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span>        }</div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01138" name="l01138"></a><span class="lineno"> 1138</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01139" name="l01139"></a><span class="lineno"> 1139</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01140" name="l01140"></a><span class="lineno"> 1140</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01141" name="l01141"></a><span class="lineno"> 1141</span>        <span class="keywordflow">if</span> (!_ekf2_started) {</div>
<div class="line"><a id="l01142" name="l01142"></a><span class="lineno"> 1142</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01143" name="l01143"></a><span class="lineno"> 1143</span>        }</div>
<div class="line"><a id="l01144" name="l01144"></a><span class="lineno"> 1144</span>        EKF2.getQuaternion(<a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a>);</div>
<div class="line"><a id="l01145" name="l01145"></a><span class="lineno"> 1145</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01146" name="l01146"></a><span class="lineno"> 1146</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01147" name="l01147"></a><span class="lineno"> 1147</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01148" name="l01148"></a><span class="lineno"> 1148</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01149" name="l01149"></a><span class="lineno"> 1149</span>        <span class="keywordflow">if</span> (!_ekf3_started) {</div>
<div class="line"><a id="l01150" name="l01150"></a><span class="lineno"> 1150</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01151" name="l01151"></a><span class="lineno"> 1151</span>        }</div>
<div class="line"><a id="l01152" name="l01152"></a><span class="lineno"> 1152</span>        EKF3.getQuaternion(<a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a>);</div>
<div class="line"><a id="l01153" name="l01153"></a><span class="lineno"> 1153</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01154" name="l01154"></a><span class="lineno"> 1154</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01155" name="l01155"></a><span class="lineno"> 1155</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01156" name="l01156"></a><span class="lineno"> 1156</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01157" name="l01157"></a><span class="lineno"> 1157</span>        <span class="keywordflow">if</span> (!sim.get_quaternion(<a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a>)) {</div>
<div class="line"><a id="l01158" name="l01158"></a><span class="lineno"> 1158</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01159" name="l01159"></a><span class="lineno"> 1159</span>        }</div>
<div class="line"><a id="l01160" name="l01160"></a><span class="lineno"> 1160</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01161" name="l01161"></a><span class="lineno"> 1161</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01162" name="l01162"></a><span class="lineno"> 1162</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01163" name="l01163"></a><span class="lineno"> 1163</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01164" name="l01164"></a><span class="lineno"> 1164</span>        <span class="comment">// we assume the external AHRS isn&#39;t trimmed with the autopilot!</span></div>
<div class="line"><a id="l01165" name="l01165"></a><span class="lineno"> 1165</span>        <span class="keywordflow">return</span> external.get_quaternion(<a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a>);</div>
<div class="line"><a id="l01166" name="l01166"></a><span class="lineno"> 1166</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01167" name="l01167"></a><span class="lineno"> 1167</span>    }</div>
<div class="line"><a id="l01168" name="l01168"></a><span class="lineno"> 1168</span> </div>
<div class="line"><a id="l01169" name="l01169"></a><span class="lineno"> 1169</span>    <a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a>.<a class="code hl_function" href="classQuaternionT.html#a8b4b54f0e29a0f2ee476662c456fe948">rotate</a>(-<a class="code hl_variable" href="classAP__AHRS.html#aa6a48349ade83ef20981f85bf5364cb5">_trim</a>.get());</div>
<div class="line"><a id="l01170" name="l01170"></a><span class="lineno"> 1170</span> </div>
<div class="line"><a id="l01171" name="l01171"></a><span class="lineno"> 1171</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01172" name="l01172"></a><span class="lineno"> 1172</span>}</div>
</div>
<div class="line"><a id="l01173" name="l01173"></a><span class="lineno"> 1173</span> </div>
<div class="line"><a id="l01174" name="l01174"></a><span class="lineno"> 1174</span><span class="comment">// return secondary attitude solution if available, as eulers in radians</span></div>
<div class="foldopen" id="foldopen01175" data-start="{" data-end="}">
<div class="line"><a id="l01175" name="l01175"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a75f0a23d4fde6c4fd8d76db586380e0e"> 1175</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a75f0a23d4fde6c4fd8d76db586380e0e">AP_AHRS::_get_secondary_attitude</a>(<a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;eulers)<span class="keyword"> const</span></div>
<div class="line"><a id="l01176" name="l01176"></a><span class="lineno"> 1176</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01177" name="l01177"></a><span class="lineno"> 1177</span>    <a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">EKFType</a> secondary_ekf_type;</div>
<div class="line"><a id="l01178" name="l01178"></a><span class="lineno"> 1178</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__AHRS.html#af41a16f5463e74fb8f67689a1289c336">_get_secondary_EKF_type</a>(secondary_ekf_type)) {</div>
<div class="line"><a id="l01179" name="l01179"></a><span class="lineno"> 1179</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01180" name="l01180"></a><span class="lineno"> 1180</span>    }</div>
<div class="line"><a id="l01181" name="l01181"></a><span class="lineno"> 1181</span> </div>
<div class="line"><a id="l01182" name="l01182"></a><span class="lineno"> 1182</span>    <span class="keywordflow">switch</span> (secondary_ekf_type) {</div>
<div class="line"><a id="l01183" name="l01183"></a><span class="lineno"> 1183</span> </div>
<div class="line"><a id="l01184" name="l01184"></a><span class="lineno"> 1184</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01185" name="l01185"></a><span class="lineno"> 1185</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01186" name="l01186"></a><span class="lineno"> 1186</span>        <span class="comment">// DCM is secondary</span></div>
<div class="line"><a id="l01187" name="l01187"></a><span class="lineno"> 1187</span>        eulers[0] = dcm_estimates.roll_rad;</div>
<div class="line"><a id="l01188" name="l01188"></a><span class="lineno"> 1188</span>        eulers[1] = dcm_estimates.pitch_rad;</div>
<div class="line"><a id="l01189" name="l01189"></a><span class="lineno"> 1189</span>        eulers[2] = dcm_estimates.yaw_rad;</div>
<div class="line"><a id="l01190" name="l01190"></a><span class="lineno"> 1190</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01191" name="l01191"></a><span class="lineno"> 1191</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01192" name="l01192"></a><span class="lineno"> 1192</span> </div>
<div class="line"><a id="l01193" name="l01193"></a><span class="lineno"> 1193</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01194" name="l01194"></a><span class="lineno"> 1194</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01195" name="l01195"></a><span class="lineno"> 1195</span>        <span class="comment">// EKF2 is secondary</span></div>
<div class="line"><a id="l01196" name="l01196"></a><span class="lineno"> 1196</span>        EKF2.getEulerAngles(eulers);</div>
<div class="line"><a id="l01197" name="l01197"></a><span class="lineno"> 1197</span>        <span class="keywordflow">return</span> _ekf2_started;</div>
<div class="line"><a id="l01198" name="l01198"></a><span class="lineno"> 1198</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01199" name="l01199"></a><span class="lineno"> 1199</span> </div>
<div class="line"><a id="l01200" name="l01200"></a><span class="lineno"> 1200</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01201" name="l01201"></a><span class="lineno"> 1201</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01202" name="l01202"></a><span class="lineno"> 1202</span>        <span class="comment">// EKF3 is secondary</span></div>
<div class="line"><a id="l01203" name="l01203"></a><span class="lineno"> 1203</span>        EKF3.getEulerAngles(eulers);</div>
<div class="line"><a id="l01204" name="l01204"></a><span class="lineno"> 1204</span>        <span class="keywordflow">return</span> _ekf3_started;</div>
<div class="line"><a id="l01205" name="l01205"></a><span class="lineno"> 1205</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01206" name="l01206"></a><span class="lineno"> 1206</span> </div>
<div class="line"><a id="l01207" name="l01207"></a><span class="lineno"> 1207</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01208" name="l01208"></a><span class="lineno"> 1208</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01209" name="l01209"></a><span class="lineno"> 1209</span>        <span class="comment">// SITL is secondary (should never happen)</span></div>
<div class="line"><a id="l01210" name="l01210"></a><span class="lineno"> 1210</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01211" name="l01211"></a><span class="lineno"> 1211</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01212" name="l01212"></a><span class="lineno"> 1212</span> </div>
<div class="line"><a id="l01213" name="l01213"></a><span class="lineno"> 1213</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01214" name="l01214"></a><span class="lineno"> 1214</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL: {</div>
<div class="line"><a id="l01215" name="l01215"></a><span class="lineno"> 1215</span>        <span class="comment">// External is secondary</span></div>
<div class="line"><a id="l01216" name="l01216"></a><span class="lineno"> 1216</span>        eulers[0] = external_estimates.roll_rad;</div>
<div class="line"><a id="l01217" name="l01217"></a><span class="lineno"> 1217</span>        eulers[1] = external_estimates.pitch_rad;</div>
<div class="line"><a id="l01218" name="l01218"></a><span class="lineno"> 1218</span>        eulers[2] = external_estimates.yaw_rad;</div>
<div class="line"><a id="l01219" name="l01219"></a><span class="lineno"> 1219</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01220" name="l01220"></a><span class="lineno"> 1220</span>    }</div>
<div class="line"><a id="l01221" name="l01221"></a><span class="lineno"> 1221</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01222" name="l01222"></a><span class="lineno"> 1222</span>    }</div>
<div class="line"><a id="l01223" name="l01223"></a><span class="lineno"> 1223</span> </div>
<div class="line"><a id="l01224" name="l01224"></a><span class="lineno"> 1224</span>    <span class="comment">// since there is no default case above, this is unreachable</span></div>
<div class="line"><a id="l01225" name="l01225"></a><span class="lineno"> 1225</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01226" name="l01226"></a><span class="lineno"> 1226</span>}</div>
</div>
<div class="line"><a id="l01227" name="l01227"></a><span class="lineno"> 1227</span> </div>
<div class="line"><a id="l01228" name="l01228"></a><span class="lineno"> 1228</span> </div>
<div class="line"><a id="l01229" name="l01229"></a><span class="lineno"> 1229</span><span class="comment">// return secondary attitude solution if available, as quaternion</span></div>
<div class="foldopen" id="foldopen01230" data-start="{" data-end="}">
<div class="line"><a id="l01230" name="l01230"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a437923af71a9e14a40fe2d07706603b2"> 1230</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a437923af71a9e14a40fe2d07706603b2">AP_AHRS::_get_secondary_quaternion</a>(<a class="code hl_class" href="classQuaternionT.html">Quaternion</a> &amp;quat)<span class="keyword"> const</span></div>
<div class="line"><a id="l01231" name="l01231"></a><span class="lineno"> 1231</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01232" name="l01232"></a><span class="lineno"> 1232</span>    <a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">EKFType</a> secondary_ekf_type;</div>
<div class="line"><a id="l01233" name="l01233"></a><span class="lineno"> 1233</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__AHRS.html#af41a16f5463e74fb8f67689a1289c336">_get_secondary_EKF_type</a>(secondary_ekf_type)) {</div>
<div class="line"><a id="l01234" name="l01234"></a><span class="lineno"> 1234</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01235" name="l01235"></a><span class="lineno"> 1235</span>    }</div>
<div class="line"><a id="l01236" name="l01236"></a><span class="lineno"> 1236</span> </div>
<div class="line"><a id="l01237" name="l01237"></a><span class="lineno"> 1237</span>    <span class="keywordflow">switch</span> (secondary_ekf_type) {</div>
<div class="line"><a id="l01238" name="l01238"></a><span class="lineno"> 1238</span> </div>
<div class="line"><a id="l01239" name="l01239"></a><span class="lineno"> 1239</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01240" name="l01240"></a><span class="lineno"> 1240</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01241" name="l01241"></a><span class="lineno"> 1241</span>        <span class="comment">// DCM is secondary</span></div>
<div class="line"><a id="l01242" name="l01242"></a><span class="lineno"> 1242</span>        <span class="keywordflow">if</span> (!dcm.get_quaternion(<a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a>)) {</div>
<div class="line"><a id="l01243" name="l01243"></a><span class="lineno"> 1243</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01244" name="l01244"></a><span class="lineno"> 1244</span>        }</div>
<div class="line"><a id="l01245" name="l01245"></a><span class="lineno"> 1245</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01246" name="l01246"></a><span class="lineno"> 1246</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01247" name="l01247"></a><span class="lineno"> 1247</span> </div>
<div class="line"><a id="l01248" name="l01248"></a><span class="lineno"> 1248</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01249" name="l01249"></a><span class="lineno"> 1249</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01250" name="l01250"></a><span class="lineno"> 1250</span>        <span class="comment">// EKF2 is secondary</span></div>
<div class="line"><a id="l01251" name="l01251"></a><span class="lineno"> 1251</span>        <span class="keywordflow">if</span> (!_ekf2_started) {</div>
<div class="line"><a id="l01252" name="l01252"></a><span class="lineno"> 1252</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01253" name="l01253"></a><span class="lineno"> 1253</span>        }</div>
<div class="line"><a id="l01254" name="l01254"></a><span class="lineno"> 1254</span>        EKF2.getQuaternion(<a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a>);</div>
<div class="line"><a id="l01255" name="l01255"></a><span class="lineno"> 1255</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01256" name="l01256"></a><span class="lineno"> 1256</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01257" name="l01257"></a><span class="lineno"> 1257</span> </div>
<div class="line"><a id="l01258" name="l01258"></a><span class="lineno"> 1258</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01259" name="l01259"></a><span class="lineno"> 1259</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01260" name="l01260"></a><span class="lineno"> 1260</span>        <span class="comment">// EKF3 is secondary</span></div>
<div class="line"><a id="l01261" name="l01261"></a><span class="lineno"> 1261</span>        <span class="keywordflow">if</span> (!_ekf3_started) {</div>
<div class="line"><a id="l01262" name="l01262"></a><span class="lineno"> 1262</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01263" name="l01263"></a><span class="lineno"> 1263</span>        }</div>
<div class="line"><a id="l01264" name="l01264"></a><span class="lineno"> 1264</span>        EKF3.getQuaternion(<a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a>);</div>
<div class="line"><a id="l01265" name="l01265"></a><span class="lineno"> 1265</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01266" name="l01266"></a><span class="lineno"> 1266</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01267" name="l01267"></a><span class="lineno"> 1267</span> </div>
<div class="line"><a id="l01268" name="l01268"></a><span class="lineno"> 1268</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01269" name="l01269"></a><span class="lineno"> 1269</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01270" name="l01270"></a><span class="lineno"> 1270</span>        <span class="comment">// SITL is secondary (should never happen)</span></div>
<div class="line"><a id="l01271" name="l01271"></a><span class="lineno"> 1271</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01272" name="l01272"></a><span class="lineno"> 1272</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01273" name="l01273"></a><span class="lineno"> 1273</span> </div>
<div class="line"><a id="l01274" name="l01274"></a><span class="lineno"> 1274</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01275" name="l01275"></a><span class="lineno"> 1275</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01276" name="l01276"></a><span class="lineno"> 1276</span>        <span class="comment">// External is secondary</span></div>
<div class="line"><a id="l01277" name="l01277"></a><span class="lineno"> 1277</span>        <span class="keywordflow">return</span> external.get_quaternion(<a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a>);</div>
<div class="line"><a id="l01278" name="l01278"></a><span class="lineno"> 1278</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01279" name="l01279"></a><span class="lineno"> 1279</span>    }</div>
<div class="line"><a id="l01280" name="l01280"></a><span class="lineno"> 1280</span> </div>
<div class="line"><a id="l01281" name="l01281"></a><span class="lineno"> 1281</span>    <a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a>.<a class="code hl_function" href="classQuaternionT.html#a8b4b54f0e29a0f2ee476662c456fe948">rotate</a>(-<a class="code hl_variable" href="classAP__AHRS.html#aa6a48349ade83ef20981f85bf5364cb5">_trim</a>.get());</div>
<div class="line"><a id="l01282" name="l01282"></a><span class="lineno"> 1282</span> </div>
<div class="line"><a id="l01283" name="l01283"></a><span class="lineno"> 1283</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01284" name="l01284"></a><span class="lineno"> 1284</span>}</div>
</div>
<div class="line"><a id="l01285" name="l01285"></a><span class="lineno"> 1285</span> </div>
<div class="line"><a id="l01286" name="l01286"></a><span class="lineno"> 1286</span><span class="comment">// return secondary position solution if available</span></div>
<div class="foldopen" id="foldopen01287" data-start="{" data-end="}">
<div class="line"><a id="l01287" name="l01287"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#ac1a399eb71c50c91044518c754c72846"> 1287</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#ac1a399eb71c50c91044518c754c72846">AP_AHRS::_get_secondary_position</a>(<a class="code hl_class" href="classLocation.html">Location</a> &amp;loc)<span class="keyword"> const</span></div>
<div class="line"><a id="l01288" name="l01288"></a><span class="lineno"> 1288</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01289" name="l01289"></a><span class="lineno"> 1289</span>    <a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">EKFType</a> secondary_ekf_type;</div>
<div class="line"><a id="l01290" name="l01290"></a><span class="lineno"> 1290</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__AHRS.html#af41a16f5463e74fb8f67689a1289c336">_get_secondary_EKF_type</a>(secondary_ekf_type)) {</div>
<div class="line"><a id="l01291" name="l01291"></a><span class="lineno"> 1291</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01292" name="l01292"></a><span class="lineno"> 1292</span>    }</div>
<div class="line"><a id="l01293" name="l01293"></a><span class="lineno"> 1293</span> </div>
<div class="line"><a id="l01294" name="l01294"></a><span class="lineno"> 1294</span>    <span class="keywordflow">switch</span> (secondary_ekf_type) {</div>
<div class="line"><a id="l01295" name="l01295"></a><span class="lineno"> 1295</span> </div>
<div class="line"><a id="l01296" name="l01296"></a><span class="lineno"> 1296</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01297" name="l01297"></a><span class="lineno"> 1297</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01298" name="l01298"></a><span class="lineno"> 1298</span>        <span class="comment">// return DCM position</span></div>
<div class="line"><a id="l01299" name="l01299"></a><span class="lineno"> 1299</span>        loc = dcm_estimates.location;</div>
<div class="line"><a id="l01300" name="l01300"></a><span class="lineno"> 1300</span>        <span class="comment">// FIXME: we intentionally do not return whether location is</span></div>
<div class="line"><a id="l01301" name="l01301"></a><span class="lineno"> 1301</span>        <span class="comment">// actually valid here so we continue to send mavlink messages</span></div>
<div class="line"><a id="l01302" name="l01302"></a><span class="lineno"> 1302</span>        <span class="comment">// and log data:</span></div>
<div class="line"><a id="l01303" name="l01303"></a><span class="lineno"> 1303</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01304" name="l01304"></a><span class="lineno"> 1304</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01305" name="l01305"></a><span class="lineno"> 1305</span> </div>
<div class="line"><a id="l01306" name="l01306"></a><span class="lineno"> 1306</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01307" name="l01307"></a><span class="lineno"> 1307</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01308" name="l01308"></a><span class="lineno"> 1308</span>        <span class="comment">// EKF2 is secondary</span></div>
<div class="line"><a id="l01309" name="l01309"></a><span class="lineno"> 1309</span>        EKF2.getLLH(loc);</div>
<div class="line"><a id="l01310" name="l01310"></a><span class="lineno"> 1310</span>        <span class="keywordflow">return</span> _ekf2_started;</div>
<div class="line"><a id="l01311" name="l01311"></a><span class="lineno"> 1311</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01312" name="l01312"></a><span class="lineno"> 1312</span> </div>
<div class="line"><a id="l01313" name="l01313"></a><span class="lineno"> 1313</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01314" name="l01314"></a><span class="lineno"> 1314</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01315" name="l01315"></a><span class="lineno"> 1315</span>        <span class="comment">// EKF3 is secondary</span></div>
<div class="line"><a id="l01316" name="l01316"></a><span class="lineno"> 1316</span>        EKF3.getLLH(loc);</div>
<div class="line"><a id="l01317" name="l01317"></a><span class="lineno"> 1317</span>        <span class="keywordflow">return</span> _ekf3_started;</div>
<div class="line"><a id="l01318" name="l01318"></a><span class="lineno"> 1318</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01319" name="l01319"></a><span class="lineno"> 1319</span> </div>
<div class="line"><a id="l01320" name="l01320"></a><span class="lineno"> 1320</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01321" name="l01321"></a><span class="lineno"> 1321</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01322" name="l01322"></a><span class="lineno"> 1322</span>        <span class="comment">// SITL is secondary (should never happen)</span></div>
<div class="line"><a id="l01323" name="l01323"></a><span class="lineno"> 1323</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01324" name="l01324"></a><span class="lineno"> 1324</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01325" name="l01325"></a><span class="lineno"> 1325</span> </div>
<div class="line"><a id="l01326" name="l01326"></a><span class="lineno"> 1326</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01327" name="l01327"></a><span class="lineno"> 1327</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01328" name="l01328"></a><span class="lineno"> 1328</span>        <span class="comment">// External is secondary</span></div>
<div class="line"><a id="l01329" name="l01329"></a><span class="lineno"> 1329</span>        <span class="keywordflow">return</span> external_estimates.get_location(loc);</div>
<div class="line"><a id="l01330" name="l01330"></a><span class="lineno"> 1330</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01331" name="l01331"></a><span class="lineno"> 1331</span>    }</div>
<div class="line"><a id="l01332" name="l01332"></a><span class="lineno"> 1332</span> </div>
<div class="line"><a id="l01333" name="l01333"></a><span class="lineno"> 1333</span>    <span class="comment">// since there is no default case above, this is unreachable</span></div>
<div class="line"><a id="l01334" name="l01334"></a><span class="lineno"> 1334</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01335" name="l01335"></a><span class="lineno"> 1335</span>}</div>
</div>
<div class="line"><a id="l01336" name="l01336"></a><span class="lineno"> 1336</span> </div>
<div class="line"><a id="l01337" name="l01337"></a><span class="lineno"> 1337</span><span class="comment">// EKF has a better ground speed vector estimate</span></div>
<div class="foldopen" id="foldopen01338" data-start="{" data-end="}">
<div class="line"><a id="l01338" name="l01338"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#aa7cca27b944af662728a34e241f2c0fa"> 1338</a></span><a class="code hl_class" href="structVector2.html">Vector2f</a> <a class="code hl_function" href="classAP__AHRS.html#aa7cca27b944af662728a34e241f2c0fa">AP_AHRS::_groundspeed_vector</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01339" name="l01339"></a><span class="lineno"> 1339</span>{</div>
<div class="line"><a id="l01340" name="l01340"></a><span class="lineno"> 1340</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01341" name="l01341"></a><span class="lineno"> 1341</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01342" name="l01342"></a><span class="lineno"> 1342</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01343" name="l01343"></a><span class="lineno"> 1343</span>        <span class="keywordflow">return</span> dcm.groundspeed_vector();</div>
<div class="line"><a id="l01344" name="l01344"></a><span class="lineno"> 1344</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01345" name="l01345"></a><span class="lineno"> 1345</span> </div>
<div class="line"><a id="l01346" name="l01346"></a><span class="lineno"> 1346</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01347" name="l01347"></a><span class="lineno"> 1347</span>    <span class="keywordflow">case</span> EKFType::TWO: {</div>
<div class="line"><a id="l01348" name="l01348"></a><span class="lineno"> 1348</span>        <a class="code hl_class" href="classVector3.html">Vector3f</a> vec;</div>
<div class="line"><a id="l01349" name="l01349"></a><span class="lineno"> 1349</span>        EKF2.getVelNED(vec);</div>
<div class="line"><a id="l01350" name="l01350"></a><span class="lineno"> 1350</span>        <span class="keywordflow">return</span> vec.<a class="code hl_function" href="classVector3.html#abcf8b89285b9966932d1aceeeadb21d3">xy</a>();</div>
<div class="line"><a id="l01351" name="l01351"></a><span class="lineno"> 1351</span>    }</div>
<div class="line"><a id="l01352" name="l01352"></a><span class="lineno"> 1352</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01353" name="l01353"></a><span class="lineno"> 1353</span> </div>
<div class="line"><a id="l01354" name="l01354"></a><span class="lineno"> 1354</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01355" name="l01355"></a><span class="lineno"> 1355</span>    <span class="keywordflow">case</span> EKFType::THREE: {</div>
<div class="line"><a id="l01356" name="l01356"></a><span class="lineno"> 1356</span>        <a class="code hl_class" href="classVector3.html">Vector3f</a> vec;</div>
<div class="line"><a id="l01357" name="l01357"></a><span class="lineno"> 1357</span>        EKF3.getVelNED(vec);</div>
<div class="line"><a id="l01358" name="l01358"></a><span class="lineno"> 1358</span>        <span class="keywordflow">return</span> vec.<a class="code hl_function" href="classVector3.html#abcf8b89285b9966932d1aceeeadb21d3">xy</a>();</div>
<div class="line"><a id="l01359" name="l01359"></a><span class="lineno"> 1359</span>    }</div>
<div class="line"><a id="l01360" name="l01360"></a><span class="lineno"> 1360</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01361" name="l01361"></a><span class="lineno"> 1361</span> </div>
<div class="line"><a id="l01362" name="l01362"></a><span class="lineno"> 1362</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01363" name="l01363"></a><span class="lineno"> 1363</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01364" name="l01364"></a><span class="lineno"> 1364</span>        <span class="keywordflow">return</span> sim.groundspeed_vector();</div>
<div class="line"><a id="l01365" name="l01365"></a><span class="lineno"> 1365</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01366" name="l01366"></a><span class="lineno"> 1366</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01367" name="l01367"></a><span class="lineno"> 1367</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL: {</div>
<div class="line"><a id="l01368" name="l01368"></a><span class="lineno"> 1368</span>        <span class="keywordflow">return</span> external.groundspeed_vector();</div>
<div class="line"><a id="l01369" name="l01369"></a><span class="lineno"> 1369</span>    }</div>
<div class="line"><a id="l01370" name="l01370"></a><span class="lineno"> 1370</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01371" name="l01371"></a><span class="lineno"> 1371</span>    }</div>
<div class="line"><a id="l01372" name="l01372"></a><span class="lineno"> 1372</span>    <span class="keywordflow">return</span> <a class="code hl_typedef" href="vector2_8h.html#a9f3739462b0605dcb64299fa289b6afe">Vector2f</a>();</div>
<div class="line"><a id="l01373" name="l01373"></a><span class="lineno"> 1373</span>}</div>
</div>
<div class="line"><a id="l01374" name="l01374"></a><span class="lineno"> 1374</span> </div>
<div class="foldopen" id="foldopen01375" data-start="{" data-end="}">
<div class="line"><a id="l01375" name="l01375"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a9a52ca012478b371f6fd5c91d0b891be"> 1375</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classAP__AHRS.html#a9a52ca012478b371f6fd5c91d0b891be">AP_AHRS::_groundspeed</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l01376" name="l01376"></a><span class="lineno"> 1376</span>{</div>
<div class="line"><a id="l01377" name="l01377"></a><span class="lineno"> 1377</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01378" name="l01378"></a><span class="lineno"> 1378</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01379" name="l01379"></a><span class="lineno"> 1379</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01380" name="l01380"></a><span class="lineno"> 1380</span>        <span class="keywordflow">return</span> dcm.groundspeed();</div>
<div class="line"><a id="l01381" name="l01381"></a><span class="lineno"> 1381</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01382" name="l01382"></a><span class="lineno"> 1382</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01383" name="l01383"></a><span class="lineno"> 1383</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01384" name="l01384"></a><span class="lineno"> 1384</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01385" name="l01385"></a><span class="lineno"> 1385</span> </div>
<div class="line"><a id="l01386" name="l01386"></a><span class="lineno"> 1386</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01387" name="l01387"></a><span class="lineno"> 1387</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01388" name="l01388"></a><span class="lineno"> 1388</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01389" name="l01389"></a><span class="lineno"> 1389</span> </div>
<div class="line"><a id="l01390" name="l01390"></a><span class="lineno"> 1390</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01391" name="l01391"></a><span class="lineno"> 1391</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01392" name="l01392"></a><span class="lineno"> 1392</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01393" name="l01393"></a><span class="lineno"> 1393</span> </div>
<div class="line"><a id="l01394" name="l01394"></a><span class="lineno"> 1394</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01395" name="l01395"></a><span class="lineno"> 1395</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01396" name="l01396"></a><span class="lineno"> 1396</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01397" name="l01397"></a><span class="lineno"> 1397</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01398" name="l01398"></a><span class="lineno"> 1398</span>    }</div>
<div class="line"><a id="l01399" name="l01399"></a><span class="lineno"> 1399</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classAP__AHRS.html#a6a5554b1eadd5417a4d1c60c5f0cc6a5">groundspeed_vector</a>().<a class="code hl_function" href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">length</a>();</div>
<div class="line"><a id="l01400" name="l01400"></a><span class="lineno"> 1400</span>}</div>
</div>
<div class="line"><a id="l01401" name="l01401"></a><span class="lineno"> 1401</span> </div>
<div class="line"><a id="l01402" name="l01402"></a><span class="lineno"> 1402</span><span class="comment">// set the EKF&#39;s origin location in 10e7 degrees.  This should only</span></div>
<div class="line"><a id="l01403" name="l01403"></a><span class="lineno"> 1403</span><span class="comment">// be called when the EKF has no absolute position reference (i.e. GPS)</span></div>
<div class="line"><a id="l01404" name="l01404"></a><span class="lineno"> 1404</span><span class="comment">// from which to decide the origin on its own</span></div>
<div class="foldopen" id="foldopen01405" data-start="{" data-end="}">
<div class="line"><a id="l01405" name="l01405"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#af1dc155ba4a9c6f30438f2db6722eda4"> 1405</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#af1dc155ba4a9c6f30438f2db6722eda4">AP_AHRS::set_origin</a>(<span class="keyword">const</span> <a class="code hl_class" href="classLocation.html">Location</a> &amp;loc)</div>
<div class="line"><a id="l01406" name="l01406"></a><span class="lineno"> 1406</span>{</div>
<div class="line"><a id="l01407" name="l01407"></a><span class="lineno"> 1407</span>    <a class="code hl_define" href="AP__HAL_2Semaphores_8h.html#a819dd9ac6de800cdf1014b0a922b67d4">WITH_SEMAPHORE</a>(<a class="code hl_variable" href="classAP__AHRS.html#a38d0378ea83c46d1edb53fb6f578beaf">_rsem</a>);</div>
<div class="line"><a id="l01408" name="l01408"></a><span class="lineno"> 1408</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01409" name="l01409"></a><span class="lineno"> 1409</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> ret2 = EKF2.setOriginLLH(loc);</div>
<div class="line"><a id="l01410" name="l01410"></a><span class="lineno"> 1410</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01411" name="l01411"></a><span class="lineno"> 1411</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01412" name="l01412"></a><span class="lineno"> 1412</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> ret3 = EKF3.setOriginLLH(loc);</div>
<div class="line"><a id="l01413" name="l01413"></a><span class="lineno"> 1413</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01414" name="l01414"></a><span class="lineno"> 1414</span> </div>
<div class="line"><a id="l01415" name="l01415"></a><span class="lineno"> 1415</span>    <span class="comment">// return success if active EKF&#39;s origin was set</span></div>
<div class="line"><a id="l01416" name="l01416"></a><span class="lineno"> 1416</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01417" name="l01417"></a><span class="lineno"> 1417</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01418" name="l01418"></a><span class="lineno"> 1418</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01419" name="l01419"></a><span class="lineno"> 1419</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01420" name="l01420"></a><span class="lineno"> 1420</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01421" name="l01421"></a><span class="lineno"> 1421</span> </div>
<div class="line"><a id="l01422" name="l01422"></a><span class="lineno"> 1422</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01423" name="l01423"></a><span class="lineno"> 1423</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01424" name="l01424"></a><span class="lineno"> 1424</span>        <span class="keywordflow">return</span> ret2;</div>
<div class="line"><a id="l01425" name="l01425"></a><span class="lineno"> 1425</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01426" name="l01426"></a><span class="lineno"> 1426</span> </div>
<div class="line"><a id="l01427" name="l01427"></a><span class="lineno"> 1427</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01428" name="l01428"></a><span class="lineno"> 1428</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01429" name="l01429"></a><span class="lineno"> 1429</span>        <span class="keywordflow">return</span> ret3;</div>
<div class="line"><a id="l01430" name="l01430"></a><span class="lineno"> 1430</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01431" name="l01431"></a><span class="lineno"> 1431</span> </div>
<div class="line"><a id="l01432" name="l01432"></a><span class="lineno"> 1432</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01433" name="l01433"></a><span class="lineno"> 1433</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01434" name="l01434"></a><span class="lineno"> 1434</span>        <span class="comment">// never allow origin set in SITL. The origin is set by the</span></div>
<div class="line"><a id="l01435" name="l01435"></a><span class="lineno"> 1435</span>        <span class="comment">// simulation backend</span></div>
<div class="line"><a id="l01436" name="l01436"></a><span class="lineno"> 1436</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01437" name="l01437"></a><span class="lineno"> 1437</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01438" name="l01438"></a><span class="lineno"> 1438</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01439" name="l01439"></a><span class="lineno"> 1439</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01440" name="l01440"></a><span class="lineno"> 1440</span>        <span class="comment">// don&#39;t allow origin set with external AHRS</span></div>
<div class="line"><a id="l01441" name="l01441"></a><span class="lineno"> 1441</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01442" name="l01442"></a><span class="lineno"> 1442</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01443" name="l01443"></a><span class="lineno"> 1443</span>    }</div>
<div class="line"><a id="l01444" name="l01444"></a><span class="lineno"> 1444</span>    <span class="comment">// since there is no default case above, this is unreachable</span></div>
<div class="line"><a id="l01445" name="l01445"></a><span class="lineno"> 1445</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01446" name="l01446"></a><span class="lineno"> 1446</span>}</div>
</div>
<div class="line"><a id="l01447" name="l01447"></a><span class="lineno"> 1447</span> </div>
<div class="line"><a id="l01448" name="l01448"></a><span class="lineno"> 1448</span><span class="preprocessor">#if AP_AHRS_POSITION_RESET_ENABLED</span></div>
<div class="line"><a id="l01449" name="l01449"></a><span class="lineno"> 1449</span><span class="keywordtype">bool</span> AP_AHRS::handle_external_position_estimate(<span class="keyword">const</span> <a class="code hl_class" href="classLocation.html">Location</a> &amp;loc, <span class="keywordtype">float</span> pos_accuracy, uint32_t timestamp_ms)</div>
<div class="line"><a id="l01450" name="l01450"></a><span class="lineno"> 1450</span>{</div>
<div class="line"><a id="l01451" name="l01451"></a><span class="lineno"> 1451</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01452" name="l01452"></a><span class="lineno"> 1452</span>    <span class="keywordflow">return</span> EKF3.setLatLng(loc, pos_accuracy, timestamp_ms);</div>
<div class="line"><a id="l01453" name="l01453"></a><span class="lineno"> 1453</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01454" name="l01454"></a><span class="lineno"> 1454</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01455" name="l01455"></a><span class="lineno"> 1455</span>}</div>
<div class="line"><a id="l01456" name="l01456"></a><span class="lineno"> 1456</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01457" name="l01457"></a><span class="lineno"> 1457</span> </div>
<div class="line"><a id="l01458" name="l01458"></a><span class="lineno"> 1458</span><span class="comment">// return true if inertial navigation is active</span></div>
<div class="foldopen" id="foldopen01459" data-start="{" data-end="}">
<div class="line"><a id="l01459" name="l01459"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a9bf7361f77c132adec1b00f52dc78980"> 1459</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a9bf7361f77c132adec1b00f52dc78980">AP_AHRS::have_inertial_nav</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01460" name="l01460"></a><span class="lineno"> 1460</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01461" name="l01461"></a><span class="lineno"> 1461</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01462" name="l01462"></a><span class="lineno"> 1462</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>() != EKFType::DCM;</div>
<div class="line"><a id="l01463" name="l01463"></a><span class="lineno"> 1463</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01464" name="l01464"></a><span class="lineno"> 1464</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01465" name="l01465"></a><span class="lineno"> 1465</span>}</div>
</div>
<div class="line"><a id="l01466" name="l01466"></a><span class="lineno"> 1466</span> </div>
<div class="line"><a id="l01467" name="l01467"></a><span class="lineno"> 1467</span><span class="comment">// return a ground velocity in meters/second, North/East/Down</span></div>
<div class="line"><a id="l01468" name="l01468"></a><span class="lineno"> 1468</span><span class="comment">// order. Must only be called if have_inertial_nav() is true</span></div>
<div class="foldopen" id="foldopen01469" data-start="{" data-end="}">
<div class="line"><a id="l01469" name="l01469"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#ac2af58fc58cc012fcb11d8ffd60a7d6b"> 1469</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#ac2af58fc58cc012fcb11d8ffd60a7d6b">AP_AHRS::_get_velocity_NED</a>(<a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;vec)<span class="keyword"> const</span></div>
<div class="line"><a id="l01470" name="l01470"></a><span class="lineno"> 1470</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01471" name="l01471"></a><span class="lineno"> 1471</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01472" name="l01472"></a><span class="lineno"> 1472</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01473" name="l01473"></a><span class="lineno"> 1473</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01474" name="l01474"></a><span class="lineno"> 1474</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01475" name="l01475"></a><span class="lineno"> 1475</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01476" name="l01476"></a><span class="lineno"> 1476</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01477" name="l01477"></a><span class="lineno"> 1477</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01478" name="l01478"></a><span class="lineno"> 1478</span>        EKF2.getVelNED(vec);</div>
<div class="line"><a id="l01479" name="l01479"></a><span class="lineno"> 1479</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01480" name="l01480"></a><span class="lineno"> 1480</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01481" name="l01481"></a><span class="lineno"> 1481</span> </div>
<div class="line"><a id="l01482" name="l01482"></a><span class="lineno"> 1482</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01483" name="l01483"></a><span class="lineno"> 1483</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01484" name="l01484"></a><span class="lineno"> 1484</span>        EKF3.getVelNED(vec);</div>
<div class="line"><a id="l01485" name="l01485"></a><span class="lineno"> 1485</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01486" name="l01486"></a><span class="lineno"> 1486</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01487" name="l01487"></a><span class="lineno"> 1487</span> </div>
<div class="line"><a id="l01488" name="l01488"></a><span class="lineno"> 1488</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01489" name="l01489"></a><span class="lineno"> 1489</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01490" name="l01490"></a><span class="lineno"> 1490</span>        <span class="keywordflow">return</span> sim.get_velocity_NED(vec);</div>
<div class="line"><a id="l01491" name="l01491"></a><span class="lineno"> 1491</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01492" name="l01492"></a><span class="lineno"> 1492</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01493" name="l01493"></a><span class="lineno"> 1493</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01494" name="l01494"></a><span class="lineno"> 1494</span>        <span class="keywordflow">return</span> external.get_velocity_NED(vec);</div>
<div class="line"><a id="l01495" name="l01495"></a><span class="lineno"> 1495</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01496" name="l01496"></a><span class="lineno"> 1496</span>    }</div>
<div class="line"><a id="l01497" name="l01497"></a><span class="lineno"> 1497</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01498" name="l01498"></a><span class="lineno"> 1498</span>    <span class="keywordflow">return</span> dcm.get_velocity_NED(vec);</div>
<div class="line"><a id="l01499" name="l01499"></a><span class="lineno"> 1499</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01500" name="l01500"></a><span class="lineno"> 1500</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01501" name="l01501"></a><span class="lineno"> 1501</span>}</div>
</div>
<div class="line"><a id="l01502" name="l01502"></a><span class="lineno"> 1502</span> </div>
<div class="line"><a id="l01503" name="l01503"></a><span class="lineno"> 1503</span><span class="comment">// returns the expected NED magnetic field</span></div>
<div class="foldopen" id="foldopen01504" data-start="{" data-end="}">
<div class="line"><a id="l01504" name="l01504"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a2da3610e7128793894c303e8f79261d6"> 1504</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a2da3610e7128793894c303e8f79261d6">AP_AHRS::get_mag_field_NED</a>(<a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;vec)<span class="keyword"> const</span></div>
<div class="line"><a id="l01505" name="l01505"></a><span class="lineno"> 1505</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01506" name="l01506"></a><span class="lineno"> 1506</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01507" name="l01507"></a><span class="lineno"> 1507</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01508" name="l01508"></a><span class="lineno"> 1508</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01509" name="l01509"></a><span class="lineno"> 1509</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01510" name="l01510"></a><span class="lineno"> 1510</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01511" name="l01511"></a><span class="lineno"> 1511</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01512" name="l01512"></a><span class="lineno"> 1512</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01513" name="l01513"></a><span class="lineno"> 1513</span>        EKF2.getMagNED(vec);</div>
<div class="line"><a id="l01514" name="l01514"></a><span class="lineno"> 1514</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01515" name="l01515"></a><span class="lineno"> 1515</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01516" name="l01516"></a><span class="lineno"> 1516</span> </div>
<div class="line"><a id="l01517" name="l01517"></a><span class="lineno"> 1517</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01518" name="l01518"></a><span class="lineno"> 1518</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01519" name="l01519"></a><span class="lineno"> 1519</span>        EKF3.getMagNED(vec);</div>
<div class="line"><a id="l01520" name="l01520"></a><span class="lineno"> 1520</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01521" name="l01521"></a><span class="lineno"> 1521</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01522" name="l01522"></a><span class="lineno"> 1522</span> </div>
<div class="line"><a id="l01523" name="l01523"></a><span class="lineno"> 1523</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01524" name="l01524"></a><span class="lineno"> 1524</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01525" name="l01525"></a><span class="lineno"> 1525</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01526" name="l01526"></a><span class="lineno"> 1526</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01527" name="l01527"></a><span class="lineno"> 1527</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01528" name="l01528"></a><span class="lineno"> 1528</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01529" name="l01529"></a><span class="lineno"> 1529</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01530" name="l01530"></a><span class="lineno"> 1530</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01531" name="l01531"></a><span class="lineno"> 1531</span>    }</div>
<div class="line"><a id="l01532" name="l01532"></a><span class="lineno"> 1532</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01533" name="l01533"></a><span class="lineno"> 1533</span>}</div>
</div>
<div class="line"><a id="l01534" name="l01534"></a><span class="lineno"> 1534</span> </div>
<div class="line"><a id="l01535" name="l01535"></a><span class="lineno"> 1535</span><span class="comment">// returns the estimated magnetic field offsets in body frame</span></div>
<div class="foldopen" id="foldopen01536" data-start="{" data-end="}">
<div class="line"><a id="l01536" name="l01536"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a99267bd1222d598fcc5f628066b7b981"> 1536</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a99267bd1222d598fcc5f628066b7b981">AP_AHRS::get_mag_field_correction</a>(<a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;vec)<span class="keyword"> const</span></div>
<div class="line"><a id="l01537" name="l01537"></a><span class="lineno"> 1537</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01538" name="l01538"></a><span class="lineno"> 1538</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01539" name="l01539"></a><span class="lineno"> 1539</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01540" name="l01540"></a><span class="lineno"> 1540</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01541" name="l01541"></a><span class="lineno"> 1541</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01542" name="l01542"></a><span class="lineno"> 1542</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01543" name="l01543"></a><span class="lineno"> 1543</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01544" name="l01544"></a><span class="lineno"> 1544</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01545" name="l01545"></a><span class="lineno"> 1545</span>        EKF2.getMagXYZ(vec);</div>
<div class="line"><a id="l01546" name="l01546"></a><span class="lineno"> 1546</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01547" name="l01547"></a><span class="lineno"> 1547</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01548" name="l01548"></a><span class="lineno"> 1548</span> </div>
<div class="line"><a id="l01549" name="l01549"></a><span class="lineno"> 1549</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01550" name="l01550"></a><span class="lineno"> 1550</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01551" name="l01551"></a><span class="lineno"> 1551</span>        EKF3.getMagXYZ(vec);</div>
<div class="line"><a id="l01552" name="l01552"></a><span class="lineno"> 1552</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01553" name="l01553"></a><span class="lineno"> 1553</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01554" name="l01554"></a><span class="lineno"> 1554</span> </div>
<div class="line"><a id="l01555" name="l01555"></a><span class="lineno"> 1555</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01556" name="l01556"></a><span class="lineno"> 1556</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01557" name="l01557"></a><span class="lineno"> 1557</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01558" name="l01558"></a><span class="lineno"> 1558</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01559" name="l01559"></a><span class="lineno"> 1559</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01560" name="l01560"></a><span class="lineno"> 1560</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01561" name="l01561"></a><span class="lineno"> 1561</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01562" name="l01562"></a><span class="lineno"> 1562</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01563" name="l01563"></a><span class="lineno"> 1563</span>    }</div>
<div class="line"><a id="l01564" name="l01564"></a><span class="lineno"> 1564</span>    <span class="comment">// since there is no default case above, this is unreachable</span></div>
<div class="line"><a id="l01565" name="l01565"></a><span class="lineno"> 1565</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01566" name="l01566"></a><span class="lineno"> 1566</span>}</div>
</div>
<div class="line"><a id="l01567" name="l01567"></a><span class="lineno"> 1567</span> </div>
<div class="line"><a id="l01568" name="l01568"></a><span class="lineno"> 1568</span><span class="comment">// Get a derivative of the vertical position which is kinematically consistent with the vertical position is required by some control loops.</span></div>
<div class="line"><a id="l01569" name="l01569"></a><span class="lineno"> 1569</span><span class="comment">// This is different to the vertical velocity from the EKF which is not always consistent with the vertical position due to the various errors that are being corrected for.</span></div>
<div class="foldopen" id="foldopen01570" data-start="{" data-end="}">
<div class="line"><a id="l01570" name="l01570"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#ab89a5d109e3ea9c6f38ee13c3216ddd1"> 1570</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#ab89a5d109e3ea9c6f38ee13c3216ddd1">AP_AHRS::get_vert_pos_rate_D</a>(<span class="keywordtype">float</span> &amp;velocity)<span class="keyword"> const</span></div>
<div class="line"><a id="l01571" name="l01571"></a><span class="lineno"> 1571</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01572" name="l01572"></a><span class="lineno"> 1572</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01573" name="l01573"></a><span class="lineno"> 1573</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01574" name="l01574"></a><span class="lineno"> 1574</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01575" name="l01575"></a><span class="lineno"> 1575</span>        <span class="keywordflow">return</span> dcm.get_vert_pos_rate_D(velocity);</div>
<div class="line"><a id="l01576" name="l01576"></a><span class="lineno"> 1576</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01577" name="l01577"></a><span class="lineno"> 1577</span> </div>
<div class="line"><a id="l01578" name="l01578"></a><span class="lineno"> 1578</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01579" name="l01579"></a><span class="lineno"> 1579</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01580" name="l01580"></a><span class="lineno"> 1580</span>        velocity = EKF2.getPosDownDerivative();</div>
<div class="line"><a id="l01581" name="l01581"></a><span class="lineno"> 1581</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01582" name="l01582"></a><span class="lineno"> 1582</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01583" name="l01583"></a><span class="lineno"> 1583</span> </div>
<div class="line"><a id="l01584" name="l01584"></a><span class="lineno"> 1584</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01585" name="l01585"></a><span class="lineno"> 1585</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01586" name="l01586"></a><span class="lineno"> 1586</span>        velocity = EKF3.getPosDownDerivative();</div>
<div class="line"><a id="l01587" name="l01587"></a><span class="lineno"> 1587</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01588" name="l01588"></a><span class="lineno"> 1588</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01589" name="l01589"></a><span class="lineno"> 1589</span> </div>
<div class="line"><a id="l01590" name="l01590"></a><span class="lineno"> 1590</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01591" name="l01591"></a><span class="lineno"> 1591</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01592" name="l01592"></a><span class="lineno"> 1592</span>        <span class="keywordflow">return</span> sim.get_vert_pos_rate_D(velocity);</div>
<div class="line"><a id="l01593" name="l01593"></a><span class="lineno"> 1593</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01594" name="l01594"></a><span class="lineno"> 1594</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01595" name="l01595"></a><span class="lineno"> 1595</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01596" name="l01596"></a><span class="lineno"> 1596</span>        <span class="keywordflow">return</span> external.get_vert_pos_rate_D(velocity);</div>
<div class="line"><a id="l01597" name="l01597"></a><span class="lineno"> 1597</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01598" name="l01598"></a><span class="lineno"> 1598</span>    }</div>
<div class="line"><a id="l01599" name="l01599"></a><span class="lineno"> 1599</span>    <span class="comment">// since there is no default case above, this is unreachable</span></div>
<div class="line"><a id="l01600" name="l01600"></a><span class="lineno"> 1600</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01601" name="l01601"></a><span class="lineno"> 1601</span>}</div>
</div>
<div class="line"><a id="l01602" name="l01602"></a><span class="lineno"> 1602</span> </div>
<div class="line"><a id="l01603" name="l01603"></a><span class="lineno"> 1603</span><span class="comment">// get latest height above ground level estimate in metres and a validity flag</span></div>
<div class="foldopen" id="foldopen01604" data-start="{" data-end="}">
<div class="line"><a id="l01604" name="l01604"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a509c6ae15e8c0bcf550515dc57f07525"> 1604</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a509c6ae15e8c0bcf550515dc57f07525">AP_AHRS::get_hagl</a>(<span class="keywordtype">float</span> &amp;height)<span class="keyword"> const</span></div>
<div class="line"><a id="l01605" name="l01605"></a><span class="lineno"> 1605</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01606" name="l01606"></a><span class="lineno"> 1606</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01607" name="l01607"></a><span class="lineno"> 1607</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01608" name="l01608"></a><span class="lineno"> 1608</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01609" name="l01609"></a><span class="lineno"> 1609</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01610" name="l01610"></a><span class="lineno"> 1610</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01611" name="l01611"></a><span class="lineno"> 1611</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01612" name="l01612"></a><span class="lineno"> 1612</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01613" name="l01613"></a><span class="lineno"> 1613</span>        <span class="keywordflow">return</span> EKF2.getHAGL(height);</div>
<div class="line"><a id="l01614" name="l01614"></a><span class="lineno"> 1614</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01615" name="l01615"></a><span class="lineno"> 1615</span> </div>
<div class="line"><a id="l01616" name="l01616"></a><span class="lineno"> 1616</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01617" name="l01617"></a><span class="lineno"> 1617</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01618" name="l01618"></a><span class="lineno"> 1618</span>        <span class="keywordflow">return</span> EKF3.getHAGL(height);</div>
<div class="line"><a id="l01619" name="l01619"></a><span class="lineno"> 1619</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01620" name="l01620"></a><span class="lineno"> 1620</span> </div>
<div class="line"><a id="l01621" name="l01621"></a><span class="lineno"> 1621</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01622" name="l01622"></a><span class="lineno"> 1622</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01623" name="l01623"></a><span class="lineno"> 1623</span>        <span class="keywordflow">return</span> sim.get_hagl(height);</div>
<div class="line"><a id="l01624" name="l01624"></a><span class="lineno"> 1624</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01625" name="l01625"></a><span class="lineno"> 1625</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01626" name="l01626"></a><span class="lineno"> 1626</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL: {</div>
<div class="line"><a id="l01627" name="l01627"></a><span class="lineno"> 1627</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01628" name="l01628"></a><span class="lineno"> 1628</span>    }</div>
<div class="line"><a id="l01629" name="l01629"></a><span class="lineno"> 1629</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01630" name="l01630"></a><span class="lineno"> 1630</span>    }</div>
<div class="line"><a id="l01631" name="l01631"></a><span class="lineno"> 1631</span>    <span class="comment">// since there is no default case above, this is unreachable</span></div>
<div class="line"><a id="l01632" name="l01632"></a><span class="lineno"> 1632</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01633" name="l01633"></a><span class="lineno"> 1633</span>}</div>
</div>
<div class="line"><a id="l01634" name="l01634"></a><span class="lineno"> 1634</span> </div>
<div class="line"><a id="l01635" name="l01635"></a><span class="lineno"> 1635</span><span class="comment">/*</span></div>
<div class="line"><a id="l01636" name="l01636"></a><span class="lineno"> 1636</span><span class="comment">  return a relative NED position from the origin in meters</span></div>
<div class="line"><a id="l01637" name="l01637"></a><span class="lineno"> 1637</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01638" data-start="{" data-end="}">
<div class="line"><a id="l01638" name="l01638"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a06855bb0b9039f54170a861fff9e9fbc"> 1638</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a06855bb0b9039f54170a861fff9e9fbc">AP_AHRS::get_relative_position_NED_origin</a>(<a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;vec)<span class="keyword"> const</span></div>
<div class="line"><a id="l01639" name="l01639"></a><span class="lineno"> 1639</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01640" name="l01640"></a><span class="lineno"> 1640</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01641" name="l01641"></a><span class="lineno"> 1641</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01642" name="l01642"></a><span class="lineno"> 1642</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01643" name="l01643"></a><span class="lineno"> 1643</span>        <span class="keywordflow">return</span> dcm.get_relative_position_NED_origin(vec);</div>
<div class="line"><a id="l01644" name="l01644"></a><span class="lineno"> 1644</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01645" name="l01645"></a><span class="lineno"> 1645</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01646" name="l01646"></a><span class="lineno"> 1646</span>    <span class="keywordflow">case</span> EKFType::TWO: {</div>
<div class="line"><a id="l01647" name="l01647"></a><span class="lineno"> 1647</span>        <a class="code hl_class" href="structVector2.html">Vector2f</a> posNE;</div>
<div class="line"><a id="l01648" name="l01648"></a><span class="lineno"> 1648</span>        <span class="keywordtype">float</span> posD;</div>
<div class="line"><a id="l01649" name="l01649"></a><span class="lineno"> 1649</span>        <span class="keywordflow">if</span> (EKF2.getPosNE(posNE) &amp;&amp; EKF2.getPosD(posD)) {</div>
<div class="line"><a id="l01650" name="l01650"></a><span class="lineno"> 1650</span>            <span class="comment">// position is valid</span></div>
<div class="line"><a id="l01651" name="l01651"></a><span class="lineno"> 1651</span>            vec.<a class="code hl_variable" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = posNE.<a class="code hl_variable" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a id="l01652" name="l01652"></a><span class="lineno"> 1652</span>            vec.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = posNE.<a class="code hl_variable" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a id="l01653" name="l01653"></a><span class="lineno"> 1653</span>            vec.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> = posD;</div>
<div class="line"><a id="l01654" name="l01654"></a><span class="lineno"> 1654</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01655" name="l01655"></a><span class="lineno"> 1655</span>        }</div>
<div class="line"><a id="l01656" name="l01656"></a><span class="lineno"> 1656</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01657" name="l01657"></a><span class="lineno"> 1657</span>    }</div>
<div class="line"><a id="l01658" name="l01658"></a><span class="lineno"> 1658</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01659" name="l01659"></a><span class="lineno"> 1659</span> </div>
<div class="line"><a id="l01660" name="l01660"></a><span class="lineno"> 1660</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01661" name="l01661"></a><span class="lineno"> 1661</span>    <span class="keywordflow">case</span> EKFType::THREE: {</div>
<div class="line"><a id="l01662" name="l01662"></a><span class="lineno"> 1662</span>            <a class="code hl_class" href="structVector2.html">Vector2f</a> posNE;</div>
<div class="line"><a id="l01663" name="l01663"></a><span class="lineno"> 1663</span>            <span class="keywordtype">float</span> posD;</div>
<div class="line"><a id="l01664" name="l01664"></a><span class="lineno"> 1664</span>            <span class="keywordflow">if</span> (EKF3.getPosNE(posNE) &amp;&amp; EKF3.getPosD(posD)) {</div>
<div class="line"><a id="l01665" name="l01665"></a><span class="lineno"> 1665</span>                <span class="comment">// position is valid</span></div>
<div class="line"><a id="l01666" name="l01666"></a><span class="lineno"> 1666</span>                vec.<a class="code hl_variable" href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">x</a> = posNE.<a class="code hl_variable" href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">x</a>;</div>
<div class="line"><a id="l01667" name="l01667"></a><span class="lineno"> 1667</span>                vec.<a class="code hl_variable" href="classVector3.html#a561df88b28e106e337a25bb86554a569">y</a> = posNE.<a class="code hl_variable" href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">y</a>;</div>
<div class="line"><a id="l01668" name="l01668"></a><span class="lineno"> 1668</span>                vec.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> = posD;</div>
<div class="line"><a id="l01669" name="l01669"></a><span class="lineno"> 1669</span>                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01670" name="l01670"></a><span class="lineno"> 1670</span>            }</div>
<div class="line"><a id="l01671" name="l01671"></a><span class="lineno"> 1671</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01672" name="l01672"></a><span class="lineno"> 1672</span>        }</div>
<div class="line"><a id="l01673" name="l01673"></a><span class="lineno"> 1673</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01674" name="l01674"></a><span class="lineno"> 1674</span> </div>
<div class="line"><a id="l01675" name="l01675"></a><span class="lineno"> 1675</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01676" name="l01676"></a><span class="lineno"> 1676</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01677" name="l01677"></a><span class="lineno"> 1677</span>        <span class="keywordflow">return</span> sim.get_relative_position_NED_origin(vec);</div>
<div class="line"><a id="l01678" name="l01678"></a><span class="lineno"> 1678</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01679" name="l01679"></a><span class="lineno"> 1679</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01680" name="l01680"></a><span class="lineno"> 1680</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL: {</div>
<div class="line"><a id="l01681" name="l01681"></a><span class="lineno"> 1681</span>        <span class="keywordflow">return</span> external.get_relative_position_NED_origin(vec);</div>
<div class="line"><a id="l01682" name="l01682"></a><span class="lineno"> 1682</span>    }</div>
<div class="line"><a id="l01683" name="l01683"></a><span class="lineno"> 1683</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01684" name="l01684"></a><span class="lineno"> 1684</span>    }</div>
<div class="line"><a id="l01685" name="l01685"></a><span class="lineno"> 1685</span>    <span class="comment">// since there is no default case above, this is unreachable</span></div>
<div class="line"><a id="l01686" name="l01686"></a><span class="lineno"> 1686</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01687" name="l01687"></a><span class="lineno"> 1687</span>}</div>
</div>
<div class="line"><a id="l01688" name="l01688"></a><span class="lineno"> 1688</span> </div>
<div class="line"><a id="l01689" name="l01689"></a><span class="lineno"> 1689</span><span class="comment">/*</span></div>
<div class="line"><a id="l01690" name="l01690"></a><span class="lineno"> 1690</span><span class="comment"> return a relative ground position from home in meters</span></div>
<div class="line"><a id="l01691" name="l01691"></a><span class="lineno"> 1691</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01692" data-start="{" data-end="}">
<div class="line"><a id="l01692" name="l01692"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#ab2dca8fa6893500c108ef684e53e283d"> 1692</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#ab2dca8fa6893500c108ef684e53e283d">AP_AHRS::get_relative_position_NED_home</a>(<a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;vec)<span class="keyword"> const</span></div>
<div class="line"><a id="l01693" name="l01693"></a><span class="lineno"> 1693</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01694" name="l01694"></a><span class="lineno"> 1694</span>    <a class="code hl_class" href="classLocation.html">Location</a> loc;</div>
<div class="line"><a id="l01695" name="l01695"></a><span class="lineno"> 1695</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__AHRS.html#a89d3f4c63809e5e5ff4d3c4a61969e4c">_home_is_set</a> ||</div>
<div class="line"><a id="l01696" name="l01696"></a><span class="lineno"> 1696</span>        !<a class="code hl_function" href="classAP__AHRS.html#a0b6672c6f1c6303a804bc0a5e02ec1af">get_location</a>(loc)) {</div>
<div class="line"><a id="l01697" name="l01697"></a><span class="lineno"> 1697</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01698" name="l01698"></a><span class="lineno"> 1698</span>    }</div>
<div class="line"><a id="l01699" name="l01699"></a><span class="lineno"> 1699</span>    vec = <a class="code hl_variable" href="classAP__AHRS.html#a2107b76042de1c58c8f550ea60804ea9">_home</a>.<a class="code hl_function" href="classLocation.html#a77ca1da10b7da6216bb6cf1253ed3dfc">get_distance_NED</a>(loc);</div>
<div class="line"><a id="l01700" name="l01700"></a><span class="lineno"> 1700</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01701" name="l01701"></a><span class="lineno"> 1701</span>}</div>
</div>
<div class="line"><a id="l01702" name="l01702"></a><span class="lineno"> 1702</span> </div>
<div class="line"><a id="l01703" name="l01703"></a><span class="lineno"> 1703</span><span class="comment">/*</span></div>
<div class="line"><a id="l01704" name="l01704"></a><span class="lineno"> 1704</span><span class="comment">  return a relative position estimate from the origin in meters</span></div>
<div class="line"><a id="l01705" name="l01705"></a><span class="lineno"> 1705</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01706" data-start="{" data-end="}">
<div class="line"><a id="l01706" name="l01706"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a61594ab53ca717ea37cdd789be94c1a3"> 1706</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a61594ab53ca717ea37cdd789be94c1a3">AP_AHRS::get_relative_position_NE_origin</a>(<a class="code hl_class" href="structVector2.html">Vector2f</a> &amp;posNE)<span class="keyword"> const</span></div>
<div class="line"><a id="l01707" name="l01707"></a><span class="lineno"> 1707</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01708" name="l01708"></a><span class="lineno"> 1708</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01709" name="l01709"></a><span class="lineno"> 1709</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01710" name="l01710"></a><span class="lineno"> 1710</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01711" name="l01711"></a><span class="lineno"> 1711</span>        <span class="keywordflow">return</span> dcm.get_relative_position_NE_origin(posNE);</div>
<div class="line"><a id="l01712" name="l01712"></a><span class="lineno"> 1712</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01713" name="l01713"></a><span class="lineno"> 1713</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01714" name="l01714"></a><span class="lineno"> 1714</span>    <span class="keywordflow">case</span> EKFType::TWO: {</div>
<div class="line"><a id="l01715" name="l01715"></a><span class="lineno"> 1715</span>        <span class="keywordtype">bool</span> position_is_valid = EKF2.getPosNE(posNE);</div>
<div class="line"><a id="l01716" name="l01716"></a><span class="lineno"> 1716</span>        <span class="keywordflow">return</span> position_is_valid;</div>
<div class="line"><a id="l01717" name="l01717"></a><span class="lineno"> 1717</span>    }</div>
<div class="line"><a id="l01718" name="l01718"></a><span class="lineno"> 1718</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01719" name="l01719"></a><span class="lineno"> 1719</span> </div>
<div class="line"><a id="l01720" name="l01720"></a><span class="lineno"> 1720</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01721" name="l01721"></a><span class="lineno"> 1721</span>    <span class="keywordflow">case</span> EKFType::THREE: {</div>
<div class="line"><a id="l01722" name="l01722"></a><span class="lineno"> 1722</span>        <span class="keywordtype">bool</span> position_is_valid = EKF3.getPosNE(posNE);</div>
<div class="line"><a id="l01723" name="l01723"></a><span class="lineno"> 1723</span>        <span class="keywordflow">return</span> position_is_valid;</div>
<div class="line"><a id="l01724" name="l01724"></a><span class="lineno"> 1724</span>    }</div>
<div class="line"><a id="l01725" name="l01725"></a><span class="lineno"> 1725</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01726" name="l01726"></a><span class="lineno"> 1726</span> </div>
<div class="line"><a id="l01727" name="l01727"></a><span class="lineno"> 1727</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01728" name="l01728"></a><span class="lineno"> 1728</span>    <span class="keywordflow">case</span> EKFType::SIM: {</div>
<div class="line"><a id="l01729" name="l01729"></a><span class="lineno"> 1729</span>        <span class="keywordflow">return</span> sim.get_relative_position_NE_origin(posNE);</div>
<div class="line"><a id="l01730" name="l01730"></a><span class="lineno"> 1730</span>    }</div>
<div class="line"><a id="l01731" name="l01731"></a><span class="lineno"> 1731</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01732" name="l01732"></a><span class="lineno"> 1732</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01733" name="l01733"></a><span class="lineno"> 1733</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01734" name="l01734"></a><span class="lineno"> 1734</span>        <span class="keywordflow">return</span> external.get_relative_position_NE_origin(posNE);</div>
<div class="line"><a id="l01735" name="l01735"></a><span class="lineno"> 1735</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01736" name="l01736"></a><span class="lineno"> 1736</span>    }</div>
<div class="line"><a id="l01737" name="l01737"></a><span class="lineno"> 1737</span>    <span class="comment">// since there is no default case above, this is unreachable</span></div>
<div class="line"><a id="l01738" name="l01738"></a><span class="lineno"> 1738</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01739" name="l01739"></a><span class="lineno"> 1739</span>}</div>
</div>
<div class="line"><a id="l01740" name="l01740"></a><span class="lineno"> 1740</span> </div>
<div class="line"><a id="l01741" name="l01741"></a><span class="lineno"> 1741</span><span class="comment">/*</span></div>
<div class="line"><a id="l01742" name="l01742"></a><span class="lineno"> 1742</span><span class="comment"> return a relative ground position from home in meters North/East</span></div>
<div class="line"><a id="l01743" name="l01743"></a><span class="lineno"> 1743</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01744" data-start="{" data-end="}">
<div class="line"><a id="l01744" name="l01744"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a763ba621dc68e75e5929ba4dba266d33"> 1744</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a763ba621dc68e75e5929ba4dba266d33">AP_AHRS::get_relative_position_NE_home</a>(<a class="code hl_class" href="structVector2.html">Vector2f</a> &amp;posNE)<span class="keyword"> const</span></div>
<div class="line"><a id="l01745" name="l01745"></a><span class="lineno"> 1745</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01746" name="l01746"></a><span class="lineno"> 1746</span>    <a class="code hl_class" href="classLocation.html">Location</a> loc;</div>
<div class="line"><a id="l01747" name="l01747"></a><span class="lineno"> 1747</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__AHRS.html#a89d3f4c63809e5e5ff4d3c4a61969e4c">_home_is_set</a> ||</div>
<div class="line"><a id="l01748" name="l01748"></a><span class="lineno"> 1748</span>        !<a class="code hl_function" href="classAP__AHRS.html#a0b6672c6f1c6303a804bc0a5e02ec1af">get_location</a>(loc)) {</div>
<div class="line"><a id="l01749" name="l01749"></a><span class="lineno"> 1749</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01750" name="l01750"></a><span class="lineno"> 1750</span>    }</div>
<div class="line"><a id="l01751" name="l01751"></a><span class="lineno"> 1751</span> </div>
<div class="line"><a id="l01752" name="l01752"></a><span class="lineno"> 1752</span>    posNE = <a class="code hl_variable" href="classAP__AHRS.html#a2107b76042de1c58c8f550ea60804ea9">_home</a>.<a class="code hl_function" href="classLocation.html#af597420e2ec20fc794ca3d5447fd36ba">get_distance_NE</a>(loc);</div>
<div class="line"><a id="l01753" name="l01753"></a><span class="lineno"> 1753</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l01754" name="l01754"></a><span class="lineno"> 1754</span>}</div>
</div>
<div class="line"><a id="l01755" name="l01755"></a><span class="lineno"> 1755</span> </div>
<div class="line"><a id="l01756" name="l01756"></a><span class="lineno"> 1756</span><span class="comment">// write a relative ground position estimate to the origin in meters, North/East order</span></div>
<div class="line"><a id="l01757" name="l01757"></a><span class="lineno"> 1757</span> </div>
<div class="line"><a id="l01758" name="l01758"></a><span class="lineno"> 1758</span> </div>
<div class="line"><a id="l01759" name="l01759"></a><span class="lineno"> 1759</span><span class="comment">/*</span></div>
<div class="line"><a id="l01760" name="l01760"></a><span class="lineno"> 1760</span><span class="comment">  return a relative ground position from the origin in meters, down</span></div>
<div class="line"><a id="l01761" name="l01761"></a><span class="lineno"> 1761</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01762" data-start="{" data-end="}">
<div class="line"><a id="l01762" name="l01762"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a62cff9296af811471d4bdebeebddc8ad"> 1762</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a62cff9296af811471d4bdebeebddc8ad">AP_AHRS::get_relative_position_D_origin</a>(<span class="keywordtype">float</span> &amp;posD)<span class="keyword"> const</span></div>
<div class="line"><a id="l01763" name="l01763"></a><span class="lineno"> 1763</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01764" name="l01764"></a><span class="lineno"> 1764</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l01765" name="l01765"></a><span class="lineno"> 1765</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01766" name="l01766"></a><span class="lineno"> 1766</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01767" name="l01767"></a><span class="lineno"> 1767</span>        <span class="keywordflow">return</span> dcm.get_relative_position_D_origin(posD);</div>
<div class="line"><a id="l01768" name="l01768"></a><span class="lineno"> 1768</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01769" name="l01769"></a><span class="lineno"> 1769</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01770" name="l01770"></a><span class="lineno"> 1770</span>    <span class="keywordflow">case</span> EKFType::TWO: {</div>
<div class="line"><a id="l01771" name="l01771"></a><span class="lineno"> 1771</span>        <span class="keywordtype">bool</span> position_is_valid = EKF2.getPosD(posD);</div>
<div class="line"><a id="l01772" name="l01772"></a><span class="lineno"> 1772</span>        <span class="keywordflow">return</span> position_is_valid;</div>
<div class="line"><a id="l01773" name="l01773"></a><span class="lineno"> 1773</span>    }</div>
<div class="line"><a id="l01774" name="l01774"></a><span class="lineno"> 1774</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01775" name="l01775"></a><span class="lineno"> 1775</span> </div>
<div class="line"><a id="l01776" name="l01776"></a><span class="lineno"> 1776</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01777" name="l01777"></a><span class="lineno"> 1777</span>    <span class="keywordflow">case</span> EKFType::THREE: {</div>
<div class="line"><a id="l01778" name="l01778"></a><span class="lineno"> 1778</span>        <span class="keywordtype">bool</span> position_is_valid = EKF3.getPosD(posD);</div>
<div class="line"><a id="l01779" name="l01779"></a><span class="lineno"> 1779</span>        <span class="keywordflow">return</span> position_is_valid;</div>
<div class="line"><a id="l01780" name="l01780"></a><span class="lineno"> 1780</span>    }</div>
<div class="line"><a id="l01781" name="l01781"></a><span class="lineno"> 1781</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01782" name="l01782"></a><span class="lineno"> 1782</span> </div>
<div class="line"><a id="l01783" name="l01783"></a><span class="lineno"> 1783</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01784" name="l01784"></a><span class="lineno"> 1784</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01785" name="l01785"></a><span class="lineno"> 1785</span>        <span class="keywordflow">return</span> sim.get_relative_position_D_origin(posD);</div>
<div class="line"><a id="l01786" name="l01786"></a><span class="lineno"> 1786</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01787" name="l01787"></a><span class="lineno"> 1787</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01788" name="l01788"></a><span class="lineno"> 1788</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01789" name="l01789"></a><span class="lineno"> 1789</span>        <span class="keywordflow">return</span> external.get_relative_position_D_origin(posD);</div>
<div class="line"><a id="l01790" name="l01790"></a><span class="lineno"> 1790</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01791" name="l01791"></a><span class="lineno"> 1791</span>    }</div>
<div class="line"><a id="l01792" name="l01792"></a><span class="lineno"> 1792</span>    <span class="comment">// since there is no default case above, this is unreachable</span></div>
<div class="line"><a id="l01793" name="l01793"></a><span class="lineno"> 1793</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l01794" name="l01794"></a><span class="lineno"> 1794</span>}</div>
</div>
<div class="line"><a id="l01795" name="l01795"></a><span class="lineno"> 1795</span> </div>
<div class="line"><a id="l01796" name="l01796"></a><span class="lineno"> 1796</span><span class="comment">/*</span></div>
<div class="line"><a id="l01797" name="l01797"></a><span class="lineno"> 1797</span><span class="comment">  return relative position from home in meters</span></div>
<div class="line"><a id="l01798" name="l01798"></a><span class="lineno"> 1798</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen01799" data-start="{" data-end="}">
<div class="line"><a id="l01799" name="l01799"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a0ce7fb0e943712be46d2ec00e2c7e7de"> 1799</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a0ce7fb0e943712be46d2ec00e2c7e7de">AP_AHRS::get_relative_position_D_home</a>(<span class="keywordtype">float</span> &amp;posD)<span class="keyword"> const</span></div>
<div class="line"><a id="l01800" name="l01800"></a><span class="lineno"> 1800</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01801" name="l01801"></a><span class="lineno"> 1801</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__AHRS.html#a89d3f4c63809e5e5ff4d3c4a61969e4c">_home_is_set</a>) {</div>
<div class="line"><a id="l01802" name="l01802"></a><span class="lineno"> 1802</span>        <span class="comment">// fall back to an altitude derived from barometric pressure</span></div>
<div class="line"><a id="l01803" name="l01803"></a><span class="lineno"> 1803</span>        <span class="comment">// differences vs a calibrated ground pressure:</span></div>
<div class="line"><a id="l01804" name="l01804"></a><span class="lineno"> 1804</span>        posD = -<a class="code hl_function" href="namespaceAP.html#a8aec57eb0b7a79044cbc1f0ca4b75bcf">AP::baro</a>().<a class="code hl_function" href="classAP__Baro.html#a50ae73cce1699d88638e3dfab4ffd330">get_altitude</a>();</div>
<div class="line"><a id="l01805" name="l01805"></a><span class="lineno"> 1805</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01806" name="l01806"></a><span class="lineno"> 1806</span>    }</div>
<div class="line"><a id="l01807" name="l01807"></a><span class="lineno"> 1807</span> </div>
<div class="line"><a id="l01808" name="l01808"></a><span class="lineno"> 1808</span>    <a class="code hl_class" href="classLocation.html">Location</a> originLLH;</div>
<div class="line"><a id="l01809" name="l01809"></a><span class="lineno"> 1809</span>    <span class="keywordtype">float</span> originD;</div>
<div class="line"><a id="l01810" name="l01810"></a><span class="lineno"> 1810</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__AHRS.html#a62cff9296af811471d4bdebeebddc8ad">get_relative_position_D_origin</a>(originD) ||</div>
<div class="line"><a id="l01811" name="l01811"></a><span class="lineno"> 1811</span>        !<a class="code hl_function" href="classAP__AHRS.html#ace0f7b506770c77053e0c46fc6bf95f9">_get_origin</a>(originLLH)) {</div>
<div class="line"><a id="l01812" name="l01812"></a><span class="lineno"> 1812</span><span class="preprocessor">#if AP_GPS_ENABLED</span></div>
<div class="line"><a id="l01813" name="l01813"></a><span class="lineno"> 1813</span>        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code hl_variable" href="GPS__AUTO__test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a> = <a class="code hl_function" href="namespaceAP.html#ae6eeec356455220f913e47e323057cd5">AP::gps</a>();</div>
<div class="line"><a id="l01814" name="l01814"></a><span class="lineno"> 1814</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#af2dd025914c020ea833f2bbeb3926233">_gps_use</a> == <a class="code hl_enumvalue" href="AP__AHRS__Backend_8h.html#abb4caec8fb8ae46a29b81a5304fd20b6a9605b58fbbae3ec411d864a08b2a26e3">GPSUse::EnableWithHeight</a> &amp;&amp;</div>
<div class="line"><a id="l01815" name="l01815"></a><span class="lineno"> 1815</span>            <a class="code hl_variable" href="GPS__AUTO__test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="code hl_function" href="classAP__GPS.html#ac22b61d2e6cf0b6ff647173ea336de01">status</a>() &gt;= <a class="code hl_enumvalue" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a>) {</div>
<div class="line"><a id="l01816" name="l01816"></a><span class="lineno"> 1816</span>            posD = (<a class="code hl_function" href="classAP__AHRS.html#a8c6d86329f149416dd092d873345bc7f">get_home</a>().<a class="code hl_variable" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> - <a class="code hl_variable" href="GPS__AUTO__test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a>.<a class="code hl_function" href="classAP__GPS.html#ab1da3f2cdc163164cfee43b3248821ed">location</a>().<a class="code hl_variable" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>) * 0.01;</div>
<div class="line"><a id="l01817" name="l01817"></a><span class="lineno"> 1817</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01818" name="l01818"></a><span class="lineno"> 1818</span>        }</div>
<div class="line"><a id="l01819" name="l01819"></a><span class="lineno"> 1819</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01820" name="l01820"></a><span class="lineno"> 1820</span>        posD = -<a class="code hl_function" href="namespaceAP.html#a8aec57eb0b7a79044cbc1f0ca4b75bcf">AP::baro</a>().<a class="code hl_function" href="classAP__Baro.html#a50ae73cce1699d88638e3dfab4ffd330">get_altitude</a>();</div>
<div class="line"><a id="l01821" name="l01821"></a><span class="lineno"> 1821</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01822" name="l01822"></a><span class="lineno"> 1822</span>    }</div>
<div class="line"><a id="l01823" name="l01823"></a><span class="lineno"> 1823</span> </div>
<div class="line"><a id="l01824" name="l01824"></a><span class="lineno"> 1824</span>    posD = originD - ((originLLH.<a class="code hl_variable" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> - <a class="code hl_variable" href="classAP__AHRS.html#a2107b76042de1c58c8f550ea60804ea9">_home</a>.<a class="code hl_variable" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>) * 0.01f);</div>
<div class="line"><a id="l01825" name="l01825"></a><span class="lineno"> 1825</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l01826" name="l01826"></a><span class="lineno"> 1826</span>}</div>
</div>
<div class="line"><a id="l01827" name="l01827"></a><span class="lineno"> 1827</span><span class="comment">/*</span></div>
<div class="line"><a id="l01828" name="l01828"></a><span class="lineno"> 1828</span><span class="comment">  canonicalise _ekf_type, forcing it to be 0, 2 or 3</span></div>
<div class="line"><a id="l01829" name="l01829"></a><span class="lineno"> 1829</span><span class="comment">  type 1 has been deprecated</span></div>
<div class="line"><a id="l01830" name="l01830"></a><span class="lineno"> 1830</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen01831" data-start="{" data-end="}">
<div class="line"><a id="l01831" name="l01831"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651"> 1831</a></span><a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">AP_AHRS::EKFType</a> <a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">AP_AHRS::ekf_type</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01832" name="l01832"></a><span class="lineno"> 1832</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01833" name="l01833"></a><span class="lineno"> 1833</span>    <a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">EKFType</a> <a class="code hl_struct" href="structtype.html">type</a> = (<a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">EKFType</a>)<a class="code hl_variable" href="classAP__AHRS.html#a49af3c66fd17d4a7f061cb9e90933013">_ekf_type</a>.get();</div>
<div class="line"><a id="l01834" name="l01834"></a><span class="lineno"> 1834</span>    <span class="keywordflow">switch</span> (<a class="code hl_struct" href="structtype.html">type</a>) {</div>
<div class="line"><a id="l01835" name="l01835"></a><span class="lineno"> 1835</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01836" name="l01836"></a><span class="lineno"> 1836</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01837" name="l01837"></a><span class="lineno"> 1837</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="TransferFunctionCheck_8cpp.html#ab84905254d7d9db8e55931846bcf06ea">type</a>;</div>
<div class="line"><a id="l01838" name="l01838"></a><span class="lineno"> 1838</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01839" name="l01839"></a><span class="lineno"> 1839</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01840" name="l01840"></a><span class="lineno"> 1840</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01841" name="l01841"></a><span class="lineno"> 1841</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="TransferFunctionCheck_8cpp.html#ab84905254d7d9db8e55931846bcf06ea">type</a>;</div>
<div class="line"><a id="l01842" name="l01842"></a><span class="lineno"> 1842</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01843" name="l01843"></a><span class="lineno"> 1843</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01844" name="l01844"></a><span class="lineno"> 1844</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01845" name="l01845"></a><span class="lineno"> 1845</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="TransferFunctionCheck_8cpp.html#ab84905254d7d9db8e55931846bcf06ea">type</a>;</div>
<div class="line"><a id="l01846" name="l01846"></a><span class="lineno"> 1846</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01847" name="l01847"></a><span class="lineno"> 1847</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01848" name="l01848"></a><span class="lineno"> 1848</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01849" name="l01849"></a><span class="lineno"> 1849</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="TransferFunctionCheck_8cpp.html#ab84905254d7d9db8e55931846bcf06ea">type</a>;</div>
<div class="line"><a id="l01850" name="l01850"></a><span class="lineno"> 1850</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01851" name="l01851"></a><span class="lineno"> 1851</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01852" name="l01852"></a><span class="lineno"> 1852</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01853" name="l01853"></a><span class="lineno"> 1853</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__AHRS.html#ab6e2d39bc4cee69c6532549694d694cd">always_use_EKF</a>()) {</div>
<div class="line"><a id="l01854" name="l01854"></a><span class="lineno"> 1854</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01855" name="l01855"></a><span class="lineno"> 1855</span>            <span class="keywordflow">return</span> EKFType::TWO;</div>
<div class="line"><a id="l01856" name="l01856"></a><span class="lineno"> 1856</span><span class="preprocessor">#elif HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01857" name="l01857"></a><span class="lineno"> 1857</span>            <span class="keywordflow">return</span> EKFType::THREE;</div>
<div class="line"><a id="l01858" name="l01858"></a><span class="lineno"> 1858</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01859" name="l01859"></a><span class="lineno"> 1859</span>        }</div>
<div class="line"><a id="l01860" name="l01860"></a><span class="lineno"> 1860</span>        <span class="keywordflow">return</span> EKFType::DCM;</div>
<div class="line"><a id="l01861" name="l01861"></a><span class="lineno"> 1861</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01862" name="l01862"></a><span class="lineno"> 1862</span>    }</div>
<div class="line"><a id="l01863" name="l01863"></a><span class="lineno"> 1863</span>    <span class="comment">// we can get to here if the user has mis-set AHRS_EKF_TYPE - any</span></div>
<div class="line"><a id="l01864" name="l01864"></a><span class="lineno"> 1864</span>    <span class="comment">// value above 3 will get to here.  TWO is returned here for no</span></div>
<div class="line"><a id="l01865" name="l01865"></a><span class="lineno"> 1865</span>    <span class="comment">// better reason than &quot;tradition&quot;.</span></div>
<div class="line"><a id="l01866" name="l01866"></a><span class="lineno"> 1866</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01867" name="l01867"></a><span class="lineno"> 1867</span>    <span class="keywordflow">return</span> EKFType::TWO;</div>
<div class="line"><a id="l01868" name="l01868"></a><span class="lineno"> 1868</span><span class="preprocessor">#elif HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01869" name="l01869"></a><span class="lineno"> 1869</span>    <span class="keywordflow">return</span> EKFType::THREE;</div>
<div class="line"><a id="l01870" name="l01870"></a><span class="lineno"> 1870</span><span class="preprocessor">#elif AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01871" name="l01871"></a><span class="lineno"> 1871</span>    <span class="keywordflow">return</span> EKFType::DCM;</div>
<div class="line"><a id="l01872" name="l01872"></a><span class="lineno"> 1872</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01873" name="l01873"></a><span class="lineno"> 1873</span><span class="preprocessor">    #error &quot;no default backend available&quot;</span></div>
<div class="line"><a id="l01874" name="l01874"></a><span class="lineno"> 1874</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01875" name="l01875"></a><span class="lineno"> 1875</span>}</div>
</div>
<div class="line"><a id="l01876" name="l01876"></a><span class="lineno"> 1876</span> </div>
<div class="foldopen" id="foldopen01877" data-start="{" data-end="}">
<div class="line"><a id="l01877" name="l01877"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a697d03969b30e69c38757247027e4656"> 1877</a></span><a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">AP_AHRS::EKFType</a> <a class="code hl_function" href="classAP__AHRS.html#a697d03969b30e69c38757247027e4656">AP_AHRS::_active_EKF_type</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l01878" name="l01878"></a><span class="lineno"> 1878</span><span class="keyword"></span>{</div>
<div class="line"><a id="l01879" name="l01879"></a><span class="lineno"> 1879</span>    <a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">EKFType</a> ret = <a class="code hl_function" href="classAP__AHRS.html#a07f652c97b4c53033c6a1c8da0d035cb">fallback_active_EKF_type</a>();</div>
<div class="line"><a id="l01880" name="l01880"></a><span class="lineno"> 1880</span> </div>
<div class="line"><a id="l01881" name="l01881"></a><span class="lineno"> 1881</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>()) {</div>
<div class="line"><a id="l01882" name="l01882"></a><span class="lineno"> 1882</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01883" name="l01883"></a><span class="lineno"> 1883</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01884" name="l01884"></a><span class="lineno"> 1884</span>        <span class="keywordflow">return</span> EKFType::DCM;</div>
<div class="line"><a id="l01885" name="l01885"></a><span class="lineno"> 1885</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01886" name="l01886"></a><span class="lineno"> 1886</span> </div>
<div class="line"><a id="l01887" name="l01887"></a><span class="lineno"> 1887</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01888" name="l01888"></a><span class="lineno"> 1888</span>    <span class="keywordflow">case</span> EKFType::TWO: {</div>
<div class="line"><a id="l01889" name="l01889"></a><span class="lineno"> 1889</span>        <span class="comment">// do we have an EKF2 yet?</span></div>
<div class="line"><a id="l01890" name="l01890"></a><span class="lineno"> 1890</span>        <span class="keywordflow">if</span> (!_ekf2_started) {</div>
<div class="line"><a id="l01891" name="l01891"></a><span class="lineno"> 1891</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="classAP__AHRS.html#a07f652c97b4c53033c6a1c8da0d035cb">fallback_active_EKF_type</a>();</div>
<div class="line"><a id="l01892" name="l01892"></a><span class="lineno"> 1892</span>        }</div>
<div class="line"><a id="l01893" name="l01893"></a><span class="lineno"> 1893</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__AHRS.html#ab6e2d39bc4cee69c6532549694d694cd">always_use_EKF</a>()) {</div>
<div class="line"><a id="l01894" name="l01894"></a><span class="lineno"> 1894</span>            uint16_t ekf2_faults;</div>
<div class="line"><a id="l01895" name="l01895"></a><span class="lineno"> 1895</span>            EKF2.getFilterFaults(ekf2_faults);</div>
<div class="line"><a id="l01896" name="l01896"></a><span class="lineno"> 1896</span>            <span class="keywordflow">if</span> (ekf2_faults == 0) {</div>
<div class="line"><a id="l01897" name="l01897"></a><span class="lineno"> 1897</span>                ret = EKFType::TWO;</div>
<div class="line"><a id="l01898" name="l01898"></a><span class="lineno"> 1898</span>            }</div>
<div class="line"><a id="l01899" name="l01899"></a><span class="lineno"> 1899</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (EKF2.healthy()) {</div>
<div class="line"><a id="l01900" name="l01900"></a><span class="lineno"> 1900</span>            ret = EKFType::TWO;</div>
<div class="line"><a id="l01901" name="l01901"></a><span class="lineno"> 1901</span>        }</div>
<div class="line"><a id="l01902" name="l01902"></a><span class="lineno"> 1902</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01903" name="l01903"></a><span class="lineno"> 1903</span>    }</div>
<div class="line"><a id="l01904" name="l01904"></a><span class="lineno"> 1904</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01905" name="l01905"></a><span class="lineno"> 1905</span> </div>
<div class="line"><a id="l01906" name="l01906"></a><span class="lineno"> 1906</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01907" name="l01907"></a><span class="lineno"> 1907</span>    <span class="keywordflow">case</span> EKFType::THREE: {</div>
<div class="line"><a id="l01908" name="l01908"></a><span class="lineno"> 1908</span>        <span class="comment">// do we have an EKF3 yet?</span></div>
<div class="line"><a id="l01909" name="l01909"></a><span class="lineno"> 1909</span>        <span class="keywordflow">if</span> (!_ekf3_started) {</div>
<div class="line"><a id="l01910" name="l01910"></a><span class="lineno"> 1910</span>            <span class="keywordflow">return</span> <a class="code hl_function" href="classAP__AHRS.html#a07f652c97b4c53033c6a1c8da0d035cb">fallback_active_EKF_type</a>();</div>
<div class="line"><a id="l01911" name="l01911"></a><span class="lineno"> 1911</span>        }</div>
<div class="line"><a id="l01912" name="l01912"></a><span class="lineno"> 1912</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__AHRS.html#ab6e2d39bc4cee69c6532549694d694cd">always_use_EKF</a>()) {</div>
<div class="line"><a id="l01913" name="l01913"></a><span class="lineno"> 1913</span>            uint16_t ekf3_faults;</div>
<div class="line"><a id="l01914" name="l01914"></a><span class="lineno"> 1914</span>            EKF3.getFilterFaults(ekf3_faults);</div>
<div class="line"><a id="l01915" name="l01915"></a><span class="lineno"> 1915</span>            <span class="keywordflow">if</span> (ekf3_faults == 0) {</div>
<div class="line"><a id="l01916" name="l01916"></a><span class="lineno"> 1916</span>                ret = EKFType::THREE;</div>
<div class="line"><a id="l01917" name="l01917"></a><span class="lineno"> 1917</span>            }</div>
<div class="line"><a id="l01918" name="l01918"></a><span class="lineno"> 1918</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (EKF3.healthy()) {</div>
<div class="line"><a id="l01919" name="l01919"></a><span class="lineno"> 1919</span>            ret = EKFType::THREE;</div>
<div class="line"><a id="l01920" name="l01920"></a><span class="lineno"> 1920</span>        }</div>
<div class="line"><a id="l01921" name="l01921"></a><span class="lineno"> 1921</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01922" name="l01922"></a><span class="lineno"> 1922</span>    }</div>
<div class="line"><a id="l01923" name="l01923"></a><span class="lineno"> 1923</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01924" name="l01924"></a><span class="lineno"> 1924</span> </div>
<div class="line"><a id="l01925" name="l01925"></a><span class="lineno"> 1925</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01926" name="l01926"></a><span class="lineno"> 1926</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01927" name="l01927"></a><span class="lineno"> 1927</span>        ret = EKFType::SIM;</div>
<div class="line"><a id="l01928" name="l01928"></a><span class="lineno"> 1928</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01929" name="l01929"></a><span class="lineno"> 1929</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01930" name="l01930"></a><span class="lineno"> 1930</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01931" name="l01931"></a><span class="lineno"> 1931</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01932" name="l01932"></a><span class="lineno"> 1932</span>        ret = EKFType::EXTERNAL;</div>
<div class="line"><a id="l01933" name="l01933"></a><span class="lineno"> 1933</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01934" name="l01934"></a><span class="lineno"> 1934</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01935" name="l01935"></a><span class="lineno"> 1935</span>    }</div>
<div class="line"><a id="l01936" name="l01936"></a><span class="lineno"> 1936</span> </div>
<div class="line"><a id="l01937" name="l01937"></a><span class="lineno"> 1937</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l01938" name="l01938"></a><span class="lineno"> 1938</span>    <span class="comment">// Handle fallback for fixed wing planes (including VTOL&#39;s) and ground vehicles.</span></div>
<div class="line"><a id="l01939" name="l01939"></a><span class="lineno"> 1939</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#a8d26e5f7cfe2eaf4661fa317f2728db4">_vehicle_class</a> == <a class="code hl_enumvalue" href="classAP__AHRS.html#a7a617dbe1beb19c71581b84d7416f2dea2c1e536ff3602f3f02665d9658dc8125">VehicleClass::FIXED_WING</a> ||</div>
<div class="line"><a id="l01940" name="l01940"></a><span class="lineno"> 1940</span>        <a class="code hl_variable" href="classAP__AHRS.html#a8d26e5f7cfe2eaf4661fa317f2728db4">_vehicle_class</a> == <a class="code hl_enumvalue" href="classAP__AHRS.html#a7a617dbe1beb19c71581b84d7416f2deadedcb56e75fe1488e20865e0ea36d0b9">VehicleClass::GROUND</a>) {</div>
<div class="line"><a id="l01941" name="l01941"></a><span class="lineno"> 1941</span>        <span class="keywordtype">bool</span> should_use_gps = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01942" name="l01942"></a><span class="lineno"> 1942</span>        <a class="code hl_union" href="unionnav__filter__status.html">nav_filter_status</a> filt_state {};</div>
<div class="line"><a id="l01943" name="l01943"></a><span class="lineno"> 1943</span>        <span class="keywordflow">switch</span> (ret) {</div>
<div class="line"><a id="l01944" name="l01944"></a><span class="lineno"> 1944</span>        <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l01945" name="l01945"></a><span class="lineno"> 1945</span>            <span class="comment">// already using DCM</span></div>
<div class="line"><a id="l01946" name="l01946"></a><span class="lineno"> 1946</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01947" name="l01947"></a><span class="lineno"> 1947</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l01948" name="l01948"></a><span class="lineno"> 1948</span>        <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l01949" name="l01949"></a><span class="lineno"> 1949</span>            EKF2.getFilterStatus(filt_state);</div>
<div class="line"><a id="l01950" name="l01950"></a><span class="lineno"> 1950</span>            should_use_gps = EKF2.configuredToUseGPSForPosXY();</div>
<div class="line"><a id="l01951" name="l01951"></a><span class="lineno"> 1951</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01952" name="l01952"></a><span class="lineno"> 1952</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01953" name="l01953"></a><span class="lineno"> 1953</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l01954" name="l01954"></a><span class="lineno"> 1954</span>        <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l01955" name="l01955"></a><span class="lineno"> 1955</span>            EKF3.getFilterStatus(filt_state);</div>
<div class="line"><a id="l01956" name="l01956"></a><span class="lineno"> 1956</span>            should_use_gps = EKF3.configuredToUseGPSForPosXY();</div>
<div class="line"><a id="l01957" name="l01957"></a><span class="lineno"> 1957</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01958" name="l01958"></a><span class="lineno"> 1958</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01959" name="l01959"></a><span class="lineno"> 1959</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l01960" name="l01960"></a><span class="lineno"> 1960</span>        <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l01961" name="l01961"></a><span class="lineno"> 1961</span>            <a class="code hl_function" href="classAP__AHRS.html#a263904852f9b6e65cf7a082e5d999131">get_filter_status</a>(filt_state);</div>
<div class="line"><a id="l01962" name="l01962"></a><span class="lineno"> 1962</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01963" name="l01963"></a><span class="lineno"> 1963</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01964" name="l01964"></a><span class="lineno"> 1964</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l01965" name="l01965"></a><span class="lineno"> 1965</span>        <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l01966" name="l01966"></a><span class="lineno"> 1966</span>            <a class="code hl_function" href="classAP__AHRS.html#a263904852f9b6e65cf7a082e5d999131">get_filter_status</a>(filt_state);</div>
<div class="line"><a id="l01967" name="l01967"></a><span class="lineno"> 1967</span>            should_use_gps = <span class="keyword">true</span>;</div>
<div class="line"><a id="l01968" name="l01968"></a><span class="lineno"> 1968</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l01969" name="l01969"></a><span class="lineno"> 1969</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01970" name="l01970"></a><span class="lineno"> 1970</span>        }</div>
<div class="line"><a id="l01971" name="l01971"></a><span class="lineno"> 1971</span> </div>
<div class="line"><a id="l01972" name="l01972"></a><span class="lineno"> 1972</span>        <span class="comment">// Handle fallback for the case where the DCM or EKF is unable to provide attitude or height data.</span></div>
<div class="line"><a id="l01973" name="l01973"></a><span class="lineno"> 1973</span>        <span class="keyword">const</span> <span class="keywordtype">bool</span> can_use_dcm = dcm.yaw_source_available() || <a class="code hl_variable" href="classAP__AHRS.html#a9ae31db83d66c1fe4d11125a34a1163b">fly_forward</a>;</div>
<div class="line"><a id="l01974" name="l01974"></a><span class="lineno"> 1974</span>        <span class="keyword">const</span> <span class="keywordtype">bool</span> can_use_ekf = filt_state.flags.attitude &amp;&amp; filt_state.flags.vert_vel &amp;&amp; filt_state.flags.vert_pos;</div>
<div class="line"><a id="l01975" name="l01975"></a><span class="lineno"> 1975</span>        <span class="keywordflow">if</span> (!can_use_dcm &amp;&amp; can_use_ekf) {</div>
<div class="line"><a id="l01976" name="l01976"></a><span class="lineno"> 1976</span>            <span class="comment">// no choice - continue to use EKF</span></div>
<div class="line"><a id="l01977" name="l01977"></a><span class="lineno"> 1977</span>            <span class="keywordflow">return</span> ret;</div>
<div class="line"><a id="l01978" name="l01978"></a><span class="lineno"> 1978</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!can_use_ekf) {</div>
<div class="line"><a id="l01979" name="l01979"></a><span class="lineno"> 1979</span>            <span class="comment">// No choice - we have to use DCM</span></div>
<div class="line"><a id="l01980" name="l01980"></a><span class="lineno"> 1980</span>            <span class="keywordflow">return</span> EKFType::DCM;</div>
<div class="line"><a id="l01981" name="l01981"></a><span class="lineno"> 1981</span>        }</div>
<div class="line"><a id="l01982" name="l01982"></a><span class="lineno"> 1982</span> </div>
<div class="line"><a id="l01983" name="l01983"></a><span class="lineno"> 1983</span>        <span class="keyword">const</span> <span class="keywordtype">bool</span> disable_dcm_fallback = <a class="code hl_variable" href="classAP__AHRS.html#a9ae31db83d66c1fe4d11125a34a1163b">fly_forward</a>?</div>
<div class="line"><a id="l01984" name="l01984"></a><span class="lineno"> 1984</span>            <a class="code hl_function" href="classAP__AHRS.html#add19752eb07981327d0f01dd1574dc96">option_set</a>(<a class="code hl_enumvalue" href="classAP__AHRS.html#a2c6484cfeeca980f350cf3dc334fc0b6a2ffe5c42f0b29db1a440f34016a3f643">Options::DISABLE_DCM_FALLBACK_FW</a>) : <a class="code hl_function" href="classAP__AHRS.html#add19752eb07981327d0f01dd1574dc96">option_set</a>(<a class="code hl_enumvalue" href="classAP__AHRS.html#a2c6484cfeeca980f350cf3dc334fc0b6aacf5422c4ca48a8d8b8178ae993bef4d">Options::DISABLE_DCM_FALLBACK_VTOL</a>);</div>
<div class="line"><a id="l01985" name="l01985"></a><span class="lineno"> 1985</span>        <span class="keywordflow">if</span> (disable_dcm_fallback) {</div>
<div class="line"><a id="l01986" name="l01986"></a><span class="lineno"> 1986</span>            <span class="comment">// don&#39;t fallback</span></div>
<div class="line"><a id="l01987" name="l01987"></a><span class="lineno"> 1987</span>            <span class="keywordflow">return</span> ret;</div>
<div class="line"><a id="l01988" name="l01988"></a><span class="lineno"> 1988</span>        }</div>
<div class="line"><a id="l01989" name="l01989"></a><span class="lineno"> 1989</span>        </div>
<div class="line"><a id="l01990" name="l01990"></a><span class="lineno"> 1990</span>        <span class="comment">// Handle loss of global position when we still have a GPS fix</span></div>
<div class="line"><a id="l01991" name="l01991"></a><span class="lineno"> 1991</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">get_soft_armed</a>() &amp;&amp;</div>
<div class="line"><a id="l01992" name="l01992"></a><span class="lineno"> 1992</span>            (<a class="code hl_variable" href="classAP__AHRS.html#af2dd025914c020ea833f2bbeb3926233">_gps_use</a> != <a class="code hl_enumvalue" href="AP__AHRS__Backend_8h.html#abb4caec8fb8ae46a29b81a5304fd20b6abcfaccebf745acfd5e75351095a5394a">GPSUse::Disable</a>) &amp;&amp;</div>
<div class="line"><a id="l01993" name="l01993"></a><span class="lineno"> 1993</span>            should_use_gps &amp;&amp;</div>
<div class="line"><a id="l01994" name="l01994"></a><span class="lineno"> 1994</span>            <a class="code hl_function" href="namespaceAP.html#ae6eeec356455220f913e47e323057cd5">AP::gps</a>().<a class="code hl_function" href="classAP__GPS.html#ac22b61d2e6cf0b6ff647173ea336de01">status</a>() &gt;= <a class="code hl_enumvalue" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a> &amp;&amp;</div>
<div class="line"><a id="l01995" name="l01995"></a><span class="lineno"> 1995</span>            (!filt_state.flags.using_gps || !filt_state.flags.horiz_pos_abs)) {</div>
<div class="line"><a id="l01996" name="l01996"></a><span class="lineno"> 1996</span>            <span class="comment">/*</span></div>
<div class="line"><a id="l01997" name="l01997"></a><span class="lineno"> 1997</span><span class="comment">               If the EKF is not fusing GPS or doesn&#39;t have a 2D fix and we have a 3D GPS lock,</span></div>
<div class="line"><a id="l01998" name="l01998"></a><span class="lineno"> 1998</span><span class="comment">               then plane and rover would prefer to use the GPS position from DCM unless the</span></div>
<div class="line"><a id="l01999" name="l01999"></a><span class="lineno"> 1999</span><span class="comment">               fallback has been inhibited by the user.</span></div>
<div class="line"><a id="l02000" name="l02000"></a><span class="lineno"> 2000</span><span class="comment">               Note: The aircraft could be dead reckoning with acceptable accuracy and rejecting a bad GPS</span></div>
<div class="line"><a id="l02001" name="l02001"></a><span class="lineno"> 2001</span><span class="comment">               Note: This is a last resort fallback and makes the navigation highly vulnerable to GPS noise.</span></div>
<div class="line"><a id="l02002" name="l02002"></a><span class="lineno"> 2002</span><span class="comment">               Note: When operating in a VTOL flight mode that actively controls height such as QHOVER,</span></div>
<div class="line"><a id="l02003" name="l02003"></a><span class="lineno"> 2003</span><span class="comment">               the EKF gives better vertical velocity and position estimates and height control characteristics.</span></div>
<div class="line"><a id="l02004" name="l02004"></a><span class="lineno"> 2004</span><span class="comment">            */</span></div>
<div class="line"><a id="l02005" name="l02005"></a><span class="lineno"> 2005</span>            <span class="keywordflow">return</span> EKFType::DCM;</div>
<div class="line"><a id="l02006" name="l02006"></a><span class="lineno"> 2006</span>        }</div>
<div class="line"><a id="l02007" name="l02007"></a><span class="lineno"> 2007</span> </div>
<div class="line"><a id="l02008" name="l02008"></a><span class="lineno"> 2008</span>        <span class="comment">// Handle complete loss of navigation</span></div>
<div class="line"><a id="l02009" name="l02009"></a><span class="lineno"> 2009</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">get_soft_armed</a>() &amp;&amp; filt_state.flags.const_pos_mode) {</div>
<div class="line"><a id="l02010" name="l02010"></a><span class="lineno"> 2010</span>            <span class="comment">/*</span></div>
<div class="line"><a id="l02011" name="l02011"></a><span class="lineno"> 2011</span><span class="comment">               Provided the EKF has been configured to use GPS, ie should_use_gps is true, then the</span></div>
<div class="line"><a id="l02012" name="l02012"></a><span class="lineno"> 2012</span><span class="comment">               key difference to the case handled above is only the absence of a GPS fix which means</span></div>
<div class="line"><a id="l02013" name="l02013"></a><span class="lineno"> 2013</span><span class="comment">               that DCM will not be able to navigate either so we are primarily concerned with</span></div>
<div class="line"><a id="l02014" name="l02014"></a><span class="lineno"> 2014</span><span class="comment">               providing an attitude, vertical position and vertical velocity estimate.</span></div>
<div class="line"><a id="l02015" name="l02015"></a><span class="lineno"> 2015</span><span class="comment">            */</span></div>
<div class="line"><a id="l02016" name="l02016"></a><span class="lineno"> 2016</span>            <span class="keywordflow">return</span> EKFType::DCM;</div>
<div class="line"><a id="l02017" name="l02017"></a><span class="lineno"> 2017</span>        }</div>
<div class="line"><a id="l02018" name="l02018"></a><span class="lineno"> 2018</span> </div>
<div class="line"><a id="l02019" name="l02019"></a><span class="lineno"> 2019</span>        <span class="keywordflow">if</span> (!filt_state.flags.horiz_vel ||</div>
<div class="line"><a id="l02020" name="l02020"></a><span class="lineno"> 2020</span>            (!filt_state.flags.horiz_pos_abs &amp;&amp; !filt_state.flags.horiz_pos_rel)) {</div>
<div class="line"><a id="l02021" name="l02021"></a><span class="lineno"> 2021</span>            <span class="keywordflow">if</span> ((!<a class="code hl_function" href="namespaceAP.html#ab9d0bcbec954b6c20abd8e13e6de7356">AP::compass</a>().use_for_yaw()) &amp;&amp;</div>
<div class="line"><a id="l02022" name="l02022"></a><span class="lineno"> 2022</span>                <a class="code hl_function" href="namespaceAP.html#ae6eeec356455220f913e47e323057cd5">AP::gps</a>().<a class="code hl_variable" href="routing_8cpp.html#acdef7b92239f1e607ef6caa33a16d2ed">status</a>() &gt;= <a class="code hl_enumvalue" href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a> &amp;&amp;</div>
<div class="line"><a id="l02023" name="l02023"></a><span class="lineno"> 2023</span>                <a class="code hl_function" href="namespaceAP.html#ae6eeec356455220f913e47e323057cd5">AP::gps</a>().<a class="code hl_variable" href="classAP__AHRS.html#ab4896dc4fbda9a88f27522d3740bb439">ground_speed</a>() &lt; 2) {</div>
<div class="line"><a id="l02024" name="l02024"></a><span class="lineno"> 2024</span>                <span class="comment">/*</span></div>
<div class="line"><a id="l02025" name="l02025"></a><span class="lineno"> 2025</span><span class="comment">                  special handling for non-compass mode when sitting</span></div>
<div class="line"><a id="l02026" name="l02026"></a><span class="lineno"> 2026</span><span class="comment">                  still. The EKF may not yet have aligned its yaw. We</span></div>
<div class="line"><a id="l02027" name="l02027"></a><span class="lineno"> 2027</span><span class="comment">                  accept EKF as healthy to allow arming. Once we reach</span></div>
<div class="line"><a id="l02028" name="l02028"></a><span class="lineno"> 2028</span><span class="comment">                  speed the EKF should get yaw alignment</span></div>
<div class="line"><a id="l02029" name="l02029"></a><span class="lineno"> 2029</span><span class="comment">                */</span></div>
<div class="line"><a id="l02030" name="l02030"></a><span class="lineno"> 2030</span>                <span class="keywordflow">if</span> (filt_state.flags.gps_quality_good) {</div>
<div class="line"><a id="l02031" name="l02031"></a><span class="lineno"> 2031</span>                    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a id="l02032" name="l02032"></a><span class="lineno"> 2032</span>                }</div>
<div class="line"><a id="l02033" name="l02033"></a><span class="lineno"> 2033</span>            }</div>
<div class="line"><a id="l02034" name="l02034"></a><span class="lineno"> 2034</span>            <span class="keywordflow">return</span> EKFType::DCM;</div>
<div class="line"><a id="l02035" name="l02035"></a><span class="lineno"> 2035</span>        }</div>
<div class="line"><a id="l02036" name="l02036"></a><span class="lineno"> 2036</span>    }</div>
<div class="line"><a id="l02037" name="l02037"></a><span class="lineno"> 2037</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02038" name="l02038"></a><span class="lineno"> 2038</span> </div>
<div class="line"><a id="l02039" name="l02039"></a><span class="lineno"> 2039</span>    <span class="keywordflow">return</span> ret;</div>
<div class="line"><a id="l02040" name="l02040"></a><span class="lineno"> 2040</span>}</div>
</div>
<div class="line"><a id="l02041" name="l02041"></a><span class="lineno"> 2041</span> </div>
<div class="foldopen" id="foldopen02042" data-start="{" data-end="}">
<div class="line"><a id="l02042" name="l02042"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a07f652c97b4c53033c6a1c8da0d035cb"> 2042</a></span><a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">AP_AHRS::EKFType</a> <a class="code hl_function" href="classAP__AHRS.html#a07f652c97b4c53033c6a1c8da0d035cb">AP_AHRS::fallback_active_EKF_type</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l02043" name="l02043"></a><span class="lineno"> 2043</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02044" name="l02044"></a><span class="lineno"> 2044</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02045" name="l02045"></a><span class="lineno"> 2045</span>    <span class="keywordflow">return</span> EKFType::DCM;</div>
<div class="line"><a id="l02046" name="l02046"></a><span class="lineno"> 2046</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02047" name="l02047"></a><span class="lineno"> 2047</span> </div>
<div class="line"><a id="l02048" name="l02048"></a><span class="lineno"> 2048</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02049" name="l02049"></a><span class="lineno"> 2049</span>    <span class="keywordflow">if</span> (_ekf3_started) {</div>
<div class="line"><a id="l02050" name="l02050"></a><span class="lineno"> 2050</span>        <span class="keywordflow">return</span> EKFType::THREE;</div>
<div class="line"><a id="l02051" name="l02051"></a><span class="lineno"> 2051</span>    }</div>
<div class="line"><a id="l02052" name="l02052"></a><span class="lineno"> 2052</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02053" name="l02053"></a><span class="lineno"> 2053</span> </div>
<div class="line"><a id="l02054" name="l02054"></a><span class="lineno"> 2054</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02055" name="l02055"></a><span class="lineno"> 2055</span>    <span class="keywordflow">if</span> (_ekf2_started) {</div>
<div class="line"><a id="l02056" name="l02056"></a><span class="lineno"> 2056</span>        <span class="keywordflow">return</span> EKFType::TWO;</div>
<div class="line"><a id="l02057" name="l02057"></a><span class="lineno"> 2057</span>    }</div>
<div class="line"><a id="l02058" name="l02058"></a><span class="lineno"> 2058</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02059" name="l02059"></a><span class="lineno"> 2059</span> </div>
<div class="line"><a id="l02060" name="l02060"></a><span class="lineno"> 2060</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02061" name="l02061"></a><span class="lineno"> 2061</span>    <span class="keywordflow">if</span> (external.healthy()) {</div>
<div class="line"><a id="l02062" name="l02062"></a><span class="lineno"> 2062</span>        <span class="keywordflow">return</span> EKFType::EXTERNAL;</div>
<div class="line"><a id="l02063" name="l02063"></a><span class="lineno"> 2063</span>    }</div>
<div class="line"><a id="l02064" name="l02064"></a><span class="lineno"> 2064</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02065" name="l02065"></a><span class="lineno"> 2065</span> </div>
<div class="line"><a id="l02066" name="l02066"></a><span class="lineno"> 2066</span>    <span class="comment">// so nobody is ready yet.  Return something, even if it is not ready:</span></div>
<div class="line"><a id="l02067" name="l02067"></a><span class="lineno"> 2067</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02068" name="l02068"></a><span class="lineno"> 2068</span>    <span class="keywordflow">return</span> EKFType::THREE;</div>
<div class="line"><a id="l02069" name="l02069"></a><span class="lineno"> 2069</span><span class="preprocessor">#elif HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02070" name="l02070"></a><span class="lineno"> 2070</span>    <span class="keywordflow">return</span> EKFType::TWO;</div>
<div class="line"><a id="l02071" name="l02071"></a><span class="lineno"> 2071</span><span class="preprocessor">#elif AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02072" name="l02072"></a><span class="lineno"> 2072</span>    <span class="keywordflow">return</span> EKFType::EXTERNAL;</div>
<div class="line"><a id="l02073" name="l02073"></a><span class="lineno"> 2073</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02074" name="l02074"></a><span class="lineno"> 2074</span>}</div>
</div>
<div class="line"><a id="l02075" name="l02075"></a><span class="lineno"> 2075</span> </div>
<div class="line"><a id="l02076" name="l02076"></a><span class="lineno"> 2076</span><span class="comment">// get secondary EKF type.  returns false if no secondary (i.e. only using DCM)</span></div>
<div class="foldopen" id="foldopen02077" data-start="{" data-end="}">
<div class="line"><a id="l02077" name="l02077"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#af41a16f5463e74fb8f67689a1289c336"> 2077</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#af41a16f5463e74fb8f67689a1289c336">AP_AHRS::_get_secondary_EKF_type</a>(<a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">EKFType</a> &amp;secondary_ekf_type)<span class="keyword"> const</span></div>
<div class="line"><a id="l02078" name="l02078"></a><span class="lineno"> 2078</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02079" name="l02079"></a><span class="lineno"> 2079</span> </div>
<div class="line"><a id="l02080" name="l02080"></a><span class="lineno"> 2080</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l02081" name="l02081"></a><span class="lineno"> 2081</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02082" name="l02082"></a><span class="lineno"> 2082</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02083" name="l02083"></a><span class="lineno"> 2083</span>        <span class="comment">// EKF2, EKF3 or External is secondary</span></div>
<div class="line"><a id="l02084" name="l02084"></a><span class="lineno"> 2084</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02085" name="l02085"></a><span class="lineno"> 2085</span>        <span class="keywordflow">if</span> ((<a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">EKFType</a>)<a class="code hl_variable" href="classAP__AHRS.html#a49af3c66fd17d4a7f061cb9e90933013">_ekf_type</a>.get() == EKFType::THREE) {</div>
<div class="line"><a id="l02086" name="l02086"></a><span class="lineno"> 2086</span>            secondary_ekf_type = EKFType::THREE;</div>
<div class="line"><a id="l02087" name="l02087"></a><span class="lineno"> 2087</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02088" name="l02088"></a><span class="lineno"> 2088</span>        }</div>
<div class="line"><a id="l02089" name="l02089"></a><span class="lineno"> 2089</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02090" name="l02090"></a><span class="lineno"> 2090</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02091" name="l02091"></a><span class="lineno"> 2091</span>        <span class="keywordflow">if</span> ((<a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">EKFType</a>)<a class="code hl_variable" href="classAP__AHRS.html#a49af3c66fd17d4a7f061cb9e90933013">_ekf_type</a>.get() == EKFType::TWO) {</div>
<div class="line"><a id="l02092" name="l02092"></a><span class="lineno"> 2092</span>            secondary_ekf_type = EKFType::TWO;</div>
<div class="line"><a id="l02093" name="l02093"></a><span class="lineno"> 2093</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02094" name="l02094"></a><span class="lineno"> 2094</span>        }</div>
<div class="line"><a id="l02095" name="l02095"></a><span class="lineno"> 2095</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02096" name="l02096"></a><span class="lineno"> 2096</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02097" name="l02097"></a><span class="lineno"> 2097</span>        <span class="keywordflow">if</span> ((<a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">EKFType</a>)<a class="code hl_variable" href="classAP__AHRS.html#a49af3c66fd17d4a7f061cb9e90933013">_ekf_type</a>.get() == EKFType::EXTERNAL) {</div>
<div class="line"><a id="l02098" name="l02098"></a><span class="lineno"> 2098</span>            secondary_ekf_type = EKFType::EXTERNAL;</div>
<div class="line"><a id="l02099" name="l02099"></a><span class="lineno"> 2099</span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02100" name="l02100"></a><span class="lineno"> 2100</span>        }</div>
<div class="line"><a id="l02101" name="l02101"></a><span class="lineno"> 2101</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02102" name="l02102"></a><span class="lineno"> 2102</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02103" name="l02103"></a><span class="lineno"> 2103</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02104" name="l02104"></a><span class="lineno"> 2104</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02105" name="l02105"></a><span class="lineno"> 2105</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02106" name="l02106"></a><span class="lineno"> 2106</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02107" name="l02107"></a><span class="lineno"> 2107</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02108" name="l02108"></a><span class="lineno"> 2108</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02109" name="l02109"></a><span class="lineno"> 2109</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02110" name="l02110"></a><span class="lineno"> 2110</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02111" name="l02111"></a><span class="lineno"> 2111</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02112" name="l02112"></a><span class="lineno"> 2112</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02113" name="l02113"></a><span class="lineno"> 2113</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02114" name="l02114"></a><span class="lineno"> 2114</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02115" name="l02115"></a><span class="lineno"> 2115</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02116" name="l02116"></a><span class="lineno"> 2116</span>        <span class="comment">// DCM is secondary</span></div>
<div class="line"><a id="l02117" name="l02117"></a><span class="lineno"> 2117</span>        secondary_ekf_type = <a class="code hl_function" href="classAP__AHRS.html#a07f652c97b4c53033c6a1c8da0d035cb">fallback_active_EKF_type</a>();</div>
<div class="line"><a id="l02118" name="l02118"></a><span class="lineno"> 2118</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02119" name="l02119"></a><span class="lineno"> 2119</span>    }</div>
<div class="line"><a id="l02120" name="l02120"></a><span class="lineno"> 2120</span> </div>
<div class="line"><a id="l02121" name="l02121"></a><span class="lineno"> 2121</span>    <span class="comment">// since there is no default case above, this is unreachable</span></div>
<div class="line"><a id="l02122" name="l02122"></a><span class="lineno"> 2122</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02123" name="l02123"></a><span class="lineno"> 2123</span>}</div>
</div>
<div class="line"><a id="l02124" name="l02124"></a><span class="lineno"> 2124</span> </div>
<div class="line"><a id="l02125" name="l02125"></a><span class="lineno"> 2125</span><span class="comment">/*</span></div>
<div class="line"><a id="l02126" name="l02126"></a><span class="lineno"> 2126</span><span class="comment">  check if the AHRS subsystem is healthy</span></div>
<div class="line"><a id="l02127" name="l02127"></a><span class="lineno"> 2127</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen02128" data-start="{" data-end="}">
<div class="line"><a id="l02128" name="l02128"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#ab22b10e389fa8dc66f67d7c60ee2a3ff"> 2128</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#ab22b10e389fa8dc66f67d7c60ee2a3ff">AP_AHRS::healthy</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l02129" name="l02129"></a><span class="lineno"> 2129</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02130" name="l02130"></a><span class="lineno"> 2130</span>    <span class="comment">// If EKF is started we switch away if it reports unhealthy. This could be due to bad</span></div>
<div class="line"><a id="l02131" name="l02131"></a><span class="lineno"> 2131</span>    <span class="comment">// sensor data. If EKF reversion is inhibited, we only switch across if the EKF encounters</span></div>
<div class="line"><a id="l02132" name="l02132"></a><span class="lineno"> 2132</span>    <span class="comment">// an internal processing error, but not for bad sensor data.</span></div>
<div class="line"><a id="l02133" name="l02133"></a><span class="lineno"> 2133</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>()) {</div>
<div class="line"><a id="l02134" name="l02134"></a><span class="lineno"> 2134</span> </div>
<div class="line"><a id="l02135" name="l02135"></a><span class="lineno"> 2135</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02136" name="l02136"></a><span class="lineno"> 2136</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02137" name="l02137"></a><span class="lineno"> 2137</span>        <span class="keywordflow">return</span> dcm.healthy();</div>
<div class="line"><a id="l02138" name="l02138"></a><span class="lineno"> 2138</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02139" name="l02139"></a><span class="lineno"> 2139</span> </div>
<div class="line"><a id="l02140" name="l02140"></a><span class="lineno"> 2140</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02141" name="l02141"></a><span class="lineno"> 2141</span>    <span class="keywordflow">case</span> EKFType::TWO: {</div>
<div class="line"><a id="l02142" name="l02142"></a><span class="lineno"> 2142</span>        <span class="keywordtype">bool</span> ret = _ekf2_started &amp;&amp; EKF2.healthy();</div>
<div class="line"><a id="l02143" name="l02143"></a><span class="lineno"> 2143</span>        <span class="keywordflow">if</span> (!ret) {</div>
<div class="line"><a id="l02144" name="l02144"></a><span class="lineno"> 2144</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02145" name="l02145"></a><span class="lineno"> 2145</span>        }</div>
<div class="line"><a id="l02146" name="l02146"></a><span class="lineno"> 2146</span>        <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__AHRS.html#a8d26e5f7cfe2eaf4661fa317f2728db4">_vehicle_class</a> == <a class="code hl_enumvalue" href="classAP__AHRS.html#a7a617dbe1beb19c71581b84d7416f2dea2c1e536ff3602f3f02665d9658dc8125">VehicleClass::FIXED_WING</a> ||</div>
<div class="line"><a id="l02147" name="l02147"></a><span class="lineno"> 2147</span>                <a class="code hl_variable" href="classAP__AHRS.html#a8d26e5f7cfe2eaf4661fa317f2728db4">_vehicle_class</a> == <a class="code hl_enumvalue" href="classAP__AHRS.html#a7a617dbe1beb19c71581b84d7416f2deadedcb56e75fe1488e20865e0ea36d0b9">VehicleClass::GROUND</a>) &amp;&amp;</div>
<div class="line"><a id="l02148" name="l02148"></a><span class="lineno"> 2148</span>                <a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>() != EKFType::TWO) {</div>
<div class="line"><a id="l02149" name="l02149"></a><span class="lineno"> 2149</span>            <span class="comment">// on fixed wing we want to be using EKF to be considered</span></div>
<div class="line"><a id="l02150" name="l02150"></a><span class="lineno"> 2150</span>            <span class="comment">// healthy if EKF is enabled</span></div>
<div class="line"><a id="l02151" name="l02151"></a><span class="lineno"> 2151</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02152" name="l02152"></a><span class="lineno"> 2152</span>        }</div>
<div class="line"><a id="l02153" name="l02153"></a><span class="lineno"> 2153</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02154" name="l02154"></a><span class="lineno"> 2154</span>    }</div>
<div class="line"><a id="l02155" name="l02155"></a><span class="lineno"> 2155</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02156" name="l02156"></a><span class="lineno"> 2156</span> </div>
<div class="line"><a id="l02157" name="l02157"></a><span class="lineno"> 2157</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02158" name="l02158"></a><span class="lineno"> 2158</span>    <span class="keywordflow">case</span> EKFType::THREE: {</div>
<div class="line"><a id="l02159" name="l02159"></a><span class="lineno"> 2159</span>        <span class="keywordtype">bool</span> ret = _ekf3_started &amp;&amp; EKF3.healthy();</div>
<div class="line"><a id="l02160" name="l02160"></a><span class="lineno"> 2160</span>        <span class="keywordflow">if</span> (!ret) {</div>
<div class="line"><a id="l02161" name="l02161"></a><span class="lineno"> 2161</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02162" name="l02162"></a><span class="lineno"> 2162</span>        }</div>
<div class="line"><a id="l02163" name="l02163"></a><span class="lineno"> 2163</span>        <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__AHRS.html#a8d26e5f7cfe2eaf4661fa317f2728db4">_vehicle_class</a> == <a class="code hl_enumvalue" href="classAP__AHRS.html#a7a617dbe1beb19c71581b84d7416f2dea2c1e536ff3602f3f02665d9658dc8125">VehicleClass::FIXED_WING</a> ||</div>
<div class="line"><a id="l02164" name="l02164"></a><span class="lineno"> 2164</span>                <a class="code hl_variable" href="classAP__AHRS.html#a8d26e5f7cfe2eaf4661fa317f2728db4">_vehicle_class</a> == <a class="code hl_enumvalue" href="classAP__AHRS.html#a7a617dbe1beb19c71581b84d7416f2deadedcb56e75fe1488e20865e0ea36d0b9">VehicleClass::GROUND</a>) &amp;&amp;</div>
<div class="line"><a id="l02165" name="l02165"></a><span class="lineno"> 2165</span>                <a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>() != EKFType::THREE) {</div>
<div class="line"><a id="l02166" name="l02166"></a><span class="lineno"> 2166</span>            <span class="comment">// on fixed wing we want to be using EKF to be considered</span></div>
<div class="line"><a id="l02167" name="l02167"></a><span class="lineno"> 2167</span>            <span class="comment">// healthy if EKF is enabled</span></div>
<div class="line"><a id="l02168" name="l02168"></a><span class="lineno"> 2168</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02169" name="l02169"></a><span class="lineno"> 2169</span>        }</div>
<div class="line"><a id="l02170" name="l02170"></a><span class="lineno"> 2170</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02171" name="l02171"></a><span class="lineno"> 2171</span>    }</div>
<div class="line"><a id="l02172" name="l02172"></a><span class="lineno"> 2172</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02173" name="l02173"></a><span class="lineno"> 2173</span> </div>
<div class="line"><a id="l02174" name="l02174"></a><span class="lineno"> 2174</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02175" name="l02175"></a><span class="lineno"> 2175</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02176" name="l02176"></a><span class="lineno"> 2176</span>        <span class="keywordflow">return</span> sim.healthy();</div>
<div class="line"><a id="l02177" name="l02177"></a><span class="lineno"> 2177</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02178" name="l02178"></a><span class="lineno"> 2178</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02179" name="l02179"></a><span class="lineno"> 2179</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02180" name="l02180"></a><span class="lineno"> 2180</span>        <span class="keywordflow">return</span> external.healthy();</div>
<div class="line"><a id="l02181" name="l02181"></a><span class="lineno"> 2181</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02182" name="l02182"></a><span class="lineno"> 2182</span>    }</div>
<div class="line"><a id="l02183" name="l02183"></a><span class="lineno"> 2183</span> </div>
<div class="line"><a id="l02184" name="l02184"></a><span class="lineno"> 2184</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02185" name="l02185"></a><span class="lineno"> 2185</span>}</div>
</div>
<div class="line"><a id="l02186" name="l02186"></a><span class="lineno"> 2186</span> </div>
<div class="line"><a id="l02187" name="l02187"></a><span class="lineno"> 2187</span><span class="comment">// returns false if we fail arming checks, in which case the buffer will be populated with a failure message</span></div>
<div class="line"><a id="l02188" name="l02188"></a><span class="lineno"> 2188</span><span class="comment">// requires_position should be true if horizontal position configuration should be checked</span></div>
<div class="foldopen" id="foldopen02189" data-start="{" data-end="}">
<div class="line"><a id="l02189" name="l02189"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#ace05b87dca74cf66b2f55c7570b63d8a"> 2189</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#ace05b87dca74cf66b2f55c7570b63d8a">AP_AHRS::pre_arm_check</a>(<span class="keywordtype">bool</span> requires_position, <span class="keywordtype">char</span> *failure_msg, uint8_t failure_msg_len)<span class="keyword"> const</span></div>
<div class="line"><a id="l02190" name="l02190"></a><span class="lineno"> 2190</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02191" name="l02191"></a><span class="lineno"> 2191</span>    <span class="keywordtype">bool</span> ret = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02192" name="l02192"></a><span class="lineno"> 2192</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__AHRS.html#ab22b10e389fa8dc66f67d7c60ee2a3ff">healthy</a>()) {</div>
<div class="line"><a id="l02193" name="l02193"></a><span class="lineno"> 2193</span>        <span class="comment">// this rather generic failure might be overwritten by</span></div>
<div class="line"><a id="l02194" name="l02194"></a><span class="lineno"> 2194</span>        <span class="comment">// something more specific in the &quot;backend&quot;</span></div>
<div class="line"><a id="l02195" name="l02195"></a><span class="lineno"> 2195</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#afaedff8102d9ae2fbc398d2099e30cf6">snprintf</a>(failure_msg, failure_msg_len, <span class="stringliteral">&quot;Not healthy&quot;</span>);</div>
<div class="line"><a id="l02196" name="l02196"></a><span class="lineno"> 2196</span>        ret = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02197" name="l02197"></a><span class="lineno"> 2197</span>    }</div>
<div class="line"><a id="l02198" name="l02198"></a><span class="lineno"> 2198</span> </div>
<div class="line"><a id="l02199" name="l02199"></a><span class="lineno"> 2199</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02200" name="l02200"></a><span class="lineno"> 2200</span>    <span class="comment">// Always check external AHRS if enabled</span></div>
<div class="line"><a id="l02201" name="l02201"></a><span class="lineno"> 2201</span>    <span class="comment">// it is a source for IMU data even if not being used as direct AHRS replacement</span></div>
<div class="line"><a id="l02202" name="l02202"></a><span class="lineno"> 2202</span>    <span class="keywordflow">if</span> (AP::externalAHRS().enabled() || (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>() == EKFType::EXTERNAL)) {</div>
<div class="line"><a id="l02203" name="l02203"></a><span class="lineno"> 2203</span>        <span class="keywordflow">if</span> (!AP::externalAHRS().<a class="code hl_function" href="classAP__AHRS.html#ace05b87dca74cf66b2f55c7570b63d8a">pre_arm_check</a>(failure_msg, failure_msg_len)) {</div>
<div class="line"><a id="l02204" name="l02204"></a><span class="lineno"> 2204</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02205" name="l02205"></a><span class="lineno"> 2205</span>        }</div>
<div class="line"><a id="l02206" name="l02206"></a><span class="lineno"> 2206</span>    }</div>
<div class="line"><a id="l02207" name="l02207"></a><span class="lineno"> 2207</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02208" name="l02208"></a><span class="lineno"> 2208</span> </div>
<div class="line"><a id="l02209" name="l02209"></a><span class="lineno"> 2209</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__AHRS.html#a676a8a732b2159d1da9683eb556309f9">attitudes_consistent</a>(failure_msg, failure_msg_len)) {</div>
<div class="line"><a id="l02210" name="l02210"></a><span class="lineno"> 2210</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02211" name="l02211"></a><span class="lineno"> 2211</span>    }</div>
<div class="line"><a id="l02212" name="l02212"></a><span class="lineno"> 2212</span> </div>
<div class="line"><a id="l02213" name="l02213"></a><span class="lineno"> 2213</span>    <span class="comment">// ensure we&#39;re using the configured backend, but bypass in compass-less cases:</span></div>
<div class="line"><a id="l02214" name="l02214"></a><span class="lineno"> 2214</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>() != <a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>() &amp;&amp; <a class="code hl_function" href="namespaceAP.html#ab9d0bcbec954b6c20abd8e13e6de7356">AP::compass</a>().use_for_yaw()) {</div>
<div class="line"><a id="l02215" name="l02215"></a><span class="lineno"> 2215</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#afaedff8102d9ae2fbc398d2099e30cf6">snprintf</a>(failure_msg, failure_msg_len, <span class="stringliteral">&quot;not using configured AHRS type&quot;</span>);</div>
<div class="line"><a id="l02216" name="l02216"></a><span class="lineno"> 2216</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02217" name="l02217"></a><span class="lineno"> 2217</span>    }</div>
<div class="line"><a id="l02218" name="l02218"></a><span class="lineno"> 2218</span> </div>
<div class="line"><a id="l02219" name="l02219"></a><span class="lineno"> 2219</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>()) {</div>
<div class="line"><a id="l02220" name="l02220"></a><span class="lineno"> 2220</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02221" name="l02221"></a><span class="lineno"> 2221</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02222" name="l02222"></a><span class="lineno"> 2222</span>        <span class="keywordflow">return</span> ret;</div>
<div class="line"><a id="l02223" name="l02223"></a><span class="lineno"> 2223</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02224" name="l02224"></a><span class="lineno"> 2224</span> </div>
<div class="line"><a id="l02225" name="l02225"></a><span class="lineno"> 2225</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02226" name="l02226"></a><span class="lineno"> 2226</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02227" name="l02227"></a><span class="lineno"> 2227</span>        <span class="keywordflow">return</span> dcm.pre_arm_check(requires_position, failure_msg, failure_msg_len) &amp;&amp; ret;</div>
<div class="line"><a id="l02228" name="l02228"></a><span class="lineno"> 2228</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02229" name="l02229"></a><span class="lineno"> 2229</span> </div>
<div class="line"><a id="l02230" name="l02230"></a><span class="lineno"> 2230</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02231" name="l02231"></a><span class="lineno"> 2231</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02232" name="l02232"></a><span class="lineno"> 2232</span>        <span class="keywordflow">return</span> external.pre_arm_check(requires_position, failure_msg, failure_msg_len);</div>
<div class="line"><a id="l02233" name="l02233"></a><span class="lineno"> 2233</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02234" name="l02234"></a><span class="lineno"> 2234</span> </div>
<div class="line"><a id="l02235" name="l02235"></a><span class="lineno"> 2235</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02236" name="l02236"></a><span class="lineno"> 2236</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02237" name="l02237"></a><span class="lineno"> 2237</span>        <span class="keywordflow">if</span> (!_ekf2_started) {</div>
<div class="line"><a id="l02238" name="l02238"></a><span class="lineno"> 2238</span>            <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#afaedff8102d9ae2fbc398d2099e30cf6">snprintf</a>(failure_msg, failure_msg_len, <span class="stringliteral">&quot;EKF2 not started&quot;</span>);</div>
<div class="line"><a id="l02239" name="l02239"></a><span class="lineno"> 2239</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02240" name="l02240"></a><span class="lineno"> 2240</span>        }</div>
<div class="line"><a id="l02241" name="l02241"></a><span class="lineno"> 2241</span>        <span class="keywordflow">return</span> EKF2.pre_arm_check(failure_msg, failure_msg_len) &amp;&amp; ret;</div>
<div class="line"><a id="l02242" name="l02242"></a><span class="lineno"> 2242</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02243" name="l02243"></a><span class="lineno"> 2243</span> </div>
<div class="line"><a id="l02244" name="l02244"></a><span class="lineno"> 2244</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02245" name="l02245"></a><span class="lineno"> 2245</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02246" name="l02246"></a><span class="lineno"> 2246</span>        <span class="keywordflow">if</span> (!_ekf3_started) {</div>
<div class="line"><a id="l02247" name="l02247"></a><span class="lineno"> 2247</span>            <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#afaedff8102d9ae2fbc398d2099e30cf6">snprintf</a>(failure_msg, failure_msg_len, <span class="stringliteral">&quot;EKF3 not started&quot;</span>);</div>
<div class="line"><a id="l02248" name="l02248"></a><span class="lineno"> 2248</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02249" name="l02249"></a><span class="lineno"> 2249</span>        }</div>
<div class="line"><a id="l02250" name="l02250"></a><span class="lineno"> 2250</span>        <span class="keywordflow">return</span> EKF3.pre_arm_check(requires_position, failure_msg, failure_msg_len) &amp;&amp; ret;</div>
<div class="line"><a id="l02251" name="l02251"></a><span class="lineno"> 2251</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02252" name="l02252"></a><span class="lineno"> 2252</span>    }</div>
<div class="line"><a id="l02253" name="l02253"></a><span class="lineno"> 2253</span> </div>
<div class="line"><a id="l02254" name="l02254"></a><span class="lineno"> 2254</span>    <span class="comment">// if we get here then ekf type is invalid</span></div>
<div class="line"><a id="l02255" name="l02255"></a><span class="lineno"> 2255</span>    <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#afaedff8102d9ae2fbc398d2099e30cf6">snprintf</a>(failure_msg, failure_msg_len, <span class="stringliteral">&quot;invalid EKF type&quot;</span>);</div>
<div class="line"><a id="l02256" name="l02256"></a><span class="lineno"> 2256</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02257" name="l02257"></a><span class="lineno"> 2257</span>}</div>
</div>
<div class="line"><a id="l02258" name="l02258"></a><span class="lineno"> 2258</span> </div>
<div class="line"><a id="l02259" name="l02259"></a><span class="lineno"> 2259</span><span class="comment">// true if the AHRS has completed initialisation</span></div>
<div class="foldopen" id="foldopen02260" data-start="{" data-end="}">
<div class="line"><a id="l02260" name="l02260"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a0521758dfddac16581d3a9bf06f0c701"> 2260</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a0521758dfddac16581d3a9bf06f0c701">AP_AHRS::initialised</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l02261" name="l02261"></a><span class="lineno"> 2261</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02262" name="l02262"></a><span class="lineno"> 2262</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>()) {</div>
<div class="line"><a id="l02263" name="l02263"></a><span class="lineno"> 2263</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02264" name="l02264"></a><span class="lineno"> 2264</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02265" name="l02265"></a><span class="lineno"> 2265</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02266" name="l02266"></a><span class="lineno"> 2266</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02267" name="l02267"></a><span class="lineno"> 2267</span> </div>
<div class="line"><a id="l02268" name="l02268"></a><span class="lineno"> 2268</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02269" name="l02269"></a><span class="lineno"> 2269</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02270" name="l02270"></a><span class="lineno"> 2270</span>        <span class="comment">// initialisation complete 10sec after ekf has started</span></div>
<div class="line"><a id="l02271" name="l02271"></a><span class="lineno"> 2271</span>        <span class="keywordflow">return</span> (_ekf2_started &amp;&amp; (<a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>() - <a class="code hl_variable" href="classAP__AHRS.html#aabe74303db6c3bada267e646efb1e32c">start_time_ms</a> &gt; <a class="code hl_define" href="AP__AHRS_8h.html#a6823ea32ab0d0ecff53a677bd68c6a5e">AP_AHRS_NAVEKF_SETTLE_TIME_MS</a>));</div>
<div class="line"><a id="l02272" name="l02272"></a><span class="lineno"> 2272</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02273" name="l02273"></a><span class="lineno"> 2273</span> </div>
<div class="line"><a id="l02274" name="l02274"></a><span class="lineno"> 2274</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02275" name="l02275"></a><span class="lineno"> 2275</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02276" name="l02276"></a><span class="lineno"> 2276</span>        <span class="comment">// initialisation complete 10sec after ekf has started</span></div>
<div class="line"><a id="l02277" name="l02277"></a><span class="lineno"> 2277</span>        <span class="keywordflow">return</span> (_ekf3_started &amp;&amp; (<a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>() - <a class="code hl_variable" href="classAP__AHRS.html#aabe74303db6c3bada267e646efb1e32c">start_time_ms</a> &gt; <a class="code hl_define" href="AP__AHRS_8h.html#a6823ea32ab0d0ecff53a677bd68c6a5e">AP_AHRS_NAVEKF_SETTLE_TIME_MS</a>));</div>
<div class="line"><a id="l02278" name="l02278"></a><span class="lineno"> 2278</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02279" name="l02279"></a><span class="lineno"> 2279</span> </div>
<div class="line"><a id="l02280" name="l02280"></a><span class="lineno"> 2280</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02281" name="l02281"></a><span class="lineno"> 2281</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02282" name="l02282"></a><span class="lineno"> 2282</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02283" name="l02283"></a><span class="lineno"> 2283</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02284" name="l02284"></a><span class="lineno"> 2284</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02285" name="l02285"></a><span class="lineno"> 2285</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02286" name="l02286"></a><span class="lineno"> 2286</span>        <span class="keywordflow">return</span> external.initialised();</div>
<div class="line"><a id="l02287" name="l02287"></a><span class="lineno"> 2287</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02288" name="l02288"></a><span class="lineno"> 2288</span>    }</div>
<div class="line"><a id="l02289" name="l02289"></a><span class="lineno"> 2289</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02290" name="l02290"></a><span class="lineno"> 2290</span>};</div>
</div>
<div class="line"><a id="l02291" name="l02291"></a><span class="lineno"> 2291</span> </div>
<div class="line"><a id="l02292" name="l02292"></a><span class="lineno"> 2292</span><span class="comment">// get_filter_status : returns filter status as a series of flags</span></div>
<div class="foldopen" id="foldopen02293" data-start="{" data-end="}">
<div class="line"><a id="l02293" name="l02293"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a263904852f9b6e65cf7a082e5d999131"> 2293</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a263904852f9b6e65cf7a082e5d999131">AP_AHRS::get_filter_status</a>(<a class="code hl_union" href="unionnav__filter__status.html">nav_filter_status</a> &amp;<a class="code hl_variable" href="routing_8cpp.html#acdef7b92239f1e607ef6caa33a16d2ed">status</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l02294" name="l02294"></a><span class="lineno"> 2294</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02295" name="l02295"></a><span class="lineno"> 2295</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>()) {</div>
<div class="line"><a id="l02296" name="l02296"></a><span class="lineno"> 2296</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02297" name="l02297"></a><span class="lineno"> 2297</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02298" name="l02298"></a><span class="lineno"> 2298</span>        <span class="keywordflow">return</span> dcm.get_filter_status(<a class="code hl_variable" href="routing_8cpp.html#acdef7b92239f1e607ef6caa33a16d2ed">status</a>);</div>
<div class="line"><a id="l02299" name="l02299"></a><span class="lineno"> 2299</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02300" name="l02300"></a><span class="lineno"> 2300</span> </div>
<div class="line"><a id="l02301" name="l02301"></a><span class="lineno"> 2301</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02302" name="l02302"></a><span class="lineno"> 2302</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02303" name="l02303"></a><span class="lineno"> 2303</span>        EKF2.getFilterStatus(<a class="code hl_variable" href="routing_8cpp.html#acdef7b92239f1e607ef6caa33a16d2ed">status</a>);</div>
<div class="line"><a id="l02304" name="l02304"></a><span class="lineno"> 2304</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02305" name="l02305"></a><span class="lineno"> 2305</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02306" name="l02306"></a><span class="lineno"> 2306</span> </div>
<div class="line"><a id="l02307" name="l02307"></a><span class="lineno"> 2307</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02308" name="l02308"></a><span class="lineno"> 2308</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02309" name="l02309"></a><span class="lineno"> 2309</span>        EKF3.getFilterStatus(<a class="code hl_variable" href="routing_8cpp.html#acdef7b92239f1e607ef6caa33a16d2ed">status</a>);</div>
<div class="line"><a id="l02310" name="l02310"></a><span class="lineno"> 2310</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02311" name="l02311"></a><span class="lineno"> 2311</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02312" name="l02312"></a><span class="lineno"> 2312</span> </div>
<div class="line"><a id="l02313" name="l02313"></a><span class="lineno"> 2313</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02314" name="l02314"></a><span class="lineno"> 2314</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02315" name="l02315"></a><span class="lineno"> 2315</span>        <span class="keywordflow">return</span> sim.get_filter_status(<a class="code hl_variable" href="routing_8cpp.html#acdef7b92239f1e607ef6caa33a16d2ed">status</a>);</div>
<div class="line"><a id="l02316" name="l02316"></a><span class="lineno"> 2316</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02317" name="l02317"></a><span class="lineno"> 2317</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02318" name="l02318"></a><span class="lineno"> 2318</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02319" name="l02319"></a><span class="lineno"> 2319</span>        <span class="keywordflow">return</span> external.get_filter_status(<a class="code hl_variable" href="routing_8cpp.html#acdef7b92239f1e607ef6caa33a16d2ed">status</a>);</div>
<div class="line"><a id="l02320" name="l02320"></a><span class="lineno"> 2320</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02321" name="l02321"></a><span class="lineno"> 2321</span>    }</div>
<div class="line"><a id="l02322" name="l02322"></a><span class="lineno"> 2322</span> </div>
<div class="line"><a id="l02323" name="l02323"></a><span class="lineno"> 2323</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02324" name="l02324"></a><span class="lineno"> 2324</span>}</div>
</div>
<div class="line"><a id="l02325" name="l02325"></a><span class="lineno"> 2325</span> </div>
<div class="line"><a id="l02326" name="l02326"></a><span class="lineno"> 2326</span><span class="comment">// write optical flow data to EKF</span></div>
<div class="foldopen" id="foldopen02327" data-start="{" data-end="}">
<div class="line"><a id="l02327" name="l02327"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#adaeee04859fd72a1861e83c7454f329a"> 2327</a></span><span class="keywordtype">void</span>  <a class="code hl_function" href="classAP__AHRS.html#adaeee04859fd72a1861e83c7454f329a">AP_AHRS::writeOptFlowMeas</a>(<span class="keyword">const</span> uint8_t rawFlowQuality, <span class="keyword">const</span> <a class="code hl_class" href="structVector2.html">Vector2f</a> &amp;rawFlowRates, <span class="keyword">const</span> <a class="code hl_class" href="structVector2.html">Vector2f</a> &amp;rawGyroRates, <span class="keyword">const</span> uint32_t msecFlowMeas, <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;posOffset, <span class="keywordtype">float</span> heightOverride)</div>
<div class="line"><a id="l02328" name="l02328"></a><span class="lineno"> 2328</span>{</div>
<div class="line"><a id="l02329" name="l02329"></a><span class="lineno"> 2329</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02330" name="l02330"></a><span class="lineno"> 2330</span>    EKF2.writeOptFlowMeas(rawFlowQuality, rawFlowRates, rawGyroRates, msecFlowMeas, posOffset, heightOverride);</div>
<div class="line"><a id="l02331" name="l02331"></a><span class="lineno"> 2331</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02332" name="l02332"></a><span class="lineno"> 2332</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02333" name="l02333"></a><span class="lineno"> 2333</span>    EKF3.writeOptFlowMeas(rawFlowQuality, rawFlowRates, rawGyroRates, msecFlowMeas, posOffset, heightOverride);</div>
<div class="line"><a id="l02334" name="l02334"></a><span class="lineno"> 2334</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02335" name="l02335"></a><span class="lineno"> 2335</span>}</div>
</div>
<div class="line"><a id="l02336" name="l02336"></a><span class="lineno"> 2336</span> </div>
<div class="line"><a id="l02337" name="l02337"></a><span class="lineno"> 2337</span><span class="comment">// retrieve latest corrected optical flow samples (used for calibration)</span></div>
<div class="foldopen" id="foldopen02338" data-start="{" data-end="}">
<div class="line"><a id="l02338" name="l02338"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#abef128fdecddf058cdaf2560b264655e"> 2338</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#abef128fdecddf058cdaf2560b264655e">AP_AHRS::getOptFlowSample</a>(uint32_t&amp; timeStamp_ms, <a class="code hl_class" href="structVector2.html">Vector2f</a>&amp; flowRate, <a class="code hl_class" href="structVector2.html">Vector2f</a>&amp; bodyRate, <a class="code hl_class" href="structVector2.html">Vector2f</a>&amp; losPred)<span class="keyword"> const</span></div>
<div class="line"><a id="l02339" name="l02339"></a><span class="lineno"> 2339</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02340" name="l02340"></a><span class="lineno"> 2340</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02341" name="l02341"></a><span class="lineno"> 2341</span>    <span class="keywordflow">return</span> EKF3.getOptFlowSample(timeStamp_ms, flowRate, bodyRate, losPred);</div>
<div class="line"><a id="l02342" name="l02342"></a><span class="lineno"> 2342</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02343" name="l02343"></a><span class="lineno"> 2343</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02344" name="l02344"></a><span class="lineno"> 2344</span>}</div>
</div>
<div class="line"><a id="l02345" name="l02345"></a><span class="lineno"> 2345</span> </div>
<div class="line"><a id="l02346" name="l02346"></a><span class="lineno"> 2346</span><span class="comment">// write body frame odometry measurements to the EKF</span></div>
<div class="foldopen" id="foldopen02347" data-start="{" data-end="}">
<div class="line"><a id="l02347" name="l02347"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a5605d0a2903d9a204e28f414dba85483"> 2347</a></span><span class="keywordtype">void</span>  <a class="code hl_function" href="classAP__AHRS.html#a5605d0a2903d9a204e28f414dba85483">AP_AHRS::writeBodyFrameOdom</a>(<span class="keywordtype">float</span> quality, <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;delPos, <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;delAng, <span class="keywordtype">float</span> delTime, uint32_t timeStamp_ms, uint16_t <a class="code hl_function" href="RCProtocolTest_8cpp.html#ab59cbd9523fdc9601bf57f555a9f8733">delay_ms</a>, <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;posOffset)</div>
<div class="line"><a id="l02348" name="l02348"></a><span class="lineno"> 2348</span>{</div>
<div class="line"><a id="l02349" name="l02349"></a><span class="lineno"> 2349</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02350" name="l02350"></a><span class="lineno"> 2350</span>    EKF3.writeBodyFrameOdom(quality, delPos, delAng, delTime, timeStamp_ms, <a class="code hl_function" href="RCProtocolTest_8cpp.html#ab59cbd9523fdc9601bf57f555a9f8733">delay_ms</a>, posOffset);</div>
<div class="line"><a id="l02351" name="l02351"></a><span class="lineno"> 2351</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02352" name="l02352"></a><span class="lineno"> 2352</span>}</div>
</div>
<div class="line"><a id="l02353" name="l02353"></a><span class="lineno"> 2353</span> </div>
<div class="line"><a id="l02354" name="l02354"></a><span class="lineno"> 2354</span><span class="comment">// Write position and quaternion data from an external navigation system</span></div>
<div class="foldopen" id="foldopen02355" data-start="{" data-end="}">
<div class="line"><a id="l02355" name="l02355"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a48a5ce86f909df35944d9b988a19e148"> 2355</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a48a5ce86f909df35944d9b988a19e148">AP_AHRS::writeExtNavData</a>(<span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;pos, <span class="keyword">const</span> <a class="code hl_class" href="classQuaternionT.html">Quaternion</a> &amp;quat, <span class="keywordtype">float</span> posErr, <span class="keywordtype">float</span> angErr, uint32_t timeStamp_ms, uint16_t <a class="code hl_function" href="RCProtocolTest_8cpp.html#ab59cbd9523fdc9601bf57f555a9f8733">delay_ms</a>, uint32_t resetTime_ms)</div>
<div class="line"><a id="l02356" name="l02356"></a><span class="lineno"> 2356</span>{</div>
<div class="line"><a id="l02357" name="l02357"></a><span class="lineno"> 2357</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02358" name="l02358"></a><span class="lineno"> 2358</span>    EKF2.writeExtNavData(pos, <a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a>, posErr, angErr, timeStamp_ms, <a class="code hl_function" href="RCProtocolTest_8cpp.html#ab59cbd9523fdc9601bf57f555a9f8733">delay_ms</a>, resetTime_ms);</div>
<div class="line"><a id="l02359" name="l02359"></a><span class="lineno"> 2359</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02360" name="l02360"></a><span class="lineno"> 2360</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02361" name="l02361"></a><span class="lineno"> 2361</span>    EKF3.writeExtNavData(pos, <a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a>, posErr, angErr, timeStamp_ms, <a class="code hl_function" href="RCProtocolTest_8cpp.html#ab59cbd9523fdc9601bf57f555a9f8733">delay_ms</a>, resetTime_ms);</div>
<div class="line"><a id="l02362" name="l02362"></a><span class="lineno"> 2362</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02363" name="l02363"></a><span class="lineno"> 2363</span>}</div>
</div>
<div class="line"><a id="l02364" name="l02364"></a><span class="lineno"> 2364</span> </div>
<div class="line"><a id="l02365" name="l02365"></a><span class="lineno"> 2365</span><span class="comment">// Writes the default equivalent airspeed and 1-sigma uncertainty in m/s to be used in forward flight if a measured airspeed is required and not available.</span></div>
<div class="foldopen" id="foldopen02366" data-start="{" data-end="}">
<div class="line"><a id="l02366" name="l02366"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a6004cf143cc0cad241c0c59747637933"> 2366</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a6004cf143cc0cad241c0c59747637933">AP_AHRS::writeDefaultAirSpeed</a>(<span class="keywordtype">float</span> <a class="code hl_variable" href="Airspeed_8cpp.html#abfed87a61c42e885ee14d5222b47583f">airspeed</a>, <span class="keywordtype">float</span> uncertainty)</div>
<div class="line"><a id="l02367" name="l02367"></a><span class="lineno"> 2367</span>{</div>
<div class="line"><a id="l02368" name="l02368"></a><span class="lineno"> 2368</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02369" name="l02369"></a><span class="lineno"> 2369</span>    EKF2.writeDefaultAirSpeed(<a class="code hl_variable" href="classAP__AHRS.html#acb4b144fc2fd1352fe991c44707f5b4e">airspeed</a>);</div>
<div class="line"><a id="l02370" name="l02370"></a><span class="lineno"> 2370</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02371" name="l02371"></a><span class="lineno"> 2371</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02372" name="l02372"></a><span class="lineno"> 2372</span>    EKF3.writeDefaultAirSpeed(<a class="code hl_variable" href="classAP__AHRS.html#acb4b144fc2fd1352fe991c44707f5b4e">airspeed</a>, uncertainty);</div>
<div class="line"><a id="l02373" name="l02373"></a><span class="lineno"> 2373</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02374" name="l02374"></a><span class="lineno"> 2374</span>}</div>
</div>
<div class="line"><a id="l02375" name="l02375"></a><span class="lineno"> 2375</span> </div>
<div class="line"><a id="l02376" name="l02376"></a><span class="lineno"> 2376</span><span class="comment">// Write velocity data from an external navigation system</span></div>
<div class="foldopen" id="foldopen02377" data-start="{" data-end="}">
<div class="line"><a id="l02377" name="l02377"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#ae4d1b8dea7e8e7b798ebf37fbd301af1"> 2377</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#ae4d1b8dea7e8e7b798ebf37fbd301af1">AP_AHRS::writeExtNavVelData</a>(<span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;vel, <span class="keywordtype">float</span> err, uint32_t timeStamp_ms, uint16_t <a class="code hl_function" href="RCProtocolTest_8cpp.html#ab59cbd9523fdc9601bf57f555a9f8733">delay_ms</a>)</div>
<div class="line"><a id="l02378" name="l02378"></a><span class="lineno"> 2378</span>{</div>
<div class="line"><a id="l02379" name="l02379"></a><span class="lineno"> 2379</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02380" name="l02380"></a><span class="lineno"> 2380</span>    EKF2.writeExtNavVelData(vel, err, timeStamp_ms, <a class="code hl_function" href="RCProtocolTest_8cpp.html#ab59cbd9523fdc9601bf57f555a9f8733">delay_ms</a>);</div>
<div class="line"><a id="l02381" name="l02381"></a><span class="lineno"> 2381</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02382" name="l02382"></a><span class="lineno"> 2382</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02383" name="l02383"></a><span class="lineno"> 2383</span>    EKF3.writeExtNavVelData(vel, err, timeStamp_ms, <a class="code hl_function" href="RCProtocolTest_8cpp.html#ab59cbd9523fdc9601bf57f555a9f8733">delay_ms</a>);</div>
<div class="line"><a id="l02384" name="l02384"></a><span class="lineno"> 2384</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02385" name="l02385"></a><span class="lineno"> 2385</span>}</div>
</div>
<div class="line"><a id="l02386" name="l02386"></a><span class="lineno"> 2386</span> </div>
<div class="line"><a id="l02387" name="l02387"></a><span class="lineno"> 2387</span><span class="comment">// get speed limit and XY navigation gain scale factor</span></div>
<div class="foldopen" id="foldopen02388" data-start="{" data-end="}">
<div class="line"><a id="l02388" name="l02388"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#af8515c37f9bf88f09d16babfa2fc900e"> 2388</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#af8515c37f9bf88f09d16babfa2fc900e">AP_AHRS::getControlLimits</a>(<span class="keywordtype">float</span> &amp;ekfGndSpdLimit, <span class="keywordtype">float</span> &amp;ekfNavVelGainScaler)<span class="keyword"> const</span></div>
<div class="line"><a id="l02389" name="l02389"></a><span class="lineno"> 2389</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02390" name="l02390"></a><span class="lineno"> 2390</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l02391" name="l02391"></a><span class="lineno"> 2391</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02392" name="l02392"></a><span class="lineno"> 2392</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02393" name="l02393"></a><span class="lineno"> 2393</span>        dcm.get_control_limits(ekfGndSpdLimit, ekfNavVelGainScaler);</div>
<div class="line"><a id="l02394" name="l02394"></a><span class="lineno"> 2394</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02395" name="l02395"></a><span class="lineno"> 2395</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02396" name="l02396"></a><span class="lineno"> 2396</span> </div>
<div class="line"><a id="l02397" name="l02397"></a><span class="lineno"> 2397</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02398" name="l02398"></a><span class="lineno"> 2398</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02399" name="l02399"></a><span class="lineno"> 2399</span>        EKF2.getEkfControlLimits(ekfGndSpdLimit,ekfNavVelGainScaler);</div>
<div class="line"><a id="l02400" name="l02400"></a><span class="lineno"> 2400</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02401" name="l02401"></a><span class="lineno"> 2401</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02402" name="l02402"></a><span class="lineno"> 2402</span> </div>
<div class="line"><a id="l02403" name="l02403"></a><span class="lineno"> 2403</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02404" name="l02404"></a><span class="lineno"> 2404</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02405" name="l02405"></a><span class="lineno"> 2405</span>        EKF3.getEkfControlLimits(ekfGndSpdLimit,ekfNavVelGainScaler);</div>
<div class="line"><a id="l02406" name="l02406"></a><span class="lineno"> 2406</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02407" name="l02407"></a><span class="lineno"> 2407</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02408" name="l02408"></a><span class="lineno"> 2408</span> </div>
<div class="line"><a id="l02409" name="l02409"></a><span class="lineno"> 2409</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02410" name="l02410"></a><span class="lineno"> 2410</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02411" name="l02411"></a><span class="lineno"> 2411</span>        sim.get_control_limits(ekfGndSpdLimit, ekfNavVelGainScaler);</div>
<div class="line"><a id="l02412" name="l02412"></a><span class="lineno"> 2412</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02413" name="l02413"></a><span class="lineno"> 2413</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02414" name="l02414"></a><span class="lineno"> 2414</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02415" name="l02415"></a><span class="lineno"> 2415</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02416" name="l02416"></a><span class="lineno"> 2416</span>        <span class="comment">// no limit on gains, large vel limit</span></div>
<div class="line"><a id="l02417" name="l02417"></a><span class="lineno"> 2417</span>        ekfGndSpdLimit = 400;</div>
<div class="line"><a id="l02418" name="l02418"></a><span class="lineno"> 2418</span>        ekfNavVelGainScaler = 1;</div>
<div class="line"><a id="l02419" name="l02419"></a><span class="lineno"> 2419</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02420" name="l02420"></a><span class="lineno"> 2420</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02421" name="l02421"></a><span class="lineno"> 2421</span>    }</div>
<div class="line"><a id="l02422" name="l02422"></a><span class="lineno"> 2422</span>}</div>
</div>
<div class="line"><a id="l02423" name="l02423"></a><span class="lineno"> 2423</span> </div>
<div class="line"><a id="l02424" name="l02424"></a><span class="lineno"> 2424</span><span class="comment">/*</span></div>
<div class="line"><a id="l02425" name="l02425"></a><span class="lineno"> 2425</span><span class="comment">  get gain factor for Z controllers</span></div>
<div class="line"><a id="l02426" name="l02426"></a><span class="lineno"> 2426</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen02427" data-start="{" data-end="}">
<div class="line"><a id="l02427" name="l02427"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a1e7a62d8dd479383855c8d40b4fd5240"> 2427</a></span><span class="keywordtype">float</span> <a class="code hl_function" href="classAP__AHRS.html#a1e7a62d8dd479383855c8d40b4fd5240">AP_AHRS::getControlScaleZ</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l02428" name="l02428"></a><span class="lineno"> 2428</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02429" name="l02429"></a><span class="lineno"> 2429</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02430" name="l02430"></a><span class="lineno"> 2430</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>() == EKFType::DCM) {</div>
<div class="line"><a id="l02431" name="l02431"></a><span class="lineno"> 2431</span>        <span class="comment">// when flying on DCM lower gains by 4x to cope with the high</span></div>
<div class="line"><a id="l02432" name="l02432"></a><span class="lineno"> 2432</span>        <span class="comment">// lag</span></div>
<div class="line"><a id="l02433" name="l02433"></a><span class="lineno"> 2433</span>        <span class="keywordflow">return</span> 0.25;</div>
<div class="line"><a id="l02434" name="l02434"></a><span class="lineno"> 2434</span>    }</div>
<div class="line"><a id="l02435" name="l02435"></a><span class="lineno"> 2435</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02436" name="l02436"></a><span class="lineno"> 2436</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><a id="l02437" name="l02437"></a><span class="lineno"> 2437</span>}</div>
</div>
<div class="line"><a id="l02438" name="l02438"></a><span class="lineno"> 2438</span> </div>
<div class="line"><a id="l02439" name="l02439"></a><span class="lineno"> 2439</span><span class="comment">// get compass offset estimates</span></div>
<div class="line"><a id="l02440" name="l02440"></a><span class="lineno"> 2440</span><span class="comment">// true if offsets are valid</span></div>
<div class="foldopen" id="foldopen02441" data-start="{" data-end="}">
<div class="line"><a id="l02441" name="l02441"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#ae72547709c34129713bb197d1c41a322"> 2441</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#ae72547709c34129713bb197d1c41a322">AP_AHRS::getMagOffsets</a>(uint8_t mag_idx, <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;magOffsets)<span class="keyword"> const</span></div>
<div class="line"><a id="l02442" name="l02442"></a><span class="lineno"> 2442</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02443" name="l02443"></a><span class="lineno"> 2443</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>()) {</div>
<div class="line"><a id="l02444" name="l02444"></a><span class="lineno"> 2444</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02445" name="l02445"></a><span class="lineno"> 2445</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02446" name="l02446"></a><span class="lineno"> 2446</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02447" name="l02447"></a><span class="lineno"> 2447</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02448" name="l02448"></a><span class="lineno"> 2448</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02449" name="l02449"></a><span class="lineno"> 2449</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02450" name="l02450"></a><span class="lineno"> 2450</span>        <span class="keywordflow">return</span> EKF2.getMagOffsets(mag_idx, magOffsets);</div>
<div class="line"><a id="l02451" name="l02451"></a><span class="lineno"> 2451</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02452" name="l02452"></a><span class="lineno"> 2452</span> </div>
<div class="line"><a id="l02453" name="l02453"></a><span class="lineno"> 2453</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02454" name="l02454"></a><span class="lineno"> 2454</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02455" name="l02455"></a><span class="lineno"> 2455</span>        <span class="keywordflow">return</span> EKF3.getMagOffsets(mag_idx, magOffsets);</div>
<div class="line"><a id="l02456" name="l02456"></a><span class="lineno"> 2456</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02457" name="l02457"></a><span class="lineno"> 2457</span> </div>
<div class="line"><a id="l02458" name="l02458"></a><span class="lineno"> 2458</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02459" name="l02459"></a><span class="lineno"> 2459</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02460" name="l02460"></a><span class="lineno"> 2460</span>        <span class="keywordflow">return</span> sim.get_mag_offsets(mag_idx, magOffsets);</div>
<div class="line"><a id="l02461" name="l02461"></a><span class="lineno"> 2461</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02462" name="l02462"></a><span class="lineno"> 2462</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02463" name="l02463"></a><span class="lineno"> 2463</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02464" name="l02464"></a><span class="lineno"> 2464</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02465" name="l02465"></a><span class="lineno"> 2465</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02466" name="l02466"></a><span class="lineno"> 2466</span>    }</div>
<div class="line"><a id="l02467" name="l02467"></a><span class="lineno"> 2467</span>    <span class="comment">// since there is no default case above, this is unreachable</span></div>
<div class="line"><a id="l02468" name="l02468"></a><span class="lineno"> 2468</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02469" name="l02469"></a><span class="lineno"> 2469</span>}</div>
</div>
<div class="line"><a id="l02470" name="l02470"></a><span class="lineno"> 2470</span> </div>
<div class="line"><a id="l02471" name="l02471"></a><span class="lineno"> 2471</span><span class="comment">// Retrieves the NED delta velocity corrected</span></div>
<div class="foldopen" id="foldopen02472" data-start="{" data-end="}">
<div class="line"><a id="l02472" name="l02472"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#ac5cf80db6af4db115d495605fd3254f3"> 2472</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#ac5cf80db6af4db115d495605fd3254f3">AP_AHRS::_getCorrectedDeltaVelocityNED</a>(<a class="code hl_class" href="classVector3.html">Vector3f</a>&amp; ret, <span class="keywordtype">float</span>&amp; dt)<span class="keyword"> const</span></div>
<div class="line"><a id="l02473" name="l02473"></a><span class="lineno"> 2473</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02474" name="l02474"></a><span class="lineno"> 2474</span>    int8_t imu_idx = -1;</div>
<div class="line"><a id="l02475" name="l02475"></a><span class="lineno"> 2475</span>    <a class="code hl_class" href="classVector3.html">Vector3f</a> <a class="code hl_variable" href="classAP__AHRS.html#a7a0bc2e33f18a2e0e352242bb4f9776e">accel_bias</a>;</div>
<div class="line"><a id="l02476" name="l02476"></a><span class="lineno"> 2476</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l02477" name="l02477"></a><span class="lineno"> 2477</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02478" name="l02478"></a><span class="lineno"> 2478</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02479" name="l02479"></a><span class="lineno"> 2479</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02480" name="l02480"></a><span class="lineno"> 2480</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02481" name="l02481"></a><span class="lineno"> 2481</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02482" name="l02482"></a><span class="lineno"> 2482</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02483" name="l02483"></a><span class="lineno"> 2483</span>        imu_idx = EKF2.getPrimaryCoreIMUIndex();</div>
<div class="line"><a id="l02484" name="l02484"></a><span class="lineno"> 2484</span>        EKF2.getAccelZBias(<a class="code hl_variable" href="classAP__AHRS.html#a7a0bc2e33f18a2e0e352242bb4f9776e">accel_bias</a>.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>);</div>
<div class="line"><a id="l02485" name="l02485"></a><span class="lineno"> 2485</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02486" name="l02486"></a><span class="lineno"> 2486</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02487" name="l02487"></a><span class="lineno"> 2487</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02488" name="l02488"></a><span class="lineno"> 2488</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02489" name="l02489"></a><span class="lineno"> 2489</span>        imu_idx = EKF3.getPrimaryCoreIMUIndex();</div>
<div class="line"><a id="l02490" name="l02490"></a><span class="lineno"> 2490</span>        EKF3.getAccelBias(-1,<a class="code hl_variable" href="classAP__AHRS.html#a7a0bc2e33f18a2e0e352242bb4f9776e">accel_bias</a>);</div>
<div class="line"><a id="l02491" name="l02491"></a><span class="lineno"> 2491</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02492" name="l02492"></a><span class="lineno"> 2492</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02493" name="l02493"></a><span class="lineno"> 2493</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02494" name="l02494"></a><span class="lineno"> 2494</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02495" name="l02495"></a><span class="lineno"> 2495</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02496" name="l02496"></a><span class="lineno"> 2496</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02497" name="l02497"></a><span class="lineno"> 2497</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02498" name="l02498"></a><span class="lineno"> 2498</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02499" name="l02499"></a><span class="lineno"> 2499</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02500" name="l02500"></a><span class="lineno"> 2500</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02501" name="l02501"></a><span class="lineno"> 2501</span>    }</div>
<div class="line"><a id="l02502" name="l02502"></a><span class="lineno"> 2502</span>    ret.<a class="code hl_function" href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">zero</a>();</div>
<div class="line"><a id="l02503" name="l02503"></a><span class="lineno"> 2503</span>    <span class="keywordflow">if</span> (imu_idx == -1) {</div>
<div class="line"><a id="l02504" name="l02504"></a><span class="lineno"> 2504</span>        <a class="code hl_function" href="namespaceAP.html#ac571aa5a2ef71b7f4b4b2bfa09143fb9">AP::ins</a>().<a class="code hl_function" href="classAP__InertialSensor.html#a57476eae6e626d247b297076a4926300">get_delta_velocity</a>(ret, dt);</div>
<div class="line"><a id="l02505" name="l02505"></a><span class="lineno"> 2505</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02506" name="l02506"></a><span class="lineno"> 2506</span>    }</div>
<div class="line"><a id="l02507" name="l02507"></a><span class="lineno"> 2507</span>    <a class="code hl_function" href="namespaceAP.html#ac571aa5a2ef71b7f4b4b2bfa09143fb9">AP::ins</a>().<a class="code hl_function" href="classAP__InertialSensor.html#a57476eae6e626d247b297076a4926300">get_delta_velocity</a>((uint8_t)imu_idx, ret, dt);</div>
<div class="line"><a id="l02508" name="l02508"></a><span class="lineno"> 2508</span>    ret -= <a class="code hl_variable" href="classAP__AHRS.html#a7a0bc2e33f18a2e0e352242bb4f9776e">accel_bias</a>*dt;</div>
<div class="line"><a id="l02509" name="l02509"></a><span class="lineno"> 2509</span>    ret = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.dcm_matrix * <a class="code hl_function" href="classAP__AHRS.html#aad11f5ece3c65e8f15ec46f7f7eb6ce3">get_rotation_autopilot_body_to_vehicle_body</a>() * ret;</div>
<div class="line"><a id="l02510" name="l02510"></a><span class="lineno"> 2510</span>    ret.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> += <a class="code hl_define" href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a>*dt;</div>
<div class="line"><a id="l02511" name="l02511"></a><span class="lineno"> 2511</span>}</div>
</div>
<div class="line"><a id="l02512" name="l02512"></a><span class="lineno"> 2512</span> </div>
<div class="foldopen" id="foldopen02513" data-start="{" data-end="}">
<div class="line"><a id="l02513" name="l02513"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a7216e2b7b02f86d522fac87e36644668"> 2513</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a7216e2b7b02f86d522fac87e36644668">AP_AHRS::set_failure_inconsistent_message</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *estimator, <span class="keyword">const</span> <span class="keywordtype">char</span> *axis, <span class="keywordtype">float</span> diff_rad, <span class="keywordtype">char</span> *failure_msg, <span class="keyword">const</span> uint8_t failure_msg_len)<span class="keyword"> const</span></div>
<div class="line"><a id="l02514" name="l02514"></a><span class="lineno"> 2514</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02515" name="l02515"></a><span class="lineno"> 2515</span>    <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#afaedff8102d9ae2fbc398d2099e30cf6">snprintf</a>(failure_msg, failure_msg_len, <span class="stringliteral">&quot;%s %s inconsistent %d deg. Wait or reboot&quot;</span>, estimator, axis, (<span class="keywordtype">int</span>)<a class="code hl_define" href="moduletest_8c.html#a903c4797a4c2860e3b9a6a978f98a44d">degrees</a>(diff_rad));</div>
<div class="line"><a id="l02516" name="l02516"></a><span class="lineno"> 2516</span>}</div>
</div>
<div class="line"><a id="l02517" name="l02517"></a><span class="lineno"> 2517</span> </div>
<div class="line"><a id="l02518" name="l02518"></a><span class="lineno"> 2518</span><span class="comment">// check all cores providing consistent attitudes for prearm checks</span></div>
<div class="foldopen" id="foldopen02519" data-start="{" data-end="}">
<div class="line"><a id="l02519" name="l02519"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a676a8a732b2159d1da9683eb556309f9"> 2519</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a676a8a732b2159d1da9683eb556309f9">AP_AHRS::attitudes_consistent</a>(<span class="keywordtype">char</span> *failure_msg, <span class="keyword">const</span> uint8_t failure_msg_len)<span class="keyword"> const</span></div>
<div class="line"><a id="l02520" name="l02520"></a><span class="lineno"> 2520</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02521" name="l02521"></a><span class="lineno"> 2521</span>    <span class="comment">// get primary attitude source&#39;s attitude as quaternion</span></div>
<div class="line"><a id="l02522" name="l02522"></a><span class="lineno"> 2522</span>    <a class="code hl_class" href="classQuaternionT.html">Quaternion</a> primary_quat;</div>
<div class="line"><a id="l02523" name="l02523"></a><span class="lineno"> 2523</span>    <a class="code hl_function" href="classAP__AHRS.html#a643071d85841345dc40f0da8b1ecd1c8">get_quat_body_to_ned</a>(primary_quat);</div>
<div class="line"><a id="l02524" name="l02524"></a><span class="lineno"> 2524</span>    <span class="comment">// only check yaw if compasses are being used</span></div>
<div class="line"><a id="l02525" name="l02525"></a><span class="lineno"> 2525</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> check_yaw = <a class="code hl_function" href="namespaceAP.html#ab9d0bcbec954b6c20abd8e13e6de7356">AP::compass</a>().<a class="code hl_function" href="classCompass.html#af5c3da7e49f681c1d7a0354b91eba7ba">use_for_yaw</a>();</div>
<div class="line"><a id="l02526" name="l02526"></a><span class="lineno"> 2526</span>    uint8_t total_ekf_cores = 0;</div>
<div class="line"><a id="l02527" name="l02527"></a><span class="lineno"> 2527</span> </div>
<div class="line"><a id="l02528" name="l02528"></a><span class="lineno"> 2528</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02529" name="l02529"></a><span class="lineno"> 2529</span>    <span class="comment">// check primary vs ekf2</span></div>
<div class="line"><a id="l02530" name="l02530"></a><span class="lineno"> 2530</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>() == EKFType::TWO || <a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>() == EKFType::TWO) {</div>
<div class="line"><a id="l02531" name="l02531"></a><span class="lineno"> 2531</span>        <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; EKF2.activeCores(); i++) {</div>
<div class="line"><a id="l02532" name="l02532"></a><span class="lineno"> 2532</span>            <a class="code hl_class" href="classQuaternionT.html">Quaternion</a> ekf2_quat;</div>
<div class="line"><a id="l02533" name="l02533"></a><span class="lineno"> 2533</span>            EKF2.getQuaternionBodyToNED(i, ekf2_quat);</div>
<div class="line"><a id="l02534" name="l02534"></a><span class="lineno"> 2534</span> </div>
<div class="line"><a id="l02535" name="l02535"></a><span class="lineno"> 2535</span>            <span class="comment">// check roll and pitch difference</span></div>
<div class="line"><a id="l02536" name="l02536"></a><span class="lineno"> 2536</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> rp_diff_rad = primary_quat.<a class="code hl_function" href="classQuaternionT.html#a56428cf7fd5c2ce7286b053757f42399">roll_pitch_difference</a>(ekf2_quat);</div>
<div class="line"><a id="l02537" name="l02537"></a><span class="lineno"> 2537</span>            <span class="keywordflow">if</span> (rp_diff_rad &gt; <a class="code hl_define" href="AP__AHRS_8cpp.html#aa001f83eac61ed153d8ecf8252ce23cd">ATTITUDE_CHECK_THRESH_ROLL_PITCH_RAD</a>) {</div>
<div class="line"><a id="l02538" name="l02538"></a><span class="lineno"> 2538</span>                <a class="code hl_function" href="classAP__AHRS.html#a7216e2b7b02f86d522fac87e36644668">set_failure_inconsistent_message</a>(<span class="stringliteral">&quot;EKF2&quot;</span>, <span class="stringliteral">&quot;Roll/Pitch&quot;</span>, rp_diff_rad, failure_msg, failure_msg_len);</div>
<div class="line"><a id="l02539" name="l02539"></a><span class="lineno"> 2539</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02540" name="l02540"></a><span class="lineno"> 2540</span>            }</div>
<div class="line"><a id="l02541" name="l02541"></a><span class="lineno"> 2541</span> </div>
<div class="line"><a id="l02542" name="l02542"></a><span class="lineno"> 2542</span>            <span class="comment">// check yaw difference</span></div>
<div class="line"><a id="l02543" name="l02543"></a><span class="lineno"> 2543</span>            <a class="code hl_class" href="classVector3.html">Vector3f</a> angle_diff;</div>
<div class="line"><a id="l02544" name="l02544"></a><span class="lineno"> 2544</span>            primary_quat.<a class="code hl_function" href="classQuaternionT.html#a175174e39e43141a74e597eadfbeb477">angular_difference</a>(ekf2_quat).<a class="code hl_function" href="classQuaternionT.html#a9f7af9ef07753ba4247f9e707c0a9cec">to_axis_angle</a>(angle_diff);</div>
<div class="line"><a id="l02545" name="l02545"></a><span class="lineno"> 2545</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> yaw_diff = fabsf(angle_diff.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>);</div>
<div class="line"><a id="l02546" name="l02546"></a><span class="lineno"> 2546</span>            <span class="keywordflow">if</span> (check_yaw &amp;&amp; (yaw_diff &gt; <a class="code hl_define" href="AP__AHRS_8cpp.html#add3f02562dfbb7df7d4bd29444d9897e">ATTITUDE_CHECK_THRESH_YAW_RAD</a>)) {</div>
<div class="line"><a id="l02547" name="l02547"></a><span class="lineno"> 2547</span>                <a class="code hl_function" href="classAP__AHRS.html#a7216e2b7b02f86d522fac87e36644668">set_failure_inconsistent_message</a>(<span class="stringliteral">&quot;EKF2&quot;</span>, <span class="stringliteral">&quot;Yaw&quot;</span>, yaw_diff, failure_msg, failure_msg_len);</div>
<div class="line"><a id="l02548" name="l02548"></a><span class="lineno"> 2548</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02549" name="l02549"></a><span class="lineno"> 2549</span>            }</div>
<div class="line"><a id="l02550" name="l02550"></a><span class="lineno"> 2550</span>        }</div>
<div class="line"><a id="l02551" name="l02551"></a><span class="lineno"> 2551</span>        total_ekf_cores = EKF2.activeCores();</div>
<div class="line"><a id="l02552" name="l02552"></a><span class="lineno"> 2552</span>    }</div>
<div class="line"><a id="l02553" name="l02553"></a><span class="lineno"> 2553</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02554" name="l02554"></a><span class="lineno"> 2554</span> </div>
<div class="line"><a id="l02555" name="l02555"></a><span class="lineno"> 2555</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02556" name="l02556"></a><span class="lineno"> 2556</span>    <span class="comment">// check primary vs ekf3</span></div>
<div class="line"><a id="l02557" name="l02557"></a><span class="lineno"> 2557</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>() == EKFType::THREE || <a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>() == EKFType::THREE) {</div>
<div class="line"><a id="l02558" name="l02558"></a><span class="lineno"> 2558</span>        <span class="keywordflow">for</span> (uint8_t i = 0; i &lt; EKF3.activeCores(); i++) {</div>
<div class="line"><a id="l02559" name="l02559"></a><span class="lineno"> 2559</span>            <a class="code hl_class" href="classQuaternionT.html">Quaternion</a> ekf3_quat;</div>
<div class="line"><a id="l02560" name="l02560"></a><span class="lineno"> 2560</span>            EKF3.getQuaternionBodyToNED(i, ekf3_quat);</div>
<div class="line"><a id="l02561" name="l02561"></a><span class="lineno"> 2561</span> </div>
<div class="line"><a id="l02562" name="l02562"></a><span class="lineno"> 2562</span>            <span class="comment">// check roll and pitch difference</span></div>
<div class="line"><a id="l02563" name="l02563"></a><span class="lineno"> 2563</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> rp_diff_rad = primary_quat.<a class="code hl_function" href="classQuaternionT.html#a56428cf7fd5c2ce7286b053757f42399">roll_pitch_difference</a>(ekf3_quat);</div>
<div class="line"><a id="l02564" name="l02564"></a><span class="lineno"> 2564</span>            <span class="keywordflow">if</span> (rp_diff_rad &gt; <a class="code hl_define" href="AP__AHRS_8cpp.html#aa001f83eac61ed153d8ecf8252ce23cd">ATTITUDE_CHECK_THRESH_ROLL_PITCH_RAD</a>) {</div>
<div class="line"><a id="l02565" name="l02565"></a><span class="lineno"> 2565</span>                <a class="code hl_function" href="classAP__AHRS.html#a7216e2b7b02f86d522fac87e36644668">set_failure_inconsistent_message</a>(<span class="stringliteral">&quot;EKF3&quot;</span>, <span class="stringliteral">&quot;Roll/Pitch&quot;</span>, rp_diff_rad, failure_msg, failure_msg_len);</div>
<div class="line"><a id="l02566" name="l02566"></a><span class="lineno"> 2566</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02567" name="l02567"></a><span class="lineno"> 2567</span>            }</div>
<div class="line"><a id="l02568" name="l02568"></a><span class="lineno"> 2568</span> </div>
<div class="line"><a id="l02569" name="l02569"></a><span class="lineno"> 2569</span>            <span class="comment">// check yaw difference</span></div>
<div class="line"><a id="l02570" name="l02570"></a><span class="lineno"> 2570</span>            <a class="code hl_class" href="classVector3.html">Vector3f</a> angle_diff;</div>
<div class="line"><a id="l02571" name="l02571"></a><span class="lineno"> 2571</span>            primary_quat.<a class="code hl_function" href="classQuaternionT.html#a175174e39e43141a74e597eadfbeb477">angular_difference</a>(ekf3_quat).<a class="code hl_function" href="classQuaternionT.html#a9f7af9ef07753ba4247f9e707c0a9cec">to_axis_angle</a>(angle_diff);</div>
<div class="line"><a id="l02572" name="l02572"></a><span class="lineno"> 2572</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> yaw_diff = fabsf(angle_diff.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>);</div>
<div class="line"><a id="l02573" name="l02573"></a><span class="lineno"> 2573</span>            <span class="keywordflow">if</span> (check_yaw &amp;&amp; (yaw_diff &gt; <a class="code hl_define" href="AP__AHRS_8cpp.html#add3f02562dfbb7df7d4bd29444d9897e">ATTITUDE_CHECK_THRESH_YAW_RAD</a>)) {</div>
<div class="line"><a id="l02574" name="l02574"></a><span class="lineno"> 2574</span>                <a class="code hl_function" href="classAP__AHRS.html#a7216e2b7b02f86d522fac87e36644668">set_failure_inconsistent_message</a>(<span class="stringliteral">&quot;EKF3&quot;</span>, <span class="stringliteral">&quot;Yaw&quot;</span>, yaw_diff, failure_msg, failure_msg_len);</div>
<div class="line"><a id="l02575" name="l02575"></a><span class="lineno"> 2575</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02576" name="l02576"></a><span class="lineno"> 2576</span>            }</div>
<div class="line"><a id="l02577" name="l02577"></a><span class="lineno"> 2577</span>        }</div>
<div class="line"><a id="l02578" name="l02578"></a><span class="lineno"> 2578</span>        total_ekf_cores += EKF3.activeCores();</div>
<div class="line"><a id="l02579" name="l02579"></a><span class="lineno"> 2579</span>    }</div>
<div class="line"><a id="l02580" name="l02580"></a><span class="lineno"> 2580</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02581" name="l02581"></a><span class="lineno"> 2581</span> </div>
<div class="line"><a id="l02582" name="l02582"></a><span class="lineno"> 2582</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02583" name="l02583"></a><span class="lineno"> 2583</span>    <span class="comment">// check primary vs dcm</span></div>
<div class="line"><a id="l02584" name="l02584"></a><span class="lineno"> 2584</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__AHRS.html#ab6e2d39bc4cee69c6532549694d694cd">always_use_EKF</a>() || (total_ekf_cores == 1)) {</div>
<div class="line"><a id="l02585" name="l02585"></a><span class="lineno"> 2585</span>        <a class="code hl_class" href="classQuaternionT.html">Quaternion</a> dcm_quat;</div>
<div class="line"><a id="l02586" name="l02586"></a><span class="lineno"> 2586</span>        dcm_quat.<a class="code hl_function" href="classQuaternionT.html#ab12c50ad4b582277deda302ff9109adf">from_rotation_matrix</a>(get_DCM_rotation_body_to_ned());</div>
<div class="line"><a id="l02587" name="l02587"></a><span class="lineno"> 2587</span> </div>
<div class="line"><a id="l02588" name="l02588"></a><span class="lineno"> 2588</span>        <span class="comment">// check roll and pitch difference</span></div>
<div class="line"><a id="l02589" name="l02589"></a><span class="lineno"> 2589</span>        <span class="keyword">const</span> <span class="keywordtype">float</span> rp_diff_rad = primary_quat.<a class="code hl_function" href="classQuaternionT.html#a56428cf7fd5c2ce7286b053757f42399">roll_pitch_difference</a>(dcm_quat);</div>
<div class="line"><a id="l02590" name="l02590"></a><span class="lineno"> 2590</span>        <span class="keywordflow">if</span> (rp_diff_rad &gt; <a class="code hl_define" href="AP__AHRS_8cpp.html#aa001f83eac61ed153d8ecf8252ce23cd">ATTITUDE_CHECK_THRESH_ROLL_PITCH_RAD</a>) {</div>
<div class="line"><a id="l02591" name="l02591"></a><span class="lineno"> 2591</span>            <a class="code hl_function" href="classAP__AHRS.html#a7216e2b7b02f86d522fac87e36644668">set_failure_inconsistent_message</a>(<span class="stringliteral">&quot;DCM&quot;</span>, <span class="stringliteral">&quot;Roll/Pitch&quot;</span>, rp_diff_rad, failure_msg, failure_msg_len);</div>
<div class="line"><a id="l02592" name="l02592"></a><span class="lineno"> 2592</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02593" name="l02593"></a><span class="lineno"> 2593</span>        }</div>
<div class="line"><a id="l02594" name="l02594"></a><span class="lineno"> 2594</span> </div>
<div class="line"><a id="l02595" name="l02595"></a><span class="lineno"> 2595</span>        <span class="comment">// Check vs DCM yaw if this vehicle could use DCM in flight</span></div>
<div class="line"><a id="l02596" name="l02596"></a><span class="lineno"> 2596</span>        <span class="comment">// and if not using an external yaw source (DCM does not support external yaw sources)</span></div>
<div class="line"><a id="l02597" name="l02597"></a><span class="lineno"> 2597</span>        <span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a1e37984ecd2c5ea0bea46e0879fc25ad">using_noncompass_for_yaw</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l02598" name="l02598"></a><span class="lineno"> 2598</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02599" name="l02599"></a><span class="lineno"> 2599</span>        <a class="code hl_function" href="classAP__AHRS.html#a1e37984ecd2c5ea0bea46e0879fc25ad">using_noncompass_for_yaw</a> = (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>() == EKFType::THREE) &amp;&amp; EKF3.using_noncompass_for_yaw();</div>
<div class="line"><a id="l02600" name="l02600"></a><span class="lineno"> 2600</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02601" name="l02601"></a><span class="lineno"> 2601</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__AHRS.html#ab6e2d39bc4cee69c6532549694d694cd">always_use_EKF</a>() &amp;&amp; !<a class="code hl_function" href="classAP__AHRS.html#a1e37984ecd2c5ea0bea46e0879fc25ad">using_noncompass_for_yaw</a>) {</div>
<div class="line"><a id="l02602" name="l02602"></a><span class="lineno"> 2602</span>            <a class="code hl_class" href="classVector3.html">Vector3f</a> angle_diff;</div>
<div class="line"><a id="l02603" name="l02603"></a><span class="lineno"> 2603</span>            primary_quat.<a class="code hl_function" href="classQuaternionT.html#a175174e39e43141a74e597eadfbeb477">angular_difference</a>(dcm_quat).<a class="code hl_function" href="classQuaternionT.html#a9f7af9ef07753ba4247f9e707c0a9cec">to_axis_angle</a>(angle_diff);</div>
<div class="line"><a id="l02604" name="l02604"></a><span class="lineno"> 2604</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> yaw_diff = fabsf(angle_diff.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>);</div>
<div class="line"><a id="l02605" name="l02605"></a><span class="lineno"> 2605</span>            <span class="keywordflow">if</span> (check_yaw &amp;&amp; (yaw_diff &gt; <a class="code hl_define" href="AP__AHRS_8cpp.html#add3f02562dfbb7df7d4bd29444d9897e">ATTITUDE_CHECK_THRESH_YAW_RAD</a>)) {</div>
<div class="line"><a id="l02606" name="l02606"></a><span class="lineno"> 2606</span>                <a class="code hl_function" href="classAP__AHRS.html#a7216e2b7b02f86d522fac87e36644668">set_failure_inconsistent_message</a>(<span class="stringliteral">&quot;DCM&quot;</span>, <span class="stringliteral">&quot;Yaw&quot;</span>, yaw_diff, failure_msg, failure_msg_len);</div>
<div class="line"><a id="l02607" name="l02607"></a><span class="lineno"> 2607</span>                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02608" name="l02608"></a><span class="lineno"> 2608</span>            }</div>
<div class="line"><a id="l02609" name="l02609"></a><span class="lineno"> 2609</span>        }</div>
<div class="line"><a id="l02610" name="l02610"></a><span class="lineno"> 2610</span>    }</div>
<div class="line"><a id="l02611" name="l02611"></a><span class="lineno"> 2611</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02612" name="l02612"></a><span class="lineno"> 2612</span> </div>
<div class="line"><a id="l02613" name="l02613"></a><span class="lineno"> 2613</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02614" name="l02614"></a><span class="lineno"> 2614</span>}</div>
</div>
<div class="line"><a id="l02615" name="l02615"></a><span class="lineno"> 2615</span> </div>
<div class="line"><a id="l02616" name="l02616"></a><span class="lineno"> 2616</span><span class="comment">// return the amount of yaw angle change due to the last yaw angle reset in radians</span></div>
<div class="line"><a id="l02617" name="l02617"></a><span class="lineno"> 2617</span><span class="comment">// returns the time of the last yaw angle reset or 0 if no reset has ever occurred</span></div>
<div class="foldopen" id="foldopen02618" data-start="{" data-end="}">
<div class="line"><a id="l02618" name="l02618"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a42ca24f998f0f6537dcc9d09258f3615"> 2618</a></span>uint32_t <a class="code hl_function" href="classAP__AHRS.html#a42ca24f998f0f6537dcc9d09258f3615">AP_AHRS::getLastYawResetAngle</a>(<span class="keywordtype">float</span> &amp;yawAng)</div>
<div class="line"><a id="l02619" name="l02619"></a><span class="lineno"> 2619</span>{</div>
<div class="line"><a id="l02620" name="l02620"></a><span class="lineno"> 2620</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l02621" name="l02621"></a><span class="lineno"> 2621</span> </div>
<div class="line"><a id="l02622" name="l02622"></a><span class="lineno"> 2622</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02623" name="l02623"></a><span class="lineno"> 2623</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02624" name="l02624"></a><span class="lineno"> 2624</span>        <span class="keywordflow">return</span> dcm.getLastYawResetAngle(yawAng);</div>
<div class="line"><a id="l02625" name="l02625"></a><span class="lineno"> 2625</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02626" name="l02626"></a><span class="lineno"> 2626</span> </div>
<div class="line"><a id="l02627" name="l02627"></a><span class="lineno"> 2627</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02628" name="l02628"></a><span class="lineno"> 2628</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02629" name="l02629"></a><span class="lineno"> 2629</span>        <span class="keywordflow">return</span> EKF2.getLastYawResetAngle(yawAng);</div>
<div class="line"><a id="l02630" name="l02630"></a><span class="lineno"> 2630</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02631" name="l02631"></a><span class="lineno"> 2631</span> </div>
<div class="line"><a id="l02632" name="l02632"></a><span class="lineno"> 2632</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02633" name="l02633"></a><span class="lineno"> 2633</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02634" name="l02634"></a><span class="lineno"> 2634</span>        <span class="keywordflow">return</span> EKF3.getLastYawResetAngle(yawAng);</div>
<div class="line"><a id="l02635" name="l02635"></a><span class="lineno"> 2635</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02636" name="l02636"></a><span class="lineno"> 2636</span> </div>
<div class="line"><a id="l02637" name="l02637"></a><span class="lineno"> 2637</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02638" name="l02638"></a><span class="lineno"> 2638</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02639" name="l02639"></a><span class="lineno"> 2639</span>        <span class="keywordflow">return</span> sim.getLastYawResetAngle(yawAng);</div>
<div class="line"><a id="l02640" name="l02640"></a><span class="lineno"> 2640</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02641" name="l02641"></a><span class="lineno"> 2641</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02642" name="l02642"></a><span class="lineno"> 2642</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02643" name="l02643"></a><span class="lineno"> 2643</span>        <span class="keywordflow">return</span> external.getLastYawResetAngle(yawAng);</div>
<div class="line"><a id="l02644" name="l02644"></a><span class="lineno"> 2644</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02645" name="l02645"></a><span class="lineno"> 2645</span>    }</div>
<div class="line"><a id="l02646" name="l02646"></a><span class="lineno"> 2646</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02647" name="l02647"></a><span class="lineno"> 2647</span>}</div>
</div>
<div class="line"><a id="l02648" name="l02648"></a><span class="lineno"> 2648</span> </div>
<div class="line"><a id="l02649" name="l02649"></a><span class="lineno"> 2649</span><span class="comment">// return the amount of NE position change in metres due to the last reset</span></div>
<div class="line"><a id="l02650" name="l02650"></a><span class="lineno"> 2650</span><span class="comment">// returns the time of the last reset or 0 if no reset has ever occurred</span></div>
<div class="foldopen" id="foldopen02651" data-start="{" data-end="}">
<div class="line"><a id="l02651" name="l02651"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a83be0822de0a592e217220c8c0102b5b"> 2651</a></span>uint32_t <a class="code hl_function" href="classAP__AHRS.html#a83be0822de0a592e217220c8c0102b5b">AP_AHRS::getLastPosNorthEastReset</a>(<a class="code hl_class" href="structVector2.html">Vector2f</a> &amp;pos)</div>
<div class="line"><a id="l02652" name="l02652"></a><span class="lineno"> 2652</span>{</div>
<div class="line"><a id="l02653" name="l02653"></a><span class="lineno"> 2653</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l02654" name="l02654"></a><span class="lineno"> 2654</span> </div>
<div class="line"><a id="l02655" name="l02655"></a><span class="lineno"> 2655</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02656" name="l02656"></a><span class="lineno"> 2656</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02657" name="l02657"></a><span class="lineno"> 2657</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02658" name="l02658"></a><span class="lineno"> 2658</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02659" name="l02659"></a><span class="lineno"> 2659</span> </div>
<div class="line"><a id="l02660" name="l02660"></a><span class="lineno"> 2660</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02661" name="l02661"></a><span class="lineno"> 2661</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02662" name="l02662"></a><span class="lineno"> 2662</span>        <span class="keywordflow">return</span> EKF2.getLastPosNorthEastReset(pos);</div>
<div class="line"><a id="l02663" name="l02663"></a><span class="lineno"> 2663</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02664" name="l02664"></a><span class="lineno"> 2664</span> </div>
<div class="line"><a id="l02665" name="l02665"></a><span class="lineno"> 2665</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02666" name="l02666"></a><span class="lineno"> 2666</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02667" name="l02667"></a><span class="lineno"> 2667</span>        <span class="keywordflow">return</span> EKF3.getLastPosNorthEastReset(pos);</div>
<div class="line"><a id="l02668" name="l02668"></a><span class="lineno"> 2668</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02669" name="l02669"></a><span class="lineno"> 2669</span> </div>
<div class="line"><a id="l02670" name="l02670"></a><span class="lineno"> 2670</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02671" name="l02671"></a><span class="lineno"> 2671</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02672" name="l02672"></a><span class="lineno"> 2672</span>        <span class="keywordflow">return</span> sim.getLastPosNorthEastReset(pos);</div>
<div class="line"><a id="l02673" name="l02673"></a><span class="lineno"> 2673</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02674" name="l02674"></a><span class="lineno"> 2674</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02675" name="l02675"></a><span class="lineno"> 2675</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02676" name="l02676"></a><span class="lineno"> 2676</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02677" name="l02677"></a><span class="lineno"> 2677</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02678" name="l02678"></a><span class="lineno"> 2678</span>    }</div>
<div class="line"><a id="l02679" name="l02679"></a><span class="lineno"> 2679</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02680" name="l02680"></a><span class="lineno"> 2680</span>}</div>
</div>
<div class="line"><a id="l02681" name="l02681"></a><span class="lineno"> 2681</span> </div>
<div class="line"><a id="l02682" name="l02682"></a><span class="lineno"> 2682</span><span class="comment">// return the amount of NE velocity change in metres/sec due to the last reset</span></div>
<div class="line"><a id="l02683" name="l02683"></a><span class="lineno"> 2683</span><span class="comment">// returns the time of the last reset or 0 if no reset has ever occurred</span></div>
<div class="foldopen" id="foldopen02684" data-start="{" data-end="}">
<div class="line"><a id="l02684" name="l02684"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a25b32d10d2878bbe0d90cd5abf43577c"> 2684</a></span>uint32_t <a class="code hl_function" href="classAP__AHRS.html#a25b32d10d2878bbe0d90cd5abf43577c">AP_AHRS::getLastVelNorthEastReset</a>(<a class="code hl_class" href="structVector2.html">Vector2f</a> &amp;vel)<span class="keyword"> const</span></div>
<div class="line"><a id="l02685" name="l02685"></a><span class="lineno"> 2685</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02686" name="l02686"></a><span class="lineno"> 2686</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l02687" name="l02687"></a><span class="lineno"> 2687</span> </div>
<div class="line"><a id="l02688" name="l02688"></a><span class="lineno"> 2688</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02689" name="l02689"></a><span class="lineno"> 2689</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02690" name="l02690"></a><span class="lineno"> 2690</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02691" name="l02691"></a><span class="lineno"> 2691</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02692" name="l02692"></a><span class="lineno"> 2692</span> </div>
<div class="line"><a id="l02693" name="l02693"></a><span class="lineno"> 2693</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02694" name="l02694"></a><span class="lineno"> 2694</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02695" name="l02695"></a><span class="lineno"> 2695</span>        <span class="keywordflow">return</span> EKF2.getLastVelNorthEastReset(vel);</div>
<div class="line"><a id="l02696" name="l02696"></a><span class="lineno"> 2696</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02697" name="l02697"></a><span class="lineno"> 2697</span> </div>
<div class="line"><a id="l02698" name="l02698"></a><span class="lineno"> 2698</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02699" name="l02699"></a><span class="lineno"> 2699</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02700" name="l02700"></a><span class="lineno"> 2700</span>        <span class="keywordflow">return</span> EKF3.getLastVelNorthEastReset(vel);</div>
<div class="line"><a id="l02701" name="l02701"></a><span class="lineno"> 2701</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02702" name="l02702"></a><span class="lineno"> 2702</span> </div>
<div class="line"><a id="l02703" name="l02703"></a><span class="lineno"> 2703</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02704" name="l02704"></a><span class="lineno"> 2704</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02705" name="l02705"></a><span class="lineno"> 2705</span>        <span class="keywordflow">return</span> sim.getLastVelNorthEastReset(vel);</div>
<div class="line"><a id="l02706" name="l02706"></a><span class="lineno"> 2706</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02707" name="l02707"></a><span class="lineno"> 2707</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02708" name="l02708"></a><span class="lineno"> 2708</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02709" name="l02709"></a><span class="lineno"> 2709</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02710" name="l02710"></a><span class="lineno"> 2710</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02711" name="l02711"></a><span class="lineno"> 2711</span>    }</div>
<div class="line"><a id="l02712" name="l02712"></a><span class="lineno"> 2712</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02713" name="l02713"></a><span class="lineno"> 2713</span>}</div>
</div>
<div class="line"><a id="l02714" name="l02714"></a><span class="lineno"> 2714</span> </div>
<div class="line"><a id="l02715" name="l02715"></a><span class="lineno"> 2715</span> </div>
<div class="line"><a id="l02716" name="l02716"></a><span class="lineno"> 2716</span><span class="comment">// return the amount of vertical position change due to the last reset in meters</span></div>
<div class="line"><a id="l02717" name="l02717"></a><span class="lineno"> 2717</span><span class="comment">// returns the time of the last reset or 0 if no reset has ever occurred</span></div>
<div class="foldopen" id="foldopen02718" data-start="{" data-end="}">
<div class="line"><a id="l02718" name="l02718"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#abce04780653c748a98fb52f6bee72e83"> 2718</a></span>uint32_t <a class="code hl_function" href="classAP__AHRS.html#abce04780653c748a98fb52f6bee72e83">AP_AHRS::getLastPosDownReset</a>(<span class="keywordtype">float</span> &amp;posDelta)</div>
<div class="line"><a id="l02719" name="l02719"></a><span class="lineno"> 2719</span>{</div>
<div class="line"><a id="l02720" name="l02720"></a><span class="lineno"> 2720</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l02721" name="l02721"></a><span class="lineno"> 2721</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02722" name="l02722"></a><span class="lineno"> 2722</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02723" name="l02723"></a><span class="lineno"> 2723</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02724" name="l02724"></a><span class="lineno"> 2724</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02725" name="l02725"></a><span class="lineno"> 2725</span> </div>
<div class="line"><a id="l02726" name="l02726"></a><span class="lineno"> 2726</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02727" name="l02727"></a><span class="lineno"> 2727</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02728" name="l02728"></a><span class="lineno"> 2728</span>        <span class="keywordflow">return</span> EKF2.getLastPosDownReset(posDelta);</div>
<div class="line"><a id="l02729" name="l02729"></a><span class="lineno"> 2729</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02730" name="l02730"></a><span class="lineno"> 2730</span> </div>
<div class="line"><a id="l02731" name="l02731"></a><span class="lineno"> 2731</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02732" name="l02732"></a><span class="lineno"> 2732</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02733" name="l02733"></a><span class="lineno"> 2733</span>        <span class="keywordflow">return</span> EKF3.getLastPosDownReset(posDelta);</div>
<div class="line"><a id="l02734" name="l02734"></a><span class="lineno"> 2734</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02735" name="l02735"></a><span class="lineno"> 2735</span> </div>
<div class="line"><a id="l02736" name="l02736"></a><span class="lineno"> 2736</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02737" name="l02737"></a><span class="lineno"> 2737</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02738" name="l02738"></a><span class="lineno"> 2738</span>        <span class="keywordflow">return</span> sim.getLastPosDownReset(posDelta);</div>
<div class="line"><a id="l02739" name="l02739"></a><span class="lineno"> 2739</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02740" name="l02740"></a><span class="lineno"> 2740</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02741" name="l02741"></a><span class="lineno"> 2741</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02742" name="l02742"></a><span class="lineno"> 2742</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02743" name="l02743"></a><span class="lineno"> 2743</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02744" name="l02744"></a><span class="lineno"> 2744</span>    }</div>
<div class="line"><a id="l02745" name="l02745"></a><span class="lineno"> 2745</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l02746" name="l02746"></a><span class="lineno"> 2746</span>}</div>
</div>
<div class="line"><a id="l02747" name="l02747"></a><span class="lineno"> 2747</span> </div>
<div class="line"><a id="l02748" name="l02748"></a><span class="lineno"> 2748</span><span class="comment">// Resets the baro so that it reads zero at the current height</span></div>
<div class="line"><a id="l02749" name="l02749"></a><span class="lineno"> 2749</span><span class="comment">// Resets the EKF height to zero</span></div>
<div class="line"><a id="l02750" name="l02750"></a><span class="lineno"> 2750</span><span class="comment">// Adjusts the EKf origin height so that the EKF height + origin height is the same as before</span></div>
<div class="line"><a id="l02751" name="l02751"></a><span class="lineno"> 2751</span><span class="comment">// Returns true if the height datum reset has been performed</span></div>
<div class="line"><a id="l02752" name="l02752"></a><span class="lineno"> 2752</span><span class="comment">// If using a range finder for height no reset is performed and it returns false</span></div>
<div class="foldopen" id="foldopen02753" data-start="{" data-end="}">
<div class="line"><a id="l02753" name="l02753"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a8714e59e0b78c781ac5bbee21e22abb8"> 2753</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a8714e59e0b78c781ac5bbee21e22abb8">AP_AHRS::resetHeightDatum</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l02754" name="l02754"></a><span class="lineno"> 2754</span>{</div>
<div class="line"><a id="l02755" name="l02755"></a><span class="lineno"> 2755</span>    <span class="comment">// support locked access functions to AHRS data</span></div>
<div class="line"><a id="l02756" name="l02756"></a><span class="lineno"> 2756</span>    <a class="code hl_define" href="AP__HAL_2Semaphores_8h.html#a819dd9ac6de800cdf1014b0a922b67d4">WITH_SEMAPHORE</a>(<a class="code hl_variable" href="classAP__AHRS.html#a38d0378ea83c46d1edb53fb6f578beaf">_rsem</a>);</div>
<div class="line"><a id="l02757" name="l02757"></a><span class="lineno"> 2757</span>    </div>
<div class="line"><a id="l02758" name="l02758"></a><span class="lineno"> 2758</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>()) {</div>
<div class="line"><a id="l02759" name="l02759"></a><span class="lineno"> 2759</span> </div>
<div class="line"><a id="l02760" name="l02760"></a><span class="lineno"> 2760</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02761" name="l02761"></a><span class="lineno"> 2761</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02762" name="l02762"></a><span class="lineno"> 2762</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02763" name="l02763"></a><span class="lineno"> 2763</span>        EKF3.resetHeightDatum();</div>
<div class="line"><a id="l02764" name="l02764"></a><span class="lineno"> 2764</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02765" name="l02765"></a><span class="lineno"> 2765</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02766" name="l02766"></a><span class="lineno"> 2766</span>        EKF2.resetHeightDatum();</div>
<div class="line"><a id="l02767" name="l02767"></a><span class="lineno"> 2767</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02768" name="l02768"></a><span class="lineno"> 2768</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02769" name="l02769"></a><span class="lineno"> 2769</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02770" name="l02770"></a><span class="lineno"> 2770</span> </div>
<div class="line"><a id="l02771" name="l02771"></a><span class="lineno"> 2771</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02772" name="l02772"></a><span class="lineno"> 2772</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02773" name="l02773"></a><span class="lineno"> 2773</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02774" name="l02774"></a><span class="lineno"> 2774</span>        EKF3.resetHeightDatum();</div>
<div class="line"><a id="l02775" name="l02775"></a><span class="lineno"> 2775</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02776" name="l02776"></a><span class="lineno"> 2776</span>        <span class="keywordflow">return</span> EKF2.resetHeightDatum();</div>
<div class="line"><a id="l02777" name="l02777"></a><span class="lineno"> 2777</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02778" name="l02778"></a><span class="lineno"> 2778</span> </div>
<div class="line"><a id="l02779" name="l02779"></a><span class="lineno"> 2779</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02780" name="l02780"></a><span class="lineno"> 2780</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02781" name="l02781"></a><span class="lineno"> 2781</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02782" name="l02782"></a><span class="lineno"> 2782</span>        EKF2.resetHeightDatum();</div>
<div class="line"><a id="l02783" name="l02783"></a><span class="lineno"> 2783</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02784" name="l02784"></a><span class="lineno"> 2784</span>        <span class="keywordflow">return</span> EKF3.resetHeightDatum();</div>
<div class="line"><a id="l02785" name="l02785"></a><span class="lineno"> 2785</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02786" name="l02786"></a><span class="lineno"> 2786</span> </div>
<div class="line"><a id="l02787" name="l02787"></a><span class="lineno"> 2787</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02788" name="l02788"></a><span class="lineno"> 2788</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02789" name="l02789"></a><span class="lineno"> 2789</span>        <span class="keywordflow">return</span> sim.resetHeightDatum();</div>
<div class="line"><a id="l02790" name="l02790"></a><span class="lineno"> 2790</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02791" name="l02791"></a><span class="lineno"> 2791</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02792" name="l02792"></a><span class="lineno"> 2792</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02793" name="l02793"></a><span class="lineno"> 2793</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02794" name="l02794"></a><span class="lineno"> 2794</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02795" name="l02795"></a><span class="lineno"> 2795</span>    }</div>
<div class="line"><a id="l02796" name="l02796"></a><span class="lineno"> 2796</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02797" name="l02797"></a><span class="lineno"> 2797</span>}</div>
</div>
<div class="line"><a id="l02798" name="l02798"></a><span class="lineno"> 2798</span> </div>
<div class="line"><a id="l02799" name="l02799"></a><span class="lineno"> 2799</span><span class="comment">// send a EKF_STATUS_REPORT for configured EKF</span></div>
<div class="foldopen" id="foldopen02800" data-start="{" data-end="}">
<div class="line"><a id="l02800" name="l02800"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a02afc2efd90caf67806e50070b5eb214"> 2800</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a02afc2efd90caf67806e50070b5eb214">AP_AHRS::send_ekf_status_report</a>(<a class="code hl_class" href="classGCS__MAVLINK.html">GCS_MAVLINK</a> &amp;link)<span class="keyword"> const</span></div>
<div class="line"><a id="l02801" name="l02801"></a><span class="lineno"> 2801</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02802" name="l02802"></a><span class="lineno"> 2802</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>()) {</div>
<div class="line"><a id="l02803" name="l02803"></a><span class="lineno"> 2803</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02804" name="l02804"></a><span class="lineno"> 2804</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02805" name="l02805"></a><span class="lineno"> 2805</span>        <span class="comment">// send zero status report</span></div>
<div class="line"><a id="l02806" name="l02806"></a><span class="lineno"> 2806</span>        dcm.send_ekf_status_report(link);</div>
<div class="line"><a id="l02807" name="l02807"></a><span class="lineno"> 2807</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02808" name="l02808"></a><span class="lineno"> 2808</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02809" name="l02809"></a><span class="lineno"> 2809</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02810" name="l02810"></a><span class="lineno"> 2810</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02811" name="l02811"></a><span class="lineno"> 2811</span>        sim.send_ekf_status_report(link);</div>
<div class="line"><a id="l02812" name="l02812"></a><span class="lineno"> 2812</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02813" name="l02813"></a><span class="lineno"> 2813</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02814" name="l02814"></a><span class="lineno"> 2814</span> </div>
<div class="line"><a id="l02815" name="l02815"></a><span class="lineno"> 2815</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02816" name="l02816"></a><span class="lineno"> 2816</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL: {</div>
<div class="line"><a id="l02817" name="l02817"></a><span class="lineno"> 2817</span>        external.send_ekf_status_report(link);</div>
<div class="line"><a id="l02818" name="l02818"></a><span class="lineno"> 2818</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02819" name="l02819"></a><span class="lineno"> 2819</span>    }</div>
<div class="line"><a id="l02820" name="l02820"></a><span class="lineno"> 2820</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02821" name="l02821"></a><span class="lineno"> 2821</span> </div>
<div class="line"><a id="l02822" name="l02822"></a><span class="lineno"> 2822</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02823" name="l02823"></a><span class="lineno"> 2823</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02824" name="l02824"></a><span class="lineno"> 2824</span>        <span class="keywordflow">return</span> EKF2.send_status_report(link);</div>
<div class="line"><a id="l02825" name="l02825"></a><span class="lineno"> 2825</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02826" name="l02826"></a><span class="lineno"> 2826</span> </div>
<div class="line"><a id="l02827" name="l02827"></a><span class="lineno"> 2827</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02828" name="l02828"></a><span class="lineno"> 2828</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02829" name="l02829"></a><span class="lineno"> 2829</span>        <span class="keywordflow">return</span> EKF3.send_status_report(link);</div>
<div class="line"><a id="l02830" name="l02830"></a><span class="lineno"> 2830</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02831" name="l02831"></a><span class="lineno"> 2831</span> </div>
<div class="line"><a id="l02832" name="l02832"></a><span class="lineno"> 2832</span>    }</div>
<div class="line"><a id="l02833" name="l02833"></a><span class="lineno"> 2833</span>}</div>
</div>
<div class="line"><a id="l02834" name="l02834"></a><span class="lineno"> 2834</span> </div>
<div class="line"><a id="l02835" name="l02835"></a><span class="lineno"> 2835</span><span class="comment">// return origin for a specified EKF type</span></div>
<div class="foldopen" id="foldopen02836" data-start="{" data-end="}">
<div class="line"><a id="l02836" name="l02836"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#ad84e56e1f28f30315e618538d5c38a9a"> 2836</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#ace0f7b506770c77053e0c46fc6bf95f9">AP_AHRS::_get_origin</a>(<a class="code hl_enumeration" href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">EKFType</a> <a class="code hl_struct" href="structtype.html">type</a>, <a class="code hl_class" href="classLocation.html">Location</a> &amp;ret)<span class="keyword"> const</span></div>
<div class="line"><a id="l02837" name="l02837"></a><span class="lineno"> 2837</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02838" name="l02838"></a><span class="lineno"> 2838</span>    <span class="keywordflow">switch</span> (<a class="code hl_struct" href="structtype.html">type</a>) {</div>
<div class="line"><a id="l02839" name="l02839"></a><span class="lineno"> 2839</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02840" name="l02840"></a><span class="lineno"> 2840</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02841" name="l02841"></a><span class="lineno"> 2841</span>        <span class="keywordflow">return</span> dcm.get_origin(ret);</div>
<div class="line"><a id="l02842" name="l02842"></a><span class="lineno"> 2842</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02843" name="l02843"></a><span class="lineno"> 2843</span> </div>
<div class="line"><a id="l02844" name="l02844"></a><span class="lineno"> 2844</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02845" name="l02845"></a><span class="lineno"> 2845</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02846" name="l02846"></a><span class="lineno"> 2846</span>        <span class="keywordflow">return</span> EKF2.getOriginLLH(ret);</div>
<div class="line"><a id="l02847" name="l02847"></a><span class="lineno"> 2847</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02848" name="l02848"></a><span class="lineno"> 2848</span> </div>
<div class="line"><a id="l02849" name="l02849"></a><span class="lineno"> 2849</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02850" name="l02850"></a><span class="lineno"> 2850</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02851" name="l02851"></a><span class="lineno"> 2851</span>        <span class="keywordflow">return</span> EKF3.getOriginLLH(ret);</div>
<div class="line"><a id="l02852" name="l02852"></a><span class="lineno"> 2852</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02853" name="l02853"></a><span class="lineno"> 2853</span> </div>
<div class="line"><a id="l02854" name="l02854"></a><span class="lineno"> 2854</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02855" name="l02855"></a><span class="lineno"> 2855</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02856" name="l02856"></a><span class="lineno"> 2856</span>        <span class="keywordflow">return</span> sim.get_origin(ret);</div>
<div class="line"><a id="l02857" name="l02857"></a><span class="lineno"> 2857</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02858" name="l02858"></a><span class="lineno"> 2858</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02859" name="l02859"></a><span class="lineno"> 2859</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02860" name="l02860"></a><span class="lineno"> 2860</span>        <span class="keywordflow">return</span> external.get_origin(ret);</div>
<div class="line"><a id="l02861" name="l02861"></a><span class="lineno"> 2861</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02862" name="l02862"></a><span class="lineno"> 2862</span>    }</div>
<div class="line"><a id="l02863" name="l02863"></a><span class="lineno"> 2863</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02864" name="l02864"></a><span class="lineno"> 2864</span>}</div>
</div>
<div class="line"><a id="l02865" name="l02865"></a><span class="lineno"> 2865</span> </div>
<div class="line"><a id="l02866" name="l02866"></a><span class="lineno"> 2866</span><span class="comment">/*</span></div>
<div class="line"><a id="l02867" name="l02867"></a><span class="lineno"> 2867</span><span class="comment">  return origin for the configured EKF type. If we are armed and the</span></div>
<div class="line"><a id="l02868" name="l02868"></a><span class="lineno"> 2868</span><span class="comment">  configured EKF type cannot return an origin then return origin for</span></div>
<div class="line"><a id="l02869" name="l02869"></a><span class="lineno"> 2869</span><span class="comment">  the active EKF type (if available)</span></div>
<div class="line"><a id="l02870" name="l02870"></a><span class="lineno"> 2870</span><span class="comment"></span> </div>
<div class="line"><a id="l02871" name="l02871"></a><span class="lineno"> 2871</span><span class="comment">  This copes with users force arming a plane that is running on DCM as</span></div>
<div class="line"><a id="l02872" name="l02872"></a><span class="lineno"> 2872</span><span class="comment">  the EKF has not fully initialised</span></div>
<div class="line"><a id="l02873" name="l02873"></a><span class="lineno"> 2873</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen02874" data-start="{" data-end="}">
<div class="line"><a id="l02874" name="l02874"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#ace0f7b506770c77053e0c46fc6bf95f9"> 2874</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#ace0f7b506770c77053e0c46fc6bf95f9">AP_AHRS::_get_origin</a>(<a class="code hl_class" href="classLocation.html">Location</a> &amp;ret)<span class="keyword"> const</span></div>
<div class="line"><a id="l02875" name="l02875"></a><span class="lineno"> 2875</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02876" name="l02876"></a><span class="lineno"> 2876</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__AHRS.html#ace0f7b506770c77053e0c46fc6bf95f9">_get_origin</a>(<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>(), ret)) {</div>
<div class="line"><a id="l02877" name="l02877"></a><span class="lineno"> 2877</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02878" name="l02878"></a><span class="lineno"> 2878</span>    }</div>
<div class="line"><a id="l02879" name="l02879"></a><span class="lineno"> 2879</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">get_soft_armed</a>() &amp;&amp; <a class="code hl_function" href="classAP__AHRS.html#ace0f7b506770c77053e0c46fc6bf95f9">_get_origin</a>(<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>(), ret)) {</div>
<div class="line"><a id="l02880" name="l02880"></a><span class="lineno"> 2880</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02881" name="l02881"></a><span class="lineno"> 2881</span>    }</div>
<div class="line"><a id="l02882" name="l02882"></a><span class="lineno"> 2882</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02883" name="l02883"></a><span class="lineno"> 2883</span>}</div>
</div>
<div class="line"><a id="l02884" name="l02884"></a><span class="lineno"> 2884</span> </div>
<div class="foldopen" id="foldopen02885" data-start="{" data-end="}">
<div class="line"><a id="l02885" name="l02885"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#acc0e5d3d137fa70154f2d3769b0c6a09"> 2885</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#acc0e5d3d137fa70154f2d3769b0c6a09">AP_AHRS::set_home</a>(<span class="keyword">const</span> <a class="code hl_class" href="classLocation.html">Location</a> &amp;loc)</div>
<div class="line"><a id="l02886" name="l02886"></a><span class="lineno"> 2886</span>{</div>
<div class="line"><a id="l02887" name="l02887"></a><span class="lineno"> 2887</span>    <a class="code hl_define" href="AP__HAL_2Semaphores_8h.html#a819dd9ac6de800cdf1014b0a922b67d4">WITH_SEMAPHORE</a>(<a class="code hl_variable" href="classAP__AHRS.html#a38d0378ea83c46d1edb53fb6f578beaf">_rsem</a>);</div>
<div class="line"><a id="l02888" name="l02888"></a><span class="lineno"> 2888</span>    <span class="comment">// check location is valid</span></div>
<div class="line"><a id="l02889" name="l02889"></a><span class="lineno"> 2889</span>    <span class="keywordflow">if</span> (loc.<a class="code hl_variable" href="classLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a> == 0 &amp;&amp; loc.<a class="code hl_variable" href="classLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a> == 0 &amp;&amp; loc.<a class="code hl_variable" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a> == 0) {</div>
<div class="line"><a id="l02890" name="l02890"></a><span class="lineno"> 2890</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02891" name="l02891"></a><span class="lineno"> 2891</span>    }</div>
<div class="line"><a id="l02892" name="l02892"></a><span class="lineno"> 2892</span>    <span class="keywordflow">if</span> (!loc.<a class="code hl_function" href="classLocation.html#a25f7297551af447cf46aef3ae92c2632">check_latlng</a>()) {</div>
<div class="line"><a id="l02893" name="l02893"></a><span class="lineno"> 2893</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02894" name="l02894"></a><span class="lineno"> 2894</span>    }</div>
<div class="line"><a id="l02895" name="l02895"></a><span class="lineno"> 2895</span>    <span class="comment">// home must always be global frame at the moment as .alt is</span></div>
<div class="line"><a id="l02896" name="l02896"></a><span class="lineno"> 2896</span>    <span class="comment">// accessed directly by the vehicles and they may not be rigorous</span></div>
<div class="line"><a id="l02897" name="l02897"></a><span class="lineno"> 2897</span>    <span class="comment">// in checking the frame type.</span></div>
<div class="line"><a id="l02898" name="l02898"></a><span class="lineno"> 2898</span>    <a class="code hl_class" href="classLocation.html">Location</a> tmp = loc;</div>
<div class="line"><a id="l02899" name="l02899"></a><span class="lineno"> 2899</span>    <span class="keywordflow">if</span> (!tmp.<a class="code hl_function" href="classLocation.html#a0338ecfc1fac3c46bc7debd2aa304dc9">change_alt_frame</a>(<a class="code hl_enumvalue" href="classLocation.html#af494dabb88cd43e0d4efa99f04d31351a3a0bc063b6db8cae0361657958be836f">Location::AltFrame::ABSOLUTE</a>)) {</div>
<div class="line"><a id="l02900" name="l02900"></a><span class="lineno"> 2900</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02901" name="l02901"></a><span class="lineno"> 2901</span>    }</div>
<div class="line"><a id="l02902" name="l02902"></a><span class="lineno"> 2902</span> </div>
<div class="line"><a id="l02903" name="l02903"></a><span class="lineno"> 2903</span><span class="preprocessor">#if !APM_BUILD_TYPE(APM_BUILD_UNKNOWN) &amp;&amp; HAL_LOGGING_ENABLED</span></div>
<div class="line"><a id="l02904" name="l02904"></a><span class="lineno"> 2904</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__AHRS.html#a89d3f4c63809e5e5ff4d3c4a61969e4c">_home_is_set</a>) {</div>
<div class="line"><a id="l02905" name="l02905"></a><span class="lineno"> 2905</span>        <span class="comment">// record home is set</span></div>
<div class="line"><a id="l02906" name="l02906"></a><span class="lineno"> 2906</span>        <a class="code hl_function" href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a>().<a class="code hl_function" href="classAP__Logger.html#acc819f09dd35b615500c4dec658519d2">Write_Event</a>(<a class="code hl_enumvalue" href="AP__Logger_8h.html#abfb7fdeeabd95c90488508e20c5ea981a04fc91bb3ffc8b8a797cd9d374cd203a">LogEvent::SET_HOME</a>);</div>
<div class="line"><a id="l02907" name="l02907"></a><span class="lineno"> 2907</span>    }</div>
<div class="line"><a id="l02908" name="l02908"></a><span class="lineno"> 2908</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02909" name="l02909"></a><span class="lineno"> 2909</span> </div>
<div class="line"><a id="l02910" name="l02910"></a><span class="lineno"> 2910</span>    <a class="code hl_variable" href="classAP__AHRS.html#a2107b76042de1c58c8f550ea60804ea9">_home</a> = tmp;</div>
<div class="line"><a id="l02911" name="l02911"></a><span class="lineno"> 2911</span>    <a class="code hl_variable" href="classAP__AHRS.html#a89d3f4c63809e5e5ff4d3c4a61969e4c">_home_is_set</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02912" name="l02912"></a><span class="lineno"> 2912</span> </div>
<div class="line"><a id="l02913" name="l02913"></a><span class="lineno"> 2913</span><span class="preprocessor">#if HAL_LOGGING_ENABLED</span></div>
<div class="line"><a id="l02914" name="l02914"></a><span class="lineno"> 2914</span>    <a class="code hl_function" href="classAP__AHRS.html#ac9514f5193b6a15b16d995fd8ee0e4c4">Log_Write_Home_And_Origin</a>();</div>
<div class="line"><a id="l02915" name="l02915"></a><span class="lineno"> 2915</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02916" name="l02916"></a><span class="lineno"> 2916</span> </div>
<div class="line"><a id="l02917" name="l02917"></a><span class="lineno"> 2917</span>    <span class="comment">// send new home and ekf origin to GCS</span></div>
<div class="line"><a id="l02918" name="l02918"></a><span class="lineno"> 2918</span>    <a class="code hl_define" href="GCS_8h.html#ae6c78c8b4fe0e326d9dce475a686e069">GCS_SEND_MESSAGE</a>(<a class="code hl_enumvalue" href="ap__message_8h.html#abeccfcc1b97df359517df10fa4209991ae245f098f5ee0ec75b4dc6331f769f8f">MSG_HOME</a>);</div>
<div class="line"><a id="l02919" name="l02919"></a><span class="lineno"> 2919</span>    <a class="code hl_define" href="GCS_8h.html#ae6c78c8b4fe0e326d9dce475a686e069">GCS_SEND_MESSAGE</a>(<a class="code hl_enumvalue" href="ap__message_8h.html#abeccfcc1b97df359517df10fa4209991af5b97ab8c9c725ebc1a437d5145a96d9">MSG_ORIGIN</a>);</div>
<div class="line"><a id="l02920" name="l02920"></a><span class="lineno"> 2920</span> </div>
<div class="line"><a id="l02921" name="l02921"></a><span class="lineno"> 2921</span>    <a class="code hl_struct" href="structAP__HAL_1_1Util_1_1PersistentData.html">AP_HAL::Util::PersistentData</a> &amp;pd = <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_variable" href="classAP__HAL_1_1Util.html#a64273fdab59825cea305a403054c25bf">persistent_data</a>;</div>
<div class="line"><a id="l02922" name="l02922"></a><span class="lineno"> 2922</span>    pd.<a class="code hl_variable" href="structAP__HAL_1_1Util_1_1PersistentData.html#a0084c9656d202d021ab77bcfb2b78eba">home_lat</a> = loc.<a class="code hl_variable" href="classLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a>;</div>
<div class="line"><a id="l02923" name="l02923"></a><span class="lineno"> 2923</span>    pd.<a class="code hl_variable" href="structAP__HAL_1_1Util_1_1PersistentData.html#aedd0eb77ffa4ae4a9dac6744e7aa72c5">home_lon</a> = loc.<a class="code hl_variable" href="classLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a>;</div>
<div class="line"><a id="l02924" name="l02924"></a><span class="lineno"> 2924</span>    pd.<a class="code hl_variable" href="structAP__HAL_1_1Util_1_1PersistentData.html#a4751bd257fc3ec1919d33852896c11ad">home_alt_cm</a> = loc.<a class="code hl_variable" href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">alt</a>;</div>
<div class="line"><a id="l02925" name="l02925"></a><span class="lineno"> 2925</span> </div>
<div class="line"><a id="l02926" name="l02926"></a><span class="lineno"> 2926</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l02927" name="l02927"></a><span class="lineno"> 2927</span>}</div>
</div>
<div class="line"><a id="l02928" name="l02928"></a><span class="lineno"> 2928</span> </div>
<div class="line"><a id="l02929" name="l02929"></a><span class="lineno"> 2929</span><span class="comment">/* if this was a watchdog reset then get home from backup registers */</span></div>
<div class="foldopen" id="foldopen02930" data-start="{" data-end="}">
<div class="line"><a id="l02930" name="l02930"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a12e4314ea3b442611a838f4844d27920"> 2930</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a12e4314ea3b442611a838f4844d27920">AP_AHRS::load_watchdog_home</a>()</div>
<div class="line"><a id="l02931" name="l02931"></a><span class="lineno"> 2931</span>{</div>
<div class="line"><a id="l02932" name="l02932"></a><span class="lineno"> 2932</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structAP__HAL_1_1Util_1_1PersistentData.html">AP_HAL::Util::PersistentData</a> &amp;pd = <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_variable" href="classAP__HAL_1_1Util.html#a64273fdab59825cea305a403054c25bf">persistent_data</a>;</div>
<div class="line"><a id="l02933" name="l02933"></a><span class="lineno"> 2933</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a19cbaa06e0e8804d1669deacf5ad6081">was_watchdog_reset</a>() &amp;&amp; (pd.<a class="code hl_variable" href="structAP__HAL_1_1Util_1_1PersistentData.html#a0084c9656d202d021ab77bcfb2b78eba">home_lat</a> != 0 || pd.<a class="code hl_variable" href="structAP__HAL_1_1Util_1_1PersistentData.html#aedd0eb77ffa4ae4a9dac6744e7aa72c5">home_lon</a> != 0)) {</div>
<div class="line"><a id="l02934" name="l02934"></a><span class="lineno"> 2934</span>        <a class="code hl_variable" href="classAP__AHRS.html#a2107b76042de1c58c8f550ea60804ea9">_home</a>.<a class="code hl_variable" href="classLocation.html#ae51548c2cf32311043ca19b94b9a9223">lat</a> = pd.<a class="code hl_variable" href="structAP__HAL_1_1Util_1_1PersistentData.html#a0084c9656d202d021ab77bcfb2b78eba">home_lat</a>;</div>
<div class="line"><a id="l02935" name="l02935"></a><span class="lineno"> 2935</span>        <a class="code hl_variable" href="classAP__AHRS.html#a2107b76042de1c58c8f550ea60804ea9">_home</a>.<a class="code hl_variable" href="classLocation.html#a5831f0aca9e51a15adb96fad465f72f8">lng</a> = pd.<a class="code hl_variable" href="structAP__HAL_1_1Util_1_1PersistentData.html#aedd0eb77ffa4ae4a9dac6744e7aa72c5">home_lon</a>;</div>
<div class="line"><a id="l02936" name="l02936"></a><span class="lineno"> 2936</span>        <a class="code hl_variable" href="classAP__AHRS.html#a2107b76042de1c58c8f550ea60804ea9">_home</a>.<a class="code hl_function" href="classLocation.html#a42ff316c00ff41841042c65521a44944">set_alt_cm</a>(pd.<a class="code hl_variable" href="structAP__HAL_1_1Util_1_1PersistentData.html#a4751bd257fc3ec1919d33852896c11ad">home_alt_cm</a>, <a class="code hl_enumvalue" href="classLocation.html#af494dabb88cd43e0d4efa99f04d31351a3a0bc063b6db8cae0361657958be836f">Location::AltFrame::ABSOLUTE</a>);</div>
<div class="line"><a id="l02937" name="l02937"></a><span class="lineno"> 2937</span>        <a class="code hl_variable" href="classAP__AHRS.html#a89d3f4c63809e5e5ff4d3c4a61969e4c">_home_is_set</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02938" name="l02938"></a><span class="lineno"> 2938</span>        <a class="code hl_variable" href="classAP__AHRS.html#a48fb629ec568f54354916fa82801943f">_home_locked</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l02939" name="l02939"></a><span class="lineno"> 2939</span>        <a class="code hl_define" href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;Restored watchdog home&quot;</span>);</div>
<div class="line"><a id="l02940" name="l02940"></a><span class="lineno"> 2940</span>    }</div>
<div class="line"><a id="l02941" name="l02941"></a><span class="lineno"> 2941</span>}</div>
</div>
<div class="line"><a id="l02942" name="l02942"></a><span class="lineno"> 2942</span> </div>
<div class="line"><a id="l02943" name="l02943"></a><span class="lineno"> 2943</span><span class="comment">// get_hgt_ctrl_limit - get maximum height to be observed by the control loops in metres and a validity flag</span></div>
<div class="line"><a id="l02944" name="l02944"></a><span class="lineno"> 2944</span><span class="comment">// this is used to limit height during optical flow navigation</span></div>
<div class="line"><a id="l02945" name="l02945"></a><span class="lineno"> 2945</span><span class="comment">// it will return false when no limiting is required</span></div>
<div class="foldopen" id="foldopen02946" data-start="{" data-end="}">
<div class="line"><a id="l02946" name="l02946"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a4c3c5a511fe50d0baa6062e8106920b7"> 2946</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a4c3c5a511fe50d0baa6062e8106920b7">AP_AHRS::get_hgt_ctrl_limit</a>(<span class="keywordtype">float</span>&amp; limit)<span class="keyword"> const</span></div>
<div class="line"><a id="l02947" name="l02947"></a><span class="lineno"> 2947</span><span class="keyword"></span>{</div>
<div class="line"><a id="l02948" name="l02948"></a><span class="lineno"> 2948</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l02949" name="l02949"></a><span class="lineno"> 2949</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l02950" name="l02950"></a><span class="lineno"> 2950</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l02951" name="l02951"></a><span class="lineno"> 2951</span>        <span class="comment">// We are not using an EKF so no limiting applies</span></div>
<div class="line"><a id="l02952" name="l02952"></a><span class="lineno"> 2952</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02953" name="l02953"></a><span class="lineno"> 2953</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02954" name="l02954"></a><span class="lineno"> 2954</span> </div>
<div class="line"><a id="l02955" name="l02955"></a><span class="lineno"> 2955</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l02956" name="l02956"></a><span class="lineno"> 2956</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l02957" name="l02957"></a><span class="lineno"> 2957</span>        <span class="keywordflow">return</span> EKF2.getHeightControlLimit(limit);</div>
<div class="line"><a id="l02958" name="l02958"></a><span class="lineno"> 2958</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02959" name="l02959"></a><span class="lineno"> 2959</span> </div>
<div class="line"><a id="l02960" name="l02960"></a><span class="lineno"> 2960</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l02961" name="l02961"></a><span class="lineno"> 2961</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l02962" name="l02962"></a><span class="lineno"> 2962</span>        <span class="keywordflow">return</span> EKF3.getHeightControlLimit(limit);</div>
<div class="line"><a id="l02963" name="l02963"></a><span class="lineno"> 2963</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02964" name="l02964"></a><span class="lineno"> 2964</span> </div>
<div class="line"><a id="l02965" name="l02965"></a><span class="lineno"> 2965</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l02966" name="l02966"></a><span class="lineno"> 2966</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l02967" name="l02967"></a><span class="lineno"> 2967</span>        <span class="keywordflow">return</span> sim.get_hgt_ctrl_limit(limit);</div>
<div class="line"><a id="l02968" name="l02968"></a><span class="lineno"> 2968</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02969" name="l02969"></a><span class="lineno"> 2969</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l02970" name="l02970"></a><span class="lineno"> 2970</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l02971" name="l02971"></a><span class="lineno"> 2971</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02972" name="l02972"></a><span class="lineno"> 2972</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l02973" name="l02973"></a><span class="lineno"> 2973</span>    }</div>
<div class="line"><a id="l02974" name="l02974"></a><span class="lineno"> 2974</span> </div>
<div class="line"><a id="l02975" name="l02975"></a><span class="lineno"> 2975</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l02976" name="l02976"></a><span class="lineno"> 2976</span>}</div>
</div>
<div class="line"><a id="l02977" name="l02977"></a><span class="lineno"> 2977</span> </div>
<div class="line"><a id="l02978" name="l02978"></a><span class="lineno"> 2978</span><span class="comment">// Set to true if the terrain underneath is stable enough to be used as a height reference</span></div>
<div class="line"><a id="l02979" name="l02979"></a><span class="lineno"> 2979</span><span class="comment">// this is not related to terrain following</span></div>
<div class="foldopen" id="foldopen02980" data-start="{" data-end="}">
<div class="line"><a id="l02980" name="l02980"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a135c23ad8e28d347f9156db99c5dbc0c"> 2980</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a135c23ad8e28d347f9156db99c5dbc0c">AP_AHRS::set_terrain_hgt_stable</a>(<span class="keywordtype">bool</span> stable)</div>
<div class="line"><a id="l02981" name="l02981"></a><span class="lineno"> 2981</span>{</div>
<div class="line"><a id="l02982" name="l02982"></a><span class="lineno"> 2982</span>    <span class="comment">// avoid repeatedly setting variable in NavEKF objects to prevent</span></div>
<div class="line"><a id="l02983" name="l02983"></a><span class="lineno"> 2983</span>    <span class="comment">// spurious event logging</span></div>
<div class="line"><a id="l02984" name="l02984"></a><span class="lineno"> 2984</span>    <span class="keywordflow">switch</span> (<a class="code hl_variable" href="classAP__AHRS.html#a1aa6ee35f06cb726f897aa1b7b3106a4">terrainHgtStableState</a>) {</div>
<div class="line"><a id="l02985" name="l02985"></a><span class="lineno"> 2985</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__AHRS.html#a85f9b24c849523630615e52bdf268f2ea696b031073e74bf2cb98e5ef201d4aa3">TriState::UNKNOWN</a>:</div>
<div class="line"><a id="l02986" name="l02986"></a><span class="lineno"> 2986</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02987" name="l02987"></a><span class="lineno"> 2987</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__AHRS.html#a85f9b24c849523630615e52bdf268f2eaf827cf462f62848df37c5e1e94a4da74">TriState::True</a>:</div>
<div class="line"><a id="l02988" name="l02988"></a><span class="lineno"> 2988</span>        <span class="keywordflow">if</span> (stable) {</div>
<div class="line"><a id="l02989" name="l02989"></a><span class="lineno"> 2989</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02990" name="l02990"></a><span class="lineno"> 2990</span>        }</div>
<div class="line"><a id="l02991" name="l02991"></a><span class="lineno"> 2991</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02992" name="l02992"></a><span class="lineno"> 2992</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__AHRS.html#a85f9b24c849523630615e52bdf268f2eaf8320b26d30ab433c5a54546d21f414c">TriState::False</a>:</div>
<div class="line"><a id="l02993" name="l02993"></a><span class="lineno"> 2993</span>        <span class="keywordflow">if</span> (!stable) {</div>
<div class="line"><a id="l02994" name="l02994"></a><span class="lineno"> 2994</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l02995" name="l02995"></a><span class="lineno"> 2995</span>        }</div>
<div class="line"><a id="l02996" name="l02996"></a><span class="lineno"> 2996</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l02997" name="l02997"></a><span class="lineno"> 2997</span>    }</div>
<div class="line"><a id="l02998" name="l02998"></a><span class="lineno"> 2998</span>    <a class="code hl_variable" href="classAP__AHRS.html#a1aa6ee35f06cb726f897aa1b7b3106a4">terrainHgtStableState</a> = (<a class="code hl_enumeration" href="classAP__AHRS.html#a85f9b24c849523630615e52bdf268f2e">TriState</a>)stable;</div>
<div class="line"><a id="l02999" name="l02999"></a><span class="lineno"> 2999</span> </div>
<div class="line"><a id="l03000" name="l03000"></a><span class="lineno"> 3000</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l03001" name="l03001"></a><span class="lineno"> 3001</span>    EKF2.setTerrainHgtStable(stable);</div>
<div class="line"><a id="l03002" name="l03002"></a><span class="lineno"> 3002</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03003" name="l03003"></a><span class="lineno"> 3003</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03004" name="l03004"></a><span class="lineno"> 3004</span>    EKF3.setTerrainHgtStable(stable);</div>
<div class="line"><a id="l03005" name="l03005"></a><span class="lineno"> 3005</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03006" name="l03006"></a><span class="lineno"> 3006</span>}</div>
</div>
<div class="line"><a id="l03007" name="l03007"></a><span class="lineno"> 3007</span> </div>
<div class="line"><a id="l03008" name="l03008"></a><span class="lineno"> 3008</span><span class="comment">// return the innovations for the primarily EKF</span></div>
<div class="line"><a id="l03009" name="l03009"></a><span class="lineno"> 3009</span><span class="comment">// boolean false is returned if innovations are not available</span></div>
<div class="foldopen" id="foldopen03010" data-start="{" data-end="}">
<div class="line"><a id="l03010" name="l03010"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a5ddc1265eec2436e4cfd219ed85e754e"> 3010</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a5ddc1265eec2436e4cfd219ed85e754e">AP_AHRS::get_innovations</a>(<a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;velInnov, <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;posInnov, <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;magInnov, <span class="keywordtype">float</span> &amp;tasInnov, <span class="keywordtype">float</span> &amp;yawInnov)<span class="keyword"> const</span></div>
<div class="line"><a id="l03011" name="l03011"></a><span class="lineno"> 3011</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03012" name="l03012"></a><span class="lineno"> 3012</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>()) {</div>
<div class="line"><a id="l03013" name="l03013"></a><span class="lineno"> 3013</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l03014" name="l03014"></a><span class="lineno"> 3014</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l03015" name="l03015"></a><span class="lineno"> 3015</span>        <span class="comment">// We are not using an EKF so no data</span></div>
<div class="line"><a id="l03016" name="l03016"></a><span class="lineno"> 3016</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03017" name="l03017"></a><span class="lineno"> 3017</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03018" name="l03018"></a><span class="lineno"> 3018</span> </div>
<div class="line"><a id="l03019" name="l03019"></a><span class="lineno"> 3019</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l03020" name="l03020"></a><span class="lineno"> 3020</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l03021" name="l03021"></a><span class="lineno"> 3021</span>        <span class="comment">// use EKF to get innovations</span></div>
<div class="line"><a id="l03022" name="l03022"></a><span class="lineno"> 3022</span>        <span class="keywordflow">return</span> EKF2.getInnovations(velInnov, posInnov, magInnov, tasInnov, yawInnov);</div>
<div class="line"><a id="l03023" name="l03023"></a><span class="lineno"> 3023</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03024" name="l03024"></a><span class="lineno"> 3024</span> </div>
<div class="line"><a id="l03025" name="l03025"></a><span class="lineno"> 3025</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03026" name="l03026"></a><span class="lineno"> 3026</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l03027" name="l03027"></a><span class="lineno"> 3027</span>        <span class="comment">// use EKF to get innovations</span></div>
<div class="line"><a id="l03028" name="l03028"></a><span class="lineno"> 3028</span>        <span class="keywordflow">return</span> EKF3.getInnovations(velInnov, posInnov, magInnov, tasInnov, yawInnov);</div>
<div class="line"><a id="l03029" name="l03029"></a><span class="lineno"> 3029</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03030" name="l03030"></a><span class="lineno"> 3030</span> </div>
<div class="line"><a id="l03031" name="l03031"></a><span class="lineno"> 3031</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l03032" name="l03032"></a><span class="lineno"> 3032</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l03033" name="l03033"></a><span class="lineno"> 3033</span>        <span class="keywordflow">return</span> sim.get_innovations(velInnov, posInnov, magInnov, tasInnov, yawInnov);</div>
<div class="line"><a id="l03034" name="l03034"></a><span class="lineno"> 3034</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03035" name="l03035"></a><span class="lineno"> 3035</span> </div>
<div class="line"><a id="l03036" name="l03036"></a><span class="lineno"> 3036</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l03037" name="l03037"></a><span class="lineno"> 3037</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l03038" name="l03038"></a><span class="lineno"> 3038</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03039" name="l03039"></a><span class="lineno"> 3039</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03040" name="l03040"></a><span class="lineno"> 3040</span>    }</div>
<div class="line"><a id="l03041" name="l03041"></a><span class="lineno"> 3041</span> </div>
<div class="line"><a id="l03042" name="l03042"></a><span class="lineno"> 3042</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03043" name="l03043"></a><span class="lineno"> 3043</span>}</div>
</div>
<div class="line"><a id="l03044" name="l03044"></a><span class="lineno"> 3044</span> </div>
<div class="line"><a id="l03045" name="l03045"></a><span class="lineno"> 3045</span><span class="comment">// returns true when the state estimates are significantly degraded by vibration</span></div>
<div class="foldopen" id="foldopen03046" data-start="{" data-end="}">
<div class="line"><a id="l03046" name="l03046"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a728d515f75fd504fba2beeaa1bb61552"> 3046</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a728d515f75fd504fba2beeaa1bb61552">AP_AHRS::is_vibration_affected</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l03047" name="l03047"></a><span class="lineno"> 3047</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03048" name="l03048"></a><span class="lineno"> 3048</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>()) {</div>
<div class="line"><a id="l03049" name="l03049"></a><span class="lineno"> 3049</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03050" name="l03050"></a><span class="lineno"> 3050</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l03051" name="l03051"></a><span class="lineno"> 3051</span>        <span class="keywordflow">return</span> EKF3.isVibrationAffected();</div>
<div class="line"><a id="l03052" name="l03052"></a><span class="lineno"> 3052</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03053" name="l03053"></a><span class="lineno"> 3053</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l03054" name="l03054"></a><span class="lineno"> 3054</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l03055" name="l03055"></a><span class="lineno"> 3055</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03056" name="l03056"></a><span class="lineno"> 3056</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l03057" name="l03057"></a><span class="lineno"> 3057</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l03058" name="l03058"></a><span class="lineno"> 3058</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03059" name="l03059"></a><span class="lineno"> 3059</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l03060" name="l03060"></a><span class="lineno"> 3060</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l03061" name="l03061"></a><span class="lineno"> 3061</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03062" name="l03062"></a><span class="lineno"> 3062</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l03063" name="l03063"></a><span class="lineno"> 3063</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l03064" name="l03064"></a><span class="lineno"> 3064</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03065" name="l03065"></a><span class="lineno"> 3065</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03066" name="l03066"></a><span class="lineno"> 3066</span>    }</div>
<div class="line"><a id="l03067" name="l03067"></a><span class="lineno"> 3067</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03068" name="l03068"></a><span class="lineno"> 3068</span>}</div>
</div>
<div class="line"><a id="l03069" name="l03069"></a><span class="lineno"> 3069</span> </div>
<div class="line"><a id="l03070" name="l03070"></a><span class="lineno"> 3070</span><span class="comment">// get_variances - provides the innovations normalised using the innovation variance where a value of 0</span></div>
<div class="line"><a id="l03071" name="l03071"></a><span class="lineno"> 3071</span><span class="comment">// indicates prefect consistency between the measurement and the EKF solution and a value of 1 is the maximum</span></div>
<div class="line"><a id="l03072" name="l03072"></a><span class="lineno"> 3072</span><span class="comment">// inconsistency that will be accepted by the filter</span></div>
<div class="line"><a id="l03073" name="l03073"></a><span class="lineno"> 3073</span><span class="comment">// boolean false is returned if variances are not available</span></div>
<div class="foldopen" id="foldopen03074" data-start="{" data-end="}">
<div class="line"><a id="l03074" name="l03074"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#af40b57b1bd3271c9dd0aa4082e6278d9"> 3074</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#af40b57b1bd3271c9dd0aa4082e6278d9">AP_AHRS::get_variances</a>(<span class="keywordtype">float</span> &amp;velVar, <span class="keywordtype">float</span> &amp;posVar, <span class="keywordtype">float</span> &amp;hgtVar, <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;magVar, <span class="keywordtype">float</span> &amp;tasVar)<span class="keyword"> const</span></div>
<div class="line"><a id="l03075" name="l03075"></a><span class="lineno"> 3075</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03076" name="l03076"></a><span class="lineno"> 3076</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>()) {</div>
<div class="line"><a id="l03077" name="l03077"></a><span class="lineno"> 3077</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l03078" name="l03078"></a><span class="lineno"> 3078</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l03079" name="l03079"></a><span class="lineno"> 3079</span>        <span class="comment">// We are not using an EKF so no data</span></div>
<div class="line"><a id="l03080" name="l03080"></a><span class="lineno"> 3080</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03081" name="l03081"></a><span class="lineno"> 3081</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03082" name="l03082"></a><span class="lineno"> 3082</span> </div>
<div class="line"><a id="l03083" name="l03083"></a><span class="lineno"> 3083</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l03084" name="l03084"></a><span class="lineno"> 3084</span>    <span class="keywordflow">case</span> EKFType::TWO: {</div>
<div class="line"><a id="l03085" name="l03085"></a><span class="lineno"> 3085</span>        <span class="comment">// use EKF to get variance</span></div>
<div class="line"><a id="l03086" name="l03086"></a><span class="lineno"> 3086</span>        <a class="code hl_class" href="structVector2.html">Vector2f</a> offset;</div>
<div class="line"><a id="l03087" name="l03087"></a><span class="lineno"> 3087</span>        <span class="keywordflow">return</span> EKF2.getVariances(velVar, posVar, hgtVar, magVar, tasVar, offset);</div>
<div class="line"><a id="l03088" name="l03088"></a><span class="lineno"> 3088</span>    }</div>
<div class="line"><a id="l03089" name="l03089"></a><span class="lineno"> 3089</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03090" name="l03090"></a><span class="lineno"> 3090</span> </div>
<div class="line"><a id="l03091" name="l03091"></a><span class="lineno"> 3091</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03092" name="l03092"></a><span class="lineno"> 3092</span>    <span class="keywordflow">case</span> EKFType::THREE: {</div>
<div class="line"><a id="l03093" name="l03093"></a><span class="lineno"> 3093</span>        <span class="comment">// use EKF to get variance</span></div>
<div class="line"><a id="l03094" name="l03094"></a><span class="lineno"> 3094</span>        <a class="code hl_class" href="structVector2.html">Vector2f</a> offset;</div>
<div class="line"><a id="l03095" name="l03095"></a><span class="lineno"> 3095</span>        <span class="keywordflow">return</span> EKF3.getVariances(velVar, posVar, hgtVar, magVar, tasVar, offset);</div>
<div class="line"><a id="l03096" name="l03096"></a><span class="lineno"> 3096</span>    }</div>
<div class="line"><a id="l03097" name="l03097"></a><span class="lineno"> 3097</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03098" name="l03098"></a><span class="lineno"> 3098</span> </div>
<div class="line"><a id="l03099" name="l03099"></a><span class="lineno"> 3099</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l03100" name="l03100"></a><span class="lineno"> 3100</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l03101" name="l03101"></a><span class="lineno"> 3101</span>        <span class="keywordflow">return</span> sim.get_variances(velVar, posVar, hgtVar, magVar, tasVar);</div>
<div class="line"><a id="l03102" name="l03102"></a><span class="lineno"> 3102</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03103" name="l03103"></a><span class="lineno"> 3103</span> </div>
<div class="line"><a id="l03104" name="l03104"></a><span class="lineno"> 3104</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l03105" name="l03105"></a><span class="lineno"> 3105</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l03106" name="l03106"></a><span class="lineno"> 3106</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03107" name="l03107"></a><span class="lineno"> 3107</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03108" name="l03108"></a><span class="lineno"> 3108</span>    }</div>
<div class="line"><a id="l03109" name="l03109"></a><span class="lineno"> 3109</span> </div>
<div class="line"><a id="l03110" name="l03110"></a><span class="lineno"> 3110</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03111" name="l03111"></a><span class="lineno"> 3111</span>}</div>
</div>
<div class="line"><a id="l03112" name="l03112"></a><span class="lineno"> 3112</span> </div>
<div class="line"><a id="l03113" name="l03113"></a><span class="lineno"> 3113</span><span class="comment">// get a source&#39;s velocity innovations.  source should be from 0 to 7 (see AP_NavEKF_Source::SourceXY)</span></div>
<div class="line"><a id="l03114" name="l03114"></a><span class="lineno"> 3114</span><span class="comment">// returns true on success and results are placed in innovations and variances arguments</span></div>
<div class="foldopen" id="foldopen03115" data-start="{" data-end="}">
<div class="line"><a id="l03115" name="l03115"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#ae8f0594679dcff5e2d1a6bf2cc593740"> 3115</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#ae8f0594679dcff5e2d1a6bf2cc593740">AP_AHRS::get_vel_innovations_and_variances_for_source</a>(uint8_t <a class="code hl_variable" href="AP__Scripting_2generator_2src_2main_8c.html#a0c4aa150664a3347db13aeeb47811829">source</a>, <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;innovations, <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;variances)<span class="keyword"> const</span></div>
<div class="line"><a id="l03116" name="l03116"></a><span class="lineno"> 3116</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03117" name="l03117"></a><span class="lineno"> 3117</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">ekf_type</a>()) {</div>
<div class="line"><a id="l03118" name="l03118"></a><span class="lineno"> 3118</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l03119" name="l03119"></a><span class="lineno"> 3119</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l03120" name="l03120"></a><span class="lineno"> 3120</span>        <span class="comment">// We are not using an EKF so no data</span></div>
<div class="line"><a id="l03121" name="l03121"></a><span class="lineno"> 3121</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03122" name="l03122"></a><span class="lineno"> 3122</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03123" name="l03123"></a><span class="lineno"> 3123</span> </div>
<div class="line"><a id="l03124" name="l03124"></a><span class="lineno"> 3124</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l03125" name="l03125"></a><span class="lineno"> 3125</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l03126" name="l03126"></a><span class="lineno"> 3126</span>        <span class="comment">// EKF2 does not support source level variances</span></div>
<div class="line"><a id="l03127" name="l03127"></a><span class="lineno"> 3127</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03128" name="l03128"></a><span class="lineno"> 3128</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03129" name="l03129"></a><span class="lineno"> 3129</span> </div>
<div class="line"><a id="l03130" name="l03130"></a><span class="lineno"> 3130</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03131" name="l03131"></a><span class="lineno"> 3131</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l03132" name="l03132"></a><span class="lineno"> 3132</span>        <span class="comment">// use EKF to get variance</span></div>
<div class="line"><a id="l03133" name="l03133"></a><span class="lineno"> 3133</span>        <span class="keywordflow">return</span> EKF3.getVelInnovationsAndVariancesForSource((<a class="code hl_enumeration" href="classAP__NavEKF__Source.html#aa463f183bb6c2c7f2b217792b850af46">AP_NavEKF_Source::SourceXY</a>)<a class="code hl_variable" href="AP__Scripting_2generator_2src_2main_8c.html#a0c4aa150664a3347db13aeeb47811829">source</a>, innovations, variances);</div>
<div class="line"><a id="l03134" name="l03134"></a><span class="lineno"> 3134</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03135" name="l03135"></a><span class="lineno"> 3135</span> </div>
<div class="line"><a id="l03136" name="l03136"></a><span class="lineno"> 3136</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l03137" name="l03137"></a><span class="lineno"> 3137</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l03138" name="l03138"></a><span class="lineno"> 3138</span>        <span class="comment">// SITL does not support source level variances</span></div>
<div class="line"><a id="l03139" name="l03139"></a><span class="lineno"> 3139</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03140" name="l03140"></a><span class="lineno"> 3140</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03141" name="l03141"></a><span class="lineno"> 3141</span> </div>
<div class="line"><a id="l03142" name="l03142"></a><span class="lineno"> 3142</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l03143" name="l03143"></a><span class="lineno"> 3143</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l03144" name="l03144"></a><span class="lineno"> 3144</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03145" name="l03145"></a><span class="lineno"> 3145</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03146" name="l03146"></a><span class="lineno"> 3146</span>    }</div>
<div class="line"><a id="l03147" name="l03147"></a><span class="lineno"> 3147</span> </div>
<div class="line"><a id="l03148" name="l03148"></a><span class="lineno"> 3148</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03149" name="l03149"></a><span class="lineno"> 3149</span>}</div>
</div>
<div class="line"><a id="l03150" name="l03150"></a><span class="lineno"> 3150</span> </div>
<div class="line"><a id="l03151" name="l03151"></a><span class="lineno"> 3151</span><span class="comment">//get the index of the active airspeed sensor, wrt the primary core</span></div>
<div class="foldopen" id="foldopen03152" data-start="{" data-end="}">
<div class="line"><a id="l03152" name="l03152"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#adc37d9d0be559afc90e704cc747a9bf5"> 3152</a></span>uint8_t <a class="code hl_function" href="classAP__AHRS.html#adc37d9d0be559afc90e704cc747a9bf5">AP_AHRS::get_active_airspeed_index</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l03153" name="l03153"></a><span class="lineno"> 3153</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03154" name="l03154"></a><span class="lineno"> 3154</span><span class="preprocessor">#if AP_AIRSPEED_ENABLED</span></div>
<div class="line"><a id="l03155" name="l03155"></a><span class="lineno"> 3155</span>    <span class="keyword">const</span> <span class="keyword">auto</span> *<a class="code hl_variable" href="classAP__AHRS.html#acb4b144fc2fd1352fe991c44707f5b4e">airspeed</a> = <a class="code hl_function" href="namespaceAP.html#a8d01caed65921a37d8d68f70ac255aa5">AP::airspeed</a>();</div>
<div class="line"><a id="l03156" name="l03156"></a><span class="lineno"> 3156</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__AHRS.html#acb4b144fc2fd1352fe991c44707f5b4e">airspeed</a> == <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l03157" name="l03157"></a><span class="lineno"> 3157</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03158" name="l03158"></a><span class="lineno"> 3158</span>    }</div>
<div class="line"><a id="l03159" name="l03159"></a><span class="lineno"> 3159</span> </div>
<div class="line"><a id="l03160" name="l03160"></a><span class="lineno"> 3160</span><span class="comment">// we only have affinity for EKF3 as of now</span></div>
<div class="line"><a id="l03161" name="l03161"></a><span class="lineno"> 3161</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03162" name="l03162"></a><span class="lineno"> 3162</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>() == EKFType::THREE) {</div>
<div class="line"><a id="l03163" name="l03163"></a><span class="lineno"> 3163</span>        uint8_t ret = EKF3.getActiveAirspeed();</div>
<div class="line"><a id="l03164" name="l03164"></a><span class="lineno"> 3164</span>        <span class="keywordflow">if</span> (ret != 255 &amp;&amp; <a class="code hl_variable" href="classAP__AHRS.html#acb4b144fc2fd1352fe991c44707f5b4e">airspeed</a>-&gt;healthy(ret) &amp;&amp; <a class="code hl_variable" href="classAP__AHRS.html#acb4b144fc2fd1352fe991c44707f5b4e">airspeed</a>-&gt;use(ret)) {</div>
<div class="line"><a id="l03165" name="l03165"></a><span class="lineno"> 3165</span>            <span class="keywordflow">return</span> ret;</div>
<div class="line"><a id="l03166" name="l03166"></a><span class="lineno"> 3166</span>        }</div>
<div class="line"><a id="l03167" name="l03167"></a><span class="lineno"> 3167</span>    }</div>
<div class="line"><a id="l03168" name="l03168"></a><span class="lineno"> 3168</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03169" name="l03169"></a><span class="lineno"> 3169</span> </div>
<div class="line"><a id="l03170" name="l03170"></a><span class="lineno"> 3170</span>    <span class="comment">// for the rest, let the primary airspeed sensor be used</span></div>
<div class="line"><a id="l03171" name="l03171"></a><span class="lineno"> 3171</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__AHRS.html#acb4b144fc2fd1352fe991c44707f5b4e">airspeed</a>-&gt;get_primary();</div>
<div class="line"><a id="l03172" name="l03172"></a><span class="lineno"> 3172</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l03173" name="l03173"></a><span class="lineno"> 3173</span> </div>
<div class="line"><a id="l03174" name="l03174"></a><span class="lineno"> 3174</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03175" name="l03175"></a><span class="lineno"> 3175</span><span class="preprocessor">#endif </span><span class="comment">// AP_AIRSPEED_ENABLED</span></div>
<div class="line"><a id="l03176" name="l03176"></a><span class="lineno"> 3176</span>}</div>
</div>
<div class="line"><a id="l03177" name="l03177"></a><span class="lineno"> 3177</span> </div>
<div class="line"><a id="l03178" name="l03178"></a><span class="lineno"> 3178</span><span class="comment">// get the index of the current primary IMU</span></div>
<div class="foldopen" id="foldopen03179" data-start="{" data-end="}">
<div class="line"><a id="l03179" name="l03179"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a44b2873fb508f655a14ec562bab4be12"> 3179</a></span>uint8_t <a class="code hl_function" href="classAP__AHRS.html#a44b2873fb508f655a14ec562bab4be12">AP_AHRS::_get_primary_IMU_index</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l03180" name="l03180"></a><span class="lineno"> 3180</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03181" name="l03181"></a><span class="lineno"> 3181</span>    int8_t imu = -1;</div>
<div class="line"><a id="l03182" name="l03182"></a><span class="lineno"> 3182</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l03183" name="l03183"></a><span class="lineno"> 3183</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l03184" name="l03184"></a><span class="lineno"> 3184</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l03185" name="l03185"></a><span class="lineno"> 3185</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03186" name="l03186"></a><span class="lineno"> 3186</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03187" name="l03187"></a><span class="lineno"> 3187</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l03188" name="l03188"></a><span class="lineno"> 3188</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l03189" name="l03189"></a><span class="lineno"> 3189</span>        <span class="comment">// let EKF2 choose primary IMU</span></div>
<div class="line"><a id="l03190" name="l03190"></a><span class="lineno"> 3190</span>        imu = EKF2.getPrimaryCoreIMUIndex();</div>
<div class="line"><a id="l03191" name="l03191"></a><span class="lineno"> 3191</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03192" name="l03192"></a><span class="lineno"> 3192</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03193" name="l03193"></a><span class="lineno"> 3193</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03194" name="l03194"></a><span class="lineno"> 3194</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l03195" name="l03195"></a><span class="lineno"> 3195</span>        <span class="comment">// let EKF2 choose primary IMU</span></div>
<div class="line"><a id="l03196" name="l03196"></a><span class="lineno"> 3196</span>        imu = EKF3.getPrimaryCoreIMUIndex();</div>
<div class="line"><a id="l03197" name="l03197"></a><span class="lineno"> 3197</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03198" name="l03198"></a><span class="lineno"> 3198</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03199" name="l03199"></a><span class="lineno"> 3199</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l03200" name="l03200"></a><span class="lineno"> 3200</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l03201" name="l03201"></a><span class="lineno"> 3201</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03202" name="l03202"></a><span class="lineno"> 3202</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03203" name="l03203"></a><span class="lineno"> 3203</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l03204" name="l03204"></a><span class="lineno"> 3204</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l03205" name="l03205"></a><span class="lineno"> 3205</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03206" name="l03206"></a><span class="lineno"> 3206</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03207" name="l03207"></a><span class="lineno"> 3207</span>    }</div>
<div class="line"><a id="l03208" name="l03208"></a><span class="lineno"> 3208</span>    <span class="keywordflow">if</span> (imu == -1) {</div>
<div class="line"><a id="l03209" name="l03209"></a><span class="lineno"> 3209</span>        imu = <a class="code hl_function" href="namespaceAP.html#ac571aa5a2ef71b7f4b4b2bfa09143fb9">AP::ins</a>().<a class="code hl_function" href="classAP__InertialSensor.html#a5e8d3dd482fa7719aac4e1a65def9b81">get_primary_gyro</a>();</div>
<div class="line"><a id="l03210" name="l03210"></a><span class="lineno"> 3210</span>    }</div>
<div class="line"><a id="l03211" name="l03211"></a><span class="lineno"> 3211</span>    <span class="keywordflow">return</span> imu;</div>
<div class="line"><a id="l03212" name="l03212"></a><span class="lineno"> 3212</span>}</div>
</div>
<div class="line"><a id="l03213" name="l03213"></a><span class="lineno"> 3213</span> </div>
<div class="line"><a id="l03214" name="l03214"></a><span class="lineno"> 3214</span><span class="comment">// return the index of the primary core or -1 if no primary core selected</span></div>
<div class="foldopen" id="foldopen03215" data-start="{" data-end="}">
<div class="line"><a id="l03215" name="l03215"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a646f98af1ebb26d8f6d2bcde910f9c04"> 3215</a></span>int8_t <a class="code hl_function" href="classAP__AHRS.html#a646f98af1ebb26d8f6d2bcde910f9c04">AP_AHRS::_get_primary_core_index</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l03216" name="l03216"></a><span class="lineno"> 3216</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03217" name="l03217"></a><span class="lineno"> 3217</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l03218" name="l03218"></a><span class="lineno"> 3218</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l03219" name="l03219"></a><span class="lineno"> 3219</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l03220" name="l03220"></a><span class="lineno"> 3220</span>        <span class="comment">// we have only one core</span></div>
<div class="line"><a id="l03221" name="l03221"></a><span class="lineno"> 3221</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03222" name="l03222"></a><span class="lineno"> 3222</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03223" name="l03223"></a><span class="lineno"> 3223</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l03224" name="l03224"></a><span class="lineno"> 3224</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l03225" name="l03225"></a><span class="lineno"> 3225</span>        <span class="comment">// we have only one core</span></div>
<div class="line"><a id="l03226" name="l03226"></a><span class="lineno"> 3226</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03227" name="l03227"></a><span class="lineno"> 3227</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03228" name="l03228"></a><span class="lineno"> 3228</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l03229" name="l03229"></a><span class="lineno"> 3229</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l03230" name="l03230"></a><span class="lineno"> 3230</span>        <span class="comment">// we have only one core</span></div>
<div class="line"><a id="l03231" name="l03231"></a><span class="lineno"> 3231</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03232" name="l03232"></a><span class="lineno"> 3232</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03233" name="l03233"></a><span class="lineno"> 3233</span> </div>
<div class="line"><a id="l03234" name="l03234"></a><span class="lineno"> 3234</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l03235" name="l03235"></a><span class="lineno"> 3235</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l03236" name="l03236"></a><span class="lineno"> 3236</span>        <span class="keywordflow">return</span> EKF2.getPrimaryCoreIndex();</div>
<div class="line"><a id="l03237" name="l03237"></a><span class="lineno"> 3237</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03238" name="l03238"></a><span class="lineno"> 3238</span> </div>
<div class="line"><a id="l03239" name="l03239"></a><span class="lineno"> 3239</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03240" name="l03240"></a><span class="lineno"> 3240</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l03241" name="l03241"></a><span class="lineno"> 3241</span>        <span class="keywordflow">return</span> EKF3.getPrimaryCoreIndex();</div>
<div class="line"><a id="l03242" name="l03242"></a><span class="lineno"> 3242</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03243" name="l03243"></a><span class="lineno"> 3243</span>    }</div>
<div class="line"><a id="l03244" name="l03244"></a><span class="lineno"> 3244</span> </div>
<div class="line"><a id="l03245" name="l03245"></a><span class="lineno"> 3245</span>    <span class="comment">// we should never get here</span></div>
<div class="line"><a id="l03246" name="l03246"></a><span class="lineno"> 3246</span>    <a class="code hl_define" href="AP__InternalError_8h.html#a6a214896237158d1318e3368b4b10dfb">INTERNAL_ERROR</a>(<a class="code hl_enumvalue" href="classAP__InternalError.html#a5173d851f3973e9a341e08ceb9451c11a125554e4c6e51cfd513a60efb7eb3c78">AP_InternalError::error_t::flow_of_control</a>);</div>
<div class="line"><a id="l03247" name="l03247"></a><span class="lineno"> 3247</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><a id="l03248" name="l03248"></a><span class="lineno"> 3248</span>}</div>
</div>
<div class="line"><a id="l03249" name="l03249"></a><span class="lineno"> 3249</span> </div>
<div class="line"><a id="l03250" name="l03250"></a><span class="lineno"> 3250</span><span class="comment">// get the index of the current primary accelerometer sensor</span></div>
<div class="foldopen" id="foldopen03251" data-start="{" data-end="}">
<div class="line"><a id="l03251" name="l03251"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a267a928eb963f170b58141a10670654f"> 3251</a></span>uint8_t <a class="code hl_function" href="classAP__AHRS.html#a267a928eb963f170b58141a10670654f">AP_AHRS::_get_primary_accel_index</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l03252" name="l03252"></a><span class="lineno"> 3252</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03253" name="l03253"></a><span class="lineno"> 3253</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classAP__AHRS.html#a44b2873fb508f655a14ec562bab4be12">_get_primary_IMU_index</a>();</div>
<div class="line"><a id="l03254" name="l03254"></a><span class="lineno"> 3254</span>}</div>
</div>
<div class="line"><a id="l03255" name="l03255"></a><span class="lineno"> 3255</span> </div>
<div class="line"><a id="l03256" name="l03256"></a><span class="lineno"> 3256</span><span class="comment">// get the index of the current primary gyro sensor</span></div>
<div class="foldopen" id="foldopen03257" data-start="{" data-end="}">
<div class="line"><a id="l03257" name="l03257"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a4edff861ea2d775757a388c158fa9e8c"> 3257</a></span>uint8_t <a class="code hl_function" href="classAP__AHRS.html#a4edff861ea2d775757a388c158fa9e8c">AP_AHRS::_get_primary_gyro_index</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l03258" name="l03258"></a><span class="lineno"> 3258</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03259" name="l03259"></a><span class="lineno"> 3259</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classAP__AHRS.html#a44b2873fb508f655a14ec562bab4be12">_get_primary_IMU_index</a>();</div>
<div class="line"><a id="l03260" name="l03260"></a><span class="lineno"> 3260</span>}</div>
</div>
<div class="line"><a id="l03261" name="l03261"></a><span class="lineno"> 3261</span> </div>
<div class="line"><a id="l03262" name="l03262"></a><span class="lineno"> 3262</span><span class="comment">// see if EKF lane switching is possible to avoid EKF failsafe</span></div>
<div class="foldopen" id="foldopen03263" data-start="{" data-end="}">
<div class="line"><a id="l03263" name="l03263"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a97a6e31baabfe1ac8ab514fb6f41c591"> 3263</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a97a6e31baabfe1ac8ab514fb6f41c591">AP_AHRS::check_lane_switch</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l03264" name="l03264"></a><span class="lineno"> 3264</span>{</div>
<div class="line"><a id="l03265" name="l03265"></a><span class="lineno"> 3265</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l03266" name="l03266"></a><span class="lineno"> 3266</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l03267" name="l03267"></a><span class="lineno"> 3267</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l03268" name="l03268"></a><span class="lineno"> 3268</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03269" name="l03269"></a><span class="lineno"> 3269</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03270" name="l03270"></a><span class="lineno"> 3270</span> </div>
<div class="line"><a id="l03271" name="l03271"></a><span class="lineno"> 3271</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l03272" name="l03272"></a><span class="lineno"> 3272</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l03273" name="l03273"></a><span class="lineno"> 3273</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03274" name="l03274"></a><span class="lineno"> 3274</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03275" name="l03275"></a><span class="lineno"> 3275</span> </div>
<div class="line"><a id="l03276" name="l03276"></a><span class="lineno"> 3276</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l03277" name="l03277"></a><span class="lineno"> 3277</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l03278" name="l03278"></a><span class="lineno"> 3278</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03279" name="l03279"></a><span class="lineno"> 3279</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03280" name="l03280"></a><span class="lineno"> 3280</span>        </div>
<div class="line"><a id="l03281" name="l03281"></a><span class="lineno"> 3281</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l03282" name="l03282"></a><span class="lineno"> 3282</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l03283" name="l03283"></a><span class="lineno"> 3283</span>        EKF2.checkLaneSwitch();</div>
<div class="line"><a id="l03284" name="l03284"></a><span class="lineno"> 3284</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03285" name="l03285"></a><span class="lineno"> 3285</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03286" name="l03286"></a><span class="lineno"> 3286</span> </div>
<div class="line"><a id="l03287" name="l03287"></a><span class="lineno"> 3287</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03288" name="l03288"></a><span class="lineno"> 3288</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l03289" name="l03289"></a><span class="lineno"> 3289</span>        EKF3.checkLaneSwitch();</div>
<div class="line"><a id="l03290" name="l03290"></a><span class="lineno"> 3290</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03291" name="l03291"></a><span class="lineno"> 3291</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03292" name="l03292"></a><span class="lineno"> 3292</span>    }</div>
<div class="line"><a id="l03293" name="l03293"></a><span class="lineno"> 3293</span>}</div>
</div>
<div class="line"><a id="l03294" name="l03294"></a><span class="lineno"> 3294</span> </div>
<div class="line"><a id="l03295" name="l03295"></a><span class="lineno"> 3295</span><span class="comment">// request EKF yaw reset to try and avoid the need for an EKF lane switch or failsafe</span></div>
<div class="foldopen" id="foldopen03296" data-start="{" data-end="}">
<div class="line"><a id="l03296" name="l03296"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#ac1b0fa5bcccd5c18fdc3b2f19e4f0ba0"> 3296</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#ac1b0fa5bcccd5c18fdc3b2f19e4f0ba0">AP_AHRS::request_yaw_reset</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l03297" name="l03297"></a><span class="lineno"> 3297</span>{</div>
<div class="line"><a id="l03298" name="l03298"></a><span class="lineno"> 3298</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l03299" name="l03299"></a><span class="lineno"> 3299</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l03300" name="l03300"></a><span class="lineno"> 3300</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l03301" name="l03301"></a><span class="lineno"> 3301</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03302" name="l03302"></a><span class="lineno"> 3302</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03303" name="l03303"></a><span class="lineno"> 3303</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l03304" name="l03304"></a><span class="lineno"> 3304</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l03305" name="l03305"></a><span class="lineno"> 3305</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03306" name="l03306"></a><span class="lineno"> 3306</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03307" name="l03307"></a><span class="lineno"> 3307</span> </div>
<div class="line"><a id="l03308" name="l03308"></a><span class="lineno"> 3308</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l03309" name="l03309"></a><span class="lineno"> 3309</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l03310" name="l03310"></a><span class="lineno"> 3310</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03311" name="l03311"></a><span class="lineno"> 3311</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03312" name="l03312"></a><span class="lineno"> 3312</span>        </div>
<div class="line"><a id="l03313" name="l03313"></a><span class="lineno"> 3313</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l03314" name="l03314"></a><span class="lineno"> 3314</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l03315" name="l03315"></a><span class="lineno"> 3315</span>        EKF2.requestYawReset();</div>
<div class="line"><a id="l03316" name="l03316"></a><span class="lineno"> 3316</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03317" name="l03317"></a><span class="lineno"> 3317</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03318" name="l03318"></a><span class="lineno"> 3318</span> </div>
<div class="line"><a id="l03319" name="l03319"></a><span class="lineno"> 3319</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03320" name="l03320"></a><span class="lineno"> 3320</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l03321" name="l03321"></a><span class="lineno"> 3321</span>        EKF3.requestYawReset();</div>
<div class="line"><a id="l03322" name="l03322"></a><span class="lineno"> 3322</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l03323" name="l03323"></a><span class="lineno"> 3323</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03324" name="l03324"></a><span class="lineno"> 3324</span>    }</div>
<div class="line"><a id="l03325" name="l03325"></a><span class="lineno"> 3325</span>}</div>
</div>
<div class="line"><a id="l03326" name="l03326"></a><span class="lineno"> 3326</span> </div>
<div class="line"><a id="l03327" name="l03327"></a><span class="lineno"> 3327</span><span class="comment">// set position, velocity and yaw sources to either 0=primary, 1=secondary, 2=tertiary</span></div>
<div class="foldopen" id="foldopen03328" data-start="{" data-end="}">
<div class="line"><a id="l03328" name="l03328"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a748d92b490eab0fb8e0e639dc6530c06"> 3328</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a748d92b490eab0fb8e0e639dc6530c06">AP_AHRS::set_posvelyaw_source_set</a>(uint8_t source_set_idx)</div>
<div class="line"><a id="l03329" name="l03329"></a><span class="lineno"> 3329</span>{</div>
<div class="line"><a id="l03330" name="l03330"></a><span class="lineno"> 3330</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03331" name="l03331"></a><span class="lineno"> 3331</span>    EKF3.setPosVelYawSourceSet(source_set_idx);</div>
<div class="line"><a id="l03332" name="l03332"></a><span class="lineno"> 3332</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03333" name="l03333"></a><span class="lineno"> 3333</span>}</div>
</div>
<div class="line"><a id="l03334" name="l03334"></a><span class="lineno"> 3334</span> </div>
<div class="line"><a id="l03335" name="l03335"></a><span class="lineno"> 3335</span><span class="comment">//returns active source set used, 0=primary, 1=secondary, 2=tertiary</span></div>
<div class="foldopen" id="foldopen03336" data-start="{" data-end="}">
<div class="line"><a id="l03336" name="l03336"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a67a5b87c29dc4339d47ea5c4022643fe"> 3336</a></span>uint8_t <a class="code hl_function" href="classAP__AHRS.html#a67a5b87c29dc4339d47ea5c4022643fe">AP_AHRS::get_posvelyaw_source_set</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l03337" name="l03337"></a><span class="lineno"> 3337</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03338" name="l03338"></a><span class="lineno"> 3338</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03339" name="l03339"></a><span class="lineno"> 3339</span>    <span class="keywordflow">return</span> EKF3.get_active_source_set();</div>
<div class="line"><a id="l03340" name="l03340"></a><span class="lineno"> 3340</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l03341" name="l03341"></a><span class="lineno"> 3341</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a id="l03342" name="l03342"></a><span class="lineno"> 3342</span><span class="preprocessor">#endif   </span></div>
<div class="line"><a id="l03343" name="l03343"></a><span class="lineno"> 3343</span>}</div>
</div>
<div class="line"><a id="l03344" name="l03344"></a><span class="lineno"> 3344</span> </div>
<div class="foldopen" id="foldopen03345" data-start="{" data-end="}">
<div class="line"><a id="l03345" name="l03345"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a82628d89667ae202e54c16fdb9bbe073"> 3345</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a82628d89667ae202e54c16fdb9bbe073">AP_AHRS::Log_Write</a>()</div>
<div class="line"><a id="l03346" name="l03346"></a><span class="lineno"> 3346</span>{</div>
<div class="line"><a id="l03347" name="l03347"></a><span class="lineno"> 3347</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l03348" name="l03348"></a><span class="lineno"> 3348</span>    EKF2.Log_Write();</div>
<div class="line"><a id="l03349" name="l03349"></a><span class="lineno"> 3349</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03350" name="l03350"></a><span class="lineno"> 3350</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03351" name="l03351"></a><span class="lineno"> 3351</span>    EKF3.Log_Write();</div>
<div class="line"><a id="l03352" name="l03352"></a><span class="lineno"> 3352</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03353" name="l03353"></a><span class="lineno"> 3353</span> </div>
<div class="line"><a id="l03354" name="l03354"></a><span class="lineno"> 3354</span>    <a class="code hl_function" href="classAP__AHRS.html#ad7ad02ea0557a4615f38eab9af6985a0">Write_AHRS2</a>();</div>
<div class="line"><a id="l03355" name="l03355"></a><span class="lineno"> 3355</span>    <a class="code hl_function" href="classAP__AHRS.html#a295a0495d5974e557bbfc71ab8bddd60">Write_POS</a>();</div>
<div class="line"><a id="l03356" name="l03356"></a><span class="lineno"> 3356</span> </div>
<div class="line"><a id="l03357" name="l03357"></a><span class="lineno"> 3357</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l03358" name="l03358"></a><span class="lineno"> 3358</span>    AP::sitl()-&gt;Log_Write_SIMSTATE();</div>
<div class="line"><a id="l03359" name="l03359"></a><span class="lineno"> 3359</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03360" name="l03360"></a><span class="lineno"> 3360</span>}</div>
</div>
<div class="line"><a id="l03361" name="l03361"></a><span class="lineno"> 3361</span> </div>
<div class="line"><a id="l03362" name="l03362"></a><span class="lineno"> 3362</span><span class="comment">// check if non-compass sensor is providing yaw.  Allows compass pre-arm checks to be bypassed</span></div>
<div class="foldopen" id="foldopen03363" data-start="{" data-end="}">
<div class="line"><a id="l03363" name="l03363"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a1e37984ecd2c5ea0bea46e0879fc25ad"> 3363</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a1e37984ecd2c5ea0bea46e0879fc25ad">AP_AHRS::using_noncompass_for_yaw</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l03364" name="l03364"></a><span class="lineno"> 3364</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03365" name="l03365"></a><span class="lineno"> 3365</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l03366" name="l03366"></a><span class="lineno"> 3366</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l03367" name="l03367"></a><span class="lineno"> 3367</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l03368" name="l03368"></a><span class="lineno"> 3368</span>        <span class="keywordflow">return</span> EKF2.isExtNavUsedForYaw();</div>
<div class="line"><a id="l03369" name="l03369"></a><span class="lineno"> 3369</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03370" name="l03370"></a><span class="lineno"> 3370</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l03371" name="l03371"></a><span class="lineno"> 3371</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l03372" name="l03372"></a><span class="lineno"> 3372</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03373" name="l03373"></a><span class="lineno"> 3373</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03374" name="l03374"></a><span class="lineno"> 3374</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l03375" name="l03375"></a><span class="lineno"> 3375</span>        <span class="keywordflow">return</span> EKF3.using_noncompass_for_yaw();</div>
<div class="line"><a id="l03376" name="l03376"></a><span class="lineno"> 3376</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03377" name="l03377"></a><span class="lineno"> 3377</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l03378" name="l03378"></a><span class="lineno"> 3378</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l03379" name="l03379"></a><span class="lineno"> 3379</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03380" name="l03380"></a><span class="lineno"> 3380</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l03381" name="l03381"></a><span class="lineno"> 3381</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l03382" name="l03382"></a><span class="lineno"> 3382</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03383" name="l03383"></a><span class="lineno"> 3383</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>; </div>
<div class="line"><a id="l03384" name="l03384"></a><span class="lineno"> 3384</span>    }</div>
<div class="line"><a id="l03385" name="l03385"></a><span class="lineno"> 3385</span>    <span class="comment">// since there is no default case above, this is unreachable</span></div>
<div class="line"><a id="l03386" name="l03386"></a><span class="lineno"> 3386</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03387" name="l03387"></a><span class="lineno"> 3387</span>}</div>
</div>
<div class="line"><a id="l03388" name="l03388"></a><span class="lineno"> 3388</span> </div>
<div class="line"><a id="l03389" name="l03389"></a><span class="lineno"> 3389</span><span class="comment">// check if external nav is providing yaw</span></div>
<div class="foldopen" id="foldopen03390" data-start="{" data-end="}">
<div class="line"><a id="l03390" name="l03390"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a8b953f388b385ff27c3a7be70e1cbb18"> 3390</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a8b953f388b385ff27c3a7be70e1cbb18">AP_AHRS::using_extnav_for_yaw</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l03391" name="l03391"></a><span class="lineno"> 3391</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03392" name="l03392"></a><span class="lineno"> 3392</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l03393" name="l03393"></a><span class="lineno"> 3393</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l03394" name="l03394"></a><span class="lineno"> 3394</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l03395" name="l03395"></a><span class="lineno"> 3395</span>        <span class="keywordflow">return</span> EKF2.isExtNavUsedForYaw();</div>
<div class="line"><a id="l03396" name="l03396"></a><span class="lineno"> 3396</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03397" name="l03397"></a><span class="lineno"> 3397</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l03398" name="l03398"></a><span class="lineno"> 3398</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l03399" name="l03399"></a><span class="lineno"> 3399</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03400" name="l03400"></a><span class="lineno"> 3400</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03401" name="l03401"></a><span class="lineno"> 3401</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l03402" name="l03402"></a><span class="lineno"> 3402</span>        <span class="keywordflow">return</span> EKF3.using_extnav_for_yaw();</div>
<div class="line"><a id="l03403" name="l03403"></a><span class="lineno"> 3403</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03404" name="l03404"></a><span class="lineno"> 3404</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l03405" name="l03405"></a><span class="lineno"> 3405</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l03406" name="l03406"></a><span class="lineno"> 3406</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03407" name="l03407"></a><span class="lineno"> 3407</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l03408" name="l03408"></a><span class="lineno"> 3408</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l03409" name="l03409"></a><span class="lineno"> 3409</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03410" name="l03410"></a><span class="lineno"> 3410</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03411" name="l03411"></a><span class="lineno"> 3411</span>    }</div>
<div class="line"><a id="l03412" name="l03412"></a><span class="lineno"> 3412</span>    <span class="comment">// since there is no default case above, this is unreachable</span></div>
<div class="line"><a id="l03413" name="l03413"></a><span class="lineno"> 3413</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03414" name="l03414"></a><span class="lineno"> 3414</span>}</div>
</div>
<div class="line"><a id="l03415" name="l03415"></a><span class="lineno"> 3415</span> </div>
<div class="line"><a id="l03416" name="l03416"></a><span class="lineno"> 3416</span><span class="comment">// set and save the alt noise parameter value</span></div>
<div class="foldopen" id="foldopen03417" data-start="{" data-end="}">
<div class="line"><a id="l03417" name="l03417"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a4f23dbb60ef107d28e82544b74d42303"> 3417</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__AHRS.html#a4f23dbb60ef107d28e82544b74d42303">AP_AHRS::set_alt_measurement_noise</a>(<span class="keywordtype">float</span> <a class="code hl_function" href="Derivative_8cpp.html#a430ab649ea04b609ea794c746bfee4ba">noise</a>)</div>
<div class="line"><a id="l03418" name="l03418"></a><span class="lineno"> 3418</span>{</div>
<div class="line"><a id="l03419" name="l03419"></a><span class="lineno"> 3419</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l03420" name="l03420"></a><span class="lineno"> 3420</span>    EKF2.set_baro_alt_noise(<a class="code hl_function" href="Derivative_8cpp.html#a430ab649ea04b609ea794c746bfee4ba">noise</a>);</div>
<div class="line"><a id="l03421" name="l03421"></a><span class="lineno"> 3421</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03422" name="l03422"></a><span class="lineno"> 3422</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03423" name="l03423"></a><span class="lineno"> 3423</span>    EKF3.set_baro_alt_noise(<a class="code hl_function" href="Derivative_8cpp.html#a430ab649ea04b609ea794c746bfee4ba">noise</a>);</div>
<div class="line"><a id="l03424" name="l03424"></a><span class="lineno"> 3424</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03425" name="l03425"></a><span class="lineno"> 3425</span>}</div>
</div>
<div class="line"><a id="l03426" name="l03426"></a><span class="lineno"> 3426</span> </div>
<div class="line"><a id="l03427" name="l03427"></a><span class="lineno"> 3427</span><span class="comment">// check if non-compass sensor is providing yaw.  Allows compass pre-arm checks to be bypassed</span></div>
<div class="foldopen" id="foldopen03428" data-start="{" data-end="}">
<div class="line"><a id="l03428" name="l03428"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a23cf8d9f8874f06a5615a2c7b45856e4"> 3428</a></span><span class="keyword">const</span> <a class="code hl_class" href="classEKFGSF__yaw.html">EKFGSF_yaw</a> *<a class="code hl_function" href="classAP__AHRS.html#a23cf8d9f8874f06a5615a2c7b45856e4">AP_AHRS::get_yaw_estimator</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span></div>
<div class="line"><a id="l03429" name="l03429"></a><span class="lineno"> 3429</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03430" name="l03430"></a><span class="lineno"> 3430</span>    <span class="keywordflow">switch</span> (<a class="code hl_function" href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">active_EKF_type</a>()) {</div>
<div class="line"><a id="l03431" name="l03431"></a><span class="lineno"> 3431</span><span class="preprocessor">#if HAL_NAVEKF2_AVAILABLE</span></div>
<div class="line"><a id="l03432" name="l03432"></a><span class="lineno"> 3432</span>    <span class="keywordflow">case</span> EKFType::TWO:</div>
<div class="line"><a id="l03433" name="l03433"></a><span class="lineno"> 3433</span>        <span class="keywordflow">return</span> EKF2.get_yawEstimator();</div>
<div class="line"><a id="l03434" name="l03434"></a><span class="lineno"> 3434</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03435" name="l03435"></a><span class="lineno"> 3435</span><span class="preprocessor">#if AP_AHRS_DCM_ENABLED</span></div>
<div class="line"><a id="l03436" name="l03436"></a><span class="lineno"> 3436</span>    <span class="keywordflow">case</span> EKFType::DCM:</div>
<div class="line"><a id="l03437" name="l03437"></a><span class="lineno"> 3437</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03438" name="l03438"></a><span class="lineno"> 3438</span>        <span class="keywordflow">return</span> EKF3.get_yawEstimator();</div>
<div class="line"><a id="l03439" name="l03439"></a><span class="lineno"> 3439</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l03440" name="l03440"></a><span class="lineno"> 3440</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l03441" name="l03441"></a><span class="lineno"> 3441</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03442" name="l03442"></a><span class="lineno"> 3442</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03443" name="l03443"></a><span class="lineno"> 3443</span><span class="preprocessor">#if HAL_NAVEKF3_AVAILABLE</span></div>
<div class="line"><a id="l03444" name="l03444"></a><span class="lineno"> 3444</span>    <span class="keywordflow">case</span> EKFType::THREE:</div>
<div class="line"><a id="l03445" name="l03445"></a><span class="lineno"> 3445</span>        <span class="keywordflow">return</span> EKF3.get_yawEstimator();</div>
<div class="line"><a id="l03446" name="l03446"></a><span class="lineno"> 3446</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03447" name="l03447"></a><span class="lineno"> 3447</span><span class="preprocessor">#if AP_AHRS_SIM_ENABLED</span></div>
<div class="line"><a id="l03448" name="l03448"></a><span class="lineno"> 3448</span>    <span class="keywordflow">case</span> EKFType::SIM:</div>
<div class="line"><a id="l03449" name="l03449"></a><span class="lineno"> 3449</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03450" name="l03450"></a><span class="lineno"> 3450</span><span class="preprocessor">#if AP_AHRS_EXTERNAL_ENABLED</span></div>
<div class="line"><a id="l03451" name="l03451"></a><span class="lineno"> 3451</span>    <span class="keywordflow">case</span> EKFType::EXTERNAL:</div>
<div class="line"><a id="l03452" name="l03452"></a><span class="lineno"> 3452</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l03453" name="l03453"></a><span class="lineno"> 3453</span>        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l03454" name="l03454"></a><span class="lineno"> 3454</span>    }</div>
<div class="line"><a id="l03455" name="l03455"></a><span class="lineno"> 3455</span>    <span class="comment">// since there is no default case above, this is unreachable</span></div>
<div class="line"><a id="l03456" name="l03456"></a><span class="lineno"> 3456</span>    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l03457" name="l03457"></a><span class="lineno"> 3457</span>}</div>
</div>
<div class="line"><a id="l03458" name="l03458"></a><span class="lineno"> 3458</span> </div>
<div class="line"><a id="l03459" name="l03459"></a><span class="lineno"> 3459</span><span class="comment">// get current location estimate</span></div>
<div class="foldopen" id="foldopen03460" data-start="{" data-end="}">
<div class="line"><a id="l03460" name="l03460"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a0b6672c6f1c6303a804bc0a5e02ec1af"> 3460</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a0b6672c6f1c6303a804bc0a5e02ec1af">AP_AHRS::get_location</a>(<a class="code hl_class" href="classLocation.html">Location</a> &amp;loc)<span class="keyword"> const</span></div>
<div class="line"><a id="l03461" name="l03461"></a><span class="lineno"> 3461</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03462" name="l03462"></a><span class="lineno"> 3462</span>    loc = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.location;</div>
<div class="line"><a id="l03463" name="l03463"></a><span class="lineno"> 3463</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.location_ok;</div>
<div class="line"><a id="l03464" name="l03464"></a><span class="lineno"> 3464</span>}</div>
</div>
<div class="line"><a id="l03465" name="l03465"></a><span class="lineno"> 3465</span> </div>
<div class="line"><a id="l03466" name="l03466"></a><span class="lineno"> 3466</span><span class="comment">// return a wind estimation vector, in m/s; returns 0,0,0 on failure</span></div>
<div class="line"><a id="l03467" name="l03467"></a><span class="lineno"> 3467</span><span class="keywordtype">bool</span> <a class="code hl_variable" href="classAP__AHRS.html#ab5c7311347bff1f1007b84ba94245e00">AP_AHRS::wind_estimate</a>(<a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;<a class="code hl_variable" href="ardupilot__SITL__QUAD_8h.html#ae4ebf6c3b1fa52d71d50bf1064a7eb14">wind</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l03468" name="l03468"></a><span class="lineno"> 3468</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03469" name="l03469"></a><span class="lineno"> 3469</span>    <a class="code hl_variable" href="ardupilot__SITL__QUAD_8h.html#ae4ebf6c3b1fa52d71d50bf1064a7eb14">wind</a> = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.wind_estimate;</div>
<div class="line"><a id="l03470" name="l03470"></a><span class="lineno"> 3470</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.wind_estimate_ok;</div>
<div class="line"><a id="l03471" name="l03471"></a><span class="lineno"> 3471</span>}</div>
<div class="line"><a id="l03472" name="l03472"></a><span class="lineno"> 3472</span> </div>
<div class="line"><a id="l03473" name="l03473"></a><span class="lineno"> 3473</span><span class="comment">// return an airspeed estimate if available. return true</span></div>
<div class="line"><a id="l03474" name="l03474"></a><span class="lineno"> 3474</span><span class="comment">// if we have an estimate</span></div>
<div class="foldopen" id="foldopen03475" data-start="{" data-end="}">
<div class="line"><a id="l03475" name="l03475"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a69088a3b05155cc99c84feca718dd6cb"> 3475</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a69088a3b05155cc99c84feca718dd6cb">AP_AHRS::airspeed_estimate</a>(<span class="keywordtype">float</span> &amp;airspeed_ret)<span class="keyword"> const</span></div>
<div class="line"><a id="l03476" name="l03476"></a><span class="lineno"> 3476</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03477" name="l03477"></a><span class="lineno"> 3477</span>    airspeed_ret = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed;</div>
<div class="line"><a id="l03478" name="l03478"></a><span class="lineno"> 3478</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed_ok;</div>
<div class="line"><a id="l03479" name="l03479"></a><span class="lineno"> 3479</span>}</div>
</div>
<div class="line"><a id="l03480" name="l03480"></a><span class="lineno"> 3480</span> </div>
<div class="line"><a id="l03481" name="l03481"></a><span class="lineno"> 3481</span><span class="comment">// return an airspeed estimate if available. return true</span></div>
<div class="line"><a id="l03482" name="l03482"></a><span class="lineno"> 3482</span><span class="comment">// if we have an estimate</span></div>
<div class="foldopen" id="foldopen03483" data-start="{" data-end="}">
<div class="line"><a id="l03483" name="l03483"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#ae0e54e3ed4c4cc9d6f26360464521aa2"> 3483</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a69088a3b05155cc99c84feca718dd6cb">AP_AHRS::airspeed_estimate</a>(<span class="keywordtype">float</span> &amp;airspeed_ret, <a class="code hl_enumeration" href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8">AP_AHRS::AirspeedEstimateType</a> &amp;<a class="code hl_struct" href="structtype.html">type</a>)<span class="keyword"> const</span></div>
<div class="line"><a id="l03484" name="l03484"></a><span class="lineno"> 3484</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03485" name="l03485"></a><span class="lineno"> 3485</span>    airspeed_ret = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed;</div>
<div class="line"><a id="l03486" name="l03486"></a><span class="lineno"> 3486</span>    <a class="code hl_struct" href="structtype.html">type</a> = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed_estimate_type;</div>
<div class="line"><a id="l03487" name="l03487"></a><span class="lineno"> 3487</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed_ok;</div>
<div class="line"><a id="l03488" name="l03488"></a><span class="lineno"> 3488</span>}</div>
</div>
<div class="line"><a id="l03489" name="l03489"></a><span class="lineno"> 3489</span> </div>
<div class="line"><a id="l03490" name="l03490"></a><span class="lineno"> 3490</span><span class="comment">// return a true airspeed estimate (navigation airspeed) if</span></div>
<div class="line"><a id="l03491" name="l03491"></a><span class="lineno"> 3491</span><span class="comment">// available. return true if we have an estimate</span></div>
<div class="foldopen" id="foldopen03492" data-start="{" data-end="}">
<div class="line"><a id="l03492" name="l03492"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a386aaa19b561b019b02ac662c5de355e"> 3492</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a386aaa19b561b019b02ac662c5de355e">AP_AHRS::airspeed_estimate_true</a>(<span class="keywordtype">float</span> &amp;airspeed_ret)<span class="keyword"> const</span></div>
<div class="line"><a id="l03493" name="l03493"></a><span class="lineno"> 3493</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03494" name="l03494"></a><span class="lineno"> 3494</span>    airspeed_ret = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed_true;</div>
<div class="line"><a id="l03495" name="l03495"></a><span class="lineno"> 3495</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed_true_ok;</div>
<div class="line"><a id="l03496" name="l03496"></a><span class="lineno"> 3496</span>}</div>
</div>
<div class="line"><a id="l03497" name="l03497"></a><span class="lineno"> 3497</span> </div>
<div class="line"><a id="l03498" name="l03498"></a><span class="lineno"> 3498</span><span class="comment">// return estimate of true airspeed vector in body frame in m/s</span></div>
<div class="line"><a id="l03499" name="l03499"></a><span class="lineno"> 3499</span><span class="comment">// returns false if estimate is unavailable</span></div>
<div class="foldopen" id="foldopen03500" data-start="{" data-end="}">
<div class="line"><a id="l03500" name="l03500"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a50390a14e350fad0d65dd9773ae6fcf5"> 3500</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a50390a14e350fad0d65dd9773ae6fcf5">AP_AHRS::airspeed_vector_true</a>(<a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;vec)<span class="keyword"> const</span></div>
<div class="line"><a id="l03501" name="l03501"></a><span class="lineno"> 3501</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03502" name="l03502"></a><span class="lineno"> 3502</span>    vec = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed_vec;</div>
<div class="line"><a id="l03503" name="l03503"></a><span class="lineno"> 3503</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.airspeed_vec_ok;</div>
<div class="line"><a id="l03504" name="l03504"></a><span class="lineno"> 3504</span>}</div>
</div>
<div class="line"><a id="l03505" name="l03505"></a><span class="lineno"> 3505</span> </div>
<div class="line"><a id="l03506" name="l03506"></a><span class="lineno"> 3506</span><span class="comment">// return the quaternion defining the rotation from NED to XYZ (body) axes</span></div>
<div class="foldopen" id="foldopen03507" data-start="{" data-end="}">
<div class="line"><a id="l03507" name="l03507"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a8297f839e21bd185928caa3966398eb0"> 3507</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a8297f839e21bd185928caa3966398eb0">AP_AHRS::get_quaternion</a>(<a class="code hl_class" href="classQuaternionT.html">Quaternion</a> &amp;quat)<span class="keyword"> const</span></div>
<div class="line"><a id="l03508" name="l03508"></a><span class="lineno"> 3508</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03509" name="l03509"></a><span class="lineno"> 3509</span>    <a class="code hl_variable" href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">quat</a> = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.quat;</div>
<div class="line"><a id="l03510" name="l03510"></a><span class="lineno"> 3510</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.quat_ok;</div>
<div class="line"><a id="l03511" name="l03511"></a><span class="lineno"> 3511</span>}</div>
</div>
<div class="line"><a id="l03512" name="l03512"></a><span class="lineno"> 3512</span> </div>
<div class="line"><a id="l03513" name="l03513"></a><span class="lineno"> 3513</span><span class="comment">// returns the inertial navigation origin in lat/lon/alt</span></div>
<div class="foldopen" id="foldopen03514" data-start="{" data-end="}">
<div class="line"><a id="l03514" name="l03514"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a47bf9dfb4cc0416efe0a2dd8c14c7e56"> 3514</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a47bf9dfb4cc0416efe0a2dd8c14c7e56">AP_AHRS::get_origin</a>(<a class="code hl_class" href="classLocation.html">Location</a> &amp;ret)<span class="keyword"> const</span></div>
<div class="line"><a id="l03515" name="l03515"></a><span class="lineno"> 3515</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03516" name="l03516"></a><span class="lineno"> 3516</span>    ret = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.origin;</div>
<div class="line"><a id="l03517" name="l03517"></a><span class="lineno"> 3517</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.origin_ok;</div>
<div class="line"><a id="l03518" name="l03518"></a><span class="lineno"> 3518</span>}</div>
</div>
<div class="line"><a id="l03519" name="l03519"></a><span class="lineno"> 3519</span> </div>
<div class="line"><a id="l03520" name="l03520"></a><span class="lineno"> 3520</span><span class="comment">// return a ground velocity in meters/second, North/East/Down</span></div>
<div class="line"><a id="l03521" name="l03521"></a><span class="lineno"> 3521</span><span class="comment">// order. Must only be called if have_inertial_nav() is true</span></div>
<div class="foldopen" id="foldopen03522" data-start="{" data-end="}">
<div class="line"><a id="l03522" name="l03522"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a2bf7783e49e2237685ac740055a20866"> 3522</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a2bf7783e49e2237685ac740055a20866">AP_AHRS::get_velocity_NED</a>(<a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;vec)<span class="keyword"> const</span></div>
<div class="line"><a id="l03523" name="l03523"></a><span class="lineno"> 3523</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03524" name="l03524"></a><span class="lineno"> 3524</span>    vec = <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.velocity_NED;</div>
<div class="line"><a id="l03525" name="l03525"></a><span class="lineno"> 3525</span>    <span class="keywordflow">return</span> <a class="code hl_variable" href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">state</a>.velocity_NED_ok;</div>
<div class="line"><a id="l03526" name="l03526"></a><span class="lineno"> 3526</span>}</div>
</div>
<div class="line"><a id="l03527" name="l03527"></a><span class="lineno"> 3527</span> </div>
<div class="line"><a id="l03528" name="l03528"></a><span class="lineno"> 3528</span><span class="comment">// return location corresponding to vector relative to the</span></div>
<div class="line"><a id="l03529" name="l03529"></a><span class="lineno"> 3529</span><span class="comment">// vehicle&#39;s origin</span></div>
<div class="foldopen" id="foldopen03530" data-start="{" data-end="}">
<div class="line"><a id="l03530" name="l03530"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a5d655743705af3aab931da813a3f978f"> 3530</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a5d655743705af3aab931da813a3f978f">AP_AHRS::get_location_from_origin_offset</a>(<a class="code hl_class" href="classLocation.html">Location</a> &amp;loc, <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3p</a> &amp;offset_ned)<span class="keyword"> const</span></div>
<div class="line"><a id="l03531" name="l03531"></a><span class="lineno"> 3531</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03532" name="l03532"></a><span class="lineno"> 3532</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__AHRS.html#a47bf9dfb4cc0416efe0a2dd8c14c7e56">get_origin</a>(loc)) {</div>
<div class="line"><a id="l03533" name="l03533"></a><span class="lineno"> 3533</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03534" name="l03534"></a><span class="lineno"> 3534</span>    }</div>
<div class="line"><a id="l03535" name="l03535"></a><span class="lineno"> 3535</span>    loc.<a class="code hl_function" href="classLocation.html#a146775eb07ce9abcc8d05f1b730404b0">offset</a>(offset_ned);</div>
<div class="line"><a id="l03536" name="l03536"></a><span class="lineno"> 3536</span> </div>
<div class="line"><a id="l03537" name="l03537"></a><span class="lineno"> 3537</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03538" name="l03538"></a><span class="lineno"> 3538</span>}</div>
</div>
<div class="line"><a id="l03539" name="l03539"></a><span class="lineno"> 3539</span> </div>
<div class="line"><a id="l03540" name="l03540"></a><span class="lineno"> 3540</span><span class="comment">// return location corresponding to vector relative to the</span></div>
<div class="line"><a id="l03541" name="l03541"></a><span class="lineno"> 3541</span><span class="comment">// vehicle&#39;s home location</span></div>
<div class="foldopen" id="foldopen03542" data-start="{" data-end="}">
<div class="line"><a id="l03542" name="l03542"></a><span class="lineno"><a class="line" href="classAP__AHRS.html#a57766270705652cb48e55e1da84051f3"> 3542</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__AHRS.html#a57766270705652cb48e55e1da84051f3">AP_AHRS::get_location_from_home_offset</a>(<a class="code hl_class" href="classLocation.html">Location</a> &amp;loc, <span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3p</a> &amp;offset_ned)<span class="keyword"> const</span></div>
<div class="line"><a id="l03543" name="l03543"></a><span class="lineno"> 3543</span><span class="keyword"></span>{</div>
<div class="line"><a id="l03544" name="l03544"></a><span class="lineno"> 3544</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__AHRS.html#a4ffe6b0b13f7f4106740105101fed115">home_is_set</a>()) {</div>
<div class="line"><a id="l03545" name="l03545"></a><span class="lineno"> 3545</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l03546" name="l03546"></a><span class="lineno"> 3546</span>    }</div>
<div class="line"><a id="l03547" name="l03547"></a><span class="lineno"> 3547</span>    loc = <a class="code hl_function" href="classAP__AHRS.html#a8c6d86329f149416dd092d873345bc7f">get_home</a>();</div>
<div class="line"><a id="l03548" name="l03548"></a><span class="lineno"> 3548</span>    loc.<a class="code hl_function" href="classLocation.html#a146775eb07ce9abcc8d05f1b730404b0">offset</a>(offset_ned);</div>
<div class="line"><a id="l03549" name="l03549"></a><span class="lineno"> 3549</span> </div>
<div class="line"><a id="l03550" name="l03550"></a><span class="lineno"> 3550</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l03551" name="l03551"></a><span class="lineno"> 3551</span>}</div>
</div>
<div class="line"><a id="l03552" name="l03552"></a><span class="lineno"> 3552</span> </div>
<div class="line"><a id="l03553" name="l03553"></a><span class="lineno"> 3553</span><span class="comment">// singleton instance</span></div>
<div class="line"><a id="l03554" name="l03554"></a><span class="lineno"> 3554</span><a class="code hl_class" href="classAP__AHRS.html">AP_AHRS</a> *<a class="code hl_variable" href="classAP__AHRS.html#a2e78db63454dfa1e2ef3baa6f7be7b6c">AP_AHRS::_singleton</a>;</div>
<div class="line"><a id="l03555" name="l03555"></a><span class="lineno"> 3555</span> </div>
<div class="line"><a id="l03556" name="l03556"></a><span class="lineno"> 3556</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceAP.html">AP</a> {</div>
<div class="line"><a id="l03557" name="l03557"></a><span class="lineno"> 3557</span> </div>
<div class="foldopen" id="foldopen03558" data-start="{" data-end="}">
<div class="line"><a id="l03558" name="l03558"></a><span class="lineno"><a class="line" href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa"> 3558</a></span><a class="code hl_class" href="classAP__AHRS.html">AP_AHRS</a> &amp;<a class="code hl_function" href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">ahrs</a>()</div>
<div class="line"><a id="l03559" name="l03559"></a><span class="lineno"> 3559</span>{</div>
<div class="line"><a id="l03560" name="l03560"></a><span class="lineno"> 3560</span>    <span class="keywordflow">return</span> *<a class="code hl_function" href="classAP__AHRS.html#af481888f56602f793fc8d9895d14a8c9">AP_AHRS::get_singleton</a>();</div>
<div class="line"><a id="l03561" name="l03561"></a><span class="lineno"> 3561</span>}</div>
</div>
<div class="line"><a id="l03562" name="l03562"></a><span class="lineno"> 3562</span> </div>
<div class="line"><a id="l03563" name="l03563"></a><span class="lineno"> 3563</span>}</div>
<div class="line"><a id="l03564" name="l03564"></a><span class="lineno"> 3564</span> </div>
<div class="line"><a id="l03565" name="l03565"></a><span class="lineno"> 3565</span><span class="preprocessor">#endif  </span><span class="comment">// AP_AHRS_ENABLED</span></div>
<div class="ttc" id="aAC__AttitudeControl_8cpp_html_a240c1a4ae2a70d1855f91e4a0b1ac938"><div class="ttname"><a href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__AK09916_8cpp_source.html#l00059">AP_Compass_AK09916.cpp:59</a></div></div>
<div class="ttc" id="aAP__AHRS_8cpp_html_a965816a73b6f15fda602e6436414e9ff"><div class="ttname"><a href="AP__AHRS_8cpp.html#a965816a73b6f15fda602e6436414e9ff">HAL_AHRS_EKF_TYPE_DEFAULT</a></div><div class="ttdeci">#define HAL_AHRS_EKF_TYPE_DEFAULT</div><div class="ttdef"><b>Definition</b> <a href="#l00050">AP_AHRS.cpp:50</a></div></div>
<div class="ttc" id="aAP__AHRS_8cpp_html_aa001f83eac61ed153d8ecf8252ce23cd"><div class="ttname"><a href="AP__AHRS_8cpp.html#aa001f83eac61ed153d8ecf8252ce23cd">ATTITUDE_CHECK_THRESH_ROLL_PITCH_RAD</a></div><div class="ttdeci">#define ATTITUDE_CHECK_THRESH_ROLL_PITCH_RAD</div><div class="ttdef"><b>Definition</b> <a href="#l00046">AP_AHRS.cpp:46</a></div></div>
<div class="ttc" id="aAP__AHRS_8cpp_html_add3f02562dfbb7df7d4bd29444d9897e"><div class="ttname"><a href="AP__AHRS_8cpp.html#add3f02562dfbb7df7d4bd29444d9897e">ATTITUDE_CHECK_THRESH_YAW_RAD</a></div><div class="ttdeci">#define ATTITUDE_CHECK_THRESH_YAW_RAD</div><div class="ttdef"><b>Definition</b> <a href="#l00047">AP_AHRS.cpp:47</a></div></div>
<div class="ttc" id="aAP__AHRS_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="AP__AHRS_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition</b> <a href="AC__PID__test_8cpp_source.html#l00021">AC_PID_test.cpp:21</a></div></div>
<div class="ttc" id="aAP__AHRS_8h_html"><div class="ttname"><a href="AP__AHRS_8h.html">AP_AHRS.h</a></div></div>
<div class="ttc" id="aAP__AHRS_8h_html_a6823ea32ab0d0ecff53a677bd68c6a5e"><div class="ttname"><a href="AP__AHRS_8h.html#a6823ea32ab0d0ecff53a677bd68c6a5e">AP_AHRS_NAVEKF_SETTLE_TIME_MS</a></div><div class="ttdeci">#define AP_AHRS_NAVEKF_SETTLE_TIME_MS</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00040">AP_AHRS.h:40</a></div></div>
<div class="ttc" id="aAP__AHRS__Backend_8h_html_abb4caec8fb8ae46a29b81a5304fd20b6a2faec1f9f8cc7f8f40d521c4dd574f49"><div class="ttname"><a href="AP__AHRS__Backend_8h.html#abb4caec8fb8ae46a29b81a5304fd20b6a2faec1f9f8cc7f8f40d521c4dd574f49">GPSUse::Enable</a></div><div class="ttdeci">@ Enable</div></div>
<div class="ttc" id="aAP__AHRS__Backend_8h_html_abb4caec8fb8ae46a29b81a5304fd20b6a9605b58fbbae3ec411d864a08b2a26e3"><div class="ttname"><a href="AP__AHRS__Backend_8h.html#abb4caec8fb8ae46a29b81a5304fd20b6a9605b58fbbae3ec411d864a08b2a26e3">GPSUse::EnableWithHeight</a></div><div class="ttdeci">@ EnableWithHeight</div></div>
<div class="ttc" id="aAP__AHRS__Backend_8h_html_abb4caec8fb8ae46a29b81a5304fd20b6abcfaccebf745acfd5e75351095a5394a"><div class="ttname"><a href="AP__AHRS__Backend_8h.html#abb4caec8fb8ae46a29b81a5304fd20b6abcfaccebf745acfd5e75351095a5394a">GPSUse::Disable</a></div><div class="ttdeci">@ Disable</div></div>
<div class="ttc" id="aAP__AHRS__View_8h_html"><div class="ttname"><a href="AP__AHRS__View_8h.html">AP_AHRS_View.h</a></div></div>
<div class="ttc" id="aAP__AHRS__config_8h_html"><div class="ttname"><a href="AP__AHRS__config_8h.html">AP_AHRS_config.h</a></div></div>
<div class="ttc" id="aAP__Baro_8h_html"><div class="ttname"><a href="AP__Baro_8h.html">AP_Baro.h</a></div></div>
<div class="ttc" id="aAP__BoardConfig_8h_html"><div class="ttname"><a href="AP__BoardConfig_8h.html">AP_BoardConfig.h</a></div></div>
<div class="ttc" id="aAP__Compass_8h_html"><div class="ttname"><a href="AP__Compass_8h.html">AP_Compass.h</a></div></div>
<div class="ttc" id="aAP__CustomRotations_8h_html"><div class="ttname"><a href="AP__CustomRotations_8h.html">AP_CustomRotations.h</a></div></div>
<div class="ttc" id="aAP__ExternalAHRS_8h_html"><div class="ttname"><a href="AP__ExternalAHRS_8h.html">AP_ExternalAHRS.h</a></div></div>
<div class="ttc" id="aAP__GPS_8h_html"><div class="ttname"><a href="AP__GPS_8h.html">AP_GPS.h</a></div></div>
<div class="ttc" id="aAP__HAL_2Semaphores_8h_html_a819dd9ac6de800cdf1014b0a922b67d4"><div class="ttname"><a href="AP__HAL_2Semaphores_8h.html#a819dd9ac6de800cdf1014b0a922b67d4">WITH_SEMAPHORE</a></div><div class="ttdeci">#define WITH_SEMAPHORE(sem)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Semaphores_8h_source.html#l00054">Semaphores.h:54</a></div></div>
<div class="ttc" id="aAP__HAL_8h_html"><div class="ttname"><a href="AP__HAL_8h.html">AP_HAL.h</a></div></div>
<div class="ttc" id="aAP__InertialSensor_8h_html"><div class="ttname"><a href="AP__InertialSensor_8h.html">AP_InertialSensor.h</a></div></div>
<div class="ttc" id="aAP__InternalError_8h_html"><div class="ttname"><a href="AP__InternalError_8h.html">AP_InternalError.h</a></div></div>
<div class="ttc" id="aAP__InternalError_8h_html_a6a214896237158d1318e3368b4b10dfb"><div class="ttname"><a href="AP__InternalError_8h.html#a6a214896237158d1318e3368b4b10dfb">INTERNAL_ERROR</a></div><div class="ttdeci">#define INTERNAL_ERROR(error_number)</div><div class="ttdef"><b>Definition</b> <a href="AP__InternalError_8h_source.html#l00118">AP_InternalError.h:118</a></div></div>
<div class="ttc" id="aAP__Logger_8h_html"><div class="ttname"><a href="AP__Logger_8h.html">AP_Logger.h</a></div></div>
<div class="ttc" id="aAP__Logger_8h_html_abfb7fdeeabd95c90488508e20c5ea981a04fc91bb3ffc8b8a797cd9d374cd203a"><div class="ttname"><a href="AP__Logger_8h.html#abfb7fdeeabd95c90488508e20c5ea981a04fc91bb3ffc8b8a797cd9d374cd203a">LogEvent::SET_HOME</a></div><div class="ttdeci">@ SET_HOME</div></div>
<div class="ttc" id="aAP__Math_8h_html_a49ad7fa2fa2e3d8aa75e8e0ec3f83b99"><div class="ttname"><a href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a></div><div class="ttdeci">static constexpr ftype radians(ftype deg)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00213">AP_Math.h:213</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a5256308fd38a7098b8f95607aa56888f"><div class="ttname"><a href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a></div><div class="ttdeci">#define constrain_float(amt, low, high)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00174">AP_Math.h:174</a></div></div>
<div class="ttc" id="aAP__Module_8h_html"><div class="ttname"><a href="AP__Module_8h.html">AP_Module.h</a></div></div>
<div class="ttc" id="aAP__Notify_8h_html"><div class="ttname"><a href="AP__Notify_8h.html">AP_Notify.h</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00163">AP_Param.h:163</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a78a408c84f2a1bafde256ac650142e4d"><div class="ttname"><a href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, clazz, element, def)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00145">AP_Param.h:145</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_ad9ca22a1e508dceea20feda89a344f9aa6b298bc938d9667ff3d25c0e8b94c349"><div class="ttname"><a href="AP__Param_8h.html#ad9ca22a1e508dceea20feda89a344f9aa6b298bc938d9667ff3d25c0e8b94c349">AP_PARAM_FLOAT</a></div><div class="ttdeci">@ AP_PARAM_FLOAT</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00183">AP_Param.h:183</a></div></div>
<div class="ttc" id="aAP__Scripting_2generator_2src_2main_8c_html_a0c4aa150664a3347db13aeeb47811829"><div class="ttname"><a href="AP__Scripting_2generator_2src_2main_8c.html#a0c4aa150664a3347db13aeeb47811829">source</a></div><div class="ttdeci">FILE * source</div><div class="ttdef"><b>Definition</b> <a href="AP__Scripting_2generator_2src_2main_8c_source.html#l00084">main.c:84</a></div></div>
<div class="ttc" id="aAP__Vehicle__Type_8h_html"><div class="ttname"><a href="AP__Vehicle__Type_8h.html">AP_Vehicle_Type.h</a></div></div>
<div class="ttc" id="aAirspeed_8cpp_html_abfed87a61c42e885ee14d5222b47583f"><div class="ttname"><a href="Airspeed_8cpp.html#abfed87a61c42e885ee14d5222b47583f">airspeed</a></div><div class="ttdeci">AP_Airspeed airspeed</div><div class="ttdef"><b>Definition</b> <a href="Airspeed_8cpp_source.html#l00038">Airspeed.cpp:38</a></div></div>
<div class="ttc" id="aBARO__generic_8cpp_html_a83c33c2542db9ae7ca46bf548b52de7a"><div class="ttname"><a href="BARO__generic_8cpp.html#a83c33c2542db9ae7ca46bf548b52de7a">sitl</a></div><div class="ttdeci">SITL::SIM sitl</div><div class="ttdef"><b>Definition</b> <a href="BARO__generic_8cpp_source.html#l00041">BARO_generic.cpp:41</a></div></div>
<div class="ttc" id="aDerivative_8cpp_html_a430ab649ea04b609ea794c746bfee4ba"><div class="ttname"><a href="Derivative_8cpp.html#a430ab649ea04b609ea794c746bfee4ba">noise</a></div><div class="ttdeci">static float noise(void)</div><div class="ttdef"><b>Definition</b> <a href="Derivative_8cpp_source.html#l00021">Derivative.cpp:21</a></div></div>
<div class="ttc" id="aGCS_8h_html"><div class="ttname"><a href="GCS_8h.html">GCS.h</a></div><div class="ttdoc">Interface definition for the various Ground Control System.</div></div>
<div class="ttc" id="aGCS_8h_html_a266bfe8eda675e1092f045e93932b4a6"><div class="ttname"><a href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a></div><div class="ttdeci">#define GCS_SEND_TEXT(severity, format, args...)</div><div class="ttdef"><b>Definition</b> <a href="GCS_8h_source.html#l01349">GCS.h:1349</a></div></div>
<div class="ttc" id="aGCS_8h_html_ae6c78c8b4fe0e326d9dce475a686e069"><div class="ttname"><a href="GCS_8h.html#ae6c78c8b4fe0e326d9dce475a686e069">GCS_SEND_MESSAGE</a></div><div class="ttdeci">#define GCS_SEND_MESSAGE(msg)</div><div class="ttdef"><b>Definition</b> <a href="GCS_8h_source.html#l01359">GCS.h:1359</a></div></div>
<div class="ttc" id="aGPS__AUTO__test_8cpp_html_a962e3f0f8682f6dedb5a001a70bdd65e"><div class="ttname"><a href="GPS__AUTO__test_8cpp.html#a962e3f0f8682f6dedb5a001a70bdd65e">gps</a></div><div class="ttdeci">static AP_GPS gps</div><div class="ttdef"><b>Definition</b> <a href="GPS__AUTO__test_8cpp_source.html#l00053">GPS_AUTO_test.cpp:53</a></div></div>
<div class="ttc" id="aPrintf_8cpp_html_a48d9522e58fa05906c6dba23e5745a72"><div class="ttname"><a href="Printf_8cpp.html#a48d9522e58fa05906c6dba23e5745a72">v</a></div><div class="ttdeci">float v</div><div class="ttdef"><b>Definition</b> <a href="Printf_8cpp_source.html#l00036">Printf.cpp:36</a></div></div>
<div class="ttc" id="aRCProtocolTest_8cpp_html_ab59cbd9523fdc9601bf57f555a9f8733"><div class="ttname"><a href="RCProtocolTest_8cpp.html#ab59cbd9523fdc9601bf57f555a9f8733">delay_ms</a></div><div class="ttdeci">static void delay_ms(uint32_t ms)</div><div class="ttdef"><b>Definition</b> <a href="RCProtocolTest_8cpp_source.html#l00064">RCProtocolTest.cpp:64</a></div></div>
<div class="ttc" id="aSITL_8h_html"><div class="ttname"><a href="SITL_8h.html">SITL.h</a></div></div>
<div class="ttc" id="aTransferFunctionCheck_8cpp_html_ab84905254d7d9db8e55931846bcf06ea"><div class="ttname"><a href="TransferFunctionCheck_8cpp.html#ab84905254d7d9db8e55931846bcf06ea">type</a></div><div class="ttdeci">enum filter_type type</div></div>
<div class="ttc" id="aap__message_8h_html_abeccfcc1b97df359517df10fa4209991ae245f098f5ee0ec75b4dc6331f769f8f"><div class="ttname"><a href="ap__message_8h.html#abeccfcc1b97df359517df10fa4209991ae245f098f5ee0ec75b4dc6331f769f8f">MSG_HOME</a></div><div class="ttdeci">@ MSG_HOME</div><div class="ttdef"><b>Definition</b> <a href="ap__message_8h_source.html#l00077">ap_message.h:77</a></div></div>
<div class="ttc" id="aap__message_8h_html_abeccfcc1b97df359517df10fa4209991af5b97ab8c9c725ebc1a437d5145a96d9"><div class="ttname"><a href="ap__message_8h.html#abeccfcc1b97df359517df10fa4209991af5b97ab8c9c725ebc1a437d5145a96d9">MSG_ORIGIN</a></div><div class="ttdeci">@ MSG_ORIGIN</div><div class="ttdef"><b>Definition</b> <a href="ap__message_8h_source.html#l00076">ap_message.h:76</a></div></div>
<div class="ttc" id="aardupilot__SITL__QUAD_8h_html_ae4ebf6c3b1fa52d71d50bf1064a7eb14"><div class="ttname"><a href="ardupilot__SITL__QUAD_8h.html#ae4ebf6c3b1fa52d71d50bf1064a7eb14">wind</a></div><div class="ttdeci">VECTOR4F wind</div><div class="ttdef"><b>Definition</b> <a href="ardupilot__SITL__QUAD_8h_source.html#l00044">ardupilot_SITL_QUAD.h:44</a></div></div>
<div class="ttc" id="aclassAP__AHRS__Backend_html_a54021e492180c40343aca0f8b4b0022c"><div class="ttname"><a href="classAP__AHRS__Backend.html#a54021e492180c40343aca0f8b4b0022c">AP_AHRS_Backend::get_EAS2TAS</a></div><div class="ttdeci">static float get_EAS2TAS(void)</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8cpp_source.html#l00267">AP_AHRS_Backend.cpp:267</a></div></div>
<div class="ttc" id="aclassAP__AHRS__View_html_a8a13fdc6ad98352197979e3a88cc564d"><div class="ttname"><a href="classAP__AHRS__View.html#a8a13fdc6ad98352197979e3a88cc564d">AP_AHRS_View::update</a></div><div class="ttdeci">void update()</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__View_8cpp_source.html#l00061">AP_AHRS_View.cpp:61</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html"><div class="ttname"><a href="classAP__AHRS.html">AP_AHRS</a></div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00046">AP_AHRS.h:46</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a00b2b4af62a91a50e14d8cf114b78639"><div class="ttname"><a href="classAP__AHRS.html#a00b2b4af62a91a50e14d8cf114b78639">AP_AHRS::get_rotation_body_to_ned</a></div><div class="ttdeci">const Matrix3f &amp; get_rotation_body_to_ned(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00581">AP_AHRS.h:581</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a02afc2efd90caf67806e50070b5eb214"><div class="ttname"><a href="classAP__AHRS.html#a02afc2efd90caf67806e50070b5eb214">AP_AHRS::send_ekf_status_report</a></div><div class="ttdeci">void send_ekf_status_report(class GCS_MAVLINK &amp;link) const</div><div class="ttdef"><b>Definition</b> <a href="#l02800">AP_AHRS.cpp:2800</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a0521758dfddac16581d3a9bf06f0c701"><div class="ttname"><a href="classAP__AHRS.html#a0521758dfddac16581d3a9bf06f0c701">AP_AHRS::initialised</a></div><div class="ttdeci">bool initialised() const</div><div class="ttdef"><b>Definition</b> <a href="#l02260">AP_AHRS.cpp:2260</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a064ea660e27536417d12b619fd7594e3"><div class="ttname"><a href="classAP__AHRS.html#a064ea660e27536417d12b619fd7594e3">AP_AHRS::earth_to_body</a></div><div class="ttdeci">Vector3f earth_to_body(const Vector3f &amp;v) const</div><div class="ttdef"><b>Definition</b> <a href="#l00307">AP_AHRS.cpp:307</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a06855bb0b9039f54170a861fff9e9fbc"><div class="ttname"><a href="classAP__AHRS.html#a06855bb0b9039f54170a861fff9e9fbc">AP_AHRS::get_relative_position_NED_origin</a></div><div class="ttdeci">bool get_relative_position_NED_origin(Vector3f &amp;vec) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l01638">AP_AHRS.cpp:1638</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a07f652c97b4c53033c6a1c8da0d035cb"><div class="ttname"><a href="classAP__AHRS.html#a07f652c97b4c53033c6a1c8da0d035cb">AP_AHRS::fallback_active_EKF_type</a></div><div class="ttdeci">EKFType fallback_active_EKF_type(void) const</div><div class="ttdef"><b>Definition</b> <a href="#l02042">AP_AHRS.cpp:2042</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a0b6672c6f1c6303a804bc0a5e02ec1af"><div class="ttname"><a href="classAP__AHRS.html#a0b6672c6f1c6303a804bc0a5e02ec1af">AP_AHRS::get_location</a></div><div class="ttdeci">bool get_location(Location &amp;loc) const</div><div class="ttdef"><b>Definition</b> <a href="#l03460">AP_AHRS.cpp:3460</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a0c57bdc4738bc94b08bcefb275598fdb"><div class="ttname"><a href="classAP__AHRS.html#a0c57bdc4738bc94b08bcefb275598fdb">AP_AHRS::update_notify_from_filter_status</a></div><div class="ttdeci">void update_notify_from_filter_status(const nav_filter_status &amp;status)</div><div class="ttdef"><b>Definition</b> <a href="#l00547">AP_AHRS.cpp:547</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a0ce7fb0e943712be46d2ec00e2c7e7de"><div class="ttname"><a href="classAP__AHRS.html#a0ce7fb0e943712be46d2ec00e2c7e7de">AP_AHRS::get_relative_position_D_home</a></div><div class="ttdeci">void get_relative_position_D_home(float &amp;posD) const</div><div class="ttdef"><b>Definition</b> <a href="#l01799">AP_AHRS.cpp:1799</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a0cfd0a7c2590aeab6494df7a50db97b7"><div class="ttname"><a href="classAP__AHRS.html#a0cfd0a7c2590aeab6494df7a50db97b7">AP_AHRS::synthetic_airspeed</a></div><div class="ttdeci">bool synthetic_airspeed(float &amp;ret) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l01084">AP_AHRS.cpp:1084</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a12e4314ea3b442611a838f4844d27920"><div class="ttname"><a href="classAP__AHRS.html#a12e4314ea3b442611a838f4844d27920">AP_AHRS::load_watchdog_home</a></div><div class="ttdeci">void load_watchdog_home()</div><div class="ttdef"><b>Definition</b> <a href="#l02930">AP_AHRS.cpp:2930</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a135c23ad8e28d347f9156db99c5dbc0c"><div class="ttname"><a href="classAP__AHRS.html#a135c23ad8e28d347f9156db99c5dbc0c">AP_AHRS::set_terrain_hgt_stable</a></div><div class="ttdeci">void set_terrain_hgt_stable(bool stable)</div><div class="ttdef"><b>Definition</b> <a href="#l02980">AP_AHRS.cpp:2980</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a13dcf78333b50371c176bf5b6be77251"><div class="ttname"><a href="classAP__AHRS.html#a13dcf78333b50371c176bf5b6be77251">AP_AHRS::active_EKF_type</a></div><div class="ttdeci">EKFType active_EKF_type(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00720">AP_AHRS.h:720</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a1462a4a27a7c1ca619a4039d18387fb6"><div class="ttname"><a href="classAP__AHRS.html#a1462a4a27a7c1ca619a4039d18387fb6">AP_AHRS::_checked_watchdog_home</a></div><div class="ttdeci">bool _checked_watchdog_home</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00777">AP_AHRS.h:777</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a1aa6ee35f06cb726f897aa1b7b3106a4"><div class="ttname"><a href="classAP__AHRS.html#a1aa6ee35f06cb726f897aa1b7b3106a4">AP_AHRS::terrainHgtStableState</a></div><div class="ttdeci">TriState terrainHgtStableState</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00789">AP_AHRS.h:789</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a1ccb16b090fdbe84c6a2afa14b612bd9a41dee249d4015a8e4874f258c41130c3"><div class="ttname"><a href="classAP__AHRS.html#a1ccb16b090fdbe84c6a2afa14b612bd9a41dee249d4015a8e4874f258c41130c3">AP_AHRS::FLAG_ALWAYS_USE_EKF</a></div><div class="ttdeci">@ FLAG_ALWAYS_USE_EKF</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00051">AP_AHRS.h:51</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a1e37984ecd2c5ea0bea46e0879fc25ad"><div class="ttname"><a href="classAP__AHRS.html#a1e37984ecd2c5ea0bea46e0879fc25ad">AP_AHRS::using_noncompass_for_yaw</a></div><div class="ttdeci">bool using_noncompass_for_yaw(void) const</div><div class="ttdef"><b>Definition</b> <a href="#l03363">AP_AHRS.cpp:3363</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a1e7a62d8dd479383855c8d40b4fd5240"><div class="ttname"><a href="classAP__AHRS.html#a1e7a62d8dd479383855c8d40b4fd5240">AP_AHRS::getControlScaleZ</a></div><div class="ttdeci">float getControlScaleZ(void) const</div><div class="ttdef"><b>Definition</b> <a href="#l02427">AP_AHRS.cpp:2427</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a2107b76042de1c58c8f550ea60804ea9"><div class="ttname"><a href="classAP__AHRS.html#a2107b76042de1c58c8f550ea60804ea9">AP_AHRS::_home</a></div><div class="ttdeci">Location _home</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00778">AP_AHRS.h:778</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a23be63851ece875ddc864babfbfafc42"><div class="ttname"><a href="classAP__AHRS.html#a23be63851ece875ddc864babfbfafc42">AP_AHRS::primary_gyro</a></div><div class="ttdeci">uint8_t primary_gyro</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00952">AP_AHRS.h:952</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a23cf8d9f8874f06a5615a2c7b45856e4"><div class="ttname"><a href="classAP__AHRS.html#a23cf8d9f8874f06a5615a2c7b45856e4">AP_AHRS::get_yaw_estimator</a></div><div class="ttdeci">const EKFGSF_yaw * get_yaw_estimator(void) const</div><div class="ttdef"><b>Definition</b> <a href="#l03428">AP_AHRS.cpp:3428</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a24af3c73593c713cbcede5fcfedec1c7"><div class="ttname"><a href="classAP__AHRS.html#a24af3c73593c713cbcede5fcfedec1c7">AP_AHRS::EKFType</a></div><div class="ttdeci">EKFType</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00434">AP_AHRS.h:434</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a25b32d10d2878bbe0d90cd5abf43577c"><div class="ttname"><a href="classAP__AHRS.html#a25b32d10d2878bbe0d90cd5abf43577c">AP_AHRS::getLastVelNorthEastReset</a></div><div class="ttdeci">uint32_t getLastVelNorthEastReset(Vector2f &amp;vel) const</div><div class="ttdef"><b>Definition</b> <a href="#l02684">AP_AHRS.cpp:2684</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a263904852f9b6e65cf7a082e5d999131"><div class="ttname"><a href="classAP__AHRS.html#a263904852f9b6e65cf7a082e5d999131">AP_AHRS::get_filter_status</a></div><div class="ttdeci">bool get_filter_status(nav_filter_status &amp;status) const</div><div class="ttdef"><b>Definition</b> <a href="#l02293">AP_AHRS.cpp:2293</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a267a928eb963f170b58141a10670654f"><div class="ttname"><a href="classAP__AHRS.html#a267a928eb963f170b58141a10670654f">AP_AHRS::_get_primary_accel_index</a></div><div class="ttdeci">uint8_t _get_primary_accel_index(void) const</div><div class="ttdef"><b>Definition</b> <a href="#l03251">AP_AHRS.cpp:3251</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a295a0495d5974e557bbfc71ab8bddd60"><div class="ttname"><a href="classAP__AHRS.html#a295a0495d5974e557bbfc71ab8bddd60">AP_AHRS::Write_POS</a></div><div class="ttdeci">void Write_POS(void) const</div></div>
<div class="ttc" id="aclassAP__AHRS_html_a2aa61744614d8e0ef64803583359a56e"><div class="ttname"><a href="classAP__AHRS.html#a2aa61744614d8e0ef64803583359a56e">AP_AHRS::pitch</a></div><div class="ttdeci">float pitch</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00683">AP_AHRS.h:683</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a2b1eae408a12feccfe34308ef0608e21"><div class="ttname"><a href="classAP__AHRS.html#a2b1eae408a12feccfe34308ef0608e21">AP_AHRS::_last_trim</a></div><div class="ttdeci">Vector3f _last_trim</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00816">AP_AHRS.h:816</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a2bf7783e49e2237685ac740055a20866"><div class="ttname"><a href="classAP__AHRS.html#a2bf7783e49e2237685ac740055a20866">AP_AHRS::get_velocity_NED</a></div><div class="ttdeci">bool get_velocity_NED(Vector3f &amp;vec) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l03522">AP_AHRS.cpp:3522</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a2c6484cfeeca980f350cf3dc334fc0b6a2ffe5c42f0b29db1a440f34016a3f643"><div class="ttname"><a href="classAP__AHRS.html#a2c6484cfeeca980f350cf3dc334fc0b6a2ffe5c42f0b29db1a440f34016a3f643">AP_AHRS::Options::DISABLE_DCM_FALLBACK_FW</a></div><div class="ttdeci">@ DISABLE_DCM_FALLBACK_FW</div></div>
<div class="ttc" id="aclassAP__AHRS_html_a2c6484cfeeca980f350cf3dc334fc0b6aacf5422c4ca48a8d8b8178ae993bef4d"><div class="ttname"><a href="classAP__AHRS.html#a2c6484cfeeca980f350cf3dc334fc0b6aacf5422c4ca48a8d8b8178ae993bef4d">AP_AHRS::Options::DISABLE_DCM_FALLBACK_VTOL</a></div><div class="ttdeci">@ DISABLE_DCM_FALLBACK_VTOL</div></div>
<div class="ttc" id="aclassAP__AHRS_html_a2da3610e7128793894c303e8f79261d6"><div class="ttname"><a href="classAP__AHRS.html#a2da3610e7128793894c303e8f79261d6">AP_AHRS::get_mag_field_NED</a></div><div class="ttdeci">bool get_mag_field_NED(Vector3f &amp;ret) const</div><div class="ttdef"><b>Definition</b> <a href="#l01504">AP_AHRS.cpp:1504</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a2da37c111a5ece04f0aae23fe9706bbe"><div class="ttname"><a href="classAP__AHRS.html#a2da37c111a5ece04f0aae23fe9706bbe">AP_AHRS::_airspeed_estimate_true</a></div><div class="ttdeci">bool _airspeed_estimate_true(float &amp;airspeed_ret) const</div><div class="ttdef"><b>Definition</b> <a href="#l00987">AP_AHRS.cpp:987</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a2e78db63454dfa1e2ef3baa6f7be7b6c"><div class="ttname"><a href="classAP__AHRS.html#a2e78db63454dfa1e2ef3baa6f7be7b6c">AP_AHRS::_singleton</a></div><div class="ttdeci">static AP_AHRS * _singleton</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00689">AP_AHRS.h:689</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a32185e96affb89981a012d83a0a604a0"><div class="ttname"><a href="classAP__AHRS.html#a32185e96affb89981a012d83a0a604a0">AP_AHRS::_airspeed_vector_true</a></div><div class="ttdeci">bool _airspeed_vector_true(Vector3f &amp;vec) const</div><div class="ttdef"><b>Definition</b> <a href="#l01018">AP_AHRS.cpp:1018</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a3402dc7d74d2360c85f8d8f3dec03287"><div class="ttname"><a href="classAP__AHRS.html#a3402dc7d74d2360c85f8d8f3dec03287">AP_AHRS::get_gyro_drift</a></div><div class="ttdeci">const Vector3f &amp; get_gyro_drift(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00083">AP_AHRS.h:83</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a34c0a28db3bc87426f69e34e5949bd8b"><div class="ttname"><a href="classAP__AHRS.html#a34c0a28db3bc87426f69e34e5949bd8b">AP_AHRS::update_trig</a></div><div class="ttdeci">void update_trig(void)</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8cpp_source.html#l00142">AP_AHRS_Backend.cpp:142</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a384a23e205126cf43e91bec9668b7ed0"><div class="ttname"><a href="classAP__AHRS.html#a384a23e205126cf43e91bec9668b7ed0">AP_AHRS::roll</a></div><div class="ttdeci">float roll</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00682">AP_AHRS.h:682</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a386aaa19b561b019b02ac662c5de355e"><div class="ttname"><a href="classAP__AHRS.html#a386aaa19b561b019b02ac662c5de355e">AP_AHRS::airspeed_estimate_true</a></div><div class="ttdeci">bool airspeed_estimate_true(float &amp;airspeed_ret) const</div><div class="ttdef"><b>Definition</b> <a href="#l03492">AP_AHRS.cpp:3492</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a38d0378ea83c46d1edb53fb6f578beaf"><div class="ttname"><a href="classAP__AHRS.html#a38d0378ea83c46d1edb53fb6f578beaf">AP_AHRS::_rsem</a></div><div class="ttdeci">HAL_Semaphore _rsem</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00698">AP_AHRS.h:698</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a39ee4a9201a1d3ecea35eaba1547c4a8"><div class="ttname"><a href="classAP__AHRS.html#a39ee4a9201a1d3ecea35eaba1547c4a8">AP_AHRS::get_wind_estimation_enabled</a></div><div class="ttdeci">bool get_wind_estimation_enabled() const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00110">AP_AHRS.h:110</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a3e17de9d30ca999a6921306ba5d84d16"><div class="ttname"><a href="classAP__AHRS.html#a3e17de9d30ca999a6921306ba5d84d16">AP_AHRS::update_DCM</a></div><div class="ttdeci">void update_DCM()</div></div>
<div class="ttc" id="aclassAP__AHRS_html_a3f21a794d38053d54165b7cb4c862b5e"><div class="ttname"><a href="classAP__AHRS.html#a3f21a794d38053d54165b7cb4c862b5e">AP_AHRS::_get_location</a></div><div class="ttdeci">bool _get_location(Location &amp;loc) const</div><div class="ttdef"><b>Definition</b> <a href="#l00733">AP_AHRS.cpp:733</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a42ca24f998f0f6537dcc9d09258f3615"><div class="ttname"><a href="classAP__AHRS.html#a42ca24f998f0f6537dcc9d09258f3615">AP_AHRS::getLastYawResetAngle</a></div><div class="ttdeci">uint32_t getLastYawResetAngle(float &amp;yawAng)</div><div class="ttdef"><b>Definition</b> <a href="#l02618">AP_AHRS.cpp:2618</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a437923af71a9e14a40fe2d07706603b2"><div class="ttname"><a href="classAP__AHRS.html#a437923af71a9e14a40fe2d07706603b2">AP_AHRS::_get_secondary_quaternion</a></div><div class="ttdeci">bool _get_secondary_quaternion(Quaternion &amp;quat) const</div><div class="ttdef"><b>Definition</b> <a href="#l01230">AP_AHRS.cpp:1230</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a44b2873fb508f655a14ec562bab4be12"><div class="ttname"><a href="classAP__AHRS.html#a44b2873fb508f655a14ec562bab4be12">AP_AHRS::_get_primary_IMU_index</a></div><div class="ttdeci">uint8_t _get_primary_IMU_index(void) const</div><div class="ttdef"><b>Definition</b> <a href="#l03179">AP_AHRS.cpp:3179</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a47bf9dfb4cc0416efe0a2dd8c14c7e56"><div class="ttname"><a href="classAP__AHRS.html#a47bf9dfb4cc0416efe0a2dd8c14c7e56">AP_AHRS::get_origin</a></div><div class="ttdeci">bool get_origin(Location &amp;ret) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l03514">AP_AHRS.cpp:3514</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a47ea335b3b317f0c5e54320f59d5ca8a"><div class="ttname"><a href="classAP__AHRS.html#a47ea335b3b317f0c5e54320f59d5ca8a">AP_AHRS::airspeed_sensor_enabled</a></div><div class="ttdeci">bool airspeed_sensor_enabled(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00180">AP_AHRS.h:180</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a48a5ce86f909df35944d9b988a19e148"><div class="ttname"><a href="classAP__AHRS.html#a48a5ce86f909df35944d9b988a19e148">AP_AHRS::writeExtNavData</a></div><div class="ttdeci">void writeExtNavData(const Vector3f &amp;pos, const Quaternion &amp;quat, float posErr, float angErr, uint32_t timeStamp_ms, uint16_t delay_ms, uint32_t resetTime_ms)</div><div class="ttdef"><b>Definition</b> <a href="#l02355">AP_AHRS.cpp:2355</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a48fb629ec568f54354916fa82801943f"><div class="ttname"><a href="classAP__AHRS.html#a48fb629ec568f54354916fa82801943f">AP_AHRS::_home_locked</a></div><div class="ttdeci">bool _home_locked</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00780">AP_AHRS.h:780</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a49af3c66fd17d4a7f061cb9e90933013"><div class="ttname"><a href="classAP__AHRS.html#a49af3c66fd17d4a7f061cb9e90933013">AP_AHRS::_ekf_type</a></div><div class="ttdeci">AP_Enum&lt; EKFType &gt; _ekf_type</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00705">AP_AHRS.h:705</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a4a17a0fa828d3250fef15bee06459418"><div class="ttname"><a href="classAP__AHRS.html#a4a17a0fa828d3250fef15bee06459418">AP_AHRS::using_airspeed_sensor</a></div><div class="ttdeci">bool using_airspeed_sensor() const</div><div class="ttdef"><b>Definition</b> <a href="#l00856">AP_AHRS.cpp:856</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a4c3c5a511fe50d0baa6062e8106920b7"><div class="ttname"><a href="classAP__AHRS.html#a4c3c5a511fe50d0baa6062e8106920b7">AP_AHRS::get_hgt_ctrl_limit</a></div><div class="ttdeci">bool get_hgt_ctrl_limit(float &amp;limit) const</div><div class="ttdef"><b>Definition</b> <a href="#l02946">AP_AHRS.cpp:2946</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a4edff861ea2d775757a388c158fa9e8c"><div class="ttname"><a href="classAP__AHRS.html#a4edff861ea2d775757a388c158fa9e8c">AP_AHRS::_get_primary_gyro_index</a></div><div class="ttdeci">uint8_t _get_primary_gyro_index(void) const</div><div class="ttdef"><b>Definition</b> <a href="#l03257">AP_AHRS.cpp:3257</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a4f23dbb60ef107d28e82544b74d42303"><div class="ttname"><a href="classAP__AHRS.html#a4f23dbb60ef107d28e82544b74d42303">AP_AHRS::set_alt_measurement_noise</a></div><div class="ttdeci">void set_alt_measurement_noise(float noise)</div><div class="ttdef"><b>Definition</b> <a href="#l03417">AP_AHRS.cpp:3417</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a4ffe6b0b13f7f4106740105101fed115"><div class="ttname"><a href="classAP__AHRS.html#a4ffe6b0b13f7f4106740105101fed115">AP_AHRS::home_is_set</a></div><div class="ttdeci">bool home_is_set(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00538">AP_AHRS.h:538</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a50390a14e350fad0d65dd9773ae6fcf5"><div class="ttname"><a href="classAP__AHRS.html#a50390a14e350fad0d65dd9773ae6fcf5">AP_AHRS::airspeed_vector_true</a></div><div class="ttdeci">bool airspeed_vector_true(Vector3f &amp;vec) const</div><div class="ttdef"><b>Definition</b> <a href="#l03500">AP_AHRS.cpp:3500</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a509c6ae15e8c0bcf550515dc57f07525"><div class="ttname"><a href="classAP__AHRS.html#a509c6ae15e8c0bcf550515dc57f07525">AP_AHRS::get_hagl</a></div><div class="ttdeci">bool get_hagl(float &amp;hagl) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l01604">AP_AHRS.cpp:1604</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a5286f1508ed0f81d4a81086c9bc88d7e"><div class="ttname"><a href="classAP__AHRS.html#a5286f1508ed0f81d4a81086c9bc88d7e">AP_AHRS::_rotation_autopilot_body_to_vehicle_body</a></div><div class="ttdeci">Matrix3f _rotation_autopilot_body_to_vehicle_body</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00818">AP_AHRS.h:818</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a5605d0a2903d9a204e28f414dba85483"><div class="ttname"><a href="classAP__AHRS.html#a5605d0a2903d9a204e28f414dba85483">AP_AHRS::writeBodyFrameOdom</a></div><div class="ttdeci">void writeBodyFrameOdom(float quality, const Vector3f &amp;delPos, const Vector3f &amp;delAng, float delTime, uint32_t timeStamp_ms, uint16_t delay_ms, const Vector3f &amp;posOffset)</div><div class="ttdef"><b>Definition</b> <a href="#l02347">AP_AHRS.cpp:2347</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a57766270705652cb48e55e1da84051f3"><div class="ttname"><a href="classAP__AHRS.html#a57766270705652cb48e55e1da84051f3">AP_AHRS::get_location_from_home_offset</a></div><div class="ttdeci">bool get_location_from_home_offset(Location &amp;loc, const Vector3p &amp;offset_ned) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l03542">AP_AHRS.cpp:3542</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a5ac76f49a420c38807a7076693906ff9"><div class="ttname"><a href="classAP__AHRS.html#a5ac76f49a420c38807a7076693906ff9">AP_AHRS::_get_quaternion</a></div><div class="ttdeci">bool _get_quaternion(Quaternion &amp;quat) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l01127">AP_AHRS.cpp:1127</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a5c987313ac84c5548c4b0c1c387ea933"><div class="ttname"><a href="classAP__AHRS.html#a5c987313ac84c5548c4b0c1c387ea933">AP_AHRS::_board_orientation</a></div><div class="ttdeci">AP_Int8 _board_orientation</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00704">AP_AHRS.h:704</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a5d655743705af3aab931da813a3f978f"><div class="ttname"><a href="classAP__AHRS.html#a5d655743705af3aab931da813a3f978f">AP_AHRS::get_location_from_origin_offset</a></div><div class="ttdeci">bool get_location_from_origin_offset(Location &amp;loc, const Vector3p &amp;offset_ned) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l03530">AP_AHRS.cpp:3530</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a5ddc1265eec2436e4cfd219ed85e754e"><div class="ttname"><a href="classAP__AHRS.html#a5ddc1265eec2436e4cfd219ed85e754e">AP_AHRS::get_innovations</a></div><div class="ttdeci">bool get_innovations(Vector3f &amp;velInnov, Vector3f &amp;posInnov, Vector3f &amp;magInnov, float &amp;tasInnov, float &amp;yawInnov) const</div><div class="ttdef"><b>Definition</b> <a href="#l03010">AP_AHRS.cpp:3010</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a5e12a1b644ef090f6bef12118ccfdc45"><div class="ttname"><a href="classAP__AHRS.html#a5e12a1b644ef090f6bef12118ccfdc45">AP_AHRS::_wind_estimate</a></div><div class="ttdeci">bool _wind_estimate(Vector3f &amp;wind) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l00795">AP_AHRS.cpp:795</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a5fc93e602ca980cb4fb860779f118329"><div class="ttname"><a href="classAP__AHRS.html#a5fc93e602ca980cb4fb860779f118329">AP_AHRS::_should_use_airspeed_sensor</a></div><div class="ttdeci">bool _should_use_airspeed_sensor(uint8_t airspeed_index) const</div><div class="ttdef"><b>Definition</b> <a href="#l00864">AP_AHRS.cpp:864</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a6004cf143cc0cad241c0c59747637933"><div class="ttname"><a href="classAP__AHRS.html#a6004cf143cc0cad241c0c59747637933">AP_AHRS::writeDefaultAirSpeed</a></div><div class="ttdeci">void writeDefaultAirSpeed(float airspeed, float uncertainty)</div><div class="ttdef"><b>Definition</b> <a href="#l02366">AP_AHRS.cpp:2366</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a61594ab53ca717ea37cdd789be94c1a3"><div class="ttname"><a href="classAP__AHRS.html#a61594ab53ca717ea37cdd789be94c1a3">AP_AHRS::get_relative_position_NE_origin</a></div><div class="ttdeci">bool get_relative_position_NE_origin(Vector2f &amp;posNE) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l01706">AP_AHRS.cpp:1706</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a62cff9296af811471d4bdebeebddc8ad"><div class="ttname"><a href="classAP__AHRS.html#a62cff9296af811471d4bdebeebddc8ad">AP_AHRS::get_relative_position_D_origin</a></div><div class="ttdeci">bool get_relative_position_D_origin(float &amp;posD) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l01762">AP_AHRS.cpp:1762</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a63359ca9325c63642050bcf1c3e1cd63"><div class="ttname"><a href="classAP__AHRS.html#a63359ca9325c63642050bcf1c3e1cd63">AP_AHRS::yaw</a></div><div class="ttdeci">float yaw</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00684">AP_AHRS.h:684</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a641b4bea4de708dbfa1d01039bfde2e8"><div class="ttname"><a href="classAP__AHRS.html#a641b4bea4de708dbfa1d01039bfde2e8">AP_AHRS::_rotation_vehicle_body_to_autopilot_body</a></div><div class="ttdeci">Matrix3f _rotation_vehicle_body_to_autopilot_body</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00819">AP_AHRS.h:819</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a643071d85841345dc40f0da8b1ecd1c8"><div class="ttname"><a href="classAP__AHRS.html#a643071d85841345dc40f0da8b1ecd1c8">AP_AHRS::get_quat_body_to_ned</a></div><div class="ttdeci">void get_quat_body_to_ned(Quaternion &amp;quat) const</div><div class="ttdef"><b>Definition</b> <a href="#l00295">AP_AHRS.cpp:295</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a646f98af1ebb26d8f6d2bcde910f9c04"><div class="ttname"><a href="classAP__AHRS.html#a646f98af1ebb26d8f6d2bcde910f9c04">AP_AHRS::_get_primary_core_index</a></div><div class="ttdeci">int8_t _get_primary_core_index() const</div><div class="ttdef"><b>Definition</b> <a href="#l03215">AP_AHRS.cpp:3215</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a64786b58a1607ee420ed4f0696c755b6"><div class="ttname"><a href="classAP__AHRS.html#a64786b58a1607ee420ed4f0696c755b6">AP_AHRS::get_EAS2TAS</a></div><div class="ttdeci">float get_EAS2TAS(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00144">AP_AHRS.h:144</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a6532311731210cc5f5f26b5c5f702132"><div class="ttname"><a href="classAP__AHRS.html#a6532311731210cc5f5f26b5c5f702132">AP_AHRS::_airspeed_estimate</a></div><div class="ttdeci">bool _airspeed_estimate(float &amp;airspeed_ret, AirspeedEstimateType &amp;status) const</div><div class="ttdef"><b>Definition</b> <a href="#l00885">AP_AHRS.cpp:885</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a676a8a732b2159d1da9683eb556309f9"><div class="ttname"><a href="classAP__AHRS.html#a676a8a732b2159d1da9683eb556309f9">AP_AHRS::attitudes_consistent</a></div><div class="ttdeci">bool attitudes_consistent(char *failure_msg, const uint8_t failure_msg_len) const</div><div class="ttdef"><b>Definition</b> <a href="#l02519">AP_AHRS.cpp:2519</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a67a5b87c29dc4339d47ea5c4022643fe"><div class="ttname"><a href="classAP__AHRS.html#a67a5b87c29dc4339d47ea5c4022643fe">AP_AHRS::get_posvelyaw_source_set</a></div><div class="ttdeci">uint8_t get_posvelyaw_source_set() const</div><div class="ttdef"><b>Definition</b> <a href="#l03336">AP_AHRS.cpp:3336</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a69088a3b05155cc99c84feca718dd6cb"><div class="ttname"><a href="classAP__AHRS.html#a69088a3b05155cc99c84feca718dd6cb">AP_AHRS::airspeed_estimate</a></div><div class="ttdeci">bool airspeed_estimate(float &amp;airspeed_ret) const</div><div class="ttdef"><b>Definition</b> <a href="#l03475">AP_AHRS.cpp:3475</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a697d03969b30e69c38757247027e4656"><div class="ttname"><a href="classAP__AHRS.html#a697d03969b30e69c38757247027e4656">AP_AHRS::_active_EKF_type</a></div><div class="ttdeci">EKFType _active_EKF_type(void) const</div><div class="ttdef"><b>Definition</b> <a href="#l01877">AP_AHRS.cpp:1877</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a6a5554b1eadd5417a4d1c60c5f0cc6a5"><div class="ttname"><a href="classAP__AHRS.html#a6a5554b1eadd5417a4d1c60c5f0cc6a5">AP_AHRS::groundspeed_vector</a></div><div class="ttdeci">const Vector2f &amp; groundspeed_vector() const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00222">AP_AHRS.h:222</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a6fae501cf684edb9174bd985998d0aa1"><div class="ttname"><a href="classAP__AHRS.html#a6fae501cf684edb9174bd985998d0aa1">AP_AHRS::wind_alignment</a></div><div class="ttdeci">float wind_alignment(const float heading_deg) const</div><div class="ttdef"><b>Definition</b> <a href="#l00834">AP_AHRS.cpp:834</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a71b7d8dd78fe4331472534a4d5b6b95d"><div class="ttname"><a href="classAP__AHRS.html#a71b7d8dd78fe4331472534a4d5b6b95d">AP_AHRS::head_wind</a></div><div class="ttdeci">float head_wind(void) const</div><div class="ttdef"><b>Definition</b> <a href="#l00847">AP_AHRS.cpp:847</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a7216e2b7b02f86d522fac87e36644668"><div class="ttname"><a href="classAP__AHRS.html#a7216e2b7b02f86d522fac87e36644668">AP_AHRS::set_failure_inconsistent_message</a></div><div class="ttdeci">void set_failure_inconsistent_message(const char *estimator, const char *axis, float diff_rad, char *failure_msg, const uint8_t failure_msg_len) const</div><div class="ttdef"><b>Definition</b> <a href="#l02513">AP_AHRS.cpp:2513</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a7284d5e65c5863f5678b4d93000b116e"><div class="ttname"><a href="classAP__AHRS.html#a7284d5e65c5863f5678b4d93000b116e">AP_AHRS::update_orientation</a></div><div class="ttdeci">void update_orientation()</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8cpp_source.html#l00071">AP_AHRS_Backend.cpp:71</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a728d515f75fd504fba2beeaa1bb61552"><div class="ttname"><a href="classAP__AHRS.html#a728d515f75fd504fba2beeaa1bb61552">AP_AHRS::is_vibration_affected</a></div><div class="ttdeci">bool is_vibration_affected() const</div><div class="ttdef"><b>Definition</b> <a href="#l03046">AP_AHRS.cpp:3046</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a7328e4bc4caf3cb87a16915edcde932e"><div class="ttname"><a href="classAP__AHRS.html#a7328e4bc4caf3cb87a16915edcde932e">AP_AHRS::update_AOA_SSA</a></div><div class="ttdeci">void update_AOA_SSA(void)</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8cpp_source.html#l00187">AP_AHRS_Backend.cpp:187</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a748d92b490eab0fb8e0e639dc6530c06"><div class="ttname"><a href="classAP__AHRS.html#a748d92b490eab0fb8e0e639dc6530c06">AP_AHRS::set_posvelyaw_source_set</a></div><div class="ttdeci">void set_posvelyaw_source_set(uint8_t source_set_idx)</div><div class="ttdef"><b>Definition</b> <a href="#l03328">AP_AHRS.cpp:3328</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a75f0a23d4fde6c4fd8d76db586380e0e"><div class="ttname"><a href="classAP__AHRS.html#a75f0a23d4fde6c4fd8d76db586380e0e">AP_AHRS::_get_secondary_attitude</a></div><div class="ttdeci">bool _get_secondary_attitude(Vector3f &amp;eulers) const</div><div class="ttdef"><b>Definition</b> <a href="#l01175">AP_AHRS.cpp:1175</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a763ba621dc68e75e5929ba4dba266d33"><div class="ttname"><a href="classAP__AHRS.html#a763ba621dc68e75e5929ba4dba266d33">AP_AHRS::get_relative_position_NE_home</a></div><div class="ttdeci">bool get_relative_position_NE_home(Vector2f &amp;posNE) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l01744">AP_AHRS.cpp:1744</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a7a0bc2e33f18a2e0e352242bb4f9776e"><div class="ttname"><a href="classAP__AHRS.html#a7a0bc2e33f18a2e0e352242bb4f9776e">AP_AHRS::accel_bias</a></div><div class="ttdeci">Vector3f accel_bias</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00959">AP_AHRS.h:959</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a7a617dbe1beb19c71581b84d7416f2dea2c1e536ff3602f3f02665d9658dc8125"><div class="ttname"><a href="classAP__AHRS.html#a7a617dbe1beb19c71581b84d7416f2dea2c1e536ff3602f3f02665d9658dc8125">AP_AHRS::VehicleClass::FIXED_WING</a></div><div class="ttdeci">@ FIXED_WING</div></div>
<div class="ttc" id="aclassAP__AHRS_html_a7a617dbe1beb19c71581b84d7416f2deadedcb56e75fe1488e20865e0ea36d0b9"><div class="ttname"><a href="classAP__AHRS.html#a7a617dbe1beb19c71581b84d7416f2deadedcb56e75fe1488e20865e0ea36d0b9">AP_AHRS::VehicleClass::GROUND</a></div><div class="ttdeci">@ GROUND</div></div>
<div class="ttc" id="aclassAP__AHRS_html_a7fb314b5977fea695ce9ee9611d867b0"><div class="ttname"><a href="classAP__AHRS.html#a7fb314b5977fea695ce9ee9611d867b0">AP_AHRS::update_state</a></div><div class="ttdeci">void update_state(void)</div><div class="ttdef"><b>Definition</b> <a href="#l00340">AP_AHRS.cpp:340</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a82628d89667ae202e54c16fdb9bbe073"><div class="ttname"><a href="classAP__AHRS.html#a82628d89667ae202e54c16fdb9bbe073">AP_AHRS::Log_Write</a></div><div class="ttdeci">void Log_Write()</div><div class="ttdef"><b>Definition</b> <a href="#l03345">AP_AHRS.cpp:3345</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a8297f839e21bd185928caa3966398eb0"><div class="ttname"><a href="classAP__AHRS.html#a8297f839e21bd185928caa3966398eb0">AP_AHRS::get_quaternion</a></div><div class="ttdeci">bool get_quaternion(Quaternion &amp;quat) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l03507">AP_AHRS.cpp:3507</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a83be0822de0a592e217220c8c0102b5b"><div class="ttname"><a href="classAP__AHRS.html#a83be0822de0a592e217220c8c0102b5b">AP_AHRS::getLastPosNorthEastReset</a></div><div class="ttdeci">uint32_t getLastPosNorthEastReset(Vector2f &amp;pos)</div><div class="ttdef"><b>Definition</b> <a href="#l02651">AP_AHRS.cpp:2651</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a85f9b24c849523630615e52bdf268f2e"><div class="ttname"><a href="classAP__AHRS.html#a85f9b24c849523630615e52bdf268f2e">AP_AHRS::TriState</a></div><div class="ttdeci">TriState</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00783">AP_AHRS.h:783</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a85f9b24c849523630615e52bdf268f2ea696b031073e74bf2cb98e5ef201d4aa3"><div class="ttname"><a href="classAP__AHRS.html#a85f9b24c849523630615e52bdf268f2ea696b031073e74bf2cb98e5ef201d4aa3">AP_AHRS::TriState::UNKNOWN</a></div><div class="ttdeci">@ UNKNOWN</div></div>
<div class="ttc" id="aclassAP__AHRS_html_a85f9b24c849523630615e52bdf268f2eaf827cf462f62848df37c5e1e94a4da74"><div class="ttname"><a href="classAP__AHRS.html#a85f9b24c849523630615e52bdf268f2eaf827cf462f62848df37c5e1e94a4da74">AP_AHRS::TriState::True</a></div><div class="ttdeci">@ True</div></div>
<div class="ttc" id="aclassAP__AHRS_html_a85f9b24c849523630615e52bdf268f2eaf8320b26d30ab433c5a54546d21f414c"><div class="ttname"><a href="classAP__AHRS.html#a85f9b24c849523630615e52bdf268f2eaf8320b26d30ab433c5a54546d21f414c">AP_AHRS::TriState::False</a></div><div class="ttdeci">@ False</div></div>
<div class="ttc" id="aclassAP__AHRS_html_a8714e59e0b78c781ac5bbee21e22abb8"><div class="ttname"><a href="classAP__AHRS.html#a8714e59e0b78c781ac5bbee21e22abb8">AP_AHRS::resetHeightDatum</a></div><div class="ttdeci">bool resetHeightDatum()</div><div class="ttdef"><b>Definition</b> <a href="#l02753">AP_AHRS.cpp:2753</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a87bf306f55bea39a4fc5b41179961c01"><div class="ttname"><a href="classAP__AHRS.html#a87bf306f55bea39a4fc5b41179961c01">AP_AHRS::copy_estimates_from_backend_estimates</a></div><div class="ttdeci">void copy_estimates_from_backend_estimates(const AP_AHRS_Backend::Estimates &amp;results)</div><div class="ttdef"><b>Definition</b> <a href="#l00500">AP_AHRS.cpp:500</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a89d3f4c63809e5e5ff4d3c4a61969e4c"><div class="ttname"><a href="classAP__AHRS.html#a89d3f4c63809e5e5ff4d3c4a61969e4c">AP_AHRS::_home_is_set</a></div><div class="ttdeci">bool _home_is_set</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00779">AP_AHRS.h:779</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a8a160130dd99016a19abab9d85917261"><div class="ttname"><a href="classAP__AHRS.html#a8a160130dd99016a19abab9d85917261">AP_AHRS::yaw_sensor</a></div><div class="ttdeci">int32_t yaw_sensor</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00579">AP_AHRS.h:579</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a8aacdd3ef702934629571099981f6379"><div class="ttname"><a href="classAP__AHRS.html#a8aacdd3ef702934629571099981f6379">AP_AHRS::body_to_earth</a></div><div class="ttdeci">Vector3f body_to_earth(const Vector3f &amp;v) const</div><div class="ttdef"><b>Definition</b> <a href="#l00301">AP_AHRS.cpp:301</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a8b953f388b385ff27c3a7be70e1cbb18"><div class="ttname"><a href="classAP__AHRS.html#a8b953f388b385ff27c3a7be70e1cbb18">AP_AHRS::using_extnav_for_yaw</a></div><div class="ttdeci">bool using_extnav_for_yaw(void) const</div><div class="ttdef"><b>Definition</b> <a href="#l03390">AP_AHRS.cpp:3390</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a8bf3f8d2410b5456bc43b937c872e6bb"><div class="ttname"><a href="classAP__AHRS.html#a8bf3f8d2410b5456bc43b937c872e6bb">AP_AHRS::update_cd_values</a></div><div class="ttdeci">void update_cd_values(void)</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8cpp_source.html#l00152">AP_AHRS_Backend.cpp:152</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a8c6d86329f149416dd092d873345bc7f"><div class="ttname"><a href="classAP__AHRS.html#a8c6d86329f149416dd092d873345bc7f">AP_AHRS::get_home</a></div><div class="ttdeci">const Location &amp; get_home(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00524">AP_AHRS.h:524</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a8d26e5f7cfe2eaf4661fa317f2728db4"><div class="ttname"><a href="classAP__AHRS.html#a8d26e5f7cfe2eaf4661fa317f2728db4">AP_AHRS::_vehicle_class</a></div><div class="ttdeci">VehicleClass _vehicle_class</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00695">AP_AHRS.h:695</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a8e585d137f8f1b4e008bd1f38f55d9b7"><div class="ttname"><a href="classAP__AHRS.html#a8e585d137f8f1b4e008bd1f38f55d9b7">AP_AHRS::update_flags</a></div><div class="ttdeci">void update_flags()</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8cpp_source.html#l00292">AP_AHRS_Backend.cpp:292</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a907147b77397e9d66f08bc5bdde26627"><div class="ttname"><a href="classAP__AHRS.html#a907147b77397e9d66f08bc5bdde26627">AP_AHRS::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdef"><b>Definition</b> <a href="#l00704">AP_AHRS.cpp:704</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a97a6e31baabfe1ac8ab514fb6f41c591"><div class="ttname"><a href="classAP__AHRS.html#a97a6e31baabfe1ac8ab514fb6f41c591">AP_AHRS::check_lane_switch</a></div><div class="ttdeci">void check_lane_switch(void)</div><div class="ttdef"><b>Definition</b> <a href="#l03263">AP_AHRS.cpp:3263</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a99267bd1222d598fcc5f628066b7b981"><div class="ttname"><a href="classAP__AHRS.html#a99267bd1222d598fcc5f628066b7b981">AP_AHRS::get_mag_field_correction</a></div><div class="ttdeci">bool get_mag_field_correction(Vector3f &amp;ret) const</div><div class="ttdef"><b>Definition</b> <a href="#l01536">AP_AHRS.cpp:1536</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a9969f325139cc43ff49fc76904d3f0a2"><div class="ttname"><a href="classAP__AHRS.html#a9969f325139cc43ff49fc76904d3f0a2">AP_AHRS::update</a></div><div class="ttdeci">void update(bool skip_ins_update=false)</div><div class="ttdef"><b>Definition</b> <a href="#l00363">AP_AHRS.cpp:363</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a9a52ca012478b371f6fd5c91d0b891be"><div class="ttname"><a href="classAP__AHRS.html#a9a52ca012478b371f6fd5c91d0b891be">AP_AHRS::_groundspeed</a></div><div class="ttdeci">float _groundspeed(void)</div><div class="ttdef"><b>Definition</b> <a href="#l01375">AP_AHRS.cpp:1375</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a9ae31db83d66c1fe4d11125a34a1163b"><div class="ttname"><a href="classAP__AHRS.html#a9ae31db83d66c1fe4d11125a34a1163b">AP_AHRS::fly_forward</a></div><div class="ttdeci">bool fly_forward</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00850">AP_AHRS.h:850</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_a9bf7361f77c132adec1b00f52dc78980"><div class="ttname"><a href="classAP__AHRS.html#a9bf7361f77c132adec1b00f52dc78980">AP_AHRS::have_inertial_nav</a></div><div class="ttdeci">bool have_inertial_nav() const</div><div class="ttdef"><b>Definition</b> <a href="#l01459">AP_AHRS.cpp:1459</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_aa3dd7d322825c6c714a59d7378e6c29b"><div class="ttname"><a href="classAP__AHRS.html#aa3dd7d322825c6c714a59d7378e6c29b">AP_AHRS::airspeed_estimate_type</a></div><div class="ttdeci">AirspeedEstimateType airspeed_estimate_type</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00965">AP_AHRS.h:965</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_aa6a48349ade83ef20981f85bf5364cb5"><div class="ttname"><a href="classAP__AHRS.html#aa6a48349ade83ef20981f85bf5364cb5">AP_AHRS::_trim</a></div><div class="ttdeci">AP_Vector3f _trim</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00813">AP_AHRS.h:813</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_aa7cca27b944af662728a34e241f2c0fa"><div class="ttname"><a href="classAP__AHRS.html#aa7cca27b944af662728a34e241f2c0fa">AP_AHRS::_groundspeed_vector</a></div><div class="ttdeci">Vector2f _groundspeed_vector(void)</div><div class="ttdef"><b>Definition</b> <a href="#l01338">AP_AHRS.cpp:1338</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_aabe74303db6c3bada267e646efb1e32c"><div class="ttname"><a href="classAP__AHRS.html#aabe74303db6c3bada267e646efb1e32c">AP_AHRS::start_time_ms</a></div><div class="ttdeci">uint32_t start_time_ms</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00767">AP_AHRS.h:767</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_aace59e4b88b49d0c25780545a6f6a872"><div class="ttname"><a href="classAP__AHRS.html#aace59e4b88b49d0c25780545a6f6a872">AP_AHRS::startup_delay_ms</a></div><div class="ttdeci">const uint16_t startup_delay_ms</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00766">AP_AHRS.h:766</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_aad11f5ece3c65e8f15ec46f7f7eb6ce3"><div class="ttname"><a href="classAP__AHRS.html#aad11f5ece3c65e8f15ec46f7f7eb6ce3">AP_AHRS::get_rotation_autopilot_body_to_vehicle_body</a></div><div class="ttdeci">const Matrix3f &amp; get_rotation_autopilot_body_to_vehicle_body(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00494">AP_AHRS.h:494</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ab22b10e389fa8dc66f67d7c60ee2a3ff"><div class="ttname"><a href="classAP__AHRS.html#ab22b10e389fa8dc66f67d7c60ee2a3ff">AP_AHRS::healthy</a></div><div class="ttdeci">bool healthy() const</div><div class="ttdef"><b>Definition</b> <a href="#l02128">AP_AHRS.cpp:2128</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ab2dca8fa6893500c108ef684e53e283d"><div class="ttname"><a href="classAP__AHRS.html#ab2dca8fa6893500c108ef684e53e283d">AP_AHRS::get_relative_position_NED_home</a></div><div class="ttdeci">bool get_relative_position_NED_home(Vector3f &amp;vec) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l01692">AP_AHRS.cpp:1692</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ab4896dc4fbda9a88f27522d3740bb439"><div class="ttname"><a href="classAP__AHRS.html#ab4896dc4fbda9a88f27522d3740bb439">AP_AHRS::ground_speed</a></div><div class="ttdeci">float ground_speed</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00981">AP_AHRS.h:981</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ab5c7311347bff1f1007b84ba94245e00"><div class="ttname"><a href="classAP__AHRS.html#ab5c7311347bff1f1007b84ba94245e00">AP_AHRS::wind_estimate</a></div><div class="ttdeci">Vector3f wind_estimate</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00960">AP_AHRS.h:960</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ab6e2d39bc4cee69c6532549694d694cd"><div class="ttname"><a href="classAP__AHRS.html#ab6e2d39bc4cee69c6532549694d694cd">AP_AHRS::always_use_EKF</a></div><div class="ttdeci">bool always_use_EKF() const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00722">AP_AHRS.h:722</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ab77dd670942d7b56013214bd72474db8"><div class="ttname"><a href="classAP__AHRS.html#ab77dd670942d7b56013214bd72474db8">AP_AHRS::quat</a></div><div class="ttdeci">Quaternion quat</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00970">AP_AHRS.h:970</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ab89a5d109e3ea9c6f38ee13c3216ddd1"><div class="ttname"><a href="classAP__AHRS.html#ab89a5d109e3ea9c6f38ee13c3216ddd1">AP_AHRS::get_vert_pos_rate_D</a></div><div class="ttdeci">bool get_vert_pos_rate_D(float &amp;velocity) const</div><div class="ttdef"><b>Definition</b> <a href="#l01570">AP_AHRS.cpp:1570</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ab9254f22fbfcb96c06a17ab8640cf7d8"><div class="ttname"><a href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8">AP_AHRS::AirspeedEstimateType</a></div><div class="ttdeci">AirspeedEstimateType</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00152">AP_AHRS.h:152</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ab9254f22fbfcb96c06a17ab8640cf7d8a0ad871f88be8264be50fb693d51d0e28"><div class="ttname"><a href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8a0ad871f88be8264be50fb693d51d0e28">AP_AHRS::AIRSPEED_SENSOR</a></div><div class="ttdeci">@ AIRSPEED_SENSOR</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00154">AP_AHRS.h:154</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ab9254f22fbfcb96c06a17ab8640cf7d8a2532db9cf7deeaf307b6bb461c4507f6"><div class="ttname"><a href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8a2532db9cf7deeaf307b6bb461c4507f6">AP_AHRS::DCM_SYNTHETIC</a></div><div class="ttdeci">@ DCM_SYNTHETIC</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00155">AP_AHRS.h:155</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ab9254f22fbfcb96c06a17ab8640cf7d8a35b9f702263d352193bbe6273d0a0ecd"><div class="ttname"><a href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8a35b9f702263d352193bbe6273d0a0ecd">AP_AHRS::EKF3_SYNTHETIC</a></div><div class="ttdeci">@ EKF3_SYNTHETIC</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00156">AP_AHRS.h:156</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ab9254f22fbfcb96c06a17ab8640cf7d8a4b2acc1e77a0ddd8580f20c792bc48fb"><div class="ttname"><a href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8a4b2acc1e77a0ddd8580f20c792bc48fb">AP_AHRS::NO_NEW_ESTIMATE</a></div><div class="ttdeci">@ NO_NEW_ESTIMATE</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00153">AP_AHRS.h:153</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ab9254f22fbfcb96c06a17ab8640cf7d8a7863d7b3a5189647a1cc2bb4c584c295"><div class="ttname"><a href="classAP__AHRS.html#ab9254f22fbfcb96c06a17ab8640cf7d8a7863d7b3a5189647a1cc2bb4c584c295">AP_AHRS::SIM</a></div><div class="ttdeci">@ SIM</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00157">AP_AHRS.h:157</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_abce04780653c748a98fb52f6bee72e83"><div class="ttname"><a href="classAP__AHRS.html#abce04780653c748a98fb52f6bee72e83">AP_AHRS::getLastPosDownReset</a></div><div class="ttdeci">uint32_t getLastPosDownReset(float &amp;posDelta)</div><div class="ttdef"><b>Definition</b> <a href="#l02718">AP_AHRS.cpp:2718</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_abeec4245d68965fa8a4c4397311efc69"><div class="ttname"><a href="classAP__AHRS.html#abeec4245d68965fa8a4c4397311efc69">AP_AHRS::get_error_yaw</a></div><div class="ttdeci">float get_error_yaw() const</div><div class="ttdef"><b>Definition</b> <a href="#l00786">AP_AHRS.cpp:786</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_abef128fdecddf058cdaf2560b264655e"><div class="ttname"><a href="classAP__AHRS.html#abef128fdecddf058cdaf2560b264655e">AP_AHRS::getOptFlowSample</a></div><div class="ttdeci">bool getOptFlowSample(uint32_t &amp;timeStamp_ms, Vector2f &amp;flowRate, Vector2f &amp;bodyRate, Vector2f &amp;losPred) const</div><div class="ttdef"><b>Definition</b> <a href="#l02338">AP_AHRS.cpp:2338</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_abf9dc928e3f13d54d202d047bab70651"><div class="ttname"><a href="classAP__AHRS.html#abf9dc928e3f13d54d202d047bab70651">AP_AHRS::ekf_type</a></div><div class="ttdeci">EKFType ekf_type(void) const</div><div class="ttdef"><b>Definition</b> <a href="#l01831">AP_AHRS.cpp:1831</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_abfb7999a03395d3623610c12aa78b714"><div class="ttname"><a href="classAP__AHRS.html#abfb7999a03395d3623610c12aa78b714">AP_AHRS::use_compass</a></div><div class="ttdeci">bool use_compass()</div><div class="ttdef"><b>Definition</b> <a href="#l01093">AP_AHRS.cpp:1093</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ac1a399eb71c50c91044518c754c72846"><div class="ttname"><a href="classAP__AHRS.html#ac1a399eb71c50c91044518c754c72846">AP_AHRS::_get_secondary_position</a></div><div class="ttdeci">bool _get_secondary_position(Location &amp;loc) const</div><div class="ttdef"><b>Definition</b> <a href="#l01287">AP_AHRS.cpp:1287</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ac1b0fa5bcccd5c18fdc3b2f19e4f0ba0"><div class="ttname"><a href="classAP__AHRS.html#ac1b0fa5bcccd5c18fdc3b2f19e4f0ba0">AP_AHRS::request_yaw_reset</a></div><div class="ttdeci">void request_yaw_reset(void)</div><div class="ttdef"><b>Definition</b> <a href="#l03296">AP_AHRS.cpp:3296</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ac2af58fc58cc012fcb11d8ffd60a7d6b"><div class="ttname"><a href="classAP__AHRS.html#ac2af58fc58cc012fcb11d8ffd60a7d6b">AP_AHRS::_get_velocity_NED</a></div><div class="ttdeci">bool _get_velocity_NED(Vector3f &amp;vec) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l01469">AP_AHRS.cpp:1469</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ac5cf80db6af4db115d495605fd3254f3"><div class="ttname"><a href="classAP__AHRS.html#ac5cf80db6af4db115d495605fd3254f3">AP_AHRS::_getCorrectedDeltaVelocityNED</a></div><div class="ttdeci">void _getCorrectedDeltaVelocityNED(Vector3f &amp;ret, float &amp;dt) const</div><div class="ttdef"><b>Definition</b> <a href="#l02472">AP_AHRS.cpp:2472</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ac88d8ea5756954941e568cc76670a674"><div class="ttname"><a href="classAP__AHRS.html#ac88d8ea5756954941e568cc76670a674">AP_AHRS::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00054">AP_AHRS.h:54</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ac9514f5193b6a15b16d995fd8ee0e4c4"><div class="ttname"><a href="classAP__AHRS.html#ac9514f5193b6a15b16d995fd8ee0e4c4">AP_AHRS::Log_Write_Home_And_Origin</a></div><div class="ttdeci">void Log_Write_Home_And_Origin()</div></div>
<div class="ttc" id="aclassAP__AHRS_html_acad24c37755823c587a684969b1cbf22"><div class="ttname"><a href="classAP__AHRS.html#acad24c37755823c587a684969b1cbf22">AP_AHRS::_wind_max</a></div><div class="ttdeci">AP_Int8 _wind_max</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00703">AP_AHRS.h:703</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_acb4b144fc2fd1352fe991c44707f5b4e"><div class="ttname"><a href="classAP__AHRS.html#acb4b144fc2fd1352fe991c44707f5b4e">AP_AHRS::airspeed</a></div><div class="ttdeci">float airspeed</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00964">AP_AHRS.h:964</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_acc0e5d3d137fa70154f2d3769b0c6a09"><div class="ttname"><a href="classAP__AHRS.html#acc0e5d3d137fa70154f2d3769b0c6a09">AP_AHRS::set_home</a></div><div class="ttdeci">bool set_home(const Location &amp;loc) WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l02885">AP_AHRS.cpp:2885</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_acc8e4d93f28e051715cb5da056d9f1a7"><div class="ttname"><a href="classAP__AHRS.html#acc8e4d93f28e051715cb5da056d9f1a7">AP_AHRS::airspeed_health_data</a></div><div class="ttdeci">bool airspeed_health_data(float &amp;innovation, float &amp;innovationVariance, uint32_t &amp;age_ms) const</div><div class="ttdef"><b>Definition</b> <a href="#l01050">AP_AHRS.cpp:1050</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_acd87e22e4768b840151da63fdf168dc6"><div class="ttname"><a href="classAP__AHRS.html#acd87e22e4768b840151da63fdf168dc6">AP_AHRS::_ekf_flags</a></div><div class="ttdeci">uint8_t _ekf_flags</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00768">AP_AHRS.h:768</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ace05b87dca74cf66b2f55c7570b63d8a"><div class="ttname"><a href="classAP__AHRS.html#ace05b87dca74cf66b2f55c7570b63d8a">AP_AHRS::pre_arm_check</a></div><div class="ttdeci">bool pre_arm_check(bool requires_position, char *failure_msg, uint8_t failure_msg_len) const</div><div class="ttdef"><b>Definition</b> <a href="#l02189">AP_AHRS.cpp:2189</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ace0f7b506770c77053e0c46fc6bf95f9"><div class="ttname"><a href="classAP__AHRS.html#ace0f7b506770c77053e0c46fc6bf95f9">AP_AHRS::_get_origin</a></div><div class="ttdeci">bool _get_origin(Location &amp;ret) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l02874">AP_AHRS.cpp:2874</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ace32b3722ca6b7884a65333f0df9c372"><div class="ttname"><a href="classAP__AHRS.html#ace32b3722ca6b7884a65333f0df9c372">AP_AHRS::primary_accel</a></div><div class="ttdeci">uint8_t primary_accel</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00953">AP_AHRS.h:953</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ad1492f040ceaf1183de326d063177efe"><div class="ttname"><a href="classAP__AHRS.html#ad1492f040ceaf1183de326d063177efe">AP_AHRS::last_active_ekf_type</a></div><div class="ttdeci">EKFType last_active_ekf_type</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00798">AP_AHRS.h:798</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ad3ac110b7f3e2e6c8eaca68fad92090e"><div class="ttname"><a href="classAP__AHRS.html#ad3ac110b7f3e2e6c8eaca68fad92090e">AP_AHRS::_view</a></div><div class="ttdeci">AP_AHRS_View * _view</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00687">AP_AHRS.h:687</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ad7ad02ea0557a4615f38eab9af6985a0"><div class="ttname"><a href="classAP__AHRS.html#ad7ad02ea0557a4615f38eab9af6985a0">AP_AHRS::Write_AHRS2</a></div><div class="ttdeci">void Write_AHRS2(void) const</div></div>
<div class="ttc" id="aclassAP__AHRS_html_adaeee04859fd72a1861e83c7454f329a"><div class="ttname"><a href="classAP__AHRS.html#adaeee04859fd72a1861e83c7454f329a">AP_AHRS::writeOptFlowMeas</a></div><div class="ttdeci">void writeOptFlowMeas(const uint8_t rawFlowQuality, const Vector2f &amp;rawFlowRates, const Vector2f &amp;rawGyroRates, const uint32_t msecFlowMeas, const Vector3f &amp;posOffset, const float heightOverride)</div><div class="ttdef"><b>Definition</b> <a href="#l02327">AP_AHRS.cpp:2327</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_adc37d9d0be559afc90e704cc747a9bf5"><div class="ttname"><a href="classAP__AHRS.html#adc37d9d0be559afc90e704cc747a9bf5">AP_AHRS::get_active_airspeed_index</a></div><div class="ttdeci">uint8_t get_active_airspeed_index() const</div><div class="ttdef"><b>Definition</b> <a href="#l03152">AP_AHRS.cpp:3152</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_add19752eb07981327d0f01dd1574dc96"><div class="ttname"><a href="classAP__AHRS.html#add19752eb07981327d0f01dd1574dc96">AP_AHRS::option_set</a></div><div class="ttdeci">bool option_set(Options option) const</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l01017">AP_AHRS.h:1017</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_adfda8756478db1ed55283e3b4af91065"><div class="ttname"><a href="classAP__AHRS.html#adfda8756478db1ed55283e3b4af91065">AP_AHRS::update_trim_rotation_matrices</a></div><div class="ttdeci">void update_trim_rotation_matrices()</div><div class="ttdef"><b>Definition</b> <a href="#l00282">AP_AHRS.cpp:282</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ae4d1b8dea7e8e7b798ebf37fbd301af1"><div class="ttname"><a href="classAP__AHRS.html#ae4d1b8dea7e8e7b798ebf37fbd301af1">AP_AHRS::writeExtNavVelData</a></div><div class="ttdeci">void writeExtNavVelData(const Vector3f &amp;vel, float err, uint32_t timeStamp_ms, uint16_t delay_ms)</div><div class="ttdef"><b>Definition</b> <a href="#l02377">AP_AHRS.cpp:2377</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ae72547709c34129713bb197d1c41a322"><div class="ttname"><a href="classAP__AHRS.html#ae72547709c34129713bb197d1c41a322">AP_AHRS::getMagOffsets</a></div><div class="ttdeci">bool getMagOffsets(uint8_t mag_idx, Vector3f &amp;magOffsets) const</div><div class="ttdef"><b>Definition</b> <a href="#l02441">AP_AHRS.cpp:2441</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_ae8f0594679dcff5e2d1a6bf2cc593740"><div class="ttname"><a href="classAP__AHRS.html#ae8f0594679dcff5e2d1a6bf2cc593740">AP_AHRS::get_vel_innovations_and_variances_for_source</a></div><div class="ttdeci">bool get_vel_innovations_and_variances_for_source(uint8_t source, Vector3f &amp;innovations, Vector3f &amp;variances) const WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l03115">AP_AHRS.cpp:3115</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_aed12488ace22c3d5ccb739245d37b0b5"><div class="ttname"><a href="classAP__AHRS.html#aed12488ace22c3d5ccb739245d37b0b5">AP_AHRS::reset_gyro_drift</a></div><div class="ttdeci">void reset_gyro_drift()</div><div class="ttdef"><b>Definition</b> <a href="#l00315">AP_AHRS.cpp:315</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_af1dc155ba4a9c6f30438f2db6722eda4"><div class="ttname"><a href="classAP__AHRS.html#af1dc155ba4a9c6f30438f2db6722eda4">AP_AHRS::set_origin</a></div><div class="ttdeci">bool set_origin(const Location &amp;loc) WARN_IF_UNUSED</div><div class="ttdef"><b>Definition</b> <a href="#l01405">AP_AHRS.cpp:1405</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_af2dd025914c020ea833f2bbeb3926233"><div class="ttname"><a href="classAP__AHRS.html#af2dd025914c020ea833f2bbeb3926233">AP_AHRS::_gps_use</a></div><div class="ttdeci">AP_Enum&lt; GPSUse &gt; _gps_use</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00717">AP_AHRS.h:717</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_af3eb6e21fdc8905a75b60caa8d5b60a2"><div class="ttname"><a href="classAP__AHRS.html#af3eb6e21fdc8905a75b60caa8d5b60a2">AP_AHRS::state</a></div><div class="ttdeci">struct AP_AHRS::@12 state</div></div>
<div class="ttc" id="aclassAP__AHRS_html_af40b57b1bd3271c9dd0aa4082e6278d9"><div class="ttname"><a href="classAP__AHRS.html#af40b57b1bd3271c9dd0aa4082e6278d9">AP_AHRS::get_variances</a></div><div class="ttdeci">bool get_variances(float &amp;velVar, float &amp;posVar, float &amp;hgtVar, Vector3f &amp;magVar, float &amp;tasVar) const</div><div class="ttdef"><b>Definition</b> <a href="#l03074">AP_AHRS.cpp:3074</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_af41a16f5463e74fb8f67689a1289c336"><div class="ttname"><a href="classAP__AHRS.html#af41a16f5463e74fb8f67689a1289c336">AP_AHRS::_get_secondary_EKF_type</a></div><div class="ttdeci">bool _get_secondary_EKF_type(EKFType &amp;secondary_ekf_type) const</div><div class="ttdef"><b>Definition</b> <a href="#l02077">AP_AHRS.cpp:2077</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_af481888f56602f793fc8d9895d14a8c9"><div class="ttname"><a href="classAP__AHRS.html#af481888f56602f793fc8d9895d14a8c9">AP_AHRS::get_singleton</a></div><div class="ttdeci">static AP_AHRS * get_singleton()</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8h_source.html#l00064">AP_AHRS.h:64</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_af4ece8588b56022e42b88d434486a882"><div class="ttname"><a href="classAP__AHRS.html#af4ece8588b56022e42b88d434486a882">AP_AHRS::get_error_rp</a></div><div class="ttdeci">float get_error_rp() const</div><div class="ttdef"><b>Definition</b> <a href="#l00778">AP_AHRS.cpp:778</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_af532a93735e1f2496acf5002028be6e3"><div class="ttname"><a href="classAP__AHRS.html#af532a93735e1f2496acf5002028be6e3">AP_AHRS::AP_AHRS</a></div><div class="ttdeci">AP_AHRS(uint8_t flags=0)</div><div class="ttdef"><b>Definition</b> <a href="#l00202">AP_AHRS.cpp:202</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_af8515c37f9bf88f09d16babfa2fc900e"><div class="ttname"><a href="classAP__AHRS.html#af8515c37f9bf88f09d16babfa2fc900e">AP_AHRS::getControlLimits</a></div><div class="ttdeci">void getControlLimits(float &amp;ekfGndSpdLimit, float &amp;controlScaleXY) const</div><div class="ttdef"><b>Definition</b> <a href="#l02388">AP_AHRS.cpp:2388</a></div></div>
<div class="ttc" id="aclassAP__AHRS_html_afa34da6c3a97b6d0fc469ca1e510fe97"><div class="ttname"><a href="classAP__AHRS.html#afa34da6c3a97b6d0fc469ca1e510fe97">AP_AHRS::init</a></div><div class="ttdeci">void init(void)</div><div class="ttdef"><b>Definition</b> <a href="#l00223">AP_AHRS.cpp:223</a></div></div>
<div class="ttc" id="aclassAP__Airspeed_html_a02885c320f3cedbc08c02bc8894aba04"><div class="ttname"><a href="classAP__Airspeed.html#a02885c320f3cedbc08c02bc8894aba04">AP_Airspeed::get_airspeed</a></div><div class="ttdeci">float get_airspeed(uint8_t i) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Airspeed_8cpp_source.html#l00884">AP_Airspeed.cpp:884</a></div></div>
<div class="ttc" id="aclassAP__Baro_html_a50ae73cce1699d88638e3dfab4ffd330"><div class="ttname"><a href="classAP__Baro.html#a50ae73cce1699d88638e3dfab4ffd330">AP_Baro::get_altitude</a></div><div class="ttdeci">float get_altitude(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__Baro_8h_source.html#l00105">AP_Baro.h:105</a></div></div>
<div class="ttc" id="aclassAP__BoardConfig_html_a063de6b157f88ddef383ef3930bdbf84"><div class="ttname"><a href="classAP__BoardConfig.html#a063de6b157f88ddef383ef3930bdbf84">AP_BoardConfig::config_error</a></div><div class="ttdeci">static void config_error(const char *reason,...) FMT_PRINTF(1</div><div class="ttdef"><b>Definition</b> <a href="AP__BoardConfig_8cpp_source.html#l00483">AP_BoardConfig.cpp:483</a></div></div>
<div class="ttc" id="aclassAP__CustomRotations_html_a55d430e886478ffd871f38686b216c5d"><div class="ttname"><a href="classAP__CustomRotations.html#a55d430e886478ffd871f38686b216c5d">AP_CustomRotations::convert</a></div><div class="ttdeci">void convert(Rotation r, float roll, float pitch, float yaw)</div><div class="ttdef"><b>Definition</b> <a href="AP__CustomRotations_8cpp_source.html#l00072">AP_CustomRotations.cpp:72</a></div></div>
<div class="ttc" id="aclassAP__Enum_html_a33baca3301d3973d46a4f04ffa614362"><div class="ttname"><a href="classAP__Enum.html#a33baca3301d3973d46a4f04ffa614362">AP_Enum::set</a></div><div class="ttdeci">void set(eclass v)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l01070">AP_Param.h:1070</a></div></div>
<div class="ttc" id="aclassAP__GPS_html_a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff"><div class="ttname"><a href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca039c0783250f3296425dfc7b53bbdbff">AP_GPS::GPS_OK_FIX_2D</a></div><div class="ttdeci">@ GPS_OK_FIX_2D</div><div class="ttdoc">Receiving valid messages and 2D lock.</div><div class="ttdef"><b>Definition</b> <a href="AP__GPS_8h_source.html#l00146">AP_GPS.h:146</a></div></div>
<div class="ttc" id="aclassAP__GPS_html_a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb"><div class="ttname"><a href="classAP__GPS.html#a7409121ce557236dce2fd541309af5fca3ea1cd30c63cf65db4a124bcd4b9fbdb">AP_GPS::GPS_OK_FIX_3D</a></div><div class="ttdeci">@ GPS_OK_FIX_3D</div><div class="ttdoc">Receiving valid messages and 3D lock.</div><div class="ttdef"><b>Definition</b> <a href="AP__GPS_8h_source.html#l00147">AP_GPS.h:147</a></div></div>
<div class="ttc" id="aclassAP__GPS_html_ab1da3f2cdc163164cfee43b3248821ed"><div class="ttname"><a href="classAP__GPS.html#ab1da3f2cdc163164cfee43b3248821ed">AP_GPS::location</a></div><div class="ttdeci">const Location &amp; location(uint8_t instance) const</div><div class="ttdef"><b>Definition</b> <a href="AP__GPS_8h_source.html#l00313">AP_GPS.h:313</a></div></div>
<div class="ttc" id="aclassAP__GPS_html_ac22b61d2e6cf0b6ff647173ea336de01"><div class="ttname"><a href="classAP__GPS.html#ac22b61d2e6cf0b6ff647173ea336de01">AP_GPS::status</a></div><div class="ttdeci">GPS_Status status(uint8_t instance) const</div><div class="ttdoc">Query GPS status.</div><div class="ttdef"><b>Definition</b> <a href="AP__GPS_8h_source.html#l00276">AP_GPS.h:276</a></div></div>
<div class="ttc" id="aclassAP__GPS_html_ae7f097588dd863d4624f6fec1509e0e6"><div class="ttname"><a href="classAP__GPS.html#ae7f097588dd863d4624f6fec1509e0e6">AP_GPS::ground_speed</a></div><div class="ttdeci">float ground_speed(uint8_t instance) const</div><div class="ttdef"><b>Definition</b> <a href="AP__GPS_8h_source.html#l00357">AP_GPS.h:357</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00021">HAL.h:21</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html_a9337a60383f4264fa96a20dbe43a4e2e"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">AP_HAL::HAL::util</a></div><div class="ttdeci">AP_HAL::Util * util</div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00131">HAL.h:131</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html_a94ab41309b1ff10b8b862b826e59c882"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a94ab41309b1ff10b8b862b826e59c882">AP_HAL::HAL::scheduler</a></div><div class="ttdeci">AP_HAL::Scheduler * scheduler</div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00130">HAL.h:130</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html_ad7f95fa7f6e04a7d6faefa3b5b3a3443"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#ad7f95fa7f6e04a7d6faefa3b5b3a3443">AP_HAL::HAL::opticalflow</a></div><div class="ttdeci">AP_HAL::OpticalFlow * opticalflow</div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00132">HAL.h:132</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1OpticalFlow_html_ac34f04153fbcec6c22296397fc7fc1cc"><div class="ttname"><a href="classAP__HAL_1_1OpticalFlow.html#ac34f04153fbcec6c22296397fc7fc1cc">AP_HAL::OpticalFlow::push_gyro_bias</a></div><div class="ttdeci">virtual void push_gyro_bias(float gyro_bias_x, float gyro_bias_y)=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1Scheduler_html_a78c4f1b1f192ac1c99544b6cc8f099b0"><div class="ttname"><a href="classAP__HAL_1_1Scheduler.html#a78c4f1b1f192ac1c99544b6cc8f099b0">AP_HAL::Scheduler::delay_microseconds</a></div><div class="ttdeci">virtual void delay_microseconds(uint16_t us)=0</div></div>
<div class="ttc" id="aclassAP__HAL_1_1Scheduler_html_ae7fbbe8ddf102d5f5c0f1502909d0af1"><div class="ttname"><a href="classAP__HAL_1_1Scheduler.html#ae7fbbe8ddf102d5f5c0f1502909d0af1">AP_HAL::Scheduler::boost_end</a></div><div class="ttdeci">virtual void boost_end(void)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Scheduler_8h_source.html#l00049">Scheduler.h:49</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Util_html_a19cbaa06e0e8804d1669deacf5ad6081"><div class="ttname"><a href="classAP__HAL_1_1Util.html#a19cbaa06e0e8804d1669deacf5ad6081">AP_HAL::Util::was_watchdog_reset</a></div><div class="ttdeci">virtual bool was_watchdog_reset() const</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Util_8h_source.html#l00024">Util.h:24</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Util_html_a287a2b82fa30b92c8d52aad61d4d27b7"><div class="ttname"><a href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">AP_HAL::Util::get_soft_armed</a></div><div class="ttdeci">bool get_soft_armed() const</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Util_8h_source.html#l00018">Util.h:18</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Util_html_a64273fdab59825cea305a403054c25bf"><div class="ttname"><a href="classAP__HAL_1_1Util.html#a64273fdab59825cea305a403054c25bf">AP_HAL::Util::persistent_data</a></div><div class="ttdeci">struct PersistentData persistent_data</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Util_8h_source.html#l00088">Util.h:88</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Util_html_afaedff8102d9ae2fbc398d2099e30cf6"><div class="ttname"><a href="classAP__HAL_1_1Util.html#afaedff8102d9ae2fbc398d2099e30cf6">AP_HAL::Util::snprintf</a></div><div class="ttdeci">int snprintf(char *str, size_t size, const char *format,...) FMT_PRINTF(4</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Util_8cpp_source.html#l00044">Util.cpp:44</a></div></div>
<div class="ttc" id="aclassAP__InertialSensor_html"><div class="ttname"><a href="classAP__InertialSensor.html">AP_InertialSensor</a></div><div class="ttdef"><b>Definition</b> <a href="AP__InertialSensor_8h_source.html#l00051">AP_InertialSensor.h:52</a></div></div>
<div class="ttc" id="aclassAP__InertialSensor_html_a1892346e6bf136a9d7683e032da12f01"><div class="ttname"><a href="classAP__InertialSensor.html#a1892346e6bf136a9d7683e032da12f01">AP_InertialSensor::update</a></div><div class="ttdeci">void update(void) __RAMFUNC__</div><div class="ttdef"><b>Definition</b> <a href="AP__InertialSensor_8cpp_source.html#l01863">AP_InertialSensor.cpp:1863</a></div></div>
<div class="ttc" id="aclassAP__InertialSensor_html_a57476eae6e626d247b297076a4926300"><div class="ttname"><a href="classAP__InertialSensor.html#a57476eae6e626d247b297076a4926300">AP_InertialSensor::get_delta_velocity</a></div><div class="ttdeci">bool get_delta_velocity(uint8_t i, Vector3f &amp;delta_velocity, float &amp;delta_velocity_dt) const</div><div class="ttdef"><b>Definition</b> <a href="AP__InertialSensor_8cpp_source.html#l02143">AP_InertialSensor.cpp:2143</a></div></div>
<div class="ttc" id="aclassAP__InertialSensor_html_a5e8d3dd482fa7719aac4e1a65def9b81"><div class="ttname"><a href="classAP__InertialSensor.html#a5e8d3dd482fa7719aac4e1a65def9b81">AP_InertialSensor::get_primary_gyro</a></div><div class="ttdeci">uint8_t get_primary_gyro(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__InertialSensor_8h_source.html#l00224">AP_InertialSensor.h:224</a></div></div>
<div class="ttc" id="aclassAP__InertialSensor_html_a707bc3f8ef8270db68ceeec36171d6ac"><div class="ttname"><a href="classAP__InertialSensor.html#a707bc3f8ef8270db68ceeec36171d6ac">AP_InertialSensor::get_accel</a></div><div class="ttdeci">const Vector3f &amp; get_accel(uint8_t i) const</div><div class="ttdef"><b>Definition</b> <a href="AP__InertialSensor_8h_source.html#l00133">AP_InertialSensor.h:133</a></div></div>
<div class="ttc" id="aclassAP__InertialSensor_html_aa4ab03d6166ffbbcdd763e45eeb8bb44"><div class="ttname"><a href="classAP__InertialSensor.html#aa4ab03d6166ffbbcdd763e45eeb8bb44">AP_InertialSensor::get_gyro</a></div><div class="ttdeci">const Vector3f &amp; get_gyro(uint8_t i) const</div><div class="ttdef"><b>Definition</b> <a href="AP__InertialSensor_8h_source.html#l00110">AP_InertialSensor.h:110</a></div></div>
<div class="ttc" id="aclassAP__InertialSensor_html_aba8e3e520625bd93b18208f008bb7c36"><div class="ttname"><a href="classAP__InertialSensor.html#aba8e3e520625bd93b18208f008bb7c36">AP_InertialSensor::get_primary_accel</a></div><div class="ttdeci">uint8_t get_primary_accel(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__InertialSensor_8h_source.html#l00223">AP_InertialSensor.h:223</a></div></div>
<div class="ttc" id="aclassAP__InternalError_html_a5173d851f3973e9a341e08ceb9451c11a125554e4c6e51cfd513a60efb7eb3c78"><div class="ttname"><a href="classAP__InternalError.html#a5173d851f3973e9a341e08ceb9451c11a125554e4c6e51cfd513a60efb7eb3c78">AP_InternalError::error_t::flow_of_control</a></div><div class="ttdeci">@ flow_of_control</div></div>
<div class="ttc" id="aclassAP__Logger_html_acc819f09dd35b615500c4dec658519d2"><div class="ttname"><a href="classAP__Logger.html#acc819f09dd35b615500c4dec658519d2">AP_Logger::Write_Event</a></div><div class="ttdeci">void Write_Event(LogEvent id)</div><div class="ttdef"><b>Definition</b> <a href="AP__Logger_8cpp_source.html#l01487">AP_Logger.cpp:1487</a></div></div>
<div class="ttc" id="aclassAP__NavEKF__Source_html_aa463f183bb6c2c7f2b217792b850af46"><div class="ttname"><a href="classAP__NavEKF__Source.html#aa463f183bb6c2c7f2b217792b850af46">AP_NavEKF_Source::SourceXY</a></div><div class="ttdeci">SourceXY</div><div class="ttdef"><b>Definition</b> <a href="AP__NavEKF__Source_8h_source.html#l00017">AP_NavEKF_Source.h:17</a></div></div>
<div class="ttc" id="aclassAP__Notify_html_a724dd074a094de26e17c72c38ac499e9"><div class="ttname"><a href="classAP__Notify.html#a724dd074a094de26e17c72c38ac499e9">AP_Notify::flags</a></div><div class="ttdeci">static struct notify_flags_and_values_type flags</div><div class="ttdef"><b>Definition</b> <a href="AP__Notify_8h_source.html#l00173">AP_Notify.h:173</a></div></div>
<div class="ttc" id="aclassAP__Param_html_a5f6dcfce1c0a79cf5bd81283e22f3201"><div class="ttname"><a href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a></div><div class="ttdeci">static void setup_object_defaults(const void *object_pointer, const struct GroupInfo *group_info)</div><div class="ttdef"><b>Definition</b> <a href="main_8cpp_source.html#l00010">main.cpp:10</a></div></div>
<div class="ttc" id="aclassAP__Param_html_a857c14c819b6d550957d0f9c56c379d0"><div class="ttname"><a href="classAP__Param.html#a857c14c819b6d550957d0f9c56c379d0">AP_Param::find_old_parameter</a></div><div class="ttdeci">static bool find_old_parameter(const struct ConversionInfo *info, AP_Param *value)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8cpp_source.html#l01935">AP_Param.cpp:1935</a></div></div>
<div class="ttc" id="aclassAP__Param_html_a97a7b5f898c84c99cb57c76d4ddc870c"><div class="ttname"><a href="classAP__Param.html#a97a7b5f898c84c99cb57c76d4ddc870c">AP_Param::find_top_level_key_by_pointer</a></div><div class="ttdeci">static bool find_top_level_key_by_pointer(const void *ptr, uint16_t &amp;key)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8cpp_source.html#l01057">AP_Param.cpp:1057</a></div></div>
<div class="ttc" id="aclassCompass_html_af5c3da7e49f681c1d7a0354b91eba7ba"><div class="ttname"><a href="classCompass.html#af5c3da7e49f681c1d7a0354b91eba7ba">Compass::use_for_yaw</a></div><div class="ttdeci">bool use_for_yaw(uint8_t i) const</div><div class="ttdoc">return true if the compass should be used for yaw calculations</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8cpp_source.html#l01928">AP_Compass.cpp:1928</a></div></div>
<div class="ttc" id="aclassEKFGSF__yaw_html"><div class="ttname"><a href="classEKFGSF__yaw.html">EKFGSF_yaw</a></div><div class="ttdef"><b>Definition</b> <a href="EKFGSF__yaw_8h_source.html#l00012">EKFGSF_yaw.h:13</a></div></div>
<div class="ttc" id="aclassGCS__MAVLINK_html"><div class="ttname"><a href="classGCS__MAVLINK.html">GCS_MAVLINK</a></div><div class="ttdoc">MAVLink transport control class.</div><div class="ttdef"><b>Definition</b> <a href="GCS_8h_source.html#l00189">GCS.h:190</a></div></div>
<div class="ttc" id="aclassLocation_html"><div class="ttname"><a href="classLocation.html">Location</a></div><div class="ttdef"><b>Definition</b> <a href="Location_8h_source.html#l00007">Location.h:8</a></div></div>
<div class="ttc" id="aclassLocation_html_a0338ecfc1fac3c46bc7debd2aa304dc9"><div class="ttname"><a href="classLocation.html#a0338ecfc1fac3c46bc7debd2aa304dc9">Location::change_alt_frame</a></div><div class="ttdeci">bool change_alt_frame(AltFrame desired_frame)</div><div class="ttdef"><b>Definition</b> <a href="Location_8cpp_source.html#l00083">Location.cpp:83</a></div></div>
<div class="ttc" id="aclassLocation_html_a146775eb07ce9abcc8d05f1b730404b0"><div class="ttname"><a href="classLocation.html#a146775eb07ce9abcc8d05f1b730404b0">Location::offset</a></div><div class="ttdeci">void offset(ftype ofs_north, ftype ofs_east)</div><div class="ttdef"><b>Definition</b> <a href="Location_8cpp_source.html#l00311">Location.cpp:311</a></div></div>
<div class="ttc" id="aclassLocation_html_a25f7297551af447cf46aef3ae92c2632"><div class="ttname"><a href="classLocation.html#a25f7297551af447cf46aef3ae92c2632">Location::check_latlng</a></div><div class="ttdeci">bool check_latlng() const</div><div class="ttdef"><b>Definition</b> <a href="Location_8cpp_source.html#l00422">Location.cpp:422</a></div></div>
<div class="ttc" id="aclassLocation_html_a42ff316c00ff41841042c65521a44944"><div class="ttname"><a href="classLocation.html#a42ff316c00ff41841042c65521a44944">Location::set_alt_cm</a></div><div class="ttdeci">void set_alt_cm(int32_t alt_cm, AltFrame frame)</div><div class="ttdef"><b>Definition</b> <a href="Location_8cpp_source.html#l00057">Location.cpp:57</a></div></div>
<div class="ttc" id="aclassLocation_html_a5831f0aca9e51a15adb96fad465f72f8"><div class="ttname"><a href="classLocation.html#a5831f0aca9e51a15adb96fad465f72f8">Location::lng</a></div><div class="ttdeci">int32_t lng</div><div class="ttdef"><b>Definition</b> <a href="Location_8h_source.html#l00020">Location.h:20</a></div></div>
<div class="ttc" id="aclassLocation_html_a77ca1da10b7da6216bb6cf1253ed3dfc"><div class="ttname"><a href="classLocation.html#a77ca1da10b7da6216bb6cf1253ed3dfc">Location::get_distance_NED</a></div><div class="ttdeci">Vector3f get_distance_NED(const Location &amp;loc2) const</div><div class="ttdef"><b>Definition</b> <a href="Location_8cpp_source.html#l00273">Location.cpp:273</a></div></div>
<div class="ttc" id="aclassLocation_html_a89e532f5bcc13db2f51ff9eed667c2b6"><div class="ttname"><a href="classLocation.html#a89e532f5bcc13db2f51ff9eed667c2b6">Location::alt</a></div><div class="ttdeci">int32_t alt</div><div class="ttdef"><b>Definition</b> <a href="Location_8h_source.html#l00018">Location.h:18</a></div></div>
<div class="ttc" id="aclassLocation_html_ae51548c2cf32311043ca19b94b9a9223"><div class="ttname"><a href="classLocation.html#ae51548c2cf32311043ca19b94b9a9223">Location::lat</a></div><div class="ttdeci">int32_t lat</div><div class="ttdef"><b>Definition</b> <a href="Location_8h_source.html#l00019">Location.h:19</a></div></div>
<div class="ttc" id="aclassLocation_html_af494dabb88cd43e0d4efa99f04d31351a3a0bc063b6db8cae0361657958be836f"><div class="ttname"><a href="classLocation.html#af494dabb88cd43e0d4efa99f04d31351a3a0bc063b6db8cae0361657958be836f">Location::AltFrame::ABSOLUTE</a></div><div class="ttdeci">@ ABSOLUTE</div></div>
<div class="ttc" id="aclassLocation_html_af597420e2ec20fc794ca3d5447fd36ba"><div class="ttname"><a href="classLocation.html#af597420e2ec20fc794ca3d5447fd36ba">Location::get_distance_NE</a></div><div class="ttdeci">Vector2f get_distance_NE(const Location &amp;loc2) const</div><div class="ttdef"><b>Definition</b> <a href="Location_8cpp_source.html#l00266">Location.cpp:266</a></div></div>
<div class="ttc" id="aclassMatrix3_html_a5a186dbb48d5cb5ecd40924578478b2e"><div class="ttname"><a href="classMatrix3.html#a5a186dbb48d5cb5ecd40924578478b2e">Matrix3::transposed</a></div><div class="ttdeci">Matrix3&lt; T &gt; transposed(void) const</div><div class="ttdef"><b>Definition</b> <a href="matrix3_8cpp_source.html#l00182">matrix3.cpp:182</a></div></div>
<div class="ttc" id="aclassMatrix3_html_aa39c6a81d6ba09446739ec82c168556b"><div class="ttname"><a href="classMatrix3.html#aa39c6a81d6ba09446739ec82c168556b">Matrix3::mul_transpose</a></div><div class="ttdeci">Vector3&lt; T &gt; mul_transpose(const Vector3&lt; T &gt; &amp;v) const</div><div class="ttdef"><b>Definition</b> <a href="matrix3_8cpp_source.html#l00158">matrix3.cpp:158</a></div></div>
<div class="ttc" id="aclassMatrix3_html_ace756290a0d39528992ead334c038de2"><div class="ttname"><a href="classMatrix3.html#ace756290a0d39528992ead334c038de2">Matrix3::from_euler</a></div><div class="ttdeci">void from_euler(T roll, T pitch, T yaw)</div><div class="ttdef"><b>Definition</b> <a href="matrix3_8cpp_source.html#l00026">matrix3.cpp:26</a></div></div>
<div class="ttc" id="aclassQuaternionT_html"><div class="ttname"><a href="classQuaternionT.html">QuaternionT&lt; float &gt;</a></div></div>
<div class="ttc" id="aclassQuaternionT_html_a175174e39e43141a74e597eadfbeb477"><div class="ttname"><a href="classQuaternionT.html#a175174e39e43141a74e597eadfbeb477">QuaternionT::angular_difference</a></div><div class="ttdeci">QuaternionT&lt; T &gt; angular_difference(const QuaternionT&lt; T &gt; &amp;v) const</div><div class="ttdef"><b>Definition</b> <a href="quaternion_8cpp_source.html#l00803">quaternion.cpp:803</a></div></div>
<div class="ttc" id="aclassQuaternionT_html_a56428cf7fd5c2ce7286b053757f42399"><div class="ttname"><a href="classQuaternionT.html#a56428cf7fd5c2ce7286b053757f42399">QuaternionT::roll_pitch_difference</a></div><div class="ttdeci">T roll_pitch_difference(const QuaternionT&lt; T &gt; &amp;v) const</div><div class="ttdef"><b>Definition</b> <a href="quaternion_8cpp_source.html#l00810">quaternion.cpp:810</a></div></div>
<div class="ttc" id="aclassQuaternionT_html_a8b4b54f0e29a0f2ee476662c456fe948"><div class="ttname"><a href="classQuaternionT.html#a8b4b54f0e29a0f2ee476662c456fe948">QuaternionT::rotate</a></div><div class="ttdeci">void rotate(enum Rotation rotation)</div><div class="ttdef"><b>Definition</b> <a href="quaternion_8cpp_source.html#l00400">quaternion.cpp:400</a></div></div>
<div class="ttc" id="aclassQuaternionT_html_a9f7af9ef07753ba4247f9e707c0a9cec"><div class="ttname"><a href="classQuaternionT.html#a9f7af9ef07753ba4247f9e707c0a9cec">QuaternionT::to_axis_angle</a></div><div class="ttdeci">void to_axis_angle(Vector3&lt; T &gt; &amp;v) const</div><div class="ttdef"><b>Definition</b> <a href="quaternion_8cpp_source.html#l00497">quaternion.cpp:497</a></div></div>
<div class="ttc" id="aclassQuaternionT_html_ab12c50ad4b582277deda302ff9109adf"><div class="ttname"><a href="classQuaternionT.html#ab12c50ad4b582277deda302ff9109adf">QuaternionT::from_rotation_matrix</a></div><div class="ttdeci">void from_rotation_matrix(const Matrix3&lt; T &gt; &amp;m)</div><div class="ttdef"><b>Definition</b> <a href="quaternion_8cpp_source.html#l00086">quaternion.cpp:86</a></div></div>
<div class="ttc" id="aclassVector3_html"><div class="ttname"><a href="classVector3.html">Vector3&lt; float &gt;</a></div></div>
<div class="ttc" id="aclassVector3_html_a1a0f7e168c71ca798099f0ba8a444244"><div class="ttname"><a href="classVector3.html#a1a0f7e168c71ca798099f0ba8a444244">Vector3::x</a></div><div class="ttdeci">T x</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00076">vector3.h:76</a></div></div>
<div class="ttc" id="aclassVector3_html_a561df88b28e106e337a25bb86554a569"><div class="ttname"><a href="classVector3.html#a561df88b28e106e337a25bb86554a569">Vector3::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00076">vector3.h:76</a></div></div>
<div class="ttc" id="aclassVector3_html_aaa6419ecd36a969d2eaecd9a1b1edd12"><div class="ttname"><a href="classVector3.html#aaa6419ecd36a969d2eaecd9a1b1edd12">Vector3::length</a></div><div class="ttdeci">T length(void) const</div><div class="ttdef"><b>Definition</b> <a href="vector3_8cpp_source.html#l00324">vector3.cpp:324</a></div></div>
<div class="ttc" id="aclassVector3_html_ab3e7f5401dd6e951978bfa746809f74f"><div class="ttname"><a href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">Vector3::z</a></div><div class="ttdeci">T z</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00076">vector3.h:76</a></div></div>
<div class="ttc" id="aclassVector3_html_abcf8b89285b9966932d1aceeeadb21d3"><div class="ttname"><a href="classVector3.html#abcf8b89285b9966932d1aceeeadb21d3">Vector3::xy</a></div><div class="ttdeci">const Vector2&lt; T &gt; &amp; xy() const</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00203">vector3.h:203</a></div></div>
<div class="ttc" id="aclassVector3_html_adf1769d5ee5df2f8585df2f540fa5efe"><div class="ttname"><a href="classVector3.html#adf1769d5ee5df2f8585df2f540fa5efe">Vector3::zero</a></div><div class="ttdeci">void zero()</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00229">vector3.h:229</a></div></div>
<div class="ttc" id="adefinitions_8h_html_aea8758bf61b23b46507902b46060ebfd"><div class="ttname"><a href="definitions_8h.html#aea8758bf61b23b46507902b46060ebfd">GRAVITY_MSS</a></div><div class="ttdeci">#define GRAVITY_MSS</div><div class="ttdef"><b>Definition</b> <a href="definitions_8h_source.html#l00047">definitions.h:47</a></div></div>
<div class="ttc" id="amoduletest_8c_html_a903c4797a4c2860e3b9a6a978f98a44d"><div class="ttname"><a href="moduletest_8c.html#a903c4797a4c2860e3b9a6a978f98a44d">degrees</a></div><div class="ttdeci">#define degrees(x)</div><div class="ttdef"><b>Definition</b> <a href="moduletest_8c_source.html#l00023">moduletest.c:23</a></div></div>
<div class="ttc" id="amonocypher_8cpp_html_afa99ec4acc4ecb2dc3c2d05da15d0e3f"><div class="ttname"><a href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a></div><div class="ttdeci">#define MAX(a, b)</div><div class="ttdef"><b>Definition</b> <a href="monocypher_8cpp_source.html#l00072">monocypher.cpp:72</a></div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a77dffbb18891996280308e21316ec186"><div class="ttname"><a href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a></div><div class="ttdeci">uint32_t millis()</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2system_8cpp_source.html#l00377">system.cpp:377</a></div></div>
<div class="ttc" id="anamespaceAP_html"><div class="ttname"><a href="namespaceAP.html">AP</a></div><div class="ttdef"><b>Definition</b> <a href="AC__Avoid_8cpp_source.html#l01481">AC_Avoid.cpp:1481</a></div></div>
<div class="ttc" id="anamespaceAP_html_a1a3d63c4a3dd8a0bd9a17a0e500ead31"><div class="ttname"><a href="namespaceAP.html#a1a3d63c4a3dd8a0bd9a17a0e500ead31">AP::custom_rotations</a></div><div class="ttdeci">AP_CustomRotations &amp; custom_rotations()</div><div class="ttdef"><b>Definition</b> <a href="AP__CustomRotations_8cpp_source.html#l00154">AP_CustomRotations.cpp:154</a></div></div>
<div class="ttc" id="anamespaceAP_html_a8aec57eb0b7a79044cbc1f0ca4b75bcf"><div class="ttname"><a href="namespaceAP.html#a8aec57eb0b7a79044cbc1f0ca4b75bcf">AP::baro</a></div><div class="ttdeci">AP_Baro &amp; baro()</div><div class="ttdef"><b>Definition</b> <a href="AP__Baro_8cpp_source.html#l01146">AP_Baro.cpp:1146</a></div></div>
<div class="ttc" id="anamespaceAP_html_a8d01caed65921a37d8d68f70ac255aa5"><div class="ttname"><a href="namespaceAP.html#a8d01caed65921a37d8d68f70ac255aa5">AP::airspeed</a></div><div class="ttdeci">AP_Airspeed * airspeed()</div><div class="ttdef"><b>Definition</b> <a href="AP__Airspeed_8cpp_source.html#l00955">AP_Airspeed.cpp:955</a></div></div>
<div class="ttc" id="anamespaceAP_html_a99432cfdb696952c9b7146f155a815aa"><div class="ttname"><a href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a></div><div class="ttdeci">AP_AHRS &amp; ahrs()</div><div class="ttdef"><b>Definition</b> <a href="#l03558">AP_AHRS.cpp:3558</a></div></div>
<div class="ttc" id="anamespaceAP_html_aa35bfac1ea2da16f110e8e72db7b3b20"><div class="ttname"><a href="namespaceAP.html#aa35bfac1ea2da16f110e8e72db7b3b20">AP::logger</a></div><div class="ttdeci">AP_Logger &amp; logger()</div><div class="ttdef"><b>Definition</b> <a href="AP__Logger_8cpp_source.html#l01740">AP_Logger.cpp:1740</a></div></div>
<div class="ttc" id="anamespaceAP_html_ab9d0bcbec954b6c20abd8e13e6de7356"><div class="ttname"><a href="namespaceAP.html#ab9d0bcbec954b6c20abd8e13e6de7356">AP::compass</a></div><div class="ttdeci">Compass &amp; compass()</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass_8cpp_source.html#l02237">AP_Compass.cpp:2237</a></div></div>
<div class="ttc" id="anamespaceAP_html_ac571aa5a2ef71b7f4b4b2bfa09143fb9"><div class="ttname"><a href="namespaceAP.html#ac571aa5a2ef71b7f4b4b2bfa09143fb9">AP::ins</a></div><div class="ttdeci">AP_InertialSensor &amp; ins()</div><div class="ttdef"><b>Definition</b> <a href="AP__InertialSensor_8cpp_source.html#l02780">AP_InertialSensor.cpp:2780</a></div></div>
<div class="ttc" id="anamespaceAP_html_ae6eeec356455220f913e47e323057cd5"><div class="ttname"><a href="namespaceAP.html#ae6eeec356455220f913e47e323057cd5">AP::gps</a></div><div class="ttdeci">AP_GPS &amp; gps()</div><div class="ttdef"><b>Definition</b> <a href="AP__GPS_8cpp_source.html#l02442">AP_GPS.cpp:2442</a></div></div>
<div class="ttc" id="arotations_8h_html_a67a250c97139a5466814a54c4aa4a681a75ddb15fe7c87cf749dc2b82fcc99fbb"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681a75ddb15fe7c87cf749dc2b82fcc99fbb">ROTATION_CUSTOM_1</a></div><div class="ttdeci">@ ROTATION_CUSTOM_1</div><div class="ttdef"><b>Definition</b> <a href="rotations_8h_source.html#l00080">rotations.h:80</a></div></div>
<div class="ttc" id="arotations_8h_html_a67a250c97139a5466814a54c4aa4a681ae7d6d0015028e041def96e2ba339bba7"><div class="ttname"><a href="rotations_8h.html#a67a250c97139a5466814a54c4aa4a681ae7d6d0015028e041def96e2ba339bba7">ROTATION_CUSTOM_OLD</a></div><div class="ttdeci">@ ROTATION_CUSTOM_OLD</div><div class="ttdef"><b>Definition</b> <a href="rotations_8h_source.html#l00079">rotations.h:79</a></div></div>
<div class="ttc" id="arouting_8cpp_html_acdef7b92239f1e607ef6caa33a16d2ed"><div class="ttname"><a href="routing_8cpp.html#acdef7b92239f1e607ef6caa33a16d2ed">status</a></div><div class="ttdeci">static mavlink_status_t status</div><div class="ttdef"><b>Definition</b> <a href="routing_8cpp_source.html#l00027">routing.cpp:27</a></div></div>
<div class="ttc" id="astructAP__AHRS__Backend_1_1Estimates_html"><div class="ttname"><a href="structAP__AHRS__Backend_1_1Estimates.html">AP_AHRS_Backend::Estimates</a></div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8h_source.html#l00052">AP_AHRS_Backend.h:52</a></div></div>
<div class="ttc" id="astructAP__AHRS__Backend_1_1Estimates_html_a358b9633edbb589893a2e2f7fec358cc"><div class="ttname"><a href="structAP__AHRS__Backend_1_1Estimates.html#a358b9633edbb589893a2e2f7fec358cc">AP_AHRS_Backend::Estimates::accel_bias</a></div><div class="ttdeci">Vector3f accel_bias</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8h_source.html#l00060">AP_AHRS_Backend.h:60</a></div></div>
<div class="ttc" id="astructAP__AHRS__Backend_1_1Estimates_html_a3c9de4e8d6c1f5e9ca4d1ae07f1fb124"><div class="ttname"><a href="structAP__AHRS__Backend_1_1Estimates.html#a3c9de4e8d6c1f5e9ca4d1ae07f1fb124">AP_AHRS_Backend::Estimates::yaw_rad</a></div><div class="ttdeci">float yaw_rad</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8h_source.html#l00055">AP_AHRS_Backend.h:55</a></div></div>
<div class="ttc" id="astructAP__AHRS__Backend_1_1Estimates_html_a5cdd53e31088bd74931a5c3dc8194d14"><div class="ttname"><a href="structAP__AHRS__Backend_1_1Estimates.html#a5cdd53e31088bd74931a5c3dc8194d14">AP_AHRS_Backend::Estimates::dcm_matrix</a></div><div class="ttdeci">Matrix3f dcm_matrix</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8h_source.html#l00056">AP_AHRS_Backend.h:56</a></div></div>
<div class="ttc" id="astructAP__AHRS__Backend_1_1Estimates_html_a7da0f875a99b436c77ff128ded5fca53"><div class="ttname"><a href="structAP__AHRS__Backend_1_1Estimates.html#a7da0f875a99b436c77ff128ded5fca53">AP_AHRS_Backend::Estimates::gyro_drift</a></div><div class="ttdeci">Vector3f gyro_drift</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8h_source.html#l00058">AP_AHRS_Backend.h:58</a></div></div>
<div class="ttc" id="astructAP__AHRS__Backend_1_1Estimates_html_a919bd2e6470f7b84d9491c25620376af"><div class="ttname"><a href="structAP__AHRS__Backend_1_1Estimates.html#a919bd2e6470f7b84d9491c25620376af">AP_AHRS_Backend::Estimates::pitch_rad</a></div><div class="ttdeci">float pitch_rad</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8h_source.html#l00054">AP_AHRS_Backend.h:54</a></div></div>
<div class="ttc" id="astructAP__AHRS__Backend_1_1Estimates_html_aadbafe8393da44d9d3dc8c7501fc9484"><div class="ttname"><a href="structAP__AHRS__Backend_1_1Estimates.html#aadbafe8393da44d9d3dc8c7501fc9484">AP_AHRS_Backend::Estimates::accel_ef</a></div><div class="ttdeci">Vector3f accel_ef</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8h_source.html#l00059">AP_AHRS_Backend.h:59</a></div></div>
<div class="ttc" id="astructAP__AHRS__Backend_1_1Estimates_html_af9a8c54de0afd5b5065e337e34101e77"><div class="ttname"><a href="structAP__AHRS__Backend_1_1Estimates.html#af9a8c54de0afd5b5065e337e34101e77">AP_AHRS_Backend::Estimates::gyro_estimate</a></div><div class="ttdeci">Vector3f gyro_estimate</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8h_source.html#l00057">AP_AHRS_Backend.h:57</a></div></div>
<div class="ttc" id="astructAP__AHRS__Backend_1_1Estimates_html_afea4d65fe81ef4e8c1bfee86cc119570"><div class="ttname"><a href="structAP__AHRS__Backend_1_1Estimates.html#afea4d65fe81ef4e8c1bfee86cc119570">AP_AHRS_Backend::Estimates::roll_rad</a></div><div class="ttdeci">float roll_rad</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS__Backend_8h_source.html#l00053">AP_AHRS_Backend.h:53</a></div></div>
<div class="ttc" id="astructAP__HAL_1_1Util_1_1PersistentData_html"><div class="ttname"><a href="structAP__HAL_1_1Util_1_1PersistentData.html">AP_HAL::Util::PersistentData</a></div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Util_8h_source.html#l00063">Util.h:63</a></div></div>
<div class="ttc" id="astructAP__HAL_1_1Util_1_1PersistentData_html_a0084c9656d202d021ab77bcfb2b78eba"><div class="ttname"><a href="structAP__HAL_1_1Util_1_1PersistentData.html#a0084c9656d202d021ab77bcfb2b78eba">AP_HAL::Util::PersistentData::home_lat</a></div><div class="ttdeci">int32_t home_lat</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Util_8h_source.html#l00065">Util.h:65</a></div></div>
<div class="ttc" id="astructAP__HAL_1_1Util_1_1PersistentData_html_a4751bd257fc3ec1919d33852896c11ad"><div class="ttname"><a href="structAP__HAL_1_1Util_1_1PersistentData.html#a4751bd257fc3ec1919d33852896c11ad">AP_HAL::Util::PersistentData::home_alt_cm</a></div><div class="ttdeci">int32_t home_alt_cm</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Util_8h_source.html#l00065">Util.h:65</a></div></div>
<div class="ttc" id="astructAP__HAL_1_1Util_1_1PersistentData_html_aedd0eb77ffa4ae4a9dac6744e7aa72c5"><div class="ttname"><a href="structAP__HAL_1_1Util_1_1PersistentData.html#aedd0eb77ffa4ae4a9dac6744e7aa72c5">AP_HAL::Util::PersistentData::home_lon</a></div><div class="ttdeci">int32_t home_lon</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Util_8h_source.html#l00065">Util.h:65</a></div></div>
<div class="ttc" id="astructAP__Notify_1_1notify__flags__and__values__type_html_a04ab5915d8f9910d4c1c098f47cd4e25"><div class="ttname"><a href="structAP__Notify_1_1notify__flags__and__values__type.html#a04ab5915d8f9910d4c1c098f47cd4e25">AP_Notify::notify_flags_and_values_type::have_pos_abs</a></div><div class="ttdeci">bool have_pos_abs</div><div class="ttdef"><b>Definition</b> <a href="AP__Notify_8h_source.html#l00137">AP_Notify.h:137</a></div></div>
<div class="ttc" id="astructAP__Notify_1_1notify__flags__and__values__type_html_a3ba536807224307e3ae12ff8fc5820e4"><div class="ttname"><a href="structAP__Notify_1_1notify__flags__and__values__type.html#a3ba536807224307e3ae12ff8fc5820e4">AP_Notify::notify_flags_and_values_type::gps_glitching</a></div><div class="ttdeci">bool gps_glitching</div><div class="ttdef"><b>Definition</b> <a href="AP__Notify_8h_source.html#l00136">AP_Notify.h:136</a></div></div>
<div class="ttc" id="astructAP__Notify_1_1notify__flags__and__values__type_html_a9303e217bc3b47f14dadb648d1f830a2"><div class="ttname"><a href="structAP__Notify_1_1notify__flags__and__values__type.html#a9303e217bc3b47f14dadb648d1f830a2">AP_Notify::notify_flags_and_values_type::gps_fusion</a></div><div class="ttdeci">bool gps_fusion</div><div class="ttdef"><b>Definition</b> <a href="AP__Notify_8h_source.html#l00135">AP_Notify.h:135</a></div></div>
<div class="ttc" id="astructAP__Param_1_1ConversionInfo_html"><div class="ttname"><a href="structAP__Param_1_1ConversionInfo.html">AP_Param::ConversionInfo</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00225">AP_Param.h:225</a></div></div>
<div class="ttc" id="astructAP__Param_1_1ConversionInfo_html_a75ff5c9be71f27763a405bb41e0c0aff"><div class="ttname"><a href="structAP__Param_1_1ConversionInfo.html#a75ff5c9be71f27763a405bb41e0c0aff">AP_Param::ConversionInfo::old_key</a></div><div class="ttdeci">uint16_t old_key</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00226">AP_Param.h:226</a></div></div>
<div class="ttc" id="astructAP__Param_1_1ConversionInfo_html_ac734a9afbd723a353dd23e05006c8f90"><div class="ttname"><a href="structAP__Param_1_1ConversionInfo.html#ac734a9afbd723a353dd23e05006c8f90">AP_Param::ConversionInfo::old_group_element</a></div><div class="ttdeci">uint32_t old_group_element</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00227">AP_Param.h:227</a></div></div>
<div class="ttc" id="astructAP__Param_1_1ConversionInfo_html_aefe1f37268bb6e4cdb0920db26127a7f"><div class="ttname"><a href="structAP__Param_1_1ConversionInfo.html#aefe1f37268bb6e4cdb0920db26127a7f">AP_Param::ConversionInfo::type</a></div><div class="ttdeci">enum ap_var_type type</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00228">AP_Param.h:228</a></div></div>
<div class="ttc" id="astructAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00199">AP_Param.h:199</a></div></div>
<div class="ttc" id="astructVector2_html"><div class="ttname"><a href="structVector2.html">Vector2&lt; float &gt;</a></div></div>
<div class="ttc" id="astructVector2_html_a6cfed8355591aa269f4dba43bd806ef9"><div class="ttname"><a href="structVector2.html#a6cfed8355591aa269f4dba43bd806ef9">Vector2::y</a></div><div class="ttdeci">T y</div><div class="ttdef"><b>Definition</b> <a href="vector2_8h_source.html#l00044">vector2.h:44</a></div></div>
<div class="ttc" id="astructVector2_html_a78fa1f2ed5e261c7fbeb8f3536a1ee34"><div class="ttname"><a href="structVector2.html#a78fa1f2ed5e261c7fbeb8f3536a1ee34">Vector2::x</a></div><div class="ttdeci">T x</div><div class="ttdef"><b>Definition</b> <a href="vector2_8h_source.html#l00044">vector2.h:44</a></div></div>
<div class="ttc" id="astructVector2_html_aed3cf4803ee803dc1447985ca323178f"><div class="ttname"><a href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">Vector2::length</a></div><div class="ttdeci">T length(void) const</div><div class="ttdef"><b>Definition</b> <a href="vector2_8cpp_source.html#l00030">vector2.cpp:30</a></div></div>
<div class="ttc" id="astructtype_html"><div class="ttname"><a href="structtype.html">type</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Scripting_2generator_2src_2main_8c_source.html#l00163">main.c:163</a></div></div>
<div class="ttc" id="astructvector4f_html_a486b8c1fdea4f2e325ce9dfd6ffeac10"><div class="ttname"><a href="structvector4f.html#a486b8c1fdea4f2e325ce9dfd6ffeac10">vector4f::x</a></div><div class="ttdeci">float x</div><div class="ttdef"><b>Definition</b> <a href="ardupilot__SITL__QUAD_8h_source.html#l00029">ardupilot_SITL_QUAD.h:29</a></div></div>
<div class="ttc" id="astructvector4f_html_af4c3cb7fd2391987e9b380120d8fde2c"><div class="ttname"><a href="structvector4f.html#af4c3cb7fd2391987e9b380120d8fde2c">vector4f::y</a></div><div class="ttdeci">float y</div><div class="ttdef"><b>Definition</b> <a href="ardupilot__SITL__QUAD_8h_source.html#l00029">ardupilot_SITL_QUAD.h:29</a></div></div>
<div class="ttc" id="aunionnav__filter__status_html"><div class="ttname"><a href="unionnav__filter__status.html">nav_filter_status</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Nav__Common_8h_source.html#l00022">AP_Nav_Common.h:22</a></div></div>
<div class="ttc" id="aunionnav__filter__status_html_a5970d586986baabc5c3baaa8c5af32a6"><div class="ttname"><a href="unionnav__filter__status.html#a5970d586986baabc5c3baaa8c5af32a6">nav_filter_status::dead_reckoning</a></div><div class="ttdeci">bool dead_reckoning</div><div class="ttdef"><b>Definition</b> <a href="AP__Nav__Common_8h_source.html#l00042">AP_Nav_Common.h:42</a></div></div>
<div class="ttc" id="aunionnav__filter__status_html_a89bf33e625b9d55f4d878c29fd8b0e98"><div class="ttname"><a href="unionnav__filter__status.html#a89bf33e625b9d55f4d878c29fd8b0e98">nav_filter_status::flags</a></div><div class="ttdeci">struct nav_filter_status::@116 flags</div></div>
<div class="ttc" id="aunionnav__filter__status_html_ad92aec0d08b311e5000b2b5359bafa10"><div class="ttname"><a href="unionnav__filter__status.html#ad92aec0d08b311e5000b2b5359bafa10">nav_filter_status::rejecting_airspeed</a></div><div class="ttdeci">bool rejecting_airspeed</div><div class="ttdef"><b>Definition</b> <a href="AP__Nav__Common_8h_source.html#l00041">AP_Nav_Common.h:41</a></div></div>
<div class="ttc" id="avector2_8h_html_a9f3739462b0605dcb64299fa289b6afe"><div class="ttname"><a href="vector2_8h.html#a9f3739462b0605dcb64299fa289b6afe">Vector2f</a></div><div class="ttdeci">Vector2&lt; float &gt; Vector2f</div><div class="ttdef"><b>Definition</b> <a href="vector2_8h_source.html#l00297">vector2.h:297</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 22 2024 16:14:13 for APM:Libraries by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
