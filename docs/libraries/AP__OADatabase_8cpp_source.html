<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APM:Libraries: libraries/AC_Avoidance/AP_OADatabase.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_0fa23c0eb29689ed5203374f2cd7307f.html">AC_Avoidance</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">AP_OADatabase.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="AP__OADatabase_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">   This program is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">   it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">   the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">   (at your option) any later version.</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment">   This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">   GNU General Public License for more details.</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">   You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">*/</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span> </div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="preprocessor">#include &quot;<a class="code" href="AP__OADatabase_8h.html">AP_OADatabase.h</a>&quot;</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &lt;<a class="code" href="AP__AHRS_8h.html">AP_AHRS/AP_AHRS.h</a>&gt;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span><span class="preprocessor">#include &lt;<a class="code" href="GCS_8h.html">GCS_MAVLink/GCS.h</a>&gt;</span></div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Math_8h.html">AP_Math/AP_Math.h</a>&gt;</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Vehicle__Type_8h.html">AP_Vehicle/AP_Vehicle_Type.h</a>&gt;</span></div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span> </div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="keyword">extern</span> <span class="keyword">const</span> <a class="code hl_class" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code hl_variable" href="AP__OADatabase_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span> </div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#ifndef AP_OADATABASE_TIMEOUT_SECONDS_DEFAULT</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno"><a class="line" href="AP__OADatabase_8cpp.html#a83752dd39ba266ef141c229b15441c25">   24</a></span><span class="preprocessor">    #define AP_OADATABASE_TIMEOUT_SECONDS_DEFAULT   10</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span> </div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#ifndef AP_OADATABASE_SIZE_DEFAULT</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno"><a class="line" href="AP__OADatabase_8cpp.html#a38ee02adb67e5d4c21187dc0387773d4">   28</a></span><span class="preprocessor">    #define AP_OADATABASE_SIZE_DEFAULT          100</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span> </div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="preprocessor">#ifndef AP_OADATABASE_QUEUE_SIZE_DEFAULT</span></div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno"><a class="line" href="AP__OADatabase_8cpp.html#a90a279ac6eac5c75719f04d70b0eaa29">   32</a></span><span class="preprocessor">    #define AP_OADATABASE_QUEUE_SIZE_DEFAULT 80</span></div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno">   33</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span> </div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="preprocessor">#ifndef AP_OADATABASE_DISTANCE_FROM_HOME</span></div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno"><a class="line" href="AP__OADatabase_8cpp.html#a63f6e3822e87b2f520d017015aa699fc">   36</a></span><span class="preprocessor">    #define AP_OADATABASE_DISTANCE_FROM_HOME 3</span></div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span> </div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span><span class="keyword">const</span> <a class="code hl_struct" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code hl_variable" href="classAP__OADatabase.html#aeeff6362948da85c45f8b14a80d8a5db">AP_OADatabase::var_info</a>[] = {</div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span> </div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    <span class="comment">// @Param: SIZE</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>    <span class="comment">// @DisplayName: OADatabase maximum number of points</span></div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span>    <span class="comment">// @Description: OADatabase maximum number of points. Set to 0 to disable the OA Database. Larger means more points but is more cpu intensive to process</span></div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>    <span class="comment">// @Range: 0 10000</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    <span class="comment">// @RebootRequired: True</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;SIZE&quot;</span>, 1, <a class="code hl_class" href="classAP__OADatabase.html">AP_OADatabase</a>, _database_size_param, <a class="code hl_define" href="AP__OADatabase_8cpp.html#a38ee02adb67e5d4c21187dc0387773d4">AP_OADATABASE_SIZE_DEFAULT</a>),</div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span> </div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    <span class="comment">// @Param: EXPIRE</span></div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span>    <span class="comment">// @DisplayName: OADatabase item timeout</span></div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    <span class="comment">// @Description: OADatabase item timeout. The time an item will linger without any updates before it expires. Zero means never expires which is useful for a sent-once static environment but terrible for dynamic ones.</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>    <span class="comment">// @Units: s</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    <span class="comment">// @Range: 0 127</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    <span class="comment">// @Increment: 1</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;EXPIRE&quot;</span>, 2, <a class="code hl_class" href="classAP__OADatabase.html">AP_OADatabase</a>, _database_expiry_seconds, <a class="code hl_define" href="AP__OADatabase_8cpp.html#a83752dd39ba266ef141c229b15441c25">AP_OADATABASE_TIMEOUT_SECONDS_DEFAULT</a>),</div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span> </div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span>    <span class="comment">// @Param: QUEUE_SIZE</span></div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    <span class="comment">// @DisplayName: OADatabase queue maximum number of points</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <span class="comment">// @Description: OADatabase queue maximum number of points. This in an input buffer size. Larger means it can handle larger bursts of incoming data points to filter into the database. No impact on cpu, only RAM. Recommend larger for faster datalinks or for sensors that generate a lot of data.</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    <span class="comment">// @Range: 1 200</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    <span class="comment">// @RebootRequired: True</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;QUEUE_SIZE&quot;</span>, 3, <a class="code hl_class" href="classAP__OADatabase.html">AP_OADatabase</a>, _queue_size_param, <a class="code hl_define" href="AP__OADatabase_8cpp.html#a90a279ac6eac5c75719f04d70b0eaa29">AP_OADATABASE_QUEUE_SIZE_DEFAULT</a>),</div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span> </div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span>    <span class="comment">// @Param: OUTPUT</span></div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span>    <span class="comment">// @DisplayName: OADatabase output level</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <span class="comment">// @Description: OADatabase output level to configure which database objects are sent to the ground station. All data is always available internally for avoidance algorithms.</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    <span class="comment">// @Values: 0:Disabled,1:Send only HIGH importance items,2:Send HIGH and NORMAL importance items,3:Send all items</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;OUTPUT&quot;</span>, 4, <a class="code hl_class" href="classAP__OADatabase.html">AP_OADatabase</a>, _output_level, (<span class="keywordtype">float</span>)OutputLevel::HIGH),</div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span> </div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    <span class="comment">// @Param: BEAM_WIDTH</span></div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span>    <span class="comment">// @DisplayName: OADatabase beam width</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span>    <span class="comment">// @Description: Beam width of incoming lidar data</span></div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    <span class="comment">// @Units: deg</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    <span class="comment">// @Range: 1 10</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    <span class="comment">// @RebootRequired: True</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;BEAM_WIDTH&quot;</span>, 5, <a class="code hl_class" href="classAP__OADatabase.html">AP_OADatabase</a>, _beam_width, 5.0f),</div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span> </div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span>    <span class="comment">// @Param: RADIUS_MIN</span></div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    <span class="comment">// @DisplayName: OADatabase Minimum  radius</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    <span class="comment">// @Description: Minimum radius of objects held in database</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    <span class="comment">// @Units: m</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    <span class="comment">// @Range: 0 10</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RADIUS_MIN&quot;</span>, 6, <a class="code hl_class" href="classAP__OADatabase.html">AP_OADatabase</a>, _radius_min, 0.01f),</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <span class="comment">// @Param: DIST_MAX</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="comment">// @DisplayName: OADatabase Distance Maximum</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    <span class="comment">// @Description: Maximum distance of objects held in database.  Set to zero to disable the limits</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <span class="comment">// @Units: m</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    <span class="comment">// @Range: 0 10</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;DIST_MAX&quot;</span>, 7, <a class="code hl_class" href="classAP__OADatabase.html">AP_OADatabase</a>, _dist_max, 0.0f),</div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span> </div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    <span class="comment">// @Param{Copter}: ALT_MIN</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <span class="comment">// @DisplayName: OADatabase minimum altitude above home before storing obstacles</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    <span class="comment">// @Description: OADatabase will reject obstacles if vehicle&#39;s altitude above home is below this parameter, in a 3 meter radius around home. Set 0 to disable this feature.</span></div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    <span class="comment">// @Units: m</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    <span class="comment">// @Range: 0 4</span></div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span>    <a class="code hl_define" href="AP__Param_8h.html#a752a6a1d27589c64a386ab2818e7057d">AP_GROUPINFO_FRAME</a>(<span class="stringliteral">&quot;ALT_MIN&quot;</span>, 8, <a class="code hl_class" href="classAP__OADatabase.html">AP_OADatabase</a>, _min_alt, 0.0f, <a class="code hl_define" href="AP__Param_8h.html#afdcffd80a5fa249148be6d8fdc63cb3c">AP_PARAM_FRAME_COPTER</a> | <a class="code hl_define" href="AP__Param_8h.html#ac1328ddd823ea908dfe71e10c9a36a2e">AP_PARAM_FRAME_HELI</a> | <a class="code hl_define" href="AP__Param_8h.html#a9838c03b98e6652d227f617eb2757dd9">AP_PARAM_FRAME_TRICOPTER</a>),</div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span> </div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>    <a class="code hl_define" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>};</div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span> </div>
<div class="foldopen" id="foldopen00109" data-start="{" data-end="}">
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno"><a class="line" href="classAP__OADatabase.html#ab08b21629849d85bcb9989b9c98bc82a">  109</a></span><a class="code hl_function" href="classAP__OADatabase.html#ab08b21629849d85bcb9989b9c98bc82a">AP_OADatabase::AP_OADatabase</a>()</div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>{</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__OADatabase.html#a919b213d1922895975d0fc4e3706b0de">_singleton</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span>        <a class="code hl_function" href="namespaceAP__HAL.html#a52edeef7d5ffaa365e1229b87c170307">AP_HAL::panic</a>(<span class="stringliteral">&quot;AP_OADatabase must be singleton&quot;</span>);</div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    }</div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    <a class="code hl_variable" href="classAP__OADatabase.html#a919b213d1922895975d0fc4e3706b0de">_singleton</a> = <span class="keyword">this</span>;</div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span> </div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <a class="code hl_function" href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a>(<span class="keyword">this</span>, var_info);</div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>}</div>
</div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span> </div>
<div class="foldopen" id="foldopen00119" data-start="{" data-end="}">
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno"><a class="line" href="classAP__OADatabase.html#a67916074c2120c0cbe39ace5877459f3">  119</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__OADatabase.html#a67916074c2120c0cbe39ace5877459f3">AP_OADatabase::init</a>()</div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>{</div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    <a class="code hl_function" href="classAP__OADatabase.html#aa782ea2d0709294f6b12e7d5e004489e">init_database</a>();</div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <a class="code hl_function" href="classAP__OADatabase.html#a6e0393d2689f0e5096574e606aae46b1">init_queue</a>();</div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span> </div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    <span class="comment">// initialise scalar using beam width of at least 1deg</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    <a class="code hl_variable" href="classAP__OADatabase.html#a272a058907ab9b3f886a5232cea1c126">dist_to_radius_scalar</a> = tanf(<a class="code hl_function" href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a>(<a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code hl_variable" href="classAP__OADatabase.html#a2e12101007e18f1a98c7a6721b33c1ac">_beam_width</a>, 1.0f)));</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__OADatabase.html#a2f67b0584e91809f70570ee66db0e730">healthy</a>()) {</div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>        <a class="code hl_define" href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;DB init failed . Sizes queue:%u, db:%u&quot;</span>, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.size, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.size);</div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>        <span class="keyword">delete</span> <a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.items;</div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>        <span class="keyword">delete</span>[] <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items;</div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    }</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span>}</div>
</div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span> </div>
<div class="foldopen" id="foldopen00135" data-start="{" data-end="}">
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno"><a class="line" href="classAP__OADatabase.html#afce1f373d53a347bff6fae313099792a">  135</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__OADatabase.html#afce1f373d53a347bff6fae313099792a">AP_OADatabase::update</a>()</div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>{</div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__OADatabase.html#a2f67b0584e91809f70570ee66db0e730">healthy</a>()) {</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    }</div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span> </div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    <a class="code hl_function" href="classAP__OADatabase.html#abb4bd77524fbd4afa173681e9d73a9e5">process_queue</a>();</div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <a class="code hl_function" href="classAP__OADatabase.html#ab7e263b2ce4698945d73b983d9ec4713">database_items_remove_all_expired</a>();</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span>}</div>
</div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span> </div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span><span class="comment">// push a location into the database</span></div>
<div class="foldopen" id="foldopen00146" data-start="{" data-end="}">
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno"><a class="line" href="classAP__OADatabase.html#ad9316034afee47f7463d230a2074e6db">  146</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__OADatabase.html#ad9316034afee47f7463d230a2074e6db">AP_OADatabase::queue_push</a>(<span class="keyword">const</span> <a class="code hl_class" href="classVector3.html">Vector3f</a> &amp;pos, uint32_t timestamp_ms, <span class="keywordtype">float</span> <a class="code hl_variable" href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a>)</div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>{</div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__OADatabase.html#a2f67b0584e91809f70570ee66db0e730">healthy</a>()) {</div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span>    }</div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span> </div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <span class="comment">// check if this obstacle needs to be rejected from DB because of low altitude near home</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span><span class="preprocessor">#if APM_BUILD_COPTER_OR_HELI</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a>(<a class="code hl_variable" href="classAP__OADatabase.html#adb45d16e6ae2d08daf963d9283018242">_min_alt</a>)) { </div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>        <a class="code hl_class" href="classVector3.html">Vector3f</a> current_pos;</div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>        <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a>().get_relative_position_NED_home(current_pos)) {</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span>            <span class="comment">// we do not know where the vehicle is</span></div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>        }</div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>        <span class="keywordflow">if</span> (current_pos.<a class="code hl_function" href="classVector3.html#abcf8b89285b9966932d1aceeeadb21d3">xy</a>().<a class="code hl_function" href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">length</a>() &lt; <a class="code hl_define" href="AP__OADatabase_8cpp.html#a63f6e3822e87b2f520d017015aa699fc">AP_OADATABASE_DISTANCE_FROM_HOME</a>) {</div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>            <span class="comment">// vehicle is within a small radius of home </span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>            <span class="keywordflow">if</span> (-current_pos.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> &lt; <a class="code hl_variable" href="classAP__OADatabase.html#adb45d16e6ae2d08daf963d9283018242">_min_alt</a>) {</div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>                <span class="comment">// vehicle is below the minimum alt</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>                <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>            }</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span>        }</div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span>    }</div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span>    </div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span>    <span class="comment">// ignore objects that are far away</span></div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__OADatabase.html#a870a65d0f848163cf8ea2336e20bebc9">_dist_max</a> &gt; 0.0f) &amp;&amp; (<a class="code hl_variable" href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a> &gt; <a class="code hl_variable" href="classAP__OADatabase.html#a870a65d0f848163cf8ea2336e20bebc9">_dist_max</a>)) {</div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span>    }</div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span> </div>
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno">  175</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structAP__OADatabase_1_1OA__DbItem.html">OA_DbItem</a> item = {pos, timestamp_ms, <a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(<a class="code hl_variable" href="classAP__OADatabase.html#acf70f2b553efb99c72298a491248efbf">_radius_min</a>, <a class="code hl_variable" href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a> * <a class="code hl_variable" href="classAP__OADatabase.html#a272a058907ab9b3f886a5232cea1c126">dist_to_radius_scalar</a>), 0, <a class="code hl_enumvalue" href="classAP__OADatabase.html#a90293810343f49085b74f18ae0ba5d48a0fffe5c548a4ae73002694a6a8c83d3b">AP_OADatabase::OA_DbItemImportance::Normal</a>};</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>    {</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>        <a class="code hl_define" href="AP__HAL_2Semaphores_8h.html#a819dd9ac6de800cdf1014b0a922b67d4">WITH_SEMAPHORE</a>(<a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.sem);</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span>        <a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.items-&gt;push(item);</div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    }</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>}</div>
</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span> </div>
<div class="foldopen" id="foldopen00182" data-start="{" data-end="}">
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno"><a class="line" href="classAP__OADatabase.html#a6e0393d2689f0e5096574e606aae46b1">  182</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__OADatabase.html#a6e0393d2689f0e5096574e606aae46b1">AP_OADatabase::init_queue</a>()</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span>{</div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span>    <a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.size = <a class="code hl_variable" href="classAP__OADatabase.html#a6a0d23913b093d0b5f250b2b84aa586a">_queue_size_param</a>;</div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.size == 0) {</div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span>    }</div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span> </div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span>    <a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.items = <span class="keyword">new</span> <a class="code hl_class" href="classObjectBuffer.html">ObjectBuffer&lt;OA_DbItem&gt;</a>(<a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.size);</div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.items != <span class="keyword">nullptr</span> &amp;&amp; <a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.items-&gt;get_size() == 0) {</div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span>        <span class="comment">// allocation failed</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span>        <span class="keyword">delete</span> <a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.items;</div>
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno">  193</span>        <a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.items = <span class="keyword">nullptr</span>;</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>    }</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>}</div>
</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span> </div>
<div class="foldopen" id="foldopen00197" data-start="{" data-end="}">
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno"><a class="line" href="classAP__OADatabase.html#aa782ea2d0709294f6b12e7d5e004489e">  197</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__OADatabase.html#aa782ea2d0709294f6b12e7d5e004489e">AP_OADatabase::init_database</a>()</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span>{</div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.size = <a class="code hl_variable" href="classAP__OADatabase.html#a535d464f6fdaea6b7096a9513624968f">_database_size_param</a>;</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__OADatabase.html#a535d464f6fdaea6b7096a9513624968f">_database_size_param</a> == 0) {</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>    }</div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span> </div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span>    <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items = <span class="keyword">new</span> <a class="code hl_struct" href="structAP__OADatabase_1_1OA__DbItem.html">OA_DbItem</a>[<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.size];</div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>}</div>
</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span> </div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span><span class="comment">// get bitmask of gcs channels item should be sent to based on its importance</span></div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span><span class="comment">// returns 0xFF (send to all channels) if should be sent, 0 if it should not be sent</span></div>
<div class="foldopen" id="foldopen00209" data-start="{" data-end="}">
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno"><a class="line" href="classAP__OADatabase.html#a8bd8574649f0920f51489fbd2a7afaae">  209</a></span>uint8_t <a class="code hl_function" href="classAP__OADatabase.html#a8bd8574649f0920f51489fbd2a7afaae">AP_OADatabase::get_send_to_gcs_flags</a>(<span class="keyword">const</span> <a class="code hl_enumeration" href="classAP__OADatabase.html#a90293810343f49085b74f18ae0ba5d48">OA_DbItemImportance</a> importance)</div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>{</div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>    <span class="keywordflow">switch</span> (importance) {</div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__OADatabase.html#a90293810343f49085b74f18ae0ba5d48a68a7524be26382c8f205e7d8e62d26e7">OA_DbItemImportance::Low</a>:</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__OADatabase.html#a74ec6665f4993a783c667d26010cdaae">_output_level</a> &gt;= <a class="code hl_enumvalue" href="classAP__OADatabase.html#a6f1d6b8a0ce5c14786f38a32a4c5ee90a5fb1f955b45e38e31789286a1790398d">OutputLevel::ALL</a>) {</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>            <span class="keywordflow">return</span> 0xFF;</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>        }</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span> </div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__OADatabase.html#a90293810343f49085b74f18ae0ba5d48a0fffe5c548a4ae73002694a6a8c83d3b">OA_DbItemImportance::Normal</a>:</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__OADatabase.html#a74ec6665f4993a783c667d26010cdaae">_output_level</a> &gt;= <a class="code hl_enumvalue" href="classAP__OADatabase.html#a6f1d6b8a0ce5c14786f38a32a4c5ee90ae020b775b206849e2c176c32d8c45fa4">OutputLevel::HIGH_AND_NORMAL</a>) {</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span>            <span class="keywordflow">return</span> 0xFF;</div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>        }</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span> </div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__OADatabase.html#a90293810343f49085b74f18ae0ba5d48a5f2dbb7d579ec195418ead1f27fae76a">OA_DbItemImportance::High</a>:</div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__OADatabase.html#a74ec6665f4993a783c667d26010cdaae">_output_level</a> &gt;= <a class="code hl_enumvalue" href="classAP__OADatabase.html#a6f1d6b8a0ce5c14786f38a32a4c5ee90ab89de3b4b81c4facfac906edf29aec8c">OutputLevel::HIGH</a>) {</div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>            <span class="keywordflow">return</span> 0xFF;</div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>        }</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    }</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>    <span class="keywordflow">return</span> 0x0;</div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>}</div>
</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span> </div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span><span class="comment">// returns true when there&#39;s more work in the queue to do</span></div>
<div class="foldopen" id="foldopen00234" data-start="{" data-end="}">
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno"><a class="line" href="classAP__OADatabase.html#abb4bd77524fbd4afa173681e9d73a9e5">  234</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__OADatabase.html#abb4bd77524fbd4afa173681e9d73a9e5">AP_OADatabase::process_queue</a>()</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>{</div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="classAP__OADatabase.html#a2f67b0584e91809f70570ee66db0e730">healthy</a>()) {</div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>    }</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span> </div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span>    <span class="comment">// processing queue by moving those entries into the database</span></div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <span class="comment">// Using a for with fixed size is better than while(!empty) because the</span></div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>    <span class="comment">// while could get us stuck here longer than expected if we&#39;re getting</span></div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    <span class="comment">// a lot of values pushing into it while we&#39;re trying to empty it. With</span></div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>    <span class="comment">// the for we know we will exit at an expected time</span></div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span>    <span class="keyword">const</span> uint16_t queue_available = <a class="code hl_define" href="monocypher_8cpp.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a>(<a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.items-&gt;available(), 100U);</div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>    <span class="keywordflow">if</span> (queue_available == 0) {</div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>    }</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span> </div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    <span class="keywordflow">for</span> (uint16_t queue_index=0; queue_index&lt;queue_available; queue_index++) {</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>        <a class="code hl_struct" href="structAP__OADatabase_1_1OA__DbItem.html">OA_DbItem</a> item;</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span> </div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span>        <span class="keywordtype">bool</span> pop_success;</div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>        {</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>            <a class="code hl_define" href="AP__HAL_2Semaphores_8h.html#a819dd9ac6de800cdf1014b0a922b67d4">WITH_SEMAPHORE</a>(<a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.sem);</div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>            pop_success = <a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.items-&gt;pop(item);</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>        }</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span>        <span class="keywordflow">if</span> (!pop_success) {</div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>        }</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span> </div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>        item.<a class="code hl_variable" href="structAP__OADatabase_1_1OA__DbItem.html#a89aabe5c472e8a69184ddefec853f8b8">send_to_gcs</a> = <a class="code hl_function" href="classAP__OADatabase.html#a8bd8574649f0920f51489fbd2a7afaae">get_send_to_gcs_flags</a>(item.<a class="code hl_variable" href="structAP__OADatabase_1_1OA__DbItem.html#a245fa8e1c6d0995254574f1ad6fc2c37">importance</a>);</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span> </div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>        <span class="comment">// compare item to all items in database. If found a similar item, update the existing, else add it as a new one</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>        <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>        <span class="keywordflow">for</span> (uint16_t i=0; i&lt;<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count; i++) {</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__OADatabase.html#abaf680e791e9e620cf948cd29c8a28b3">is_close_to_item_in_database</a>(i, item)) {</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>                <a class="code hl_function" href="classAP__OADatabase.html#ab747dbcf71da4dc88332cb3da5dbb63a">database_item_refresh</a>(i, item.<a class="code hl_variable" href="structAP__OADatabase_1_1OA__DbItem.html#a58dfd766c1654ee197557a464147a887">timestamp_ms</a>, item.<a class="code hl_variable" href="structAP__OADatabase_1_1OA__DbItem.html#a2c6aa42293e0cf46ff0c79a78e947b6c">radius</a>);</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>                found = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span>            }</div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>        }</div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span> </div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>        <span class="keywordflow">if</span> (!found) {</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>            <a class="code hl_function" href="classAP__OADatabase.html#af10e2a08d20f79bd87bebebb8e9ae22a">database_item_add</a>(item);</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>        }</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span>    }</div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span>    <span class="keywordflow">return</span> (<a class="code hl_variable" href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">_queue</a>.items-&gt;available() &gt; 0);</div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>}</div>
</div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span> </div>
<div class="foldopen" id="foldopen00281" data-start="{" data-end="}">
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno"><a class="line" href="classAP__OADatabase.html#af10e2a08d20f79bd87bebebb8e9ae22a">  281</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__OADatabase.html#af10e2a08d20f79bd87bebebb8e9ae22a">AP_OADatabase::database_item_add</a>(<span class="keyword">const</span> <a class="code hl_struct" href="structAP__OADatabase_1_1OA__DbItem.html">OA_DbItem</a> &amp;item)</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>{</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count &gt;= <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.size) {</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>    }</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>    <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count] = item;</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>    <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count].<a class="code hl_variable" href="structAP__OADatabase_1_1OA__DbItem.html#a89aabe5c472e8a69184ddefec853f8b8">send_to_gcs</a> = <a class="code hl_function" href="classAP__OADatabase.html#a8bd8574649f0920f51489fbd2a7afaae">get_send_to_gcs_flags</a>(<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count].importance);</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span>    <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count++;</div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>}</div>
</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span> </div>
<div class="foldopen" id="foldopen00291" data-start="{" data-end="}">
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno"><a class="line" href="classAP__OADatabase.html#a475ce24200984d31b1cb943f22444be9">  291</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__OADatabase.html#a475ce24200984d31b1cb943f22444be9">AP_OADatabase::database_item_remove</a>(<span class="keyword">const</span> uint16_t index)</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>{</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>    <span class="keywordflow">if</span> (index &gt;= <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count || <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count == 0) {</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>        <span class="comment">// index out of range</span></div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>    }</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span> </div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>    <span class="comment">// radius of 0 tells the GCS we don&#39;t care about it any more (aka it expired)</span></div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>    <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index].radius = 0;</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>    <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index].send_to_gcs = <a class="code hl_function" href="classAP__OADatabase.html#a8bd8574649f0920f51489fbd2a7afaae">get_send_to_gcs_flags</a>(<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index].importance);</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span> </div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>    <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count--;</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count == 0) {</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span>    }</div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span> </div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>    <span class="keywordflow">if</span> (index != <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count) {</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>        <span class="comment">// copy last object in array over expired object</span></div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>        <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index] = <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count];</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>        <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index].send_to_gcs = <a class="code hl_function" href="classAP__OADatabase.html#a8bd8574649f0920f51489fbd2a7afaae">get_send_to_gcs_flags</a>(<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index].importance);</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>    }</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>}</div>
</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span> </div>
<div class="foldopen" id="foldopen00314" data-start="{" data-end="}">
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno"><a class="line" href="classAP__OADatabase.html#ab747dbcf71da4dc88332cb3da5dbb63a">  314</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__OADatabase.html#ab747dbcf71da4dc88332cb3da5dbb63a">AP_OADatabase::database_item_refresh</a>(<span class="keyword">const</span> uint16_t index, <span class="keyword">const</span> uint32_t timestamp_ms, <span class="keyword">const</span> <span class="keywordtype">float</span> radius)</div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>{</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>    <span class="keywordflow">if</span> (index &gt;= <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count) {</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>        <span class="comment">// index out of range</span></div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>    }</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span> </div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>    <span class="keyword">const</span> <span class="keywordtype">bool</span> is_different =</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>            (!<a class="code hl_function" href="AP__Math_8cpp.html#a74db690fa0d764d7e0900a9c97f629b2">is_equal</a>(<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index].radius, radius)) ||</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span>            (timestamp_ms - <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index].timestamp_ms &gt;= 500);</div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span> </div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>    <span class="keywordflow">if</span> (is_different) {</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>        <span class="comment">// update timestamp and radius on close object so it stays around longer</span></div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>        <span class="comment">// and trigger resending to GCS</span></div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>        <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index].timestamp_ms = timestamp_ms;</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span>        <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index].radius = radius;</div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>        <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index].send_to_gcs = <a class="code hl_function" href="classAP__OADatabase.html#a8bd8574649f0920f51489fbd2a7afaae">get_send_to_gcs_flags</a>(<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index].importance);</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>    }</div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>}</div>
</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span> </div>
<div class="foldopen" id="foldopen00334" data-start="{" data-end="}">
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno"><a class="line" href="classAP__OADatabase.html#ab7e263b2ce4698945d73b983d9ec4713">  334</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__OADatabase.html#ab7e263b2ce4698945d73b983d9ec4713">AP_OADatabase::database_items_remove_all_expired</a>()</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>{</div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>    <span class="comment">// calculate age of all items in the _database</span></div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span> </div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__OADatabase.html#a4b1b8980b1e67c652754fe82ea6f29e0">_database_expiry_seconds</a> &lt;= 0) {</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>        <span class="comment">// zero means never expire. This is not normal behavior but perhaps you could send a static</span></div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span>        <span class="comment">// environment once that you don&#39;t want to have to constantly update</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>    }</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span> </div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    <span class="keyword">const</span> uint32_t now_ms = <a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>    <span class="keyword">const</span> uint32_t expiry_ms = (uint32_t)<a class="code hl_variable" href="classAP__OADatabase.html#a4b1b8980b1e67c652754fe82ea6f29e0">_database_expiry_seconds</a> * 1000;</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>    uint16_t index = 0;</div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>    <span class="keywordflow">while</span> (index &lt; <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count) {</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>        <span class="keywordflow">if</span> (now_ms - <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index].timestamp_ms &gt; expiry_ms) {</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>            <a class="code hl_function" href="classAP__OADatabase.html#a475ce24200984d31b1cb943f22444be9">database_item_remove</a>(index);</div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>            index++;</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>        }</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>    }</div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>}</div>
</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span> </div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span><span class="comment">// returns true if a similar object already exists in database. When true, the object timer is also reset</span></div>
<div class="foldopen" id="foldopen00357" data-start="{" data-end="}">
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno"><a class="line" href="classAP__OADatabase.html#abaf680e791e9e620cf948cd29c8a28b3">  357</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__OADatabase.html#abaf680e791e9e620cf948cd29c8a28b3">AP_OADatabase::is_close_to_item_in_database</a>(<span class="keyword">const</span> uint16_t index, <span class="keyword">const</span> <a class="code hl_struct" href="structAP__OADatabase_1_1OA__DbItem.html">OA_DbItem</a> &amp;item)<span class="keyword"> const</span></div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    <span class="keywordflow">if</span> (index &gt;= <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count) {</div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>        <span class="comment">// index out of range</span></div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>    }</div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span> </div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> distance_sq = (<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index].pos - item.<a class="code hl_variable" href="structAP__OADatabase_1_1OA__DbItem.html#a997544da3e55d486b5af5f4097371dd3">pos</a>).length_squared();</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>    <span class="keywordflow">return</span> ((distance_sq &lt; <a class="code hl_function" href="AP__Math_8h.html#a34f41fcf2bc527b1728ae04423dfba46">sq</a>(item.<a class="code hl_variable" href="structAP__OADatabase_1_1OA__DbItem.html#a2c6aa42293e0cf46ff0c79a78e947b6c">radius</a>)) || (distance_sq &lt; <a class="code hl_function" href="AP__Math_8h.html#a34f41fcf2bc527b1728ae04423dfba46">sq</a>(<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[index].radius)));</div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>}</div>
</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span> </div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span><span class="preprocessor">#if HAL_GCS_ENABLED</span></div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span><span class="comment">// send ADSB_VEHICLE mavlink messages</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__OADatabase.html#abd4dc926f49ecbf644d36b0ee7ceb10e">AP_OADatabase::send_adsb_vehicle</a>(mavlink_channel_t <a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>, uint16_t interval_ms)</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>{</div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>    <span class="comment">// ensure database&#39;s send_to_gcs field is large enough</span></div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>    <span class="keyword">static_assert</span>(<a class="code hl_define" href="GCS__MAVLink_8h.html#aff625e94451bf446bdd56f5d0e081077">MAVLINK_COMM_NUM_BUFFERS</a> &lt;= <span class="keyword">sizeof</span>(<a class="code hl_variable" href="structAP__OADatabase_1_1OA__DbItem.html#a89aabe5c472e8a69184ddefec853f8b8">OA_DbItem::send_to_gcs</a>) * 8,</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>                  <span class="stringliteral">&quot;AP_OADatabase&#39;s OA_DBItem.send_to_gcs bitmask must be large enough to hold MAVLINK_COMM_NUM_BUFFERS&quot;</span>);</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span> </div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__OADatabase.html#a74ec6665f4993a783c667d26010cdaae">_output_level</a> &lt;= <a class="code hl_enumvalue" href="classAP__OADatabase.html#a6f1d6b8a0ce5c14786f38a32a4c5ee90ab50339a10e1de285ac99d4c3990b8693">OutputLevel::NONE</a>) || !<a class="code hl_function" href="classAP__OADatabase.html#a2f67b0584e91809f70570ee66db0e730">healthy</a>()) {</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span>    }</div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>    <span class="keyword">const</span> uint8_t chan_as_bitmask = 1 &lt;&lt; <a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>;</div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> callsign[9] = <span class="stringliteral">&quot;OA_DB&quot;</span>;</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span> </div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>    <span class="comment">// calculate how many messages we should send</span></div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    <span class="keyword">const</span> uint32_t now_ms = <a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>    uint16_t num_to_send = 1;</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>    uint16_t num_sent = 0;</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>    <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__OADatabase.html#a72c8ee2a93ec4f03b7dfdc57a7515f97">_last_send_to_gcs_ms</a>[<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>] != 0) &amp;&amp; (interval_ms &gt; 0)) {</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>        uint32_t diff_ms = now_ms - <a class="code hl_variable" href="classAP__OADatabase.html#a72c8ee2a93ec4f03b7dfdc57a7515f97">_last_send_to_gcs_ms</a>[<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>];</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span>        num_to_send = <a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(diff_ms / interval_ms, 1U);</div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    }</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    <a class="code hl_variable" href="classAP__OADatabase.html#a72c8ee2a93ec4f03b7dfdc57a7515f97">_last_send_to_gcs_ms</a>[<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>] = now_ms;</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span> </div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>    <span class="comment">// send unsent objects until output buffer is full or have sent enough</span></div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>    <span class="keywordflow">for</span> (uint16_t i=0; i &lt; <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count; i++) {</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span>        <span class="keywordflow">if</span> (!<a class="code hl_define" href="GCS_8h.html#a567872f14571119c9f5e1f8b7ed8085e">HAVE_PAYLOAD_SPACE</a>(<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>, ADSB_VEHICLE) || (num_sent &gt;= num_to_send)) {</div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>            <span class="comment">// all done for now</span></div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>        }</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span> </div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>        <span class="keyword">const</span> uint16_t idx = <a class="code hl_variable" href="classAP__OADatabase.html#af8c458c50bde800489b1592b00fb8367">_next_index_to_send</a>[<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>];</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span> </div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>        <span class="comment">// prepare to send next object</span></div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>        <a class="code hl_variable" href="classAP__OADatabase.html#af8c458c50bde800489b1592b00fb8367">_next_index_to_send</a>[<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>]++;</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__OADatabase.html#af8c458c50bde800489b1592b00fb8367">_next_index_to_send</a>[<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>] &gt;= <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count) {</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span>            <a class="code hl_variable" href="classAP__OADatabase.html#af8c458c50bde800489b1592b00fb8367">_next_index_to_send</a>[<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>] = 0;</div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>        }</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span> </div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>        <span class="keywordflow">if</span> ((<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[idx].send_to_gcs &amp; chan_as_bitmask) == 0) {</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>        }</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span> </div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>        <span class="comment">// convert object&#39;s position as an offset from EKF origin to Location</span></div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span>        <span class="keyword">const</span> <a class="code hl_class" href="classLocation.html">Location</a> item_loc(<a class="code hl_typedef" href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a>(<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[idx].pos.x * 100.0f, <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[idx].pos.y * 100.0f, <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[idx].pos.z * 100.0f), <a class="code hl_enumvalue" href="classLocation.html#af494dabb88cd43e0d4efa99f04d31351a188096f6fdb3ff253412ae80be048dcf">Location::AltFrame::ABOVE_ORIGIN</a>);</div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span> </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span>        mavlink_msg_adsb_vehicle_send(<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>,</div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span>            idx,</div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span>            item_loc.lat,</div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span>            item_loc.lng,</div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span>            0,                          <span class="comment">// altitude_type</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span>            item_loc.alt,               </div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span>            0,                          <span class="comment">// heading</span></div>
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno">  422</span>            0,                          <span class="comment">// hor_velocity</span></div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>            0,                          <span class="comment">// ver_velocity</span></div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>            callsign,                   <span class="comment">// callsign</span></div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>            255,                        <span class="comment">// emitter_type</span></div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>            0,                          <span class="comment">// tslc</span></div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span>            0,                          <span class="comment">// flags</span></div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>            (uint16_t)(<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[idx].radius * 100.f));   <span class="comment">// squawk</span></div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span> </div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>        <span class="comment">// unmark item for sending to gcs</span></div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>        <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[idx].send_to_gcs &amp;= ~chan_as_bitmask;</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span> </div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>        <span class="comment">// update highest index sent to GCS</span></div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>        <a class="code hl_variable" href="classAP__OADatabase.html#a50f755f0e61264cd84a8395b024416ac">_highest_index_sent</a>[<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>] = <a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(idx, <a class="code hl_variable" href="classAP__OADatabase.html#a50f755f0e61264cd84a8395b024416ac">_highest_index_sent</a>[<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>]);</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span> </div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>        <span class="comment">// update count sent</span></div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>        num_sent++;</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>    }</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span> </div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>    <span class="comment">// clear expired items in case the database size shrank</span></div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>    <span class="keywordflow">while</span> (<a class="code hl_variable" href="classAP__OADatabase.html#a50f755f0e61264cd84a8395b024416ac">_highest_index_sent</a>[<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>] &gt; <a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.count) {</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>        <span class="keywordflow">if</span> (!<a class="code hl_define" href="GCS_8h.html#a567872f14571119c9f5e1f8b7ed8085e">HAVE_PAYLOAD_SPACE</a>(<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>, ADSB_VEHICLE) || (num_sent &gt;= num_to_send)) {</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>            <span class="comment">// all done for now</span></div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>            <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>        }</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span> </div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span>        <span class="keyword">const</span> uint16_t idx = <a class="code hl_variable" href="classAP__OADatabase.html#a50f755f0e61264cd84a8395b024416ac">_highest_index_sent</a>[<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>];</div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span>        <a class="code hl_variable" href="classAP__OADatabase.html#a50f755f0e61264cd84a8395b024416ac">_highest_index_sent</a>[<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>]--;</div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span> </div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">_database</a>.items[idx].importance != <a class="code hl_enumvalue" href="classAP__OADatabase.html#a90293810343f49085b74f18ae0ba5d48a5f2dbb7d579ec195418ead1f27fae76a">OA_DbItemImportance::High</a>) {</div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>        }</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span> </div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>        mavlink_msg_adsb_vehicle_send(<a class="code hl_variable" href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a>,</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>            idx,        <span class="comment">// id</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>            0,          <span class="comment">// latitude</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>            0,          <span class="comment">// longitude</span></div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>            0,          <span class="comment">// altitude_type</span></div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>            0,          <span class="comment">// altitude</span></div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>            0,          <span class="comment">// heading</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>            0,          <span class="comment">// hor_velocity</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>            0,          <span class="comment">// ver_velocity</span></div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>            callsign,   <span class="comment">// callsign</span></div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>            255,        <span class="comment">// emitter_type</span></div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>            0,          <span class="comment">// tslc</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>            0,          <span class="comment">// flags</span></div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>            0);         <span class="comment">// squawk</span></div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span> </div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>        <span class="comment">// update count sent</span></div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>        num_sent++;</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>    }</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span>}</div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span><span class="preprocessor">#endif  </span><span class="comment">// HAL_GCS_ENABLED</span></div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span> </div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span><span class="comment">// singleton instance</span></div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span><a class="code hl_class" href="classAP__OADatabase.html">AP_OADatabase</a> *<a class="code hl_variable" href="classAP__OADatabase.html#a919b213d1922895975d0fc4e3706b0de">AP_OADatabase::_singleton</a>;</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span> </div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceAP.html">AP</a> {</div>
<div class="foldopen" id="foldopen00479" data-start="{" data-end="}">
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno"><a class="line" href="namespaceAP.html#afcaac7657bb6b713f524d42ee5bb98b5">  479</a></span><a class="code hl_class" href="classAP__OADatabase.html">AP_OADatabase</a> *<a class="code hl_function" href="namespaceAP.html#afcaac7657bb6b713f524d42ee5bb98b5">oadatabase</a>()</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span>{</div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classAP__OADatabase.html#ab8f19d091ebd7ddebab525bf60925ba6">AP_OADatabase::get_singleton</a>();</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>}</div>
</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span> </div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span>}</div>
<div class="ttc" id="aAP__AHRS_8h_html"><div class="ttname"><a href="AP__AHRS_8h.html">AP_AHRS.h</a></div></div>
<div class="ttc" id="aAP__HAL_2Semaphores_8h_html_a819dd9ac6de800cdf1014b0a922b67d4"><div class="ttname"><a href="AP__HAL_2Semaphores_8h.html#a819dd9ac6de800cdf1014b0a922b67d4">WITH_SEMAPHORE</a></div><div class="ttdeci">#define WITH_SEMAPHORE(sem)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Semaphores_8h_source.html#l00054">Semaphores.h:54</a></div></div>
<div class="ttc" id="aAP__Math_8cpp_html_a74db690fa0d764d7e0900a9c97f629b2"><div class="ttname"><a href="AP__Math_8cpp.html#a74db690fa0d764d7e0900a9c97f629b2">is_equal</a></div><div class="ttdeci">std::enable_if&lt; std::is_integral&lt; typenamestd::common_type&lt; Arithmetic1, Arithmetic2 &gt;::type &gt;::value, bool &gt;::type is_equal(const Arithmetic1 v_1, const Arithmetic2 v_2)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8cpp_source.html#l00014">AP_Math.cpp:14</a></div></div>
<div class="ttc" id="aAP__Math_8h_html"><div class="ttname"><a href="AP__Math_8h.html">AP_Math.h</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a2a12cce483e9b870da70d30406d82c60"><div class="ttname"><a href="AP__Math_8h.html#a2a12cce483e9b870da70d30406d82c60">is_zero</a></div><div class="ttdeci">bool is_zero(const T fVal1)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00053">AP_Math.h:53</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a34f41fcf2bc527b1728ae04423dfba46"><div class="ttname"><a href="AP__Math_8h.html#a34f41fcf2bc527b1728ae04423dfba46">sq</a></div><div class="ttdeci">ftype sq(const T val)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00225">AP_Math.h:225</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a49ad7fa2fa2e3d8aa75e8e0ec3f83b99"><div class="ttname"><a href="AP__Math_8h.html#a49ad7fa2fa2e3d8aa75e8e0ec3f83b99">radians</a></div><div class="ttdeci">static constexpr ftype radians(ftype deg)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00213">AP_Math.h:213</a></div></div>
<div class="ttc" id="aAP__OADatabase_8cpp_html_a38ee02adb67e5d4c21187dc0387773d4"><div class="ttname"><a href="AP__OADatabase_8cpp.html#a38ee02adb67e5d4c21187dc0387773d4">AP_OADATABASE_SIZE_DEFAULT</a></div><div class="ttdeci">#define AP_OADATABASE_SIZE_DEFAULT</div><div class="ttdef"><b>Definition</b> <a href="#l00028">AP_OADatabase.cpp:28</a></div></div>
<div class="ttc" id="aAP__OADatabase_8cpp_html_a63f6e3822e87b2f520d017015aa699fc"><div class="ttname"><a href="AP__OADatabase_8cpp.html#a63f6e3822e87b2f520d017015aa699fc">AP_OADATABASE_DISTANCE_FROM_HOME</a></div><div class="ttdeci">#define AP_OADATABASE_DISTANCE_FROM_HOME</div><div class="ttdef"><b>Definition</b> <a href="#l00036">AP_OADatabase.cpp:36</a></div></div>
<div class="ttc" id="aAP__OADatabase_8cpp_html_a83752dd39ba266ef141c229b15441c25"><div class="ttname"><a href="AP__OADatabase_8cpp.html#a83752dd39ba266ef141c229b15441c25">AP_OADATABASE_TIMEOUT_SECONDS_DEFAULT</a></div><div class="ttdeci">#define AP_OADATABASE_TIMEOUT_SECONDS_DEFAULT</div><div class="ttdef"><b>Definition</b> <a href="#l00024">AP_OADatabase.cpp:24</a></div></div>
<div class="ttc" id="aAP__OADatabase_8cpp_html_a90a279ac6eac5c75719f04d70b0eaa29"><div class="ttname"><a href="AP__OADatabase_8cpp.html#a90a279ac6eac5c75719f04d70b0eaa29">AP_OADATABASE_QUEUE_SIZE_DEFAULT</a></div><div class="ttdeci">#define AP_OADATABASE_QUEUE_SIZE_DEFAULT</div><div class="ttdef"><b>Definition</b> <a href="#l00032">AP_OADatabase.cpp:32</a></div></div>
<div class="ttc" id="aAP__OADatabase_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="AP__OADatabase_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition</b> <a href="AC__PID__test_8cpp_source.html#l00021">AC_PID_test.cpp:21</a></div></div>
<div class="ttc" id="aAP__OADatabase_8h_html"><div class="ttname"><a href="AP__OADatabase_8h.html">AP_OADatabase.h</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00163">AP_Param.h:163</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a752a6a1d27589c64a386ab2818e7057d"><div class="ttname"><a href="AP__Param_8h.html#a752a6a1d27589c64a386ab2818e7057d">AP_GROUPINFO_FRAME</a></div><div class="ttdeci">#define AP_GROUPINFO_FRAME(name, idx, clazz, element, def, frame_flags)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00136">AP_Param.h:136</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a78a408c84f2a1bafde256ac650142e4d"><div class="ttname"><a href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, clazz, element, def)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00145">AP_Param.h:145</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a9838c03b98e6652d227f617eb2757dd9"><div class="ttname"><a href="AP__Param_8h.html#a9838c03b98e6652d227f617eb2757dd9">AP_PARAM_FRAME_TRICOPTER</a></div><div class="ttdeci">#define AP_PARAM_FRAME_TRICOPTER</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00120">AP_Param.h:120</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_ac1328ddd823ea908dfe71e10c9a36a2e"><div class="ttname"><a href="AP__Param_8h.html#ac1328ddd823ea908dfe71e10c9a36a2e">AP_PARAM_FRAME_HELI</a></div><div class="ttdeci">#define AP_PARAM_FRAME_HELI</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00121">AP_Param.h:121</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_afdcffd80a5fa249148be6d8fdc63cb3c"><div class="ttname"><a href="AP__Param_8h.html#afdcffd80a5fa249148be6d8fdc63cb3c">AP_PARAM_FRAME_COPTER</a></div><div class="ttdeci">#define AP_PARAM_FRAME_COPTER</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00116">AP_Param.h:116</a></div></div>
<div class="ttc" id="aAP__Vehicle__Type_8h_html"><div class="ttname"><a href="AP__Vehicle__Type_8h.html">AP_Vehicle_Type.h</a></div></div>
<div class="ttc" id="aGCS_8h_html"><div class="ttname"><a href="GCS_8h.html">GCS.h</a></div><div class="ttdoc">Interface definition for the various Ground Control System.</div></div>
<div class="ttc" id="aGCS_8h_html_a266bfe8eda675e1092f045e93932b4a6"><div class="ttname"><a href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a></div><div class="ttdeci">#define GCS_SEND_TEXT(severity, format, args...)</div><div class="ttdef"><b>Definition</b> <a href="GCS_8h_source.html#l01349">GCS.h:1349</a></div></div>
<div class="ttc" id="aGCS_8h_html_a567872f14571119c9f5e1f8b7ed8085e"><div class="ttname"><a href="GCS_8h.html#a567872f14571119c9f5e1f8b7ed8085e">HAVE_PAYLOAD_SPACE</a></div><div class="ttdeci">#define HAVE_PAYLOAD_SPACE(_chan, id)</div><div class="ttdef"><b>Definition</b> <a href="GCS_8h_source.html#l00054">GCS.h:54</a></div></div>
<div class="ttc" id="aGCS__MAVLink_8h_html_aff625e94451bf446bdd56f5d0e081077"><div class="ttname"><a href="GCS__MAVLink_8h.html#aff625e94451bf446bdd56f5d0e081077">MAVLINK_COMM_NUM_BUFFERS</a></div><div class="ttdeci">#define MAVLINK_COMM_NUM_BUFFERS</div><div class="ttdef"><b>Definition</b> <a href="GCS__MAVLink_8h_source.html#l00023">GCS_MAVLink.h:23</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00021">HAL.h:21</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html"><div class="ttname"><a href="classAP__OADatabase.html">AP_OADatabase</a></div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00008">AP_OADatabase.h:8</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a272a058907ab9b3f886a5232cea1c126"><div class="ttname"><a href="classAP__OADatabase.html#a272a058907ab9b3f886a5232cea1c126">AP_OADatabase::dist_to_radius_scalar</a></div><div class="ttdeci">float dist_to_radius_scalar</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00099">AP_OADatabase.h:99</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a2946cae35e2bd0bce611265d0cf9dea6"><div class="ttname"><a href="classAP__OADatabase.html#a2946cae35e2bd0bce611265d0cf9dea6">AP_OADatabase::_database</a></div><div class="ttdeci">struct AP_OADatabase::@2 _database</div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a2e12101007e18f1a98c7a6721b33c1ac"><div class="ttname"><a href="classAP__OADatabase.html#a2e12101007e18f1a98c7a6721b33c1ac">AP_OADatabase::_beam_width</a></div><div class="ttdeci">AP_Float _beam_width</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00089">AP_OADatabase.h:89</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a2f67b0584e91809f70570ee66db0e730"><div class="ttname"><a href="classAP__OADatabase.html#a2f67b0584e91809f70570ee66db0e730">AP_OADatabase::healthy</a></div><div class="ttdeci">bool healthy() const</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00041">AP_OADatabase.h:41</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a475ce24200984d31b1cb943f22444be9"><div class="ttname"><a href="classAP__OADatabase.html#a475ce24200984d31b1cb943f22444be9">AP_OADatabase::database_item_remove</a></div><div class="ttdeci">void database_item_remove(const uint16_t index)</div><div class="ttdef"><b>Definition</b> <a href="#l00291">AP_OADatabase.cpp:291</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a4b1b8980b1e67c652754fe82ea6f29e0"><div class="ttname"><a href="classAP__OADatabase.html#a4b1b8980b1e67c652754fe82ea6f29e0">AP_OADatabase::_database_expiry_seconds</a></div><div class="ttdeci">AP_Int8 _database_expiry_seconds</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00087">AP_OADatabase.h:87</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a50f755f0e61264cd84a8395b024416ac"><div class="ttname"><a href="classAP__OADatabase.html#a50f755f0e61264cd84a8395b024416ac">AP_OADatabase::_highest_index_sent</a></div><div class="ttdeci">uint16_t _highest_index_sent[MAVLINK_COMM_NUM_BUFFERS]</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00108">AP_OADatabase.h:108</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a535d464f6fdaea6b7096a9513624968f"><div class="ttname"><a href="classAP__OADatabase.html#a535d464f6fdaea6b7096a9513624968f">AP_OADatabase::_database_size_param</a></div><div class="ttdeci">AP_Int16 _database_size_param</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00086">AP_OADatabase.h:86</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a67916074c2120c0cbe39ace5877459f3"><div class="ttname"><a href="classAP__OADatabase.html#a67916074c2120c0cbe39ace5877459f3">AP_OADatabase::init</a></div><div class="ttdeci">void init()</div><div class="ttdef"><b>Definition</b> <a href="#l00119">AP_OADatabase.cpp:119</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a6a0d23913b093d0b5f250b2b84aa586a"><div class="ttname"><a href="classAP__OADatabase.html#a6a0d23913b093d0b5f250b2b84aa586a">AP_OADatabase::_queue_size_param</a></div><div class="ttdeci">AP_Int16 _queue_size_param</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00085">AP_OADatabase.h:85</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a6e0393d2689f0e5096574e606aae46b1"><div class="ttname"><a href="classAP__OADatabase.html#a6e0393d2689f0e5096574e606aae46b1">AP_OADatabase::init_queue</a></div><div class="ttdeci">void init_queue()</div><div class="ttdef"><b>Definition</b> <a href="#l00182">AP_OADatabase.cpp:182</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a6f1d6b8a0ce5c14786f38a32a4c5ee90a5fb1f955b45e38e31789286a1790398d"><div class="ttname"><a href="classAP__OADatabase.html#a6f1d6b8a0ce5c14786f38a32a4c5ee90a5fb1f955b45e38e31789286a1790398d">AP_OADatabase::OutputLevel::ALL</a></div><div class="ttdeci">@ ALL</div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a6f1d6b8a0ce5c14786f38a32a4c5ee90ab50339a10e1de285ac99d4c3990b8693"><div class="ttname"><a href="classAP__OADatabase.html#a6f1d6b8a0ce5c14786f38a32a4c5ee90ab50339a10e1de285ac99d4c3990b8693">AP_OADatabase::OutputLevel::NONE</a></div><div class="ttdeci">@ NONE</div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a6f1d6b8a0ce5c14786f38a32a4c5ee90ab89de3b4b81c4facfac906edf29aec8c"><div class="ttname"><a href="classAP__OADatabase.html#a6f1d6b8a0ce5c14786f38a32a4c5ee90ab89de3b4b81c4facfac906edf29aec8c">AP_OADatabase::OutputLevel::HIGH</a></div><div class="ttdeci">@ HIGH</div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a6f1d6b8a0ce5c14786f38a32a4c5ee90ae020b775b206849e2c176c32d8c45fa4"><div class="ttname"><a href="classAP__OADatabase.html#a6f1d6b8a0ce5c14786f38a32a4c5ee90ae020b775b206849e2c176c32d8c45fa4">AP_OADatabase::OutputLevel::HIGH_AND_NORMAL</a></div><div class="ttdeci">@ HIGH_AND_NORMAL</div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a72c8ee2a93ec4f03b7dfdc57a7515f97"><div class="ttname"><a href="classAP__OADatabase.html#a72c8ee2a93ec4f03b7dfdc57a7515f97">AP_OADatabase::_last_send_to_gcs_ms</a></div><div class="ttdeci">uint32_t _last_send_to_gcs_ms[MAVLINK_COMM_NUM_BUFFERS]</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00109">AP_OADatabase.h:109</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a74ec6665f4993a783c667d26010cdaae"><div class="ttname"><a href="classAP__OADatabase.html#a74ec6665f4993a783c667d26010cdaae">AP_OADatabase::_output_level</a></div><div class="ttdeci">AP_Enum&lt; OutputLevel &gt; _output_level</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00088">AP_OADatabase.h:88</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a7aa875a4dc353e222070f07b728cc08d"><div class="ttname"><a href="classAP__OADatabase.html#a7aa875a4dc353e222070f07b728cc08d">AP_OADatabase::_queue</a></div><div class="ttdeci">struct AP_OADatabase::@1 _queue</div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a870a65d0f848163cf8ea2336e20bebc9"><div class="ttname"><a href="classAP__OADatabase.html#a870a65d0f848163cf8ea2336e20bebc9">AP_OADatabase::_dist_max</a></div><div class="ttdeci">AP_Float _dist_max</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00091">AP_OADatabase.h:91</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a8bd8574649f0920f51489fbd2a7afaae"><div class="ttname"><a href="classAP__OADatabase.html#a8bd8574649f0920f51489fbd2a7afaae">AP_OADatabase::get_send_to_gcs_flags</a></div><div class="ttdeci">uint8_t get_send_to_gcs_flags(const OA_DbItemImportance importance)</div><div class="ttdef"><b>Definition</b> <a href="#l00209">AP_OADatabase.cpp:209</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a90293810343f49085b74f18ae0ba5d48"><div class="ttname"><a href="classAP__OADatabase.html#a90293810343f49085b74f18ae0ba5d48">AP_OADatabase::OA_DbItemImportance</a></div><div class="ttdeci">OA_DbItemImportance</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00020">AP_OADatabase.h:20</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a90293810343f49085b74f18ae0ba5d48a0fffe5c548a4ae73002694a6a8c83d3b"><div class="ttname"><a href="classAP__OADatabase.html#a90293810343f49085b74f18ae0ba5d48a0fffe5c548a4ae73002694a6a8c83d3b">AP_OADatabase::Normal</a></div><div class="ttdeci">@ Normal</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00022">AP_OADatabase.h:22</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a90293810343f49085b74f18ae0ba5d48a5f2dbb7d579ec195418ead1f27fae76a"><div class="ttname"><a href="classAP__OADatabase.html#a90293810343f49085b74f18ae0ba5d48a5f2dbb7d579ec195418ead1f27fae76a">AP_OADatabase::High</a></div><div class="ttdeci">@ High</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00023">AP_OADatabase.h:23</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a90293810343f49085b74f18ae0ba5d48a68a7524be26382c8f205e7d8e62d26e7"><div class="ttname"><a href="classAP__OADatabase.html#a90293810343f49085b74f18ae0ba5d48a68a7524be26382c8f205e7d8e62d26e7">AP_OADatabase::Low</a></div><div class="ttdeci">@ Low</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00021">AP_OADatabase.h:21</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_a919b213d1922895975d0fc4e3706b0de"><div class="ttname"><a href="classAP__OADatabase.html#a919b213d1922895975d0fc4e3706b0de">AP_OADatabase::_singleton</a></div><div class="ttdeci">static AP_OADatabase * _singleton</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00111">AP_OADatabase.h:111</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_aa782ea2d0709294f6b12e7d5e004489e"><div class="ttname"><a href="classAP__OADatabase.html#aa782ea2d0709294f6b12e7d5e004489e">AP_OADatabase::init_database</a></div><div class="ttdeci">void init_database()</div><div class="ttdef"><b>Definition</b> <a href="#l00197">AP_OADatabase.cpp:197</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_ab08b21629849d85bcb9989b9c98bc82a"><div class="ttname"><a href="classAP__OADatabase.html#ab08b21629849d85bcb9989b9c98bc82a">AP_OADatabase::AP_OADatabase</a></div><div class="ttdeci">AP_OADatabase()</div><div class="ttdef"><b>Definition</b> <a href="#l00109">AP_OADatabase.cpp:109</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_ab747dbcf71da4dc88332cb3da5dbb63a"><div class="ttname"><a href="classAP__OADatabase.html#ab747dbcf71da4dc88332cb3da5dbb63a">AP_OADatabase::database_item_refresh</a></div><div class="ttdeci">void database_item_refresh(const uint16_t index, const uint32_t timestamp_ms, const float radius)</div><div class="ttdef"><b>Definition</b> <a href="#l00314">AP_OADatabase.cpp:314</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_ab7e263b2ce4698945d73b983d9ec4713"><div class="ttname"><a href="classAP__OADatabase.html#ab7e263b2ce4698945d73b983d9ec4713">AP_OADatabase::database_items_remove_all_expired</a></div><div class="ttdeci">void database_items_remove_all_expired()</div><div class="ttdef"><b>Definition</b> <a href="#l00334">AP_OADatabase.cpp:334</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_ab8f19d091ebd7ddebab525bf60925ba6"><div class="ttname"><a href="classAP__OADatabase.html#ab8f19d091ebd7ddebab525bf60925ba6">AP_OADatabase::get_singleton</a></div><div class="ttdeci">static AP_OADatabase * get_singleton()</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00016">AP_OADatabase.h:16</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_abaf680e791e9e620cf948cd29c8a28b3"><div class="ttname"><a href="classAP__OADatabase.html#abaf680e791e9e620cf948cd29c8a28b3">AP_OADatabase::is_close_to_item_in_database</a></div><div class="ttdeci">bool is_close_to_item_in_database(const uint16_t index, const OA_DbItem &amp;item) const</div><div class="ttdef"><b>Definition</b> <a href="#l00357">AP_OADatabase.cpp:357</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_abb4bd77524fbd4afa173681e9d73a9e5"><div class="ttname"><a href="classAP__OADatabase.html#abb4bd77524fbd4afa173681e9d73a9e5">AP_OADatabase::process_queue</a></div><div class="ttdeci">bool process_queue()</div><div class="ttdef"><b>Definition</b> <a href="#l00234">AP_OADatabase.cpp:234</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_abd4dc926f49ecbf644d36b0ee7ceb10e"><div class="ttname"><a href="classAP__OADatabase.html#abd4dc926f49ecbf644d36b0ee7ceb10e">AP_OADatabase::send_adsb_vehicle</a></div><div class="ttdeci">void send_adsb_vehicle(mavlink_channel_t chan, uint16_t interval_ms)</div></div>
<div class="ttc" id="aclassAP__OADatabase_html_acf70f2b553efb99c72298a491248efbf"><div class="ttname"><a href="classAP__OADatabase.html#acf70f2b553efb99c72298a491248efbf">AP_OADatabase::_radius_min</a></div><div class="ttdeci">AP_Float _radius_min</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00090">AP_OADatabase.h:90</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_ad9316034afee47f7463d230a2074e6db"><div class="ttname"><a href="classAP__OADatabase.html#ad9316034afee47f7463d230a2074e6db">AP_OADatabase::queue_push</a></div><div class="ttdeci">void queue_push(const Vector3f &amp;pos, uint32_t timestamp_ms, float distance)</div><div class="ttdef"><b>Definition</b> <a href="#l00146">AP_OADatabase.cpp:146</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_adb45d16e6ae2d08daf963d9283018242"><div class="ttname"><a href="classAP__OADatabase.html#adb45d16e6ae2d08daf963d9283018242">AP_OADatabase::_min_alt</a></div><div class="ttdeci">AP_Float _min_alt</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00092">AP_OADatabase.h:92</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_aeeff6362948da85c45f8b14a80d8a5db"><div class="ttname"><a href="classAP__OADatabase.html#aeeff6362948da85c45f8b14a80d8a5db">AP_OADatabase::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00039">AP_OADatabase.h:39</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_af10e2a08d20f79bd87bebebb8e9ae22a"><div class="ttname"><a href="classAP__OADatabase.html#af10e2a08d20f79bd87bebebb8e9ae22a">AP_OADatabase::database_item_add</a></div><div class="ttdeci">void database_item_add(const OA_DbItem &amp;item)</div><div class="ttdef"><b>Definition</b> <a href="#l00281">AP_OADatabase.cpp:281</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_af8c458c50bde800489b1592b00fb8367"><div class="ttname"><a href="classAP__OADatabase.html#af8c458c50bde800489b1592b00fb8367">AP_OADatabase::_next_index_to_send</a></div><div class="ttdeci">uint16_t _next_index_to_send[MAVLINK_COMM_NUM_BUFFERS]</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00107">AP_OADatabase.h:107</a></div></div>
<div class="ttc" id="aclassAP__OADatabase_html_afce1f373d53a347bff6fae313099792a"><div class="ttname"><a href="classAP__OADatabase.html#afce1f373d53a347bff6fae313099792a">AP_OADatabase::update</a></div><div class="ttdeci">void update()</div><div class="ttdef"><b>Definition</b> <a href="#l00135">AP_OADatabase.cpp:135</a></div></div>
<div class="ttc" id="aclassAP__Param_html_a5f6dcfce1c0a79cf5bd81283e22f3201"><div class="ttname"><a href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a></div><div class="ttdeci">static void setup_object_defaults(const void *object_pointer, const struct GroupInfo *group_info)</div><div class="ttdef"><b>Definition</b> <a href="main_8cpp_source.html#l00010">main.cpp:10</a></div></div>
<div class="ttc" id="aclassLocation_html"><div class="ttname"><a href="classLocation.html">Location</a></div><div class="ttdef"><b>Definition</b> <a href="Location_8h_source.html#l00007">Location.h:8</a></div></div>
<div class="ttc" id="aclassLocation_html_af494dabb88cd43e0d4efa99f04d31351a188096f6fdb3ff253412ae80be048dcf"><div class="ttname"><a href="classLocation.html#af494dabb88cd43e0d4efa99f04d31351a188096f6fdb3ff253412ae80be048dcf">Location::AltFrame::ABOVE_ORIGIN</a></div><div class="ttdeci">@ ABOVE_ORIGIN</div></div>
<div class="ttc" id="aclassObjectBuffer_html"><div class="ttname"><a href="classObjectBuffer.html">ObjectBuffer</a></div><div class="ttdef"><b>Definition</b> <a href="RingBuffer_8h_source.html#l00112">RingBuffer.h:112</a></div></div>
<div class="ttc" id="aclassVector3_html"><div class="ttname"><a href="classVector3.html">Vector3&lt; float &gt;</a></div></div>
<div class="ttc" id="aclassVector3_html_ab3e7f5401dd6e951978bfa746809f74f"><div class="ttname"><a href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">Vector3::z</a></div><div class="ttdeci">T z</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00076">vector3.h:76</a></div></div>
<div class="ttc" id="aclassVector3_html_abcf8b89285b9966932d1aceeeadb21d3"><div class="ttname"><a href="classVector3.html#abcf8b89285b9966932d1aceeeadb21d3">Vector3::xy</a></div><div class="ttdeci">const Vector2&lt; T &gt; &amp; xy() const</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00203">vector3.h:203</a></div></div>
<div class="ttc" id="aexamples_2AnalogIn_2AnalogIn_8cpp_html_a130f3ebe4c1bb6993e1094760227ad6a"><div class="ttname"><a href="examples_2AnalogIn_2AnalogIn_8cpp.html#a130f3ebe4c1bb6993e1094760227ad6a">chan</a></div><div class="ttdeci">AP_HAL::AnalogSource * chan</div><div class="ttdef"><b>Definition</b> <a href="examples_2AnalogIn_2AnalogIn_8cpp_source.html#l00025">AnalogIn.cpp:25</a></div></div>
<div class="ttc" id="aexamples_2location_2location_8cpp_html_a06f14a9abd47b91465f895d5259cdc1b"><div class="ttname"><a href="examples_2location_2location_8cpp.html#a06f14a9abd47b91465f895d5259cdc1b">distance</a></div><div class="ttdeci">float distance</div><div class="ttdef"><b>Definition</b> <a href="examples_2location_2location_8cpp_source.html#l00095">location.cpp:95</a></div></div>
<div class="ttc" id="amonocypher_8cpp_html_a3acffbd305ee72dcd4593c0d8af64a4f"><div class="ttname"><a href="monocypher_8cpp.html#a3acffbd305ee72dcd4593c0d8af64a4f">MIN</a></div><div class="ttdeci">#define MIN(a, b)</div><div class="ttdef"><b>Definition</b> <a href="monocypher_8cpp_source.html#l00071">monocypher.cpp:71</a></div></div>
<div class="ttc" id="amonocypher_8cpp_html_afa99ec4acc4ecb2dc3c2d05da15d0e3f"><div class="ttname"><a href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a></div><div class="ttdeci">#define MAX(a, b)</div><div class="ttdef"><b>Definition</b> <a href="monocypher_8cpp_source.html#l00072">monocypher.cpp:72</a></div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a52edeef7d5ffaa365e1229b87c170307"><div class="ttname"><a href="namespaceAP__HAL.html#a52edeef7d5ffaa365e1229b87c170307">AP_HAL::panic</a></div><div class="ttdeci">void panic(const char *errormsg,...) FMT_PRINTF(1</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2system_8cpp_source.html#l00327">system.cpp:327</a></div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a77dffbb18891996280308e21316ec186"><div class="ttname"><a href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a></div><div class="ttdeci">uint32_t millis()</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2system_8cpp_source.html#l00377">system.cpp:377</a></div></div>
<div class="ttc" id="anamespaceAP_html"><div class="ttname"><a href="namespaceAP.html">AP</a></div><div class="ttdef"><b>Definition</b> <a href="AC__Avoid_8cpp_source.html#l01481">AC_Avoid.cpp:1481</a></div></div>
<div class="ttc" id="anamespaceAP_html_a99432cfdb696952c9b7146f155a815aa"><div class="ttname"><a href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a></div><div class="ttdeci">AP_AHRS &amp; ahrs()</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8cpp_source.html#l03558">AP_AHRS.cpp:3558</a></div></div>
<div class="ttc" id="anamespaceAP_html_afcaac7657bb6b713f524d42ee5bb98b5"><div class="ttname"><a href="namespaceAP.html#afcaac7657bb6b713f524d42ee5bb98b5">AP::oadatabase</a></div><div class="ttdeci">AP_OADatabase * oadatabase()</div><div class="ttdef"><b>Definition</b> <a href="#l00479">AP_OADatabase.cpp:479</a></div></div>
<div class="ttc" id="astructAP__OADatabase_1_1OA__DbItem_html"><div class="ttname"><a href="structAP__OADatabase_1_1OA__DbItem.html">AP_OADatabase::OA_DbItem</a></div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00026">AP_OADatabase.h:26</a></div></div>
<div class="ttc" id="astructAP__OADatabase_1_1OA__DbItem_html_a245fa8e1c6d0995254574f1ad6fc2c37"><div class="ttname"><a href="structAP__OADatabase_1_1OA__DbItem.html#a245fa8e1c6d0995254574f1ad6fc2c37">AP_OADatabase::OA_DbItem::importance</a></div><div class="ttdeci">OA_DbItemImportance importance</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00031">AP_OADatabase.h:31</a></div></div>
<div class="ttc" id="astructAP__OADatabase_1_1OA__DbItem_html_a2c6aa42293e0cf46ff0c79a78e947b6c"><div class="ttname"><a href="structAP__OADatabase_1_1OA__DbItem.html#a2c6aa42293e0cf46ff0c79a78e947b6c">AP_OADatabase::OA_DbItem::radius</a></div><div class="ttdeci">float radius</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00029">AP_OADatabase.h:29</a></div></div>
<div class="ttc" id="astructAP__OADatabase_1_1OA__DbItem_html_a58dfd766c1654ee197557a464147a887"><div class="ttname"><a href="structAP__OADatabase_1_1OA__DbItem.html#a58dfd766c1654ee197557a464147a887">AP_OADatabase::OA_DbItem::timestamp_ms</a></div><div class="ttdeci">uint32_t timestamp_ms</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00028">AP_OADatabase.h:28</a></div></div>
<div class="ttc" id="astructAP__OADatabase_1_1OA__DbItem_html_a89aabe5c472e8a69184ddefec853f8b8"><div class="ttname"><a href="structAP__OADatabase_1_1OA__DbItem.html#a89aabe5c472e8a69184ddefec853f8b8">AP_OADatabase::OA_DbItem::send_to_gcs</a></div><div class="ttdeci">uint8_t send_to_gcs</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00030">AP_OADatabase.h:30</a></div></div>
<div class="ttc" id="astructAP__OADatabase_1_1OA__DbItem_html_a997544da3e55d486b5af5f4097371dd3"><div class="ttname"><a href="structAP__OADatabase_1_1OA__DbItem.html#a997544da3e55d486b5af5f4097371dd3">AP_OADatabase::OA_DbItem::pos</a></div><div class="ttdeci">Vector3f pos</div><div class="ttdef"><b>Definition</b> <a href="AP__OADatabase_8h_source.html#l00027">AP_OADatabase.h:27</a></div></div>
<div class="ttc" id="astructAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00199">AP_Param.h:199</a></div></div>
<div class="ttc" id="astructVector2_html_aed3cf4803ee803dc1447985ca323178f"><div class="ttname"><a href="structVector2.html#aed3cf4803ee803dc1447985ca323178f">Vector2::length</a></div><div class="ttdeci">T length(void) const</div><div class="ttdef"><b>Definition</b> <a href="vector2_8cpp_source.html#l00030">vector2.cpp:30</a></div></div>
<div class="ttc" id="avector3_8h_html_af345ad77ba5e240c7ab72b4b2077e754"><div class="ttname"><a href="vector3_8h.html#af345ad77ba5e240c7ab72b4b2077e754">Vector3f</a></div><div class="ttdeci">Vector3&lt; float &gt; Vector3f</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00412">vector3.h:412</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 22 2024 16:14:13 for APM:Libraries by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
