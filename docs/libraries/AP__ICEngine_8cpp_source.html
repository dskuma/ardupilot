<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>APM:Libraries: libraries/AP_ICEngine/AP_ICEngine.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">APM:Libraries
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_bc0718b08fb2015b8e59c47b2805f60c.html">libraries</a></li><li class="navelem"><a class="el" href="dir_eecdb3b7edc378c3b87f1df0443878bf.html">AP_ICEngine</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle"><div class="title">AP_ICEngine.cpp</div></div>
</div><!--header-->
<div class="contents">
<a href="AP__ICEngine_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a id="l00001" name="l00001"></a><span class="lineno">    1</span><span class="comment">/*</span></div>
<div class="line"><a id="l00002" name="l00002"></a><span class="lineno">    2</span><span class="comment">   This program is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a id="l00003" name="l00003"></a><span class="lineno">    3</span><span class="comment">   it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><a id="l00004" name="l00004"></a><span class="lineno">    4</span><span class="comment">   the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a id="l00005" name="l00005"></a><span class="lineno">    5</span><span class="comment">   (at your option) any later version.</span></div>
<div class="line"><a id="l00006" name="l00006"></a><span class="lineno">    6</span><span class="comment"></span> </div>
<div class="line"><a id="l00007" name="l00007"></a><span class="lineno">    7</span><span class="comment">   This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a id="l00008" name="l00008"></a><span class="lineno">    8</span><span class="comment">   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a id="l00009" name="l00009"></a><span class="lineno">    9</span><span class="comment">   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a id="l00010" name="l00010"></a><span class="lineno">   10</span><span class="comment">   GNU General Public License for more details.</span></div>
<div class="line"><a id="l00011" name="l00011"></a><span class="lineno">   11</span><span class="comment"></span> </div>
<div class="line"><a id="l00012" name="l00012"></a><span class="lineno">   12</span><span class="comment">   You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a id="l00013" name="l00013"></a><span class="lineno">   13</span><span class="comment">   along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a id="l00014" name="l00014"></a><span class="lineno">   14</span><span class="comment"> */</span></div>
<div class="line"><a id="l00015" name="l00015"></a><span class="lineno">   15</span> </div>
<div class="line"><a id="l00016" name="l00016"></a><span class="lineno">   16</span><span class="preprocessor">#include &quot;<a class="code" href="AP__ICEngine_8h.html">AP_ICEngine.h</a>&quot;</span></div>
<div class="line"><a id="l00017" name="l00017"></a><span class="lineno">   17</span> </div>
<div class="line"><a id="l00018" name="l00018"></a><span class="lineno">   18</span><span class="preprocessor">#if AP_ICENGINE_ENABLED</span></div>
<div class="line"><a id="l00019" name="l00019"></a><span class="lineno">   19</span> </div>
<div class="line"><a id="l00020" name="l00020"></a><span class="lineno">   20</span><span class="preprocessor">#include &lt;<a class="code" href="SRV__Channel_8h.html">SRV_Channel/SRV_Channel.h</a>&gt;</span></div>
<div class="line"><a id="l00021" name="l00021"></a><span class="lineno">   21</span><span class="preprocessor">#include &lt;<a class="code" href="GCS_8h.html">GCS_MAVLink/GCS.h</a>&gt;</span></div>
<div class="line"><a id="l00022" name="l00022"></a><span class="lineno">   22</span><span class="preprocessor">#include &lt;<a class="code" href="AP__AHRS_8h.html">AP_AHRS/AP_AHRS.h</a>&gt;</span></div>
<div class="line"><a id="l00023" name="l00023"></a><span class="lineno">   23</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Scheduler_8h.html">AP_Scheduler/AP_Scheduler.h</a>&gt;</span></div>
<div class="line"><a id="l00024" name="l00024"></a><span class="lineno">   24</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Notify_8h.html">AP_Notify/AP_Notify.h</a>&gt;</span></div>
<div class="line"><a id="l00025" name="l00025"></a><span class="lineno">   25</span><span class="preprocessor">#include &lt;<a class="code" href="RC__Channel_8h.html">RC_Channel/RC_Channel.h</a>&gt;</span></div>
<div class="line"><a id="l00026" name="l00026"></a><span class="lineno">   26</span><span class="preprocessor">#include &lt;<a class="code" href="AP__RPM_8h.html">AP_RPM/AP_RPM.h</a>&gt;</span></div>
<div class="line"><a id="l00027" name="l00027"></a><span class="lineno">   27</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Parachute_8h.html">AP_Parachute/AP_Parachute.h</a>&gt;</span></div>
<div class="line"><a id="l00028" name="l00028"></a><span class="lineno">   28</span><span class="preprocessor">#include &lt;<a class="code" href="AP__Relay_8h.html">AP_Relay/AP_Relay.h</a>&gt;</span></div>
<div class="line"><a id="l00029" name="l00029"></a><span class="lineno">   29</span><span class="preprocessor">#include &quot;<a class="code" href="AP__ICEngine_8h.html">AP_ICEngine.h</a>&quot;</span></div>
<div class="line"><a id="l00030" name="l00030"></a><span class="lineno">   30</span> </div>
<div class="line"><a id="l00031" name="l00031"></a><span class="lineno">   31</span><span class="keyword">extern</span> <span class="keyword">const</span> <a class="code hl_class" href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a>&amp; <a class="code hl_variable" href="AP__ICEngine_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a>;</div>
<div class="line"><a id="l00032" name="l00032"></a><span class="lineno">   32</span> </div>
<div class="line"><a id="l00033" name="l00033"></a><span class="lineno"><a class="line" href="AP__ICEngine_8cpp.html#a389bf79eb8712fc5dde7e2910d893e67">   33</a></span><span class="preprocessor">#define AP_ICENGINE_START_CHAN_DEBOUNCE_MS          300</span></div>
<div class="line"><a id="l00034" name="l00034"></a><span class="lineno">   34</span> </div>
<div class="line"><a id="l00035" name="l00035"></a><span class="lineno">   35</span><span class="keyword">const</span> <a class="code hl_struct" href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a> <a class="code hl_variable" href="classAP__ICEngine.html#a44fe9a8e0d8890b3c722e5dd83ec2aa9">AP_ICEngine::var_info</a>[] = {</div>
<div class="line"><a id="l00036" name="l00036"></a><span class="lineno">   36</span> </div>
<div class="line"><a id="l00037" name="l00037"></a><span class="lineno">   37</span>    <span class="comment">// @Param: ENABLE</span></div>
<div class="line"><a id="l00038" name="l00038"></a><span class="lineno">   38</span>    <span class="comment">// @DisplayName: Enable ICEngine control</span></div>
<div class="line"><a id="l00039" name="l00039"></a><span class="lineno">   39</span>    <span class="comment">// @Description: This enables internal combustion engine control</span></div>
<div class="line"><a id="l00040" name="l00040"></a><span class="lineno">   40</span>    <span class="comment">// @Values: 0:Disabled, 1:Enabled</span></div>
<div class="line"><a id="l00041" name="l00041"></a><span class="lineno">   41</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00042" name="l00042"></a><span class="lineno">   42</span>    <a class="code hl_define" href="AP__Param_8h.html#ac24e2eb16c2194e975d27e47ddcb7f1c">AP_GROUPINFO_FLAGS</a>(<span class="stringliteral">&quot;ENABLE&quot;</span>, 0, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, enable, 0, <a class="code hl_define" href="AP__Param_8h.html#ae25c1c7495435989f8be5781c86be078">AP_PARAM_FLAG_ENABLE</a>),</div>
<div class="line"><a id="l00043" name="l00043"></a><span class="lineno">   43</span> </div>
<div class="line"><a id="l00044" name="l00044"></a><span class="lineno">   44</span>    <span class="comment">// @Param: START_CHAN</span></div>
<div class="line"><a id="l00045" name="l00045"></a><span class="lineno">   45</span>    <span class="comment">// @DisplayName: Input channel for engine start</span></div>
<div class="line"><a id="l00046" name="l00046"></a><span class="lineno">   46</span>    <span class="comment">// @Description: This is an RC input channel for requesting engine start. Engine will try to start when channel is at or above 1700. Engine will stop when channel is at or below 1300. Between 1301 and 1699 the engine will not change state unless a MAVLink command or mission item commands a state change, or the vehicle is disarmed. See ICE_STARTCHN_MIN parameter to change engine stop PWM value and/or to enable debouncing of the START_CH to avoid accidental engine kills due to noise on channel.</span></div>
<div class="line"><a id="l00047" name="l00047"></a><span class="lineno">   47</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00048" name="l00048"></a><span class="lineno">   48</span>    <span class="comment">// @Values: 0:None,1:Chan1,2:Chan2,3:Chan3,4:Chan4,5:Chan5,6:Chan6,7:Chan7,8:Chan8,9:Chan9,10:Chan10,11:Chan11,12:Chan12,13:Chan13,14:Chan14,15:Chan15,16:Chan16</span></div>
<div class="line"><a id="l00049" name="l00049"></a><span class="lineno">   49</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;START_CHAN&quot;</span>, 1, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, start_chan, 0),</div>
<div class="line"><a id="l00050" name="l00050"></a><span class="lineno">   50</span> </div>
<div class="line"><a id="l00051" name="l00051"></a><span class="lineno">   51</span>    <span class="comment">// @Param: STARTER_TIME</span></div>
<div class="line"><a id="l00052" name="l00052"></a><span class="lineno">   52</span>    <span class="comment">// @DisplayName: Time to run starter</span></div>
<div class="line"><a id="l00053" name="l00053"></a><span class="lineno">   53</span>    <span class="comment">// @Description: This is the number of seconds to run the starter when trying to start the engine</span></div>
<div class="line"><a id="l00054" name="l00054"></a><span class="lineno">   54</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00055" name="l00055"></a><span class="lineno">   55</span>    <span class="comment">// @Units: s</span></div>
<div class="line"><a id="l00056" name="l00056"></a><span class="lineno">   56</span>    <span class="comment">// @Range: 0.1 5</span></div>
<div class="line"><a id="l00057" name="l00057"></a><span class="lineno">   57</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;STARTER_TIME&quot;</span>, 2, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, starter_time, 3),</div>
<div class="line"><a id="l00058" name="l00058"></a><span class="lineno">   58</span> </div>
<div class="line"><a id="l00059" name="l00059"></a><span class="lineno">   59</span>    <span class="comment">// @Param: START_DELAY</span></div>
<div class="line"><a id="l00060" name="l00060"></a><span class="lineno">   60</span>    <span class="comment">// @DisplayName: Time to wait between starts</span></div>
<div class="line"><a id="l00061" name="l00061"></a><span class="lineno">   61</span>    <span class="comment">// @Description: Delay between start attempts</span></div>
<div class="line"><a id="l00062" name="l00062"></a><span class="lineno">   62</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00063" name="l00063"></a><span class="lineno">   63</span>    <span class="comment">// @Units: s</span></div>
<div class="line"><a id="l00064" name="l00064"></a><span class="lineno">   64</span>    <span class="comment">// @Range: 1 10</span></div>
<div class="line"><a id="l00065" name="l00065"></a><span class="lineno">   65</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;START_DELAY&quot;</span>, 3, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, starter_delay, 2),</div>
<div class="line"><a id="l00066" name="l00066"></a><span class="lineno">   66</span> </div>
<div class="line"><a id="l00067" name="l00067"></a><span class="lineno">   67</span><span class="preprocessor">#if AP_RPM_ENABLED</span></div>
<div class="line"><a id="l00068" name="l00068"></a><span class="lineno">   68</span>    <span class="comment">// @Param: RPM_THRESH</span></div>
<div class="line"><a id="l00069" name="l00069"></a><span class="lineno">   69</span>    <span class="comment">// @DisplayName: RPM threshold</span></div>
<div class="line"><a id="l00070" name="l00070"></a><span class="lineno">   70</span>    <span class="comment">// @Description: This is the measured RPM above which the engine is considered to be running</span></div>
<div class="line"><a id="l00071" name="l00071"></a><span class="lineno">   71</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00072" name="l00072"></a><span class="lineno">   72</span>    <span class="comment">// @Range: 100 100000</span></div>
<div class="line"><a id="l00073" name="l00073"></a><span class="lineno">   73</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RPM_THRESH&quot;</span>, 4, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, rpm_threshold, 100),</div>
<div class="line"><a id="l00074" name="l00074"></a><span class="lineno">   74</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00075" name="l00075"></a><span class="lineno">   75</span> </div>
<div class="line"><a id="l00076" name="l00076"></a><span class="lineno">   76</span>    <span class="comment">// @Param: PWM_IGN_ON</span></div>
<div class="line"><a id="l00077" name="l00077"></a><span class="lineno">   77</span>    <span class="comment">// @DisplayName: PWM value for ignition on</span></div>
<div class="line"><a id="l00078" name="l00078"></a><span class="lineno">   78</span>    <span class="comment">// @Description: This is the value sent to the ignition channel when on</span></div>
<div class="line"><a id="l00079" name="l00079"></a><span class="lineno">   79</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00080" name="l00080"></a><span class="lineno">   80</span>    <span class="comment">// @Range: 1000 2000</span></div>
<div class="line"><a id="l00081" name="l00081"></a><span class="lineno">   81</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PWM_IGN_ON&quot;</span>, 5, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, pwm_ignition_on, 2000),</div>
<div class="line"><a id="l00082" name="l00082"></a><span class="lineno">   82</span> </div>
<div class="line"><a id="l00083" name="l00083"></a><span class="lineno">   83</span>    <span class="comment">// @Param: PWM_IGN_OFF</span></div>
<div class="line"><a id="l00084" name="l00084"></a><span class="lineno">   84</span>    <span class="comment">// @DisplayName: PWM value for ignition off</span></div>
<div class="line"><a id="l00085" name="l00085"></a><span class="lineno">   85</span>    <span class="comment">// @Description: This is the value sent to the ignition channel when off</span></div>
<div class="line"><a id="l00086" name="l00086"></a><span class="lineno">   86</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00087" name="l00087"></a><span class="lineno">   87</span>    <span class="comment">// @Range: 1000 2000</span></div>
<div class="line"><a id="l00088" name="l00088"></a><span class="lineno">   88</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PWM_IGN_OFF&quot;</span>, 6, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, pwm_ignition_off, 1000),</div>
<div class="line"><a id="l00089" name="l00089"></a><span class="lineno">   89</span> </div>
<div class="line"><a id="l00090" name="l00090"></a><span class="lineno">   90</span>    <span class="comment">// @Param: PWM_STRT_ON</span></div>
<div class="line"><a id="l00091" name="l00091"></a><span class="lineno">   91</span>    <span class="comment">// @DisplayName: PWM value for starter on</span></div>
<div class="line"><a id="l00092" name="l00092"></a><span class="lineno">   92</span>    <span class="comment">// @Description: This is the value sent to the starter channel when on</span></div>
<div class="line"><a id="l00093" name="l00093"></a><span class="lineno">   93</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00094" name="l00094"></a><span class="lineno">   94</span>    <span class="comment">// @Range: 1000 2000</span></div>
<div class="line"><a id="l00095" name="l00095"></a><span class="lineno">   95</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PWM_STRT_ON&quot;</span>, 7, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, pwm_starter_on, 2000),</div>
<div class="line"><a id="l00096" name="l00096"></a><span class="lineno">   96</span> </div>
<div class="line"><a id="l00097" name="l00097"></a><span class="lineno">   97</span>    <span class="comment">// @Param: PWM_STRT_OFF</span></div>
<div class="line"><a id="l00098" name="l00098"></a><span class="lineno">   98</span>    <span class="comment">// @DisplayName: PWM value for starter off</span></div>
<div class="line"><a id="l00099" name="l00099"></a><span class="lineno">   99</span>    <span class="comment">// @Description: This is the value sent to the starter channel when off</span></div>
<div class="line"><a id="l00100" name="l00100"></a><span class="lineno">  100</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00101" name="l00101"></a><span class="lineno">  101</span>    <span class="comment">// @Range: 1000 2000</span></div>
<div class="line"><a id="l00102" name="l00102"></a><span class="lineno">  102</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;PWM_STRT_OFF&quot;</span>, 8, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, pwm_starter_off, 1000),</div>
<div class="line"><a id="l00103" name="l00103"></a><span class="lineno">  103</span> </div>
<div class="line"><a id="l00104" name="l00104"></a><span class="lineno">  104</span><span class="preprocessor">#if AP_RPM_ENABLED</span></div>
<div class="line"><a id="l00105" name="l00105"></a><span class="lineno">  105</span>    <span class="comment">// @Param: RPM_CHAN</span></div>
<div class="line"><a id="l00106" name="l00106"></a><span class="lineno">  106</span>    <span class="comment">// @DisplayName: RPM instance channel to use</span></div>
<div class="line"><a id="l00107" name="l00107"></a><span class="lineno">  107</span>    <span class="comment">// @Description: This is which of the RPM instances to use for detecting the RPM of the engine</span></div>
<div class="line"><a id="l00108" name="l00108"></a><span class="lineno">  108</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00109" name="l00109"></a><span class="lineno">  109</span>    <span class="comment">// @Values: 0:None,1:RPM1,2:RPM2</span></div>
<div class="line"><a id="l00110" name="l00110"></a><span class="lineno">  110</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;RPM_CHAN&quot;</span>,  9, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, rpm_instance, 0),</div>
<div class="line"><a id="l00111" name="l00111"></a><span class="lineno">  111</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00112" name="l00112"></a><span class="lineno">  112</span> </div>
<div class="line"><a id="l00113" name="l00113"></a><span class="lineno">  113</span>    <span class="comment">// @Param: START_PCT</span></div>
<div class="line"><a id="l00114" name="l00114"></a><span class="lineno">  114</span>    <span class="comment">// @DisplayName: Throttle percentage for engine start</span></div>
<div class="line"><a id="l00115" name="l00115"></a><span class="lineno">  115</span>    <span class="comment">// @Description: This is the percentage throttle output for engine start</span></div>
<div class="line"><a id="l00116" name="l00116"></a><span class="lineno">  116</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00117" name="l00117"></a><span class="lineno">  117</span>    <span class="comment">// @Range: 0 100</span></div>
<div class="line"><a id="l00118" name="l00118"></a><span class="lineno">  118</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;START_PCT&quot;</span>, 10, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, start_percent, 5),</div>
<div class="line"><a id="l00119" name="l00119"></a><span class="lineno">  119</span> </div>
<div class="line"><a id="l00120" name="l00120"></a><span class="lineno">  120</span>    <span class="comment">// @Param: IDLE_PCT</span></div>
<div class="line"><a id="l00121" name="l00121"></a><span class="lineno">  121</span>    <span class="comment">// @DisplayName: Throttle percentage for engine idle</span></div>
<div class="line"><a id="l00122" name="l00122"></a><span class="lineno">  122</span>    <span class="comment">// @Description: This is the minimum percentage throttle output while running, this includes being disarmed, but not safe</span></div>
<div class="line"><a id="l00123" name="l00123"></a><span class="lineno">  123</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00124" name="l00124"></a><span class="lineno">  124</span>    <span class="comment">// @Range: 0 100</span></div>
<div class="line"><a id="l00125" name="l00125"></a><span class="lineno">  125</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;IDLE_PCT&quot;</span>, 11, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, idle_percent, 0),</div>
<div class="line"><a id="l00126" name="l00126"></a><span class="lineno">  126</span> </div>
<div class="line"><a id="l00127" name="l00127"></a><span class="lineno">  127</span><span class="preprocessor">#if AP_RPM_ENABLED</span></div>
<div class="line"><a id="l00128" name="l00128"></a><span class="lineno">  128</span>    <span class="comment">// @Param: IDLE_RPM</span></div>
<div class="line"><a id="l00129" name="l00129"></a><span class="lineno">  129</span>    <span class="comment">// @DisplayName: RPM Setpoint for Idle Governor</span></div>
<div class="line"><a id="l00130" name="l00130"></a><span class="lineno">  130</span>    <span class="comment">// @Description: This configures the RPM that will be commanded by the idle governor. Set to -1 to disable</span></div>
<div class="line"><a id="l00131" name="l00131"></a><span class="lineno">  131</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00132" name="l00132"></a><span class="lineno">  132</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;IDLE_RPM&quot;</span>, 12, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, idle_rpm, -1),</div>
<div class="line"><a id="l00133" name="l00133"></a><span class="lineno">  133</span> </div>
<div class="line"><a id="l00134" name="l00134"></a><span class="lineno">  134</span>    <span class="comment">// @Param: IDLE_DB</span></div>
<div class="line"><a id="l00135" name="l00135"></a><span class="lineno">  135</span>    <span class="comment">// @DisplayName: Deadband for Idle Governor</span></div>
<div class="line"><a id="l00136" name="l00136"></a><span class="lineno">  136</span>    <span class="comment">// @Description: This configures the deadband that is tolerated before adjusting the idle setpoint</span></div>
<div class="line"><a id="l00137" name="l00137"></a><span class="lineno">  137</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;IDLE_DB&quot;</span>, 13, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, idle_db, 50),</div>
<div class="line"><a id="l00138" name="l00138"></a><span class="lineno">  138</span> </div>
<div class="line"><a id="l00139" name="l00139"></a><span class="lineno">  139</span>    <span class="comment">// @Param: IDLE_SLEW</span></div>
<div class="line"><a id="l00140" name="l00140"></a><span class="lineno">  140</span>    <span class="comment">// @DisplayName: Slew Rate for idle control</span></div>
<div class="line"><a id="l00141" name="l00141"></a><span class="lineno">  141</span>    <span class="comment">// @Description: This configures the slewrate used to adjust the idle setpoint in percentage points per second</span></div>
<div class="line"><a id="l00142" name="l00142"></a><span class="lineno">  142</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;IDLE_SLEW&quot;</span>, 14, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, idle_slew, 1),</div>
<div class="line"><a id="l00143" name="l00143"></a><span class="lineno">  143</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00144" name="l00144"></a><span class="lineno">  144</span> </div>
<div class="line"><a id="l00145" name="l00145"></a><span class="lineno">  145</span>    <span class="comment">// @Param: OPTIONS</span></div>
<div class="line"><a id="l00146" name="l00146"></a><span class="lineno">  146</span>    <span class="comment">// @DisplayName: ICE options</span></div>
<div class="line"><a id="l00147" name="l00147"></a><span class="lineno">  147</span>    <span class="comment">// @Description: Options for ICE control. The Disable ignition in RC failsafe option will cause the ignition to be set off on any R/C failsafe. If Throttle while disarmed is set then throttle control will be allowed while disarmed for planes when in MANUAL mode. If disable while disarmed is set the engine will not start while the vehicle is disarmed unless overriden by the MAVLink DO_ENGINE_CONTROL command.</span></div>
<div class="line"><a id="l00148" name="l00148"></a><span class="lineno">  148</span>    <span class="comment">// @Bitmask: 0:Disable ignition in RC failsafe,1:Disable redline governor,2:Throttle while disarmed,3:Disable while disarmed</span></div>
<div class="line"><a id="l00149" name="l00149"></a><span class="lineno">  149</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;OPTIONS&quot;</span>, 15, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, options, 0),</div>
<div class="line"><a id="l00150" name="l00150"></a><span class="lineno">  150</span> </div>
<div class="line"><a id="l00151" name="l00151"></a><span class="lineno">  151</span>    <span class="comment">// @Param: STARTCHN_MIN</span></div>
<div class="line"><a id="l00152" name="l00152"></a><span class="lineno">  152</span>    <span class="comment">// @DisplayName: Input channel for engine start minimum PWM</span></div>
<div class="line"><a id="l00153" name="l00153"></a><span class="lineno">  153</span>    <span class="comment">// @Description: This is a minimum PWM value for engine start channel for an engine stop to be commanded. Setting this value will avoid RC input glitches with low PWM values from causing an unwanted engine stop. A value of zero means any PWM below 1300 triggers an engine stop.</span></div>
<div class="line"><a id="l00154" name="l00154"></a><span class="lineno">  154</span>    <span class="comment">// @User: Standard</span></div>
<div class="line"><a id="l00155" name="l00155"></a><span class="lineno">  155</span>    <span class="comment">// @Range: 0 1300</span></div>
<div class="line"><a id="l00156" name="l00156"></a><span class="lineno">  156</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;STARTCHN_MIN&quot;</span>, 16, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, start_chan_min_pwm, 0),</div>
<div class="line"><a id="l00157" name="l00157"></a><span class="lineno">  157</span> </div>
<div class="line"><a id="l00158" name="l00158"></a><span class="lineno">  158</span><span class="preprocessor">#if AP_RPM_ENABLED</span></div>
<div class="line"><a id="l00159" name="l00159"></a><span class="lineno">  159</span>    <span class="comment">// @Param: REDLINE_RPM</span></div>
<div class="line"><a id="l00160" name="l00160"></a><span class="lineno">  160</span>    <span class="comment">// @DisplayName: RPM of the redline limit for the engine</span></div>
<div class="line"><a id="l00161" name="l00161"></a><span class="lineno">  161</span>    <span class="comment">// @Description: Maximum RPM for the engine provided by the manufacturer. A value of 0 disables this feature. See ICE_OPTIONS to enable or disable the governor.</span></div>
<div class="line"><a id="l00162" name="l00162"></a><span class="lineno">  162</span>    <span class="comment">// @User: Advanced</span></div>
<div class="line"><a id="l00163" name="l00163"></a><span class="lineno">  163</span>    <span class="comment">// @Range: 0 2000000</span></div>
<div class="line"><a id="l00164" name="l00164"></a><span class="lineno">  164</span>    <span class="comment">// @Units: RPM</span></div>
<div class="line"><a id="l00165" name="l00165"></a><span class="lineno">  165</span>    <a class="code hl_define" href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a>(<span class="stringliteral">&quot;REDLINE_RPM&quot;</span>, 17, <a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a>, redline_rpm, 0),</div>
<div class="line"><a id="l00166" name="l00166"></a><span class="lineno">  166</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00167" name="l00167"></a><span class="lineno">  167</span> </div>
<div class="line"><a id="l00168" name="l00168"></a><span class="lineno">  168</span>    <span class="comment">// 18 was IGNITION_RLY</span></div>
<div class="line"><a id="l00169" name="l00169"></a><span class="lineno">  169</span> </div>
<div class="line"><a id="l00170" name="l00170"></a><span class="lineno">  170</span> </div>
<div class="line"><a id="l00171" name="l00171"></a><span class="lineno">  171</span>    <a class="code hl_define" href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div>
<div class="line"><a id="l00172" name="l00172"></a><span class="lineno">  172</span>};</div>
<div class="line"><a id="l00173" name="l00173"></a><span class="lineno">  173</span> </div>
<div class="line"><a id="l00174" name="l00174"></a><span class="lineno">  174</span><span class="comment">// constructor</span></div>
<div class="foldopen" id="foldopen00175" data-start="{" data-end="}">
<div class="line"><a id="l00175" name="l00175"></a><span class="lineno"><a class="line" href="classAP__ICEngine.html#a084fd3c2ce9d8dc26e4e82f7ffb10360">  175</a></span><a class="code hl_function" href="classAP__ICEngine.html#a084fd3c2ce9d8dc26e4e82f7ffb10360">AP_ICEngine::AP_ICEngine</a>()</div>
<div class="line"><a id="l00176" name="l00176"></a><span class="lineno">  176</span>{</div>
<div class="line"><a id="l00177" name="l00177"></a><span class="lineno">  177</span>    <a class="code hl_function" href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a>(<span class="keyword">this</span>, var_info);</div>
<div class="line"><a id="l00178" name="l00178"></a><span class="lineno">  178</span> </div>
<div class="line"><a id="l00179" name="l00179"></a><span class="lineno">  179</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#afbdeb8f287c78f52bcbf64d8452ab7b9">_singleton</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00180" name="l00180"></a><span class="lineno">  180</span>        <a class="code hl_function" href="namespaceAP__HAL.html#a52edeef7d5ffaa365e1229b87c170307">AP_HAL::panic</a>(<span class="stringliteral">&quot;AP_ICEngine must be singleton&quot;</span>);</div>
<div class="line"><a id="l00181" name="l00181"></a><span class="lineno">  181</span>    }</div>
<div class="line"><a id="l00182" name="l00182"></a><span class="lineno">  182</span>    <a class="code hl_variable" href="classAP__ICEngine.html#afbdeb8f287c78f52bcbf64d8452ab7b9">_singleton</a> = <span class="keyword">this</span>;</div>
<div class="line"><a id="l00183" name="l00183"></a><span class="lineno">  183</span> </div>
<div class="line"><a id="l00184" name="l00184"></a><span class="lineno">  184</span><span class="preprocessor">#if AP_RPM_ENABLED</span></div>
<div class="line"><a id="l00185" name="l00185"></a><span class="lineno">  185</span>    <span class="comment">// ICEngine runs at 10Hz</span></div>
<div class="line"><a id="l00186" name="l00186"></a><span class="lineno">  186</span>    _rpm_filter.set_cutoff_frequency(10, 0.5f);</div>
<div class="line"><a id="l00187" name="l00187"></a><span class="lineno">  187</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00188" name="l00188"></a><span class="lineno">  188</span>}</div>
</div>
<div class="line"><a id="l00189" name="l00189"></a><span class="lineno">  189</span> </div>
<div class="line"><a id="l00190" name="l00190"></a><span class="lineno">  190</span><span class="comment">/*</span></div>
<div class="line"><a id="l00191" name="l00191"></a><span class="lineno">  191</span><span class="comment">  update engine state</span></div>
<div class="line"><a id="l00192" name="l00192"></a><span class="lineno">  192</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00193" data-start="{" data-end="}">
<div class="line"><a id="l00193" name="l00193"></a><span class="lineno"><a class="line" href="classAP__ICEngine.html#a72c0687138bdfde2f905f00be039b710">  193</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__ICEngine.html#a72c0687138bdfde2f905f00be039b710">AP_ICEngine::update</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a id="l00194" name="l00194"></a><span class="lineno">  194</span>{</div>
<div class="line"><a id="l00195" name="l00195"></a><span class="lineno">  195</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__ICEngine.html#a3b636c3789b124d18c8ec6102a46e294">enable</a>) {</div>
<div class="line"><a id="l00196" name="l00196"></a><span class="lineno">  196</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00197" name="l00197"></a><span class="lineno">  197</span>    }</div>
<div class="line"><a id="l00198" name="l00198"></a><span class="lineno">  198</span> </div>
<div class="line"><a id="l00199" name="l00199"></a><span class="lineno">  199</span>    uint16_t cvalue = 1500;</div>
<div class="line"><a id="l00200" name="l00200"></a><span class="lineno">  200</span>    <a class="code hl_class" href="classRC__Channel.html">RC_Channel</a> *c = <a class="code hl_function" href="RC__Channel_8h.html#abe35aea6177a1cdf87a22af5c263bb89">rc</a>().<a class="code hl_function" href="classRC__Channels.html#a3736f2167041c3930941f66c73ec7d1d">channel</a>(<a class="code hl_variable" href="classAP__ICEngine.html#ab5fea2c005e803691ede6a31acaba2f8">start_chan</a>-1);</div>
<div class="line"><a id="l00201" name="l00201"></a><span class="lineno">  201</span>    <span class="keywordflow">if</span> (c != <span class="keyword">nullptr</span> &amp;&amp; <a class="code hl_function" href="RC__Channel_8h.html#abe35aea6177a1cdf87a22af5c263bb89">rc</a>().has_valid_input()) {</div>
<div class="line"><a id="l00202" name="l00202"></a><span class="lineno">  202</span>        <span class="comment">// get starter control channel</span></div>
<div class="line"><a id="l00203" name="l00203"></a><span class="lineno">  203</span>        cvalue = c-&gt;<a class="code hl_function" href="classRC__Channel.html#a35dd43d363695269b38277306426f883">get_radio_in</a>();</div>
<div class="line"><a id="l00204" name="l00204"></a><span class="lineno">  204</span> </div>
<div class="line"><a id="l00205" name="l00205"></a><span class="lineno">  205</span>        <span class="keywordflow">if</span> (cvalue &lt; <a class="code hl_variable" href="classAP__ICEngine.html#a6d2e9264114c4692c8f8cabfdfca8436">start_chan_min_pwm</a>) {</div>
<div class="line"><a id="l00206" name="l00206"></a><span class="lineno">  206</span>            cvalue = <a class="code hl_variable" href="classAP__ICEngine.html#aeffbc12c44d7aeaba2771acad3dca4c7">start_chan_last_value</a>;</div>
<div class="line"><a id="l00207" name="l00207"></a><span class="lineno">  207</span>        }</div>
<div class="line"><a id="l00208" name="l00208"></a><span class="lineno">  208</span> </div>
<div class="line"><a id="l00209" name="l00209"></a><span class="lineno">  209</span>        <span class="comment">// snap the input to either 1000, 1500, or 2000</span></div>
<div class="line"><a id="l00210" name="l00210"></a><span class="lineno">  210</span>        <span class="comment">// this is useful to compare a debounce changed value</span></div>
<div class="line"><a id="l00211" name="l00211"></a><span class="lineno">  211</span>        <span class="comment">// while ignoring tiny noise</span></div>
<div class="line"><a id="l00212" name="l00212"></a><span class="lineno">  212</span>        <span class="keywordflow">if</span> (cvalue &gt;= <a class="code hl_variable" href="classRC__Channel.html#a491839aced6cfd88ce008423bcaed6a1">RC_Channel::AUX_PWM_TRIGGER_HIGH</a>) {</div>
<div class="line"><a id="l00213" name="l00213"></a><span class="lineno">  213</span>            cvalue = 2000;</div>
<div class="line"><a id="l00214" name="l00214"></a><span class="lineno">  214</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((cvalue &gt; 800) &amp;&amp; (cvalue &lt;= <a class="code hl_variable" href="classRC__Channel.html#a7e23801a755b980004432cb0ec52cbf5">RC_Channel::AUX_PWM_TRIGGER_LOW</a>)) {</div>
<div class="line"><a id="l00215" name="l00215"></a><span class="lineno">  215</span>            cvalue = 1300;</div>
<div class="line"><a id="l00216" name="l00216"></a><span class="lineno">  216</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00217" name="l00217"></a><span class="lineno">  217</span>            cvalue = 1500;</div>
<div class="line"><a id="l00218" name="l00218"></a><span class="lineno">  218</span>        }</div>
<div class="line"><a id="l00219" name="l00219"></a><span class="lineno">  219</span>    }</div>
<div class="line"><a id="l00220" name="l00220"></a><span class="lineno">  220</span> </div>
<div class="line"><a id="l00221" name="l00221"></a><span class="lineno">  221</span>    <span class="keywordtype">bool</span> should_run = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00222" name="l00222"></a><span class="lineno">  222</span>    uint32_t now = <a class="code hl_function" href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a>();</div>
<div class="line"><a id="l00223" name="l00223"></a><span class="lineno">  223</span> </div>
<div class="line"><a id="l00224" name="l00224"></a><span class="lineno">  224</span> </div>
<div class="line"><a id="l00225" name="l00225"></a><span class="lineno">  225</span>    <span class="comment">// debounce timer to protect from spurious changes on start_chan rc input</span></div>
<div class="line"><a id="l00226" name="l00226"></a><span class="lineno">  226</span>    <span class="comment">// If the cached value is the same, reset timer</span></div>
<div class="line"><a id="l00227" name="l00227"></a><span class="lineno">  227</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#aeffbc12c44d7aeaba2771acad3dca4c7">start_chan_last_value</a> == cvalue) {</div>
<div class="line"><a id="l00228" name="l00228"></a><span class="lineno">  228</span>        <a class="code hl_variable" href="classAP__ICEngine.html#a671dbf712bccea7ce99e7953ab53d840">start_chan_last_ms</a> = now;</div>
<div class="line"><a id="l00229" name="l00229"></a><span class="lineno">  229</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (now - <a class="code hl_variable" href="classAP__ICEngine.html#a671dbf712bccea7ce99e7953ab53d840">start_chan_last_ms</a> &gt;= <a class="code hl_define" href="AP__ICEngine_8cpp.html#a389bf79eb8712fc5dde7e2910d893e67">AP_ICENGINE_START_CHAN_DEBOUNCE_MS</a>) {</div>
<div class="line"><a id="l00230" name="l00230"></a><span class="lineno">  230</span>        <span class="comment">// if it has changed, and stayed changed for the duration, then use that new value</span></div>
<div class="line"><a id="l00231" name="l00231"></a><span class="lineno">  231</span>        <a class="code hl_variable" href="classAP__ICEngine.html#aeffbc12c44d7aeaba2771acad3dca4c7">start_chan_last_value</a> = cvalue;</div>
<div class="line"><a id="l00232" name="l00232"></a><span class="lineno">  232</span>    }</div>
<div class="line"><a id="l00233" name="l00233"></a><span class="lineno">  233</span> </div>
<div class="line"><a id="l00234" name="l00234"></a><span class="lineno">  234</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> == <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eadc052604e13414f786fd43c37c622c92">ICE_START_HEIGHT_DELAY</a> &amp;&amp; <a class="code hl_variable" href="classAP__ICEngine.html#aeffbc12c44d7aeaba2771acad3dca4c7">start_chan_last_value</a> &gt;= <a class="code hl_variable" href="classRC__Channel.html#a491839aced6cfd88ce008423bcaed6a1">RC_Channel::AUX_PWM_TRIGGER_HIGH</a>) {</div>
<div class="line"><a id="l00235" name="l00235"></a><span class="lineno">  235</span>        <span class="comment">// user is overriding the height start delay and asking for</span></div>
<div class="line"><a id="l00236" name="l00236"></a><span class="lineno">  236</span>        <span class="comment">// immediate start. Put into ICE_OFF so that the logic below</span></div>
<div class="line"><a id="l00237" name="l00237"></a><span class="lineno">  237</span>        <span class="comment">// can start the engine now</span></div>
<div class="line"><a id="l00238" name="l00238"></a><span class="lineno">  238</span>        <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> = <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea0689148093af2b40bd95ddb6cd4569a1">ICE_OFF</a>;</div>
<div class="line"><a id="l00239" name="l00239"></a><span class="lineno">  239</span>    }</div>
<div class="line"><a id="l00240" name="l00240"></a><span class="lineno">  240</span> </div>
<div class="line"><a id="l00241" name="l00241"></a><span class="lineno">  241</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> == <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea0689148093af2b40bd95ddb6cd4569a1">ICE_OFF</a> &amp;&amp; <a class="code hl_variable" href="classAP__ICEngine.html#aeffbc12c44d7aeaba2771acad3dca4c7">start_chan_last_value</a> &gt;= <a class="code hl_variable" href="classRC__Channel.html#a491839aced6cfd88ce008423bcaed6a1">RC_Channel::AUX_PWM_TRIGGER_HIGH</a>) {</div>
<div class="line"><a id="l00242" name="l00242"></a><span class="lineno">  242</span>        should_run = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00243" name="l00243"></a><span class="lineno">  243</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#aeffbc12c44d7aeaba2771acad3dca4c7">start_chan_last_value</a> &lt;= <a class="code hl_variable" href="classRC__Channel.html#a7e23801a755b980004432cb0ec52cbf5">RC_Channel::AUX_PWM_TRIGGER_LOW</a>) {</div>
<div class="line"><a id="l00244" name="l00244"></a><span class="lineno">  244</span>        should_run = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00245" name="l00245"></a><span class="lineno">  245</span> </div>
<div class="line"><a id="l00246" name="l00246"></a><span class="lineno">  246</span>        <span class="comment">// clear the single start flag now that we will be stopping the engine</span></div>
<div class="line"><a id="l00247" name="l00247"></a><span class="lineno">  247</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> != <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea0689148093af2b40bd95ddb6cd4569a1">ICE_OFF</a>) {</div>
<div class="line"><a id="l00248" name="l00248"></a><span class="lineno">  248</span>            <a class="code hl_variable" href="classAP__ICEngine.html#a6f21623150cbe96407a8e4cc1c4a18dd">allow_single_start_while_disarmed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00249" name="l00249"></a><span class="lineno">  249</span>        }</div>
<div class="line"><a id="l00250" name="l00250"></a><span class="lineno">  250</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> != <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea0689148093af2b40bd95ddb6cd4569a1">ICE_OFF</a>) {</div>
<div class="line"><a id="l00251" name="l00251"></a><span class="lineno">  251</span>        should_run = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00252" name="l00252"></a><span class="lineno">  252</span>    }</div>
<div class="line"><a id="l00253" name="l00253"></a><span class="lineno">  253</span> </div>
<div class="line"><a id="l00254" name="l00254"></a><span class="lineno">  254</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__ICEngine.html#a22aece84cd178d4ca5a491f5152a0d0b">option_set</a>(<a class="code hl_enumvalue" href="classAP__ICEngine.html#ae20e42c747959eda704325166aeb8028ad2ec7c3afbe24bae2980c5a0332317e6">Options::DISABLE_IGNITION_RC_FAILSAFE</a>) &amp;&amp; <a class="code hl_variable" href="classAP__Notify.html#a724dd074a094de26e17c72c38ac499e9">AP_Notify::flags</a>.failsafe_radio) {</div>
<div class="line"><a id="l00255" name="l00255"></a><span class="lineno">  255</span>        <span class="comment">// user has requested ignition kill on RC failsafe</span></div>
<div class="line"><a id="l00256" name="l00256"></a><span class="lineno">  256</span>        should_run = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00257" name="l00257"></a><span class="lineno">  257</span>    }</div>
<div class="line"><a id="l00258" name="l00258"></a><span class="lineno">  258</span> </div>
<div class="line"><a id="l00259" name="l00259"></a><span class="lineno">  259</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__ICEngine.html#a22aece84cd178d4ca5a491f5152a0d0b">option_set</a>(<a class="code hl_enumvalue" href="classAP__ICEngine.html#ae20e42c747959eda704325166aeb8028a22e6fd142851c2bd2b308e91239c683b">Options::NO_RUNNING_WHILE_DISARMED</a>)) {</div>
<div class="line"><a id="l00260" name="l00260"></a><span class="lineno">  260</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">get_soft_armed</a>()) {</div>
<div class="line"><a id="l00261" name="l00261"></a><span class="lineno">  261</span>            <span class="comment">// clear the disarmed start flag, as we are now armed, if we disarm again we expect the engine to stop</span></div>
<div class="line"><a id="l00262" name="l00262"></a><span class="lineno">  262</span>            <a class="code hl_variable" href="classAP__ICEngine.html#a6f21623150cbe96407a8e4cc1c4a18dd">allow_single_start_while_disarmed</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00263" name="l00263"></a><span class="lineno">  263</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00264" name="l00264"></a><span class="lineno">  264</span>            <span class="comment">// check if we are blocking disarmed starts</span></div>
<div class="line"><a id="l00265" name="l00265"></a><span class="lineno">  265</span>            <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__ICEngine.html#a6f21623150cbe96407a8e4cc1c4a18dd">allow_single_start_while_disarmed</a>) {</div>
<div class="line"><a id="l00266" name="l00266"></a><span class="lineno">  266</span>                should_run = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00267" name="l00267"></a><span class="lineno">  267</span>            }</div>
<div class="line"><a id="l00268" name="l00268"></a><span class="lineno">  268</span>        }</div>
<div class="line"><a id="l00269" name="l00269"></a><span class="lineno">  269</span>    }</div>
<div class="line"><a id="l00270" name="l00270"></a><span class="lineno">  270</span> </div>
<div class="line"><a id="l00271" name="l00271"></a><span class="lineno">  271</span><span class="preprocessor">#if HAL_PARACHUTE_ENABLED</span></div>
<div class="line"><a id="l00272" name="l00272"></a><span class="lineno">  272</span>    <span class="comment">// Stop on parachute deployment</span></div>
<div class="line"><a id="l00273" name="l00273"></a><span class="lineno">  273</span>    <a class="code hl_class" href="classAP__Parachute.html">AP_Parachute</a> *parachute = <a class="code hl_function" href="namespaceAP.html#ab75e299618fd1bc72888405984b61a50">AP::parachute</a>();</div>
<div class="line"><a id="l00274" name="l00274"></a><span class="lineno">  274</span>    <span class="keywordflow">if</span> ((parachute != <span class="keyword">nullptr</span>) &amp;&amp; parachute-&gt;<a class="code hl_function" href="classAP__Parachute.html#a9edc1cc4c168a1a13424d4611bd1a47c">release_initiated</a>()) {</div>
<div class="line"><a id="l00275" name="l00275"></a><span class="lineno">  275</span>        should_run = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00276" name="l00276"></a><span class="lineno">  276</span>    }</div>
<div class="line"><a id="l00277" name="l00277"></a><span class="lineno">  277</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00278" name="l00278"></a><span class="lineno">  278</span> </div>
<div class="line"><a id="l00279" name="l00279"></a><span class="lineno">  279</span>    <span class="comment">// switch on current state to work out new state</span></div>
<div class="line"><a id="l00280" name="l00280"></a><span class="lineno">  280</span>    <span class="keywordflow">switch</span> (<a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a>) {</div>
<div class="line"><a id="l00281" name="l00281"></a><span class="lineno">  281</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eab1f2bb6a0afb2c29a97021eade74bad5">ICE_DISABLED</a>:</div>
<div class="line"><a id="l00282" name="l00282"></a><span class="lineno">  282</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00283" name="l00283"></a><span class="lineno">  283</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea0689148093af2b40bd95ddb6cd4569a1">ICE_OFF</a>:</div>
<div class="line"><a id="l00284" name="l00284"></a><span class="lineno">  284</span>        <span class="keywordflow">if</span> (should_run) {</div>
<div class="line"><a id="l00285" name="l00285"></a><span class="lineno">  285</span>            <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> = <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea6c6f711f18a620ba39d0215d396d1c59">ICE_START_DELAY</a>;</div>
<div class="line"><a id="l00286" name="l00286"></a><span class="lineno">  286</span>        }</div>
<div class="line"><a id="l00287" name="l00287"></a><span class="lineno">  287</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00288" name="l00288"></a><span class="lineno">  288</span> </div>
<div class="line"><a id="l00289" name="l00289"></a><span class="lineno">  289</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eadc052604e13414f786fd43c37c622c92">ICE_START_HEIGHT_DELAY</a>: {</div>
<div class="line"><a id="l00290" name="l00290"></a><span class="lineno">  290</span>        <a class="code hl_class" href="classVector3.html">Vector3f</a> pos;</div>
<div class="line"><a id="l00291" name="l00291"></a><span class="lineno">  291</span>        <span class="keywordflow">if</span> (!should_run) {</div>
<div class="line"><a id="l00292" name="l00292"></a><span class="lineno">  292</span>            <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> = <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea0689148093af2b40bd95ddb6cd4569a1">ICE_OFF</a>;</div>
<div class="line"><a id="l00293" name="l00293"></a><span class="lineno">  293</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a>().get_relative_position_NED_origin(pos)) {</div>
<div class="line"><a id="l00294" name="l00294"></a><span class="lineno">  294</span>            <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#a416eeeb7e22a4b3b7c927cf7409d4a43">height_pending</a>) {</div>
<div class="line"><a id="l00295" name="l00295"></a><span class="lineno">  295</span>                <a class="code hl_variable" href="classAP__ICEngine.html#a416eeeb7e22a4b3b7c927cf7409d4a43">height_pending</a> = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00296" name="l00296"></a><span class="lineno">  296</span>                <a class="code hl_variable" href="classAP__ICEngine.html#a0f40d24501ea23ca9d860351f084ca17">initial_height</a> = -pos.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a id="l00297" name="l00297"></a><span class="lineno">  297</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((-pos.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>) &gt;= <a class="code hl_variable" href="classAP__ICEngine.html#a0f40d24501ea23ca9d860351f084ca17">initial_height</a> + <a class="code hl_variable" href="classAP__ICEngine.html#a5ccd39797b09456f6b6257541483cdd0">height_required</a>) {</div>
<div class="line"><a id="l00298" name="l00298"></a><span class="lineno">  298</span>                <a class="code hl_define" href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;Starting height reached %.1f&quot;</span>,</div>
<div class="line"><a id="l00299" name="l00299"></a><span class="lineno">  299</span>                                                 (<span class="keywordtype">double</span>)(-pos.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a> - <a class="code hl_variable" href="classAP__ICEngine.html#a0f40d24501ea23ca9d860351f084ca17">initial_height</a>));</div>
<div class="line"><a id="l00300" name="l00300"></a><span class="lineno">  300</span>                <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> = <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea73eead72ca890d2fe2ae8065d57c5b47">ICE_STARTING</a>;</div>
<div class="line"><a id="l00301" name="l00301"></a><span class="lineno">  301</span>            }</div>
<div class="line"><a id="l00302" name="l00302"></a><span class="lineno">  302</span>        }</div>
<div class="line"><a id="l00303" name="l00303"></a><span class="lineno">  303</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00304" name="l00304"></a><span class="lineno">  304</span>    }</div>
<div class="line"><a id="l00305" name="l00305"></a><span class="lineno">  305</span> </div>
<div class="line"><a id="l00306" name="l00306"></a><span class="lineno">  306</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea6c6f711f18a620ba39d0215d396d1c59">ICE_START_DELAY</a>:</div>
<div class="line"><a id="l00307" name="l00307"></a><span class="lineno">  307</span>        <span class="keywordflow">if</span> (!should_run) {</div>
<div class="line"><a id="l00308" name="l00308"></a><span class="lineno">  308</span>            <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> = <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea0689148093af2b40bd95ddb6cd4569a1">ICE_OFF</a>;</div>
<div class="line"><a id="l00309" name="l00309"></a><span class="lineno">  309</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (now - <a class="code hl_variable" href="classAP__ICEngine.html#ae68f765382e16bf7f797f756bd8ab71b">starter_last_run_ms</a> &gt;= <a class="code hl_variable" href="classAP__ICEngine.html#a346918729b138929cb938df5173e34a1">starter_delay</a>*1000) {</div>
<div class="line"><a id="l00310" name="l00310"></a><span class="lineno">  310</span>            <a class="code hl_define" href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;Starting engine&quot;</span>);</div>
<div class="line"><a id="l00311" name="l00311"></a><span class="lineno">  311</span>            <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> = <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea73eead72ca890d2fe2ae8065d57c5b47">ICE_STARTING</a>;</div>
<div class="line"><a id="l00312" name="l00312"></a><span class="lineno">  312</span>        }</div>
<div class="line"><a id="l00313" name="l00313"></a><span class="lineno">  313</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00314" name="l00314"></a><span class="lineno">  314</span> </div>
<div class="line"><a id="l00315" name="l00315"></a><span class="lineno">  315</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea73eead72ca890d2fe2ae8065d57c5b47">ICE_STARTING</a>:</div>
<div class="line"><a id="l00316" name="l00316"></a><span class="lineno">  316</span>        <span class="keywordflow">if</span> (!should_run) {</div>
<div class="line"><a id="l00317" name="l00317"></a><span class="lineno">  317</span>            <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> = <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea0689148093af2b40bd95ddb6cd4569a1">ICE_OFF</a>;</div>
<div class="line"><a id="l00318" name="l00318"></a><span class="lineno">  318</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (now - <a class="code hl_variable" href="classAP__ICEngine.html#ae82f2816e4edc65615219d25c0322dcb">starter_start_time_ms</a> &gt;= <a class="code hl_variable" href="classAP__ICEngine.html#a4cbc352541d1ca74ae9047714e77cf54">starter_time</a>*1000) {</div>
<div class="line"><a id="l00319" name="l00319"></a><span class="lineno">  319</span>            <a class="code hl_define" href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;Engine running&quot;</span>);</div>
<div class="line"><a id="l00320" name="l00320"></a><span class="lineno">  320</span>            <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> = <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eab7a045bcfc9d7088d41ac1c8468ceb77">ICE_RUNNING</a>;</div>
<div class="line"><a id="l00321" name="l00321"></a><span class="lineno">  321</span>        }</div>
<div class="line"><a id="l00322" name="l00322"></a><span class="lineno">  322</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00323" name="l00323"></a><span class="lineno">  323</span> </div>
<div class="line"><a id="l00324" name="l00324"></a><span class="lineno">  324</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eab7a045bcfc9d7088d41ac1c8468ceb77">ICE_RUNNING</a>:</div>
<div class="line"><a id="l00325" name="l00325"></a><span class="lineno">  325</span>        <span class="keywordflow">if</span> (!should_run) {</div>
<div class="line"><a id="l00326" name="l00326"></a><span class="lineno">  326</span>            <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> = <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea0689148093af2b40bd95ddb6cd4569a1">ICE_OFF</a>;</div>
<div class="line"><a id="l00327" name="l00327"></a><span class="lineno">  327</span>            <a class="code hl_define" href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;Stopped engine&quot;</span>);</div>
<div class="line"><a id="l00328" name="l00328"></a><span class="lineno">  328</span>        }</div>
<div class="line"><a id="l00329" name="l00329"></a><span class="lineno">  329</span><span class="preprocessor">#if AP_RPM_ENABLED</span></div>
<div class="line"><a id="l00330" name="l00330"></a><span class="lineno">  330</span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rpm_instance &gt; 0) {</div>
<div class="line"><a id="l00331" name="l00331"></a><span class="lineno">  331</span>            <span class="comment">// check RPM to see if still running</span></div>
<div class="line"><a id="l00332" name="l00332"></a><span class="lineno">  332</span>            <span class="keywordtype">float</span> rpm_value;</div>
<div class="line"><a id="l00333" name="l00333"></a><span class="lineno">  333</span>            <span class="keywordflow">if</span> (!<a class="code hl_function" href="namespaceAP.html#ad5986df034b9156395fea23c11cb2210">AP::rpm</a>()-&gt;get_rpm(rpm_instance-1, rpm_value) ||</div>
<div class="line"><a id="l00334" name="l00334"></a><span class="lineno">  334</span>                rpm_value &lt; rpm_threshold) {</div>
<div class="line"><a id="l00335" name="l00335"></a><span class="lineno">  335</span>                <span class="comment">// engine has stopped when it should be running</span></div>
<div class="line"><a id="l00336" name="l00336"></a><span class="lineno">  336</span>                <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> = <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea6c6f711f18a620ba39d0215d396d1c59">ICE_START_DELAY</a>;</div>
<div class="line"><a id="l00337" name="l00337"></a><span class="lineno">  337</span>                <a class="code hl_define" href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;Uncommanded engine stop&quot;</span>);</div>
<div class="line"><a id="l00338" name="l00338"></a><span class="lineno">  338</span>            }</div>
<div class="line"><a id="l00339" name="l00339"></a><span class="lineno">  339</span>        }</div>
<div class="line"><a id="l00340" name="l00340"></a><span class="lineno">  340</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00341" name="l00341"></a><span class="lineno">  341</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00342" name="l00342"></a><span class="lineno">  342</span>    }</div>
<div class="line"><a id="l00343" name="l00343"></a><span class="lineno">  343</span> </div>
<div class="line"><a id="l00344" name="l00344"></a><span class="lineno">  344</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">get_soft_armed</a>()) {</div>
<div class="line"><a id="l00345" name="l00345"></a><span class="lineno">  345</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> == <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eadc052604e13414f786fd43c37c622c92">ICE_START_HEIGHT_DELAY</a>) {</div>
<div class="line"><a id="l00346" name="l00346"></a><span class="lineno">  346</span>            <span class="comment">// when disarmed we can be waiting for takeoff</span></div>
<div class="line"><a id="l00347" name="l00347"></a><span class="lineno">  347</span>            <a class="code hl_class" href="classVector3.html">Vector3f</a> pos;</div>
<div class="line"><a id="l00348" name="l00348"></a><span class="lineno">  348</span>            <span class="keywordflow">if</span> (<a class="code hl_function" href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a>().get_relative_position_NED_origin(pos)) {</div>
<div class="line"><a id="l00349" name="l00349"></a><span class="lineno">  349</span>                <span class="comment">// reset initial height while disarmed</span></div>
<div class="line"><a id="l00350" name="l00350"></a><span class="lineno">  350</span>                <a class="code hl_variable" href="classAP__ICEngine.html#a0f40d24501ea23ca9d860351f084ca17">initial_height</a> = -pos.<a class="code hl_variable" href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">z</a>;</div>
<div class="line"><a id="l00351" name="l00351"></a><span class="lineno">  351</span>            }</div>
<div class="line"><a id="l00352" name="l00352"></a><span class="lineno">  352</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#af95518b4249c271f3c8a6c8ba04f531c">idle_percent</a> &lt;= 0 &amp;&amp; !<a class="code hl_function" href="classAP__ICEngine.html#a22aece84cd178d4ca5a491f5152a0d0b">option_set</a>(<a class="code hl_enumvalue" href="classAP__ICEngine.html#ae20e42c747959eda704325166aeb8028a253d26cc6bc4fad62ef20d1ee9d926c1">Options::THROTTLE_WHILE_DISARMED</a>)) {</div>
<div class="line"><a id="l00353" name="l00353"></a><span class="lineno">  353</span>            <span class="comment">// force ignition off when disarmed</span></div>
<div class="line"><a id="l00354" name="l00354"></a><span class="lineno">  354</span>            <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> = <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea0689148093af2b40bd95ddb6cd4569a1">ICE_OFF</a>;</div>
<div class="line"><a id="l00355" name="l00355"></a><span class="lineno">  355</span>        }</div>
<div class="line"><a id="l00356" name="l00356"></a><span class="lineno">  356</span>    }</div>
<div class="line"><a id="l00357" name="l00357"></a><span class="lineno">  357</span> </div>
<div class="line"><a id="l00358" name="l00358"></a><span class="lineno">  358</span><span class="preprocessor">#if AP_RPM_ENABLED</span></div>
<div class="line"><a id="l00359" name="l00359"></a><span class="lineno">  359</span>    <span class="comment">// check against redline RPM</span></div>
<div class="line"><a id="l00360" name="l00360"></a><span class="lineno">  360</span>    <span class="keywordtype">float</span> rpm_value;</div>
<div class="line"><a id="l00361" name="l00361"></a><span class="lineno">  361</span>    <span class="keywordflow">if</span> (rpm_instance &gt; 0 &amp;&amp; redline_rpm &gt; 0 &amp;&amp; <a class="code hl_function" href="namespaceAP.html#ad5986df034b9156395fea23c11cb2210">AP::rpm</a>()-&gt;get_rpm(rpm_instance-1, rpm_value)) {</div>
<div class="line"><a id="l00362" name="l00362"></a><span class="lineno">  362</span>        <span class="comment">// update the filtered RPM value</span></div>
<div class="line"><a id="l00363" name="l00363"></a><span class="lineno">  363</span>        filtered_rpm_value =  _rpm_filter.apply(rpm_value);</div>
<div class="line"><a id="l00364" name="l00364"></a><span class="lineno">  364</span>        <span class="keywordflow">if</span> (!redline.flag &amp;&amp; filtered_rpm_value &gt; redline_rpm) {</div>
<div class="line"><a id="l00365" name="l00365"></a><span class="lineno">  365</span>            <span class="comment">// redline governor is off. rpm is too high. enable the governor</span></div>
<div class="line"><a id="l00366" name="l00366"></a><span class="lineno">  366</span>            <a class="code hl_define" href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;Engine: Above redline RPM&quot;</span>);</div>
<div class="line"><a id="l00367" name="l00367"></a><span class="lineno">  367</span>            redline.flag = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00368" name="l00368"></a><span class="lineno">  368</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (redline.flag &amp;&amp; filtered_rpm_value &lt; redline_rpm * 0.9f) {</div>
<div class="line"><a id="l00369" name="l00369"></a><span class="lineno">  369</span>            <span class="comment">// redline governor is on. rpm is safely below. disable the governor</span></div>
<div class="line"><a id="l00370" name="l00370"></a><span class="lineno">  370</span>            redline.flag = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00371" name="l00371"></a><span class="lineno">  371</span>            <span class="comment">// reset redline governor</span></div>
<div class="line"><a id="l00372" name="l00372"></a><span class="lineno">  372</span>            redline.throttle_percentage = 0.0f;</div>
<div class="line"><a id="l00373" name="l00373"></a><span class="lineno">  373</span>            redline.governor_integrator = 0.0f;</div>
<div class="line"><a id="l00374" name="l00374"></a><span class="lineno">  374</span>        }</div>
<div class="line"><a id="l00375" name="l00375"></a><span class="lineno">  375</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00376" name="l00376"></a><span class="lineno">  376</span>        redline.flag = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00377" name="l00377"></a><span class="lineno">  377</span>    }</div>
<div class="line"><a id="l00378" name="l00378"></a><span class="lineno">  378</span><span class="preprocessor">#endif </span><span class="comment">// AP_RPM_ENABLED</span></div>
<div class="line"><a id="l00379" name="l00379"></a><span class="lineno">  379</span> </div>
<div class="line"><a id="l00380" name="l00380"></a><span class="lineno">  380</span>    <span class="comment">/* now set output channels */</span></div>
<div class="line"><a id="l00381" name="l00381"></a><span class="lineno">  381</span>    <span class="keywordflow">switch</span> (<a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a>) {</div>
<div class="line"><a id="l00382" name="l00382"></a><span class="lineno">  382</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eab1f2bb6a0afb2c29a97021eade74bad5">ICE_DISABLED</a>:</div>
<div class="line"><a id="l00383" name="l00383"></a><span class="lineno">  383</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00384" name="l00384"></a><span class="lineno">  384</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea0689148093af2b40bd95ddb6cd4569a1">ICE_OFF</a>:</div>
<div class="line"><a id="l00385" name="l00385"></a><span class="lineno">  385</span>        <a class="code hl_function" href="classAP__ICEngine.html#ab632fddb2ed066ba969a58f6f7c0c2fb">set_ignition</a>(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00386" name="l00386"></a><span class="lineno">  386</span>        <a class="code hl_function" href="classAP__ICEngine.html#ace82d76b8d7223ac7402d038e494f8f2">set_starter</a>(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00387" name="l00387"></a><span class="lineno">  387</span>        <a class="code hl_variable" href="classAP__ICEngine.html#ae82f2816e4edc65615219d25c0322dcb">starter_start_time_ms</a> = 0;</div>
<div class="line"><a id="l00388" name="l00388"></a><span class="lineno">  388</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00389" name="l00389"></a><span class="lineno">  389</span> </div>
<div class="line"><a id="l00390" name="l00390"></a><span class="lineno">  390</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eadc052604e13414f786fd43c37c622c92">ICE_START_HEIGHT_DELAY</a>:</div>
<div class="line"><a id="l00391" name="l00391"></a><span class="lineno">  391</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea6c6f711f18a620ba39d0215d396d1c59">ICE_START_DELAY</a>:</div>
<div class="line"><a id="l00392" name="l00392"></a><span class="lineno">  392</span>        <a class="code hl_function" href="classAP__ICEngine.html#ab632fddb2ed066ba969a58f6f7c0c2fb">set_ignition</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00393" name="l00393"></a><span class="lineno">  393</span>        <a class="code hl_function" href="classAP__ICEngine.html#ace82d76b8d7223ac7402d038e494f8f2">set_starter</a>(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00394" name="l00394"></a><span class="lineno">  394</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00395" name="l00395"></a><span class="lineno">  395</span> </div>
<div class="line"><a id="l00396" name="l00396"></a><span class="lineno">  396</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea73eead72ca890d2fe2ae8065d57c5b47">ICE_STARTING</a>:</div>
<div class="line"><a id="l00397" name="l00397"></a><span class="lineno">  397</span>        <a class="code hl_function" href="classAP__ICEngine.html#ab632fddb2ed066ba969a58f6f7c0c2fb">set_ignition</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00398" name="l00398"></a><span class="lineno">  398</span>        <a class="code hl_function" href="classAP__ICEngine.html#ace82d76b8d7223ac7402d038e494f8f2">set_starter</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00399" name="l00399"></a><span class="lineno">  399</span> </div>
<div class="line"><a id="l00400" name="l00400"></a><span class="lineno">  400</span>        <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#ae82f2816e4edc65615219d25c0322dcb">starter_start_time_ms</a> == 0) {</div>
<div class="line"><a id="l00401" name="l00401"></a><span class="lineno">  401</span>            <a class="code hl_variable" href="classAP__ICEngine.html#ae82f2816e4edc65615219d25c0322dcb">starter_start_time_ms</a> = now;</div>
<div class="line"><a id="l00402" name="l00402"></a><span class="lineno">  402</span>        }</div>
<div class="line"><a id="l00403" name="l00403"></a><span class="lineno">  403</span>        <a class="code hl_variable" href="classAP__ICEngine.html#ae68f765382e16bf7f797f756bd8ab71b">starter_last_run_ms</a> = now;</div>
<div class="line"><a id="l00404" name="l00404"></a><span class="lineno">  404</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00405" name="l00405"></a><span class="lineno">  405</span> </div>
<div class="line"><a id="l00406" name="l00406"></a><span class="lineno">  406</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eab7a045bcfc9d7088d41ac1c8468ceb77">ICE_RUNNING</a>:</div>
<div class="line"><a id="l00407" name="l00407"></a><span class="lineno">  407</span>        <a class="code hl_function" href="classAP__ICEngine.html#ab632fddb2ed066ba969a58f6f7c0c2fb">set_ignition</a>(<span class="keyword">true</span>);</div>
<div class="line"><a id="l00408" name="l00408"></a><span class="lineno">  408</span>        <a class="code hl_function" href="classAP__ICEngine.html#ace82d76b8d7223ac7402d038e494f8f2">set_starter</a>(<span class="keyword">false</span>);</div>
<div class="line"><a id="l00409" name="l00409"></a><span class="lineno">  409</span>        <a class="code hl_variable" href="classAP__ICEngine.html#ae82f2816e4edc65615219d25c0322dcb">starter_start_time_ms</a> = 0;</div>
<div class="line"><a id="l00410" name="l00410"></a><span class="lineno">  410</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00411" name="l00411"></a><span class="lineno">  411</span>    }</div>
<div class="line"><a id="l00412" name="l00412"></a><span class="lineno">  412</span>}</div>
</div>
<div class="line"><a id="l00413" name="l00413"></a><span class="lineno">  413</span> </div>
<div class="line"><a id="l00414" name="l00414"></a><span class="lineno">  414</span> </div>
<div class="line"><a id="l00415" name="l00415"></a><span class="lineno">  415</span><span class="comment">/*</span></div>
<div class="line"><a id="l00416" name="l00416"></a><span class="lineno">  416</span><span class="comment">  check for throttle override. This allows the ICE controller to force</span></div>
<div class="line"><a id="l00417" name="l00417"></a><span class="lineno">  417</span><span class="comment">  the correct starting throttle when starting the engine and maintain idle when disarmed</span></div>
<div class="line"><a id="l00418" name="l00418"></a><span class="lineno">  418</span><span class="comment"></span> </div>
<div class="line"><a id="l00419" name="l00419"></a><span class="lineno">  419</span><span class="comment">  base_throttle is the throttle before the disarmed override</span></div>
<div class="line"><a id="l00420" name="l00420"></a><span class="lineno">  420</span><span class="comment">  check. This allows for throttle control while disarmed</span></div>
<div class="line"><a id="l00421" name="l00421"></a><span class="lineno">  421</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00422" data-start="{" data-end="}">
<div class="line"><a id="l00422" name="l00422"></a><span class="lineno"><a class="line" href="classAP__ICEngine.html#aa842e83f650741b792d5ec035c8050e5">  422</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__ICEngine.html#aa842e83f650741b792d5ec035c8050e5">AP_ICEngine::throttle_override</a>(<span class="keywordtype">float</span> &amp;percentage, <span class="keyword">const</span> <span class="keywordtype">float</span> base_throttle)</div>
<div class="line"><a id="l00423" name="l00423"></a><span class="lineno">  423</span>{</div>
<div class="line"><a id="l00424" name="l00424"></a><span class="lineno">  424</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__ICEngine.html#a3b636c3789b124d18c8ec6102a46e294">enable</a>) {</div>
<div class="line"><a id="l00425" name="l00425"></a><span class="lineno">  425</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00426" name="l00426"></a><span class="lineno">  426</span>    }</div>
<div class="line"><a id="l00427" name="l00427"></a><span class="lineno">  427</span> </div>
<div class="line"><a id="l00428" name="l00428"></a><span class="lineno">  428</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> == <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eab7a045bcfc9d7088d41ac1c8468ceb77">ICE_RUNNING</a> &amp;&amp;</div>
<div class="line"><a id="l00429" name="l00429"></a><span class="lineno">  429</span>        <a class="code hl_variable" href="classAP__ICEngine.html#af95518b4249c271f3c8a6c8ba04f531c">idle_percent</a> &gt; 0 &amp;&amp;</div>
<div class="line"><a id="l00430" name="l00430"></a><span class="lineno">  430</span>        <a class="code hl_variable" href="classAP__ICEngine.html#af95518b4249c271f3c8a6c8ba04f531c">idle_percent</a> &lt; 100 &amp;&amp;</div>
<div class="line"><a id="l00431" name="l00431"></a><span class="lineno">  431</span>        <a class="code hl_variable" href="classAP__ICEngine.html#af95518b4249c271f3c8a6c8ba04f531c">idle_percent</a> &gt; percentage)</div>
<div class="line"><a id="l00432" name="l00432"></a><span class="lineno">  432</span>    {</div>
<div class="line"><a id="l00433" name="l00433"></a><span class="lineno">  433</span>        percentage = <a class="code hl_variable" href="classAP__ICEngine.html#af95518b4249c271f3c8a6c8ba04f531c">idle_percent</a>;</div>
<div class="line"><a id="l00434" name="l00434"></a><span class="lineno">  434</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__ICEngine.html#a22aece84cd178d4ca5a491f5152a0d0b">option_set</a>(<a class="code hl_enumvalue" href="classAP__ICEngine.html#ae20e42c747959eda704325166aeb8028a253d26cc6bc4fad62ef20d1ee9d926c1">Options::THROTTLE_WHILE_DISARMED</a>) &amp;&amp; !<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">get_soft_armed</a>()) {</div>
<div class="line"><a id="l00435" name="l00435"></a><span class="lineno">  435</span>            percentage = <a class="code hl_define" href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a>(percentage, base_throttle);</div>
<div class="line"><a id="l00436" name="l00436"></a><span class="lineno">  436</span>        }</div>
<div class="line"><a id="l00437" name="l00437"></a><span class="lineno">  437</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00438" name="l00438"></a><span class="lineno">  438</span>    }</div>
<div class="line"><a id="l00439" name="l00439"></a><span class="lineno">  439</span> </div>
<div class="line"><a id="l00440" name="l00440"></a><span class="lineno">  440</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> == <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea73eead72ca890d2fe2ae8065d57c5b47">ICE_STARTING</a> || <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> == <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea6c6f711f18a620ba39d0215d396d1c59">ICE_START_DELAY</a>) {</div>
<div class="line"><a id="l00441" name="l00441"></a><span class="lineno">  441</span>        percentage = <a class="code hl_variable" href="classAP__ICEngine.html#a5aabdc12cb572bb8c433b7c41c025470">start_percent</a>.get();</div>
<div class="line"><a id="l00442" name="l00442"></a><span class="lineno">  442</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00443" name="l00443"></a><span class="lineno">  443</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> != <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eab7a045bcfc9d7088d41ac1c8468ceb77">ICE_RUNNING</a> &amp;&amp; <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">get_soft_armed</a>()) {</div>
<div class="line"><a id="l00444" name="l00444"></a><span class="lineno">  444</span>        percentage = 0;</div>
<div class="line"><a id="l00445" name="l00445"></a><span class="lineno">  445</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00446" name="l00446"></a><span class="lineno">  446</span>    }</div>
<div class="line"><a id="l00447" name="l00447"></a><span class="lineno">  447</span> </div>
<div class="line"><a id="l00448" name="l00448"></a><span class="lineno">  448</span><span class="preprocessor">#if AP_RPM_ENABLED</span></div>
<div class="line"><a id="l00449" name="l00449"></a><span class="lineno">  449</span>    <span class="keywordflow">if</span> (redline.flag &amp;&amp; !<a class="code hl_function" href="classAP__ICEngine.html#a22aece84cd178d4ca5a491f5152a0d0b">option_set</a>(<a class="code hl_enumvalue" href="classAP__ICEngine.html#ae20e42c747959eda704325166aeb8028a3748a74ece215dbfa16081bbbfe32f0d">Options::DISABLE_REDLINE_GOVERNOR</a>)) {</div>
<div class="line"><a id="l00450" name="l00450"></a><span class="lineno">  450</span>        <span class="comment">// limit the throttle from increasing above what the current output is</span></div>
<div class="line"><a id="l00451" name="l00451"></a><span class="lineno">  451</span>        <span class="keywordflow">if</span> (redline.throttle_percentage &lt; 1.0f) {</div>
<div class="line"><a id="l00452" name="l00452"></a><span class="lineno">  452</span>            redline.throttle_percentage = percentage;</div>
<div class="line"><a id="l00453" name="l00453"></a><span class="lineno">  453</span>        }</div>
<div class="line"><a id="l00454" name="l00454"></a><span class="lineno">  454</span>        <span class="keywordflow">if</span> (percentage &lt; redline.throttle_percentage - redline.governor_integrator) {</div>
<div class="line"><a id="l00455" name="l00455"></a><span class="lineno">  455</span>            <span class="comment">// the throttle before the override is much lower than what the integrator is at</span></div>
<div class="line"><a id="l00456" name="l00456"></a><span class="lineno">  456</span>            <span class="comment">// reset the integrator</span></div>
<div class="line"><a id="l00457" name="l00457"></a><span class="lineno">  457</span>            redline.governor_integrator = 0;</div>
<div class="line"><a id="l00458" name="l00458"></a><span class="lineno">  458</span>            redline.throttle_percentage = percentage;</div>
<div class="line"><a id="l00459" name="l00459"></a><span class="lineno">  459</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (percentage &lt; redline.throttle_percentage) {</div>
<div class="line"><a id="l00460" name="l00460"></a><span class="lineno">  460</span>            <span class="comment">// the throttle is below the integrator set point</span></div>
<div class="line"><a id="l00461" name="l00461"></a><span class="lineno">  461</span>            <span class="comment">// remove the difference from the integrator</span></div>
<div class="line"><a id="l00462" name="l00462"></a><span class="lineno">  462</span>            redline.governor_integrator -= redline.throttle_percentage - percentage;</div>
<div class="line"><a id="l00463" name="l00463"></a><span class="lineno">  463</span>            redline.throttle_percentage = percentage;</div>
<div class="line"><a id="l00464" name="l00464"></a><span class="lineno">  464</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (filtered_rpm_value &gt; redline_rpm) {</div>
<div class="line"><a id="l00465" name="l00465"></a><span class="lineno">  465</span>            <span class="comment">// reduce the throttle if still over the redline RPM</span></div>
<div class="line"><a id="l00466" name="l00466"></a><span class="lineno">  466</span>            <span class="keyword">const</span> <span class="keywordtype">float</span> redline_setpoint_step = idle_slew * <a class="code hl_function" href="namespaceAP.html#acdeafe5406efd2650ba54d24d3aecb7c">AP::scheduler</a>().<a class="code hl_function" href="classAP__Scheduler.html#a82db30c491d6a4eb2a2c34750d7a1de5">get_loop_period_s</a>();</div>
<div class="line"><a id="l00467" name="l00467"></a><span class="lineno">  467</span>            redline.governor_integrator += redline_setpoint_step;</div>
<div class="line"><a id="l00468" name="l00468"></a><span class="lineno">  468</span>        }</div>
<div class="line"><a id="l00469" name="l00469"></a><span class="lineno">  469</span>        percentage = redline.throttle_percentage - redline.governor_integrator;</div>
<div class="line"><a id="l00470" name="l00470"></a><span class="lineno">  470</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00471" name="l00471"></a><span class="lineno">  471</span>    }</div>
<div class="line"><a id="l00472" name="l00472"></a><span class="lineno">  472</span><span class="preprocessor">#endif </span><span class="comment">// AP_RPM_ENABLED</span></div>
<div class="line"><a id="l00473" name="l00473"></a><span class="lineno">  473</span> </div>
<div class="line"><a id="l00474" name="l00474"></a><span class="lineno">  474</span>    <span class="comment">// if THROTTLE_WHILE_DISARMED is set then we use the base_throttle, allowing the pilot to control throttle while disarmed</span></div>
<div class="line"><a id="l00475" name="l00475"></a><span class="lineno">  475</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__ICEngine.html#a22aece84cd178d4ca5a491f5152a0d0b">option_set</a>(<a class="code hl_enumvalue" href="classAP__ICEngine.html#ae20e42c747959eda704325166aeb8028a253d26cc6bc4fad62ef20d1ee9d926c1">Options::THROTTLE_WHILE_DISARMED</a>) &amp;&amp; !<a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">get_soft_armed</a>() &amp;&amp;</div>
<div class="line"><a id="l00476" name="l00476"></a><span class="lineno">  476</span>        base_throttle &gt; percentage) {</div>
<div class="line"><a id="l00477" name="l00477"></a><span class="lineno">  477</span>        percentage = base_throttle;</div>
<div class="line"><a id="l00478" name="l00478"></a><span class="lineno">  478</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00479" name="l00479"></a><span class="lineno">  479</span>    }</div>
<div class="line"><a id="l00480" name="l00480"></a><span class="lineno">  480</span> </div>
<div class="line"><a id="l00481" name="l00481"></a><span class="lineno">  481</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00482" name="l00482"></a><span class="lineno">  482</span>}</div>
</div>
<div class="line"><a id="l00483" name="l00483"></a><span class="lineno">  483</span> </div>
<div class="line"><a id="l00484" name="l00484"></a><span class="lineno">  484</span><span class="comment">/*</span></div>
<div class="line"><a id="l00485" name="l00485"></a><span class="lineno">  485</span><span class="comment">  handle DO_ENGINE_CONTROL messages via MAVLink or mission</span></div>
<div class="line"><a id="l00486" name="l00486"></a><span class="lineno">  486</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00487" data-start="{" data-end="}">
<div class="line"><a id="l00487" name="l00487"></a><span class="lineno"><a class="line" href="classAP__ICEngine.html#a750f9d5a76f14960f5d98e2474822ce6">  487</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__ICEngine.html#a750f9d5a76f14960f5d98e2474822ce6">AP_ICEngine::engine_control</a>(<span class="keywordtype">float</span> start_control, <span class="keywordtype">float</span> cold_start, <span class="keywordtype">float</span> height_delay, uint32_t flags)</div>
<div class="line"><a id="l00488" name="l00488"></a><span class="lineno">  488</span>{</div>
<div class="line"><a id="l00489" name="l00489"></a><span class="lineno">  489</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__ICEngine.html#a3b636c3789b124d18c8ec6102a46e294">enable</a>) {</div>
<div class="line"><a id="l00490" name="l00490"></a><span class="lineno">  490</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00491" name="l00491"></a><span class="lineno">  491</span>    }</div>
<div class="line"><a id="l00492" name="l00492"></a><span class="lineno">  492</span> </div>
<div class="line"><a id="l00493" name="l00493"></a><span class="lineno">  493</span>    <span class="comment">// always update the start while disarmed flag</span></div>
<div class="line"><a id="l00494" name="l00494"></a><span class="lineno">  494</span>    <a class="code hl_variable" href="classAP__ICEngine.html#a6f21623150cbe96407a8e4cc1c4a18dd">allow_single_start_while_disarmed</a> = (flags &amp; ENGINE_CONTROL_OPTIONS_ALLOW_START_WHILE_DISARMED) != 0;</div>
<div class="line"><a id="l00495" name="l00495"></a><span class="lineno">  495</span> </div>
<div class="line"><a id="l00496" name="l00496"></a><span class="lineno">  496</span>    <span class="keywordflow">if</span> (start_control &lt;= 0) {</div>
<div class="line"><a id="l00497" name="l00497"></a><span class="lineno">  497</span>        <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> = <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea0689148093af2b40bd95ddb6cd4569a1">ICE_OFF</a>;</div>
<div class="line"><a id="l00498" name="l00498"></a><span class="lineno">  498</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00499" name="l00499"></a><span class="lineno">  499</span>    }</div>
<div class="line"><a id="l00500" name="l00500"></a><span class="lineno">  500</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> == <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eab7a045bcfc9d7088d41ac1c8468ceb77">ICE_RUNNING</a> || <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> == <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea6c6f711f18a620ba39d0215d396d1c59">ICE_START_DELAY</a> || <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> == <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea73eead72ca890d2fe2ae8065d57c5b47">ICE_STARTING</a>) {</div>
<div class="line"><a id="l00501" name="l00501"></a><span class="lineno">  501</span>        <a class="code hl_define" href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;Engine: already running&quot;</span>);</div>
<div class="line"><a id="l00502" name="l00502"></a><span class="lineno">  502</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00503" name="l00503"></a><span class="lineno">  503</span>    }</div>
<div class="line"><a id="l00504" name="l00504"></a><span class="lineno">  504</span>    <a class="code hl_class" href="classRC__Channel.html">RC_Channel</a> *c = <a class="code hl_function" href="RC__Channel_8h.html#abe35aea6177a1cdf87a22af5c263bb89">rc</a>().<a class="code hl_function" href="classRC__Channels.html#a3736f2167041c3930941f66c73ec7d1d">channel</a>(<a class="code hl_variable" href="classAP__ICEngine.html#ab5fea2c005e803691ede6a31acaba2f8">start_chan</a>-1);</div>
<div class="line"><a id="l00505" name="l00505"></a><span class="lineno">  505</span>    <span class="keywordflow">if</span> (c != <span class="keyword">nullptr</span> &amp;&amp; <a class="code hl_function" href="RC__Channel_8h.html#abe35aea6177a1cdf87a22af5c263bb89">rc</a>().has_valid_input()) {</div>
<div class="line"><a id="l00506" name="l00506"></a><span class="lineno">  506</span>        <span class="comment">// get starter control channel</span></div>
<div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span>        uint16_t cvalue = c-&gt;<a class="code hl_function" href="classRC__Channel.html#a35dd43d363695269b38277306426f883">get_radio_in</a>();</div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>        <span class="keywordflow">if</span> (cvalue &gt;= <a class="code hl_variable" href="classAP__ICEngine.html#a6d2e9264114c4692c8f8cabfdfca8436">start_chan_min_pwm</a> &amp;&amp; cvalue &lt;= <a class="code hl_variable" href="classRC__Channel.html#a7e23801a755b980004432cb0ec52cbf5">RC_Channel::AUX_PWM_TRIGGER_LOW</a>) {</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span>            <a class="code hl_define" href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;Engine: start control disabled&quot;</span>);</div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>        }</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>    }</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>    <span class="keywordflow">if</span> (height_delay &gt; 0) {</div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>        <a class="code hl_variable" href="classAP__ICEngine.html#a416eeeb7e22a4b3b7c927cf7409d4a43">height_pending</a> = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>        <a class="code hl_variable" href="classAP__ICEngine.html#a0f40d24501ea23ca9d860351f084ca17">initial_height</a> = 0;</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>        <a class="code hl_variable" href="classAP__ICEngine.html#a5ccd39797b09456f6b6257541483cdd0">height_required</a> = height_delay;</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>        <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> = <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eadc052604e13414f786fd43c37c622c92">ICE_START_HEIGHT_DELAY</a>;</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>        <a class="code hl_define" href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a>(MAV_SEVERITY_INFO, <span class="stringliteral">&quot;Takeoff height set to %.1fm&quot;</span>, (<span class="keywordtype">double</span>)height_delay);</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>    }</div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>    <a class="code hl_variable" href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">state</a> = <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea73eead72ca890d2fe2ae8065d57c5b47">ICE_STARTING</a>;</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>}</div>
</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span> </div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span><span class="comment">/*</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span><span class="comment">  Update low throttle limit to ensure steady idle for IC Engines</span></div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span><span class="comment">  return a new min_throttle value</span></div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span><span class="comment">*/</span></div>
<div class="foldopen" id="foldopen00529" data-start="{" data-end="}">
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno"><a class="line" href="classAP__ICEngine.html#afd17e93a45d569f6ac57160ffa2a5bb5">  529</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__ICEngine.html#afd17e93a45d569f6ac57160ffa2a5bb5">AP_ICEngine::update_idle_governor</a>(int8_t &amp;min_throttle)</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>{</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__ICEngine.html#a3b636c3789b124d18c8ec6102a46e294">enable</a>) {</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span>    }</div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span><span class="preprocessor">#if AP_RPM_ENABLED</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>    <span class="keyword">const</span> int8_t min_throttle_base = min_throttle;</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span> </div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>    <span class="comment">// Initialize idle point to min_throttle on the first run</span></div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>    <span class="keyword">static</span> <span class="keywordtype">bool</span> idle_point_initialized = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>    <span class="keywordflow">if</span> (!idle_point_initialized) {</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>        <a class="code hl_variable" href="classAP__ICEngine.html#abf97a1551eebe245e9882418073cb1a7">idle_governor_integrator</a> = min_throttle;</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>        idle_point_initialized = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>    }</div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>    <a class="code hl_class" href="classAP__RPM.html">AP_RPM</a> *ap_rpm = <a class="code hl_function" href="namespaceAP.html#ad5986df034b9156395fea23c11cb2210">AP::rpm</a>();</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>    <span class="keywordflow">if</span> (!ap_rpm || rpm_instance == 0 || !ap_rpm-&gt;<a class="code hl_function" href="classAP__RPM.html#a9c5715bbd3d39c3b66960e411644457d">healthy</a>(rpm_instance-1)) {</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>    }</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span> </div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>    <span class="comment">// Check to make sure we have an enabled IC Engine, EFI Instance and that the idle governor is enabled</span></div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classAP__ICEngine.html#a64bdbdeb04e3486e2af5a37fac1f5070">get_state</a>() != <a class="code hl_enumvalue" href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eab7a045bcfc9d7088d41ac1c8468ceb77">AP_ICEngine::ICE_RUNNING</a> || idle_rpm &lt; 0) {</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>    }</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span> </div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>    <span class="comment">// get current RPM feedback</span></div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span>    <span class="keywordtype">float</span> rpmv;</div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span> </div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>    <span class="comment">// Double Check to make sure engine is really running</span></div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span>    <span class="keywordflow">if</span> (!ap_rpm-&gt;<a class="code hl_function" href="classAP__RPM.html#aa6da697806e00e9173c36ed0c97cf175">get_rpm</a>(rpm_instance-1, rpmv) || rpmv &lt; 1) {</div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>        <span class="comment">// Reset idle point to the default value when the engine is stopped</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>        <a class="code hl_variable" href="classAP__ICEngine.html#abf97a1551eebe245e9882418073cb1a7">idle_governor_integrator</a> = min_throttle;</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>    }</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span> </div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span>    <span class="comment">// Override</span></div>
<div class="line"><a id="l00564" name="l00564"></a><span class="lineno">  564</span>    min_throttle = roundf(<a class="code hl_variable" href="classAP__ICEngine.html#abf97a1551eebe245e9882418073cb1a7">idle_governor_integrator</a>);</div>
<div class="line"><a id="l00565" name="l00565"></a><span class="lineno">  565</span> </div>
<div class="line"><a id="l00566" name="l00566"></a><span class="lineno">  566</span>    <span class="comment">// Calculate Error in system</span></div>
<div class="line"><a id="l00567" name="l00567"></a><span class="lineno">  567</span>    int32_t <a class="code hl_define" href="AP__ADC__ADS1115_8cpp.html#aa72707fcb3d070ae7967b9a9e6b58013">error</a> = idle_rpm - rpmv;</div>
<div class="line"><a id="l00568" name="l00568"></a><span class="lineno">  568</span> </div>
<div class="line"><a id="l00569" name="l00569"></a><span class="lineno">  569</span>    <span class="keywordtype">bool</span> underspeed = <a class="code hl_define" href="AP__ADC__ADS1115_8cpp.html#aa72707fcb3d070ae7967b9a9e6b58013">error</a> &gt; 0;</div>
<div class="line"><a id="l00570" name="l00570"></a><span class="lineno">  570</span> </div>
<div class="line"><a id="l00571" name="l00571"></a><span class="lineno">  571</span>    <span class="comment">// Don&#39;t adjust idle point when we&#39;re within the deadband</span></div>
<div class="line"><a id="l00572" name="l00572"></a><span class="lineno">  572</span>    <span class="keywordflow">if</span> (abs(<a class="code hl_define" href="AP__ADC__ADS1115_8cpp.html#aa72707fcb3d070ae7967b9a9e6b58013">error</a>) &lt; idle_db) {</div>
<div class="line"><a id="l00573" name="l00573"></a><span class="lineno">  573</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00574" name="l00574"></a><span class="lineno">  574</span>    }</div>
<div class="line"><a id="l00575" name="l00575"></a><span class="lineno">  575</span> </div>
<div class="line"><a id="l00576" name="l00576"></a><span class="lineno">  576</span>    <span class="comment">// Don&#39;t adjust idle point if the commanded throttle is above the</span></div>
<div class="line"><a id="l00577" name="l00577"></a><span class="lineno">  577</span>    <span class="comment">// current idle throttle setpoint and the RPM is above the idle</span></div>
<div class="line"><a id="l00578" name="l00578"></a><span class="lineno">  578</span>    <span class="comment">// RPM setpoint (Normal flight)</span></div>
<div class="line"><a id="l00579" name="l00579"></a><span class="lineno">  579</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="classSRV__Channels.html#abd70bd7df5b7206952247f9cae658250">SRV_Channels::get_output_scaled</a>(<a class="code hl_enumvalue" href="classSRV__Channel.html#a9ca1754fc905dddeebec41568a475d68a2b2f8365b3776f0a588082805cd9acbe">SRV_Channel::k_throttle</a>) &gt; min_throttle &amp;&amp; !underspeed) {</div>
<div class="line"><a id="l00580" name="l00580"></a><span class="lineno">  580</span>        <span class="keywordflow">return</span>;</div>
<div class="line"><a id="l00581" name="l00581"></a><span class="lineno">  581</span>    }</div>
<div class="line"><a id="l00582" name="l00582"></a><span class="lineno">  582</span> </div>
<div class="line"><a id="l00583" name="l00583"></a><span class="lineno">  583</span>    <span class="comment">// Calculate the change per loop to achieve the desired slew rate of 1 percent per second</span></div>
<div class="line"><a id="l00584" name="l00584"></a><span class="lineno">  584</span>    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">float</span> idle_setpoint_step = idle_slew * <a class="code hl_function" href="namespaceAP.html#acdeafe5406efd2650ba54d24d3aecb7c">AP::scheduler</a>().<a class="code hl_function" href="classAP__Scheduler.html#a82db30c491d6a4eb2a2c34750d7a1de5">get_loop_period_s</a>();</div>
<div class="line"><a id="l00585" name="l00585"></a><span class="lineno">  585</span> </div>
<div class="line"><a id="l00586" name="l00586"></a><span class="lineno">  586</span>    <span class="comment">// Update Integrator</span></div>
<div class="line"><a id="l00587" name="l00587"></a><span class="lineno">  587</span>    <span class="keywordflow">if</span> (underspeed) {</div>
<div class="line"><a id="l00588" name="l00588"></a><span class="lineno">  588</span>        <a class="code hl_variable" href="classAP__ICEngine.html#abf97a1551eebe245e9882418073cb1a7">idle_governor_integrator</a> += idle_setpoint_step;</div>
<div class="line"><a id="l00589" name="l00589"></a><span class="lineno">  589</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><a id="l00590" name="l00590"></a><span class="lineno">  590</span>        <a class="code hl_variable" href="classAP__ICEngine.html#abf97a1551eebe245e9882418073cb1a7">idle_governor_integrator</a> -= idle_setpoint_step;</div>
<div class="line"><a id="l00591" name="l00591"></a><span class="lineno">  591</span>    }</div>
<div class="line"><a id="l00592" name="l00592"></a><span class="lineno">  592</span> </div>
<div class="line"><a id="l00593" name="l00593"></a><span class="lineno">  593</span>    <a class="code hl_variable" href="classAP__ICEngine.html#abf97a1551eebe245e9882418073cb1a7">idle_governor_integrator</a> = <a class="code hl_define" href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a>(<a class="code hl_variable" href="classAP__ICEngine.html#abf97a1551eebe245e9882418073cb1a7">idle_governor_integrator</a>, min_throttle_base, 40.0f);</div>
<div class="line"><a id="l00594" name="l00594"></a><span class="lineno">  594</span> </div>
<div class="line"><a id="l00595" name="l00595"></a><span class="lineno">  595</span>    min_throttle = roundf(<a class="code hl_variable" href="classAP__ICEngine.html#abf97a1551eebe245e9882418073cb1a7">idle_governor_integrator</a>);</div>
<div class="line"><a id="l00596" name="l00596"></a><span class="lineno">  596</span><span class="preprocessor">#endif </span><span class="comment">// AP_RPM_ENABLED</span></div>
<div class="line"><a id="l00597" name="l00597"></a><span class="lineno">  597</span>}</div>
</div>
<div class="line"><a id="l00598" name="l00598"></a><span class="lineno">  598</span> </div>
<div class="line"><a id="l00599" name="l00599"></a><span class="lineno">  599</span><span class="comment">/*</span></div>
<div class="line"><a id="l00600" name="l00600"></a><span class="lineno">  600</span><span class="comment">  set ignition state</span></div>
<div class="line"><a id="l00601" name="l00601"></a><span class="lineno">  601</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00602" data-start="{" data-end="}">
<div class="line"><a id="l00602" name="l00602"></a><span class="lineno"><a class="line" href="classAP__ICEngine.html#ab632fddb2ed066ba969a58f6f7c0c2fb">  602</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__ICEngine.html#ab632fddb2ed066ba969a58f6f7c0c2fb">AP_ICEngine::set_ignition</a>(<span class="keywordtype">bool</span> on)</div>
<div class="line"><a id="l00603" name="l00603"></a><span class="lineno">  603</span>{</div>
<div class="line"><a id="l00604" name="l00604"></a><span class="lineno">  604</span>    <a class="code hl_function" href="classSRV__Channels.html#a6ec155ae75e3d22a0de00e21e5b330a9">SRV_Channels::set_output_pwm</a>(<a class="code hl_enumvalue" href="classSRV__Channel.html#a9ca1754fc905dddeebec41568a475d68a722f4cff8c7bcd4e2825ab4b977d2fdf">SRV_Channel::k_ignition</a>, on? <a class="code hl_variable" href="classAP__ICEngine.html#af8f955ce6d7bc408b06bcd1643de98d3">pwm_ignition_on</a> : <a class="code hl_variable" href="classAP__ICEngine.html#a85cd863863fa1a373a9bc3c57611aadf">pwm_ignition_off</a>);</div>
<div class="line"><a id="l00605" name="l00605"></a><span class="lineno">  605</span> </div>
<div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span><span class="preprocessor">#if AP_RELAY_ENABLED</span></div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>    <a class="code hl_class" href="classAP__Relay.html">AP_Relay</a> *<a class="code hl_variable" href="AP__Parachute__test_8cpp.html#a1b01eb2a0239e74c68c0190c5a24bd6d">relay</a> = <a class="code hl_function" href="namespaceAP.html#a730acdb902fce56b0e171368b2d2036b">AP::relay</a>();</div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="AP__Parachute__test_8cpp.html#a1b01eb2a0239e74c68c0190c5a24bd6d">relay</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>        <a class="code hl_variable" href="AP__Parachute__test_8cpp.html#a1b01eb2a0239e74c68c0190c5a24bd6d">relay</a>-&gt;<a class="code hl_function" href="classAP__Relay.html#a57d529ac3c020c0e73652a7293a8a273">set</a>(<a class="code hl_enumvalue" href="classAP__Relay__Params.html#a73c0886b439cc9c4dcc660f5a084f042ae719c3236c9ae48ded0dd5d5fc27cb20">AP_Relay_Params::FUNCTION::IGNITION</a>, on);</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>    }</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span><span class="preprocessor">#endif </span><span class="comment">// AP_RELAY_ENABLED</span></div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span> </div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>}</div>
</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span> </div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span><span class="comment">/*</span></div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span><span class="comment">  set starter state</span></div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span><span class="comment"> */</span></div>
<div class="foldopen" id="foldopen00618" data-start="{" data-end="}">
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno"><a class="line" href="classAP__ICEngine.html#ace82d76b8d7223ac7402d038e494f8f2">  618</a></span><span class="keywordtype">void</span> <a class="code hl_function" href="classAP__ICEngine.html#ace82d76b8d7223ac7402d038e494f8f2">AP_ICEngine::set_starter</a>(<span class="keywordtype">bool</span> on)</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>{</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span>    <a class="code hl_function" href="classSRV__Channels.html#a6ec155ae75e3d22a0de00e21e5b330a9">SRV_Channels::set_output_pwm</a>(<a class="code hl_enumvalue" href="classSRV__Channel.html#a9ca1754fc905dddeebec41568a475d68a74b4c481896ab920a1185557733423a6">SRV_Channel::k_starter</a>, on? <a class="code hl_variable" href="classAP__ICEngine.html#abaa30520c4ee51243f978d0676f0518c">pwm_starter_on</a> : <a class="code hl_variable" href="classAP__ICEngine.html#ae2b7a31fff3fe5d7f62bd05bbbcd211a">pwm_starter_off</a>);</div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span> </div>
<div class="line"><a id="l00622" name="l00622"></a><span class="lineno">  622</span><span class="preprocessor">#if AP_ICENGINE_TCA9554_STARTER_ENABLED</span></div>
<div class="line"><a id="l00623" name="l00623"></a><span class="lineno">  623</span>    <a class="code hl_variable" href="classAP__ICEngine.html#a4496d57e3adf0b55a30c3faa95713176">tca9554_starter</a>.<a class="code hl_function" href="classAP__ICEngine__TCA9554.html#ab7e6292fe09d5d4c768ab9e053c748d7">set_starter</a>(on);</div>
<div class="line"><a id="l00624" name="l00624"></a><span class="lineno">  624</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00625" name="l00625"></a><span class="lineno">  625</span> </div>
<div class="line"><a id="l00626" name="l00626"></a><span class="lineno">  626</span><span class="preprocessor">#if AP_RELAY_ENABLED</span></div>
<div class="line"><a id="l00627" name="l00627"></a><span class="lineno">  627</span>    <a class="code hl_class" href="classAP__Relay.html">AP_Relay</a> *<a class="code hl_variable" href="AP__Parachute__test_8cpp.html#a1b01eb2a0239e74c68c0190c5a24bd6d">relay</a> = <a class="code hl_function" href="namespaceAP.html#a730acdb902fce56b0e171368b2d2036b">AP::relay</a>();</div>
<div class="line"><a id="l00628" name="l00628"></a><span class="lineno">  628</span>    <span class="keywordflow">if</span> (<a class="code hl_variable" href="AP__Parachute__test_8cpp.html#a1b01eb2a0239e74c68c0190c5a24bd6d">relay</a> != <span class="keyword">nullptr</span>) {</div>
<div class="line"><a id="l00629" name="l00629"></a><span class="lineno">  629</span>        <a class="code hl_variable" href="AP__Parachute__test_8cpp.html#a1b01eb2a0239e74c68c0190c5a24bd6d">relay</a>-&gt;<a class="code hl_function" href="classAP__Relay.html#a57d529ac3c020c0e73652a7293a8a273">set</a>(<a class="code hl_enumvalue" href="classAP__Relay__Params.html#a73c0886b439cc9c4dcc660f5a084f042adfe15510fb533b788896024b37c1985b">AP_Relay_Params::FUNCTION::ICE_STARTER</a>, on);</div>
<div class="line"><a id="l00630" name="l00630"></a><span class="lineno">  630</span>    }</div>
<div class="line"><a id="l00631" name="l00631"></a><span class="lineno">  631</span><span class="preprocessor">#endif </span><span class="comment">// AP_RELAY_ENABLED</span></div>
<div class="line"><a id="l00632" name="l00632"></a><span class="lineno">  632</span>}</div>
</div>
<div class="line"><a id="l00633" name="l00633"></a><span class="lineno">  633</span> </div>
<div class="line"><a id="l00634" name="l00634"></a><span class="lineno">  634</span> </div>
<div class="foldopen" id="foldopen00635" data-start="{" data-end="}">
<div class="line"><a id="l00635" name="l00635"></a><span class="lineno"><a class="line" href="classAP__ICEngine.html#ae2545410d275462a76555b55c3b8c38d">  635</a></span><span class="keywordtype">bool</span> <a class="code hl_function" href="classAP__ICEngine.html#ae2545410d275462a76555b55c3b8c38d">AP_ICEngine::allow_throttle_while_disarmed</a>()<span class="keyword"> const</span></div>
<div class="line"><a id="l00636" name="l00636"></a><span class="lineno">  636</span><span class="keyword"></span>{</div>
<div class="line"><a id="l00637" name="l00637"></a><span class="lineno">  637</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="classAP__ICEngine.html#a22aece84cd178d4ca5a491f5152a0d0b">option_set</a>(<a class="code hl_enumvalue" href="classAP__ICEngine.html#ae20e42c747959eda704325166aeb8028a253d26cc6bc4fad62ef20d1ee9d926c1">Options::THROTTLE_WHILE_DISARMED</a>) &amp;&amp;</div>
<div class="line"><a id="l00638" name="l00638"></a><span class="lineno">  638</span>        <a class="code hl_variable" href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a>.<a class="code hl_variable" href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">util</a>-&gt;<a class="code hl_function" href="classAP__HAL_1_1Util.html#a9cd8bcd13d4c3c74c665b0702f86451b">safety_switch_state</a>() != <a class="code hl_enumvalue" href="classAP__HAL_1_1Util.html#a4b04d344ba779364624427a51ea3669fa0bdaddc5635bc9fa38649e9bf6f63735">AP_HAL::Util::SAFETY_DISARMED</a>;</div>
<div class="line"><a id="l00639" name="l00639"></a><span class="lineno">  639</span>}</div>
</div>
<div class="line"><a id="l00640" name="l00640"></a><span class="lineno">  640</span> </div>
<div class="line"><a id="l00641" name="l00641"></a><span class="lineno">  641</span><span class="preprocessor">#if AP_RELAY_ENABLED</span></div>
<div class="line"><a id="l00642" name="l00642"></a><span class="lineno">  642</span><span class="keywordtype">bool</span> AP_ICEngine::get_legacy_ignition_relay_index(int8_t &amp;num) </div>
<div class="line"><a id="l00643" name="l00643"></a><span class="lineno">  643</span>{</div>
<div class="line"><a id="l00644" name="l00644"></a><span class="lineno">  644</span>    <span class="comment">// PARAMETER_CONVERSION - Added: Dec-2023</span></div>
<div class="line"><a id="l00645" name="l00645"></a><span class="lineno">  645</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="classAP__ICEngine.html#a3b636c3789b124d18c8ec6102a46e294">enable</a> || !<a class="code hl_function" href="classAP__Param.html#ad2508e1fcf812a2d2671144d0b5a36be">AP_Param::get_param_by_index</a>(<span class="keyword">this</span>, 18, <a class="code hl_enumvalue" href="AP__Param_8h.html#ad9ca22a1e508dceea20feda89a344f9aae846a3e359a88214fe754f3862bc9347">AP_PARAM_INT8</a>, &amp;num)) {</div>
<div class="line"><a id="l00646" name="l00646"></a><span class="lineno">  646</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00647" name="l00647"></a><span class="lineno">  647</span>    }</div>
<div class="line"><a id="l00648" name="l00648"></a><span class="lineno">  648</span>    <span class="comment">// convert to zero indexed</span></div>
<div class="line"><a id="l00649" name="l00649"></a><span class="lineno">  649</span>    num -= 1;</div>
<div class="line"><a id="l00650" name="l00650"></a><span class="lineno">  650</span>    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a id="l00651" name="l00651"></a><span class="lineno">  651</span>}</div>
<div class="line"><a id="l00652" name="l00652"></a><span class="lineno">  652</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00653" name="l00653"></a><span class="lineno">  653</span> </div>
<div class="line"><a id="l00654" name="l00654"></a><span class="lineno">  654</span><span class="comment">// singleton instance. Should only ever be set in the constructor.</span></div>
<div class="line"><a id="l00655" name="l00655"></a><span class="lineno">  655</span><a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a> *<a class="code hl_variable" href="classAP__ICEngine.html#afbdeb8f287c78f52bcbf64d8452ab7b9">AP_ICEngine::_singleton</a>;</div>
<div class="line"><a id="l00656" name="l00656"></a><span class="lineno">  656</span><span class="keyword">namespace </span><a class="code hl_namespace" href="namespaceAP.html">AP</a> {</div>
<div class="foldopen" id="foldopen00657" data-start="{" data-end="}">
<div class="line"><a id="l00657" name="l00657"></a><span class="lineno"><a class="line" href="namespaceAP.html#a9c02489e4e6b2c2b5ef79c8a6a58224d">  657</a></span><a class="code hl_class" href="classAP__ICEngine.html">AP_ICEngine</a> *<a class="code hl_function" href="namespaceAP.html#a9c02489e4e6b2c2b5ef79c8a6a58224d">ice</a>() {</div>
<div class="line"><a id="l00658" name="l00658"></a><span class="lineno">  658</span>        <span class="keywordflow">return</span> <a class="code hl_function" href="classAP__ICEngine.html#aef90859734ff5a67689d34ad7587872c">AP_ICEngine::get_singleton</a>();</div>
<div class="line"><a id="l00659" name="l00659"></a><span class="lineno">  659</span>    }</div>
</div>
<div class="line"><a id="l00660" name="l00660"></a><span class="lineno">  660</span>}</div>
<div class="line"><a id="l00661" name="l00661"></a><span class="lineno">  661</span> </div>
<div class="line"><a id="l00662" name="l00662"></a><span class="lineno">  662</span><span class="preprocessor">#endif  </span><span class="comment">// AP_ICENGINE_ENABLED</span></div>
<div class="ttc" id="aAC__AttitudeControl_8cpp_html_a240c1a4ae2a70d1855f91e4a0b1ac938"><div class="ttname"><a href="AC__AttitudeControl_8cpp.html#a240c1a4ae2a70d1855f91e4a0b1ac938">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition</b> <a href="AP__Compass__AK09916_8cpp_source.html#l00059">AP_Compass_AK09916.cpp:59</a></div></div>
<div class="ttc" id="aAP__ADC__ADS1115_8cpp_html_aa72707fcb3d070ae7967b9a9e6b58013"><div class="ttname"><a href="AP__ADC__ADS1115_8cpp.html#aa72707fcb3d070ae7967b9a9e6b58013">error</a></div><div class="ttdeci">#define error(fmt, args ...)</div><div class="ttdef"><b>Definition</b> <a href="AP__ADC__ADS1115_8cpp_source.html#l00091">AP_ADC_ADS1115.cpp:91</a></div></div>
<div class="ttc" id="aAP__AHRS_8h_html"><div class="ttname"><a href="AP__AHRS_8h.html">AP_AHRS.h</a></div></div>
<div class="ttc" id="aAP__ICEngine_8cpp_html_a389bf79eb8712fc5dde7e2910d893e67"><div class="ttname"><a href="AP__ICEngine_8cpp.html#a389bf79eb8712fc5dde7e2910d893e67">AP_ICENGINE_START_CHAN_DEBOUNCE_MS</a></div><div class="ttdeci">#define AP_ICENGINE_START_CHAN_DEBOUNCE_MS</div><div class="ttdef"><b>Definition</b> <a href="#l00033">AP_ICEngine.cpp:33</a></div></div>
<div class="ttc" id="aAP__ICEngine_8cpp_html_ae08c3ca4ba26b63cda0bb3e3c6c02785"><div class="ttname"><a href="AP__ICEngine_8cpp.html#ae08c3ca4ba26b63cda0bb3e3c6c02785">hal</a></div><div class="ttdeci">const AP_HAL::HAL &amp; hal</div><div class="ttdef"><b>Definition</b> <a href="AC__PID__test_8cpp_source.html#l00021">AC_PID_test.cpp:21</a></div></div>
<div class="ttc" id="aAP__ICEngine_8h_html"><div class="ttname"><a href="AP__ICEngine_8h.html">AP_ICEngine.h</a></div></div>
<div class="ttc" id="aAP__Math_8h_html_a5256308fd38a7098b8f95607aa56888f"><div class="ttname"><a href="AP__Math_8h.html#a5256308fd38a7098b8f95607aa56888f">constrain_float</a></div><div class="ttdeci">#define constrain_float(amt, low, high)</div><div class="ttdef"><b>Definition</b> <a href="AP__Math_8h_source.html#l00174">AP_Math.h:174</a></div></div>
<div class="ttc" id="aAP__Notify_8h_html"><div class="ttname"><a href="AP__Notify_8h.html">AP_Notify.h</a></div></div>
<div class="ttc" id="aAP__Parachute_8h_html"><div class="ttname"><a href="AP__Parachute_8h.html">AP_Parachute.h</a></div><div class="ttdoc">Parachute release library.</div></div>
<div class="ttc" id="aAP__Parachute__test_8cpp_html_a1b01eb2a0239e74c68c0190c5a24bd6d"><div class="ttname"><a href="AP__Parachute__test_8cpp.html#a1b01eb2a0239e74c68c0190c5a24bd6d">relay</a></div><div class="ttdeci">static AP_Relay relay</div><div class="ttdef"><b>Definition</b> <a href="AP__Parachute__test_8cpp_source.html#l00022">AP_Parachute_test.cpp:22</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a0f9acb038a5283b964b862aea8cc5051"><div class="ttname"><a href="AP__Param_8h.html#a0f9acb038a5283b964b862aea8cc5051">AP_GROUPEND</a></div><div class="ttdeci">#define AP_GROUPEND</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00163">AP_Param.h:163</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_a78a408c84f2a1bafde256ac650142e4d"><div class="ttname"><a href="AP__Param_8h.html#a78a408c84f2a1bafde256ac650142e4d">AP_GROUPINFO</a></div><div class="ttdeci">#define AP_GROUPINFO(name, idx, clazz, element, def)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00145">AP_Param.h:145</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_ac24e2eb16c2194e975d27e47ddcb7f1c"><div class="ttname"><a href="AP__Param_8h.html#ac24e2eb16c2194e975d27e47ddcb7f1c">AP_GROUPINFO_FLAGS</a></div><div class="ttdeci">#define AP_GROUPINFO_FLAGS(name, idx, clazz, element, def, flags)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00133">AP_Param.h:133</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_ad9ca22a1e508dceea20feda89a344f9aae846a3e359a88214fe754f3862bc9347"><div class="ttname"><a href="AP__Param_8h.html#ad9ca22a1e508dceea20feda89a344f9aae846a3e359a88214fe754f3862bc9347">AP_PARAM_INT8</a></div><div class="ttdeci">@ AP_PARAM_INT8</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00180">AP_Param.h:180</a></div></div>
<div class="ttc" id="aAP__Param_8h_html_ae25c1c7495435989f8be5781c86be078"><div class="ttname"><a href="AP__Param_8h.html#ae25c1c7495435989f8be5781c86be078">AP_PARAM_FLAG_ENABLE</a></div><div class="ttdeci">#define AP_PARAM_FLAG_ENABLE</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00087">AP_Param.h:87</a></div></div>
<div class="ttc" id="aAP__RPM_8h_html"><div class="ttname"><a href="AP__RPM_8h.html">AP_RPM.h</a></div></div>
<div class="ttc" id="aAP__Relay_8h_html"><div class="ttname"><a href="AP__Relay_8h.html">AP_Relay.h</a></div><div class="ttdoc">APM relay control class.</div></div>
<div class="ttc" id="aAP__Scheduler_8h_html"><div class="ttname"><a href="AP__Scheduler_8h.html">AP_Scheduler.h</a></div></div>
<div class="ttc" id="aGCS_8h_html"><div class="ttname"><a href="GCS_8h.html">GCS.h</a></div><div class="ttdoc">Interface definition for the various Ground Control System.</div></div>
<div class="ttc" id="aGCS_8h_html_a266bfe8eda675e1092f045e93932b4a6"><div class="ttname"><a href="GCS_8h.html#a266bfe8eda675e1092f045e93932b4a6">GCS_SEND_TEXT</a></div><div class="ttdeci">#define GCS_SEND_TEXT(severity, format, args...)</div><div class="ttdef"><b>Definition</b> <a href="GCS_8h_source.html#l01349">GCS.h:1349</a></div></div>
<div class="ttc" id="aRC__Channel_8h_html"><div class="ttname"><a href="RC__Channel_8h.html">RC_Channel.h</a></div><div class="ttdoc">RC_Channel manager, with EEPROM-backed storage of constants.</div></div>
<div class="ttc" id="aRC__Channel_8h_html_abe35aea6177a1cdf87a22af5c263bb89"><div class="ttname"><a href="RC__Channel_8h.html#abe35aea6177a1cdf87a22af5c263bb89">rc</a></div><div class="ttdeci">RC_Channels &amp; rc()</div><div class="ttdef"><b>Definition</b> <a href="RC__Channels_8cpp_source.html#l00314">RC_Channels.cpp:314</a></div></div>
<div class="ttc" id="aSRV__Channel_8h_html"><div class="ttname"><a href="SRV__Channel_8h.html">SRV_Channel.h</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html"><div class="ttname"><a href="classAP__HAL_1_1HAL.html">AP_HAL::HAL</a></div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00021">HAL.h:21</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1HAL_html_a9337a60383f4264fa96a20dbe43a4e2e"><div class="ttname"><a href="classAP__HAL_1_1HAL.html#a9337a60383f4264fa96a20dbe43a4e2e">AP_HAL::HAL::util</a></div><div class="ttdeci">AP_HAL::Util * util</div><div class="ttdef"><b>Definition</b> <a href="HAL_8h_source.html#l00131">HAL.h:131</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Util_html_a287a2b82fa30b92c8d52aad61d4d27b7"><div class="ttname"><a href="classAP__HAL_1_1Util.html#a287a2b82fa30b92c8d52aad61d4d27b7">AP_HAL::Util::get_soft_armed</a></div><div class="ttdeci">bool get_soft_armed() const</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Util_8h_source.html#l00018">Util.h:18</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Util_html_a4b04d344ba779364624427a51ea3669fa0bdaddc5635bc9fa38649e9bf6f63735"><div class="ttname"><a href="classAP__HAL_1_1Util.html#a4b04d344ba779364624427a51ea3669fa0bdaddc5635bc9fa38649e9bf6f63735">AP_HAL::Util::SAFETY_DISARMED</a></div><div class="ttdeci">@ SAFETY_DISARMED</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Util_8h_source.html#l00053">Util.h:53</a></div></div>
<div class="ttc" id="aclassAP__HAL_1_1Util_html_a9cd8bcd13d4c3c74c665b0702f86451b"><div class="ttname"><a href="classAP__HAL_1_1Util.html#a9cd8bcd13d4c3c74c665b0702f86451b">AP_HAL::Util::safety_switch_state</a></div><div class="ttdeci">virtual enum safety_state safety_switch_state(void)</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL_2Util_8h_source.html#l00095">Util.h:95</a></div></div>
<div class="ttc" id="aclassAP__ICEngine__TCA9554_html_ab7e6292fe09d5d4c768ab9e053c748d7"><div class="ttname"><a href="classAP__ICEngine__TCA9554.html#ab7e6292fe09d5d4c768ab9e053c748d7">AP_ICEngine_TCA9554::set_starter</a></div><div class="ttdeci">void set_starter(bool on)</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine__TCA9554_8cpp_source.html#l00085">AP_ICEngine_TCA9554.cpp:85</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html"><div class="ttname"><a href="classAP__ICEngine.html">AP_ICEngine</a></div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00035">AP_ICEngine.h:35</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a084fd3c2ce9d8dc26e4e82f7ffb10360"><div class="ttname"><a href="classAP__ICEngine.html#a084fd3c2ce9d8dc26e4e82f7ffb10360">AP_ICEngine::AP_ICEngine</a></div><div class="ttdeci">AP_ICEngine()</div><div class="ttdef"><b>Definition</b> <a href="#l00175">AP_ICEngine.cpp:175</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a0f40d24501ea23ca9d860351f084ca17"><div class="ttname"><a href="classAP__ICEngine.html#a0f40d24501ea23ca9d860351f084ca17">AP_ICEngine::initial_height</a></div><div class="ttdeci">float initial_height</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00145">AP_ICEngine.h:145</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a22aece84cd178d4ca5a491f5152a0d0b"><div class="ttname"><a href="classAP__ICEngine.html#a22aece84cd178d4ca5a491f5152a0d0b">AP_ICEngine::option_set</a></div><div class="ttdeci">bool option_set(Options option) const</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00166">AP_ICEngine.h:166</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a346918729b138929cb938df5173e34a1"><div class="ttname"><a href="classAP__ICEngine.html#a346918729b138929cb938df5173e34a1">AP_ICEngine::starter_delay</a></div><div class="ttdeci">AP_Float starter_delay</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00108">AP_ICEngine.h:108</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a3b636c3789b124d18c8ec6102a46e294"><div class="ttname"><a href="classAP__ICEngine.html#a3b636c3789b124d18c8ec6102a46e294">AP_ICEngine::enable</a></div><div class="ttdeci">AP_Int8 enable</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00091">AP_ICEngine.h:91</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a416eeeb7e22a4b3b7c927cf7409d4a43"><div class="ttname"><a href="classAP__ICEngine.html#a416eeeb7e22a4b3b7c927cf7409d4a43">AP_ICEngine::height_pending</a></div><div class="ttdeci">bool height_pending</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00151">AP_ICEngine.h:151</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a4496d57e3adf0b55a30c3faa95713176"><div class="ttname"><a href="classAP__ICEngine.html#a4496d57e3adf0b55a30c3faa95713176">AP_ICEngine::tca9554_starter</a></div><div class="ttdeci">AP_ICEngine_TCA9554 tca9554_starter</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00175">AP_ICEngine.h:175</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a44fe9a8e0d8890b3c722e5dd83ec2aa9"><div class="ttname"><a href="classAP__ICEngine.html#a44fe9a8e0d8890b3c722e5dd83ec2aa9">AP_ICEngine::var_info</a></div><div class="ttdeci">static const struct AP_Param::GroupInfo var_info[]</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00035">AP_ICEngine.h:35</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a4cbc352541d1ca74ae9047714e77cf54"><div class="ttname"><a href="classAP__ICEngine.html#a4cbc352541d1ca74ae9047714e77cf54">AP_ICEngine::starter_time</a></div><div class="ttdeci">AP_Float starter_time</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00105">AP_ICEngine.h:105</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a5aabdc12cb572bb8c433b7c41c025470"><div class="ttname"><a href="classAP__ICEngine.html#a5aabdc12cb572bb8c433b7c41c025470">AP_ICEngine::start_percent</a></div><div class="ttdeci">AP_Int8 start_percent</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00128">AP_ICEngine.h:128</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a5ccd39797b09456f6b6257541483cdd0"><div class="ttname"><a href="classAP__ICEngine.html#a5ccd39797b09456f6b6257541483cdd0">AP_ICEngine::height_required</a></div><div class="ttdeci">float height_required</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00148">AP_ICEngine.h:148</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a64bdbdeb04e3486e2af5a37fac1f5070"><div class="ttname"><a href="classAP__ICEngine.html#a64bdbdeb04e3486e2af5a37fac1f5070">AP_ICEngine::get_state</a></div><div class="ttdeci">ICE_State get_state(void) const</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00058">AP_ICEngine.h:58</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a671dbf712bccea7ce99e7953ab53d840"><div class="ttname"><a href="classAP__ICEngine.html#a671dbf712bccea7ce99e7953ab53d840">AP_ICEngine::start_chan_last_ms</a></div><div class="ttdeci">uint32_t start_chan_last_ms</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00172">AP_ICEngine.h:172</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a6d2e9264114c4692c8f8cabfdfca8436"><div class="ttname"><a href="classAP__ICEngine.html#a6d2e9264114c4692c8f8cabfdfca8436">AP_ICEngine::start_chan_min_pwm</a></div><div class="ttdeci">AP_Int16 start_chan_min_pwm</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00097">AP_ICEngine.h:97</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a6f21623150cbe96407a8e4cc1c4a18dd"><div class="ttname"><a href="classAP__ICEngine.html#a6f21623150cbe96407a8e4cc1c4a18dd">AP_ICEngine::allow_single_start_while_disarmed</a></div><div class="ttdeci">bool allow_single_start_while_disarmed</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00153">AP_ICEngine.h:153</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a72c0687138bdfde2f905f00be039b710"><div class="ttname"><a href="classAP__ICEngine.html#a72c0687138bdfde2f905f00be039b710">AP_ICEngine::update</a></div><div class="ttdeci">void update(void)</div><div class="ttdef"><b>Definition</b> <a href="#l00193">AP_ICEngine.cpp:193</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a750f9d5a76f14960f5d98e2474822ce6"><div class="ttname"><a href="classAP__ICEngine.html#a750f9d5a76f14960f5d98e2474822ce6">AP_ICEngine::engine_control</a></div><div class="ttdeci">bool engine_control(float start_control, float cold_start, float height_delay, uint32_t flags)</div><div class="ttdef"><b>Definition</b> <a href="#l00487">AP_ICEngine.cpp:487</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_a85cd863863fa1a373a9bc3c57611aadf"><div class="ttname"><a href="classAP__ICEngine.html#a85cd863863fa1a373a9bc3c57611aadf">AP_ICEngine::pwm_ignition_off</a></div><div class="ttdeci">AP_Int16 pwm_ignition_off</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00112">AP_ICEngine.h:112</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_aa842e83f650741b792d5ec035c8050e5"><div class="ttname"><a href="classAP__ICEngine.html#aa842e83f650741b792d5ec035c8050e5">AP_ICEngine::throttle_override</a></div><div class="ttdeci">bool throttle_override(float &amp;percent, const float base_throttle)</div><div class="ttdef"><b>Definition</b> <a href="#l00422">AP_ICEngine.cpp:422</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ab417dbbac7557b327b5ededdaed46c0ea0689148093af2b40bd95ddb6cd4569a1"><div class="ttname"><a href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea0689148093af2b40bd95ddb6cd4569a1">AP_ICEngine::ICE_OFF</a></div><div class="ttdeci">@ ICE_OFF</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00050">AP_ICEngine.h:50</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ab417dbbac7557b327b5ededdaed46c0ea6c6f711f18a620ba39d0215d396d1c59"><div class="ttname"><a href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea6c6f711f18a620ba39d0215d396d1c59">AP_ICEngine::ICE_START_DELAY</a></div><div class="ttdeci">@ ICE_START_DELAY</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00052">AP_ICEngine.h:52</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ab417dbbac7557b327b5ededdaed46c0ea73eead72ca890d2fe2ae8065d57c5b47"><div class="ttname"><a href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0ea73eead72ca890d2fe2ae8065d57c5b47">AP_ICEngine::ICE_STARTING</a></div><div class="ttdeci">@ ICE_STARTING</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00053">AP_ICEngine.h:53</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ab417dbbac7557b327b5ededdaed46c0eab1f2bb6a0afb2c29a97021eade74bad5"><div class="ttname"><a href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eab1f2bb6a0afb2c29a97021eade74bad5">AP_ICEngine::ICE_DISABLED</a></div><div class="ttdeci">@ ICE_DISABLED</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00049">AP_ICEngine.h:49</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ab417dbbac7557b327b5ededdaed46c0eab7a045bcfc9d7088d41ac1c8468ceb77"><div class="ttname"><a href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eab7a045bcfc9d7088d41ac1c8468ceb77">AP_ICEngine::ICE_RUNNING</a></div><div class="ttdeci">@ ICE_RUNNING</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00055">AP_ICEngine.h:54</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ab417dbbac7557b327b5ededdaed46c0eadc052604e13414f786fd43c37c622c92"><div class="ttname"><a href="classAP__ICEngine.html#ab417dbbac7557b327b5ededdaed46c0eadc052604e13414f786fd43c37c622c92">AP_ICEngine::ICE_START_HEIGHT_DELAY</a></div><div class="ttdeci">@ ICE_START_HEIGHT_DELAY</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00051">AP_ICEngine.h:51</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ab5fea2c005e803691ede6a31acaba2f8"><div class="ttname"><a href="classAP__ICEngine.html#ab5fea2c005e803691ede6a31acaba2f8">AP_ICEngine::start_chan</a></div><div class="ttdeci">AP_Int8 start_chan</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00094">AP_ICEngine.h:94</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ab632fddb2ed066ba969a58f6f7c0c2fb"><div class="ttname"><a href="classAP__ICEngine.html#ab632fddb2ed066ba969a58f6f7c0c2fb">AP_ICEngine::set_ignition</a></div><div class="ttdeci">void set_ignition(bool on)</div><div class="ttdef"><b>Definition</b> <a href="#l00602">AP_ICEngine.cpp:602</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_abaa30520c4ee51243f978d0676f0518c"><div class="ttname"><a href="classAP__ICEngine.html#abaa30520c4ee51243f978d0676f0518c">AP_ICEngine::pwm_starter_on</a></div><div class="ttdeci">AP_Int16 pwm_starter_on</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00113">AP_ICEngine.h:113</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_abf97a1551eebe245e9882418073cb1a7"><div class="ttname"><a href="classAP__ICEngine.html#abf97a1551eebe245e9882418073cb1a7">AP_ICEngine::idle_governor_integrator</a></div><div class="ttdeci">float idle_governor_integrator</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00156">AP_ICEngine.h:156</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ace82d76b8d7223ac7402d038e494f8f2"><div class="ttname"><a href="classAP__ICEngine.html#ace82d76b8d7223ac7402d038e494f8f2">AP_ICEngine::set_starter</a></div><div class="ttdeci">void set_starter(bool on)</div><div class="ttdef"><b>Definition</b> <a href="#l00618">AP_ICEngine.cpp:618</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_acea80153691d4a8e4aaa9e3ba6220828"><div class="ttname"><a href="classAP__ICEngine.html#acea80153691d4a8e4aaa9e3ba6220828">AP_ICEngine::state</a></div><div class="ttdeci">enum ICE_State state</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00082">AP_ICEngine.h:82</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ae20e42c747959eda704325166aeb8028a22e6fd142851c2bd2b308e91239c683b"><div class="ttname"><a href="classAP__ICEngine.html#ae20e42c747959eda704325166aeb8028a22e6fd142851c2bd2b308e91239c683b">AP_ICEngine::Options::NO_RUNNING_WHILE_DISARMED</a></div><div class="ttdeci">@ NO_RUNNING_WHILE_DISARMED</div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ae20e42c747959eda704325166aeb8028a253d26cc6bc4fad62ef20d1ee9d926c1"><div class="ttname"><a href="classAP__ICEngine.html#ae20e42c747959eda704325166aeb8028a253d26cc6bc4fad62ef20d1ee9d926c1">AP_ICEngine::Options::THROTTLE_WHILE_DISARMED</a></div><div class="ttdeci">@ THROTTLE_WHILE_DISARMED</div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ae20e42c747959eda704325166aeb8028a3748a74ece215dbfa16081bbbfe32f0d"><div class="ttname"><a href="classAP__ICEngine.html#ae20e42c747959eda704325166aeb8028a3748a74ece215dbfa16081bbbfe32f0d">AP_ICEngine::Options::DISABLE_REDLINE_GOVERNOR</a></div><div class="ttdeci">@ DISABLE_REDLINE_GOVERNOR</div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ae20e42c747959eda704325166aeb8028ad2ec7c3afbe24bae2980c5a0332317e6"><div class="ttname"><a href="classAP__ICEngine.html#ae20e42c747959eda704325166aeb8028ad2ec7c3afbe24bae2980c5a0332317e6">AP_ICEngine::Options::DISABLE_IGNITION_RC_FAILSAFE</a></div><div class="ttdeci">@ DISABLE_IGNITION_RC_FAILSAFE</div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ae2545410d275462a76555b55c3b8c38d"><div class="ttname"><a href="classAP__ICEngine.html#ae2545410d275462a76555b55c3b8c38d">AP_ICEngine::allow_throttle_while_disarmed</a></div><div class="ttdeci">bool allow_throttle_while_disarmed(void) const</div><div class="ttdef"><b>Definition</b> <a href="#l00635">AP_ICEngine.cpp:635</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ae2b7a31fff3fe5d7f62bd05bbbcd211a"><div class="ttname"><a href="classAP__ICEngine.html#ae2b7a31fff3fe5d7f62bd05bbbcd211a">AP_ICEngine::pwm_starter_off</a></div><div class="ttdeci">AP_Int16 pwm_starter_off</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00114">AP_ICEngine.h:114</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ae68f765382e16bf7f797f756bd8ab71b"><div class="ttname"><a href="classAP__ICEngine.html#ae68f765382e16bf7f797f756bd8ab71b">AP_ICEngine::starter_last_run_ms</a></div><div class="ttdeci">uint32_t starter_last_run_ms</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00125">AP_ICEngine.h:125</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_ae82f2816e4edc65615219d25c0322dcb"><div class="ttname"><a href="classAP__ICEngine.html#ae82f2816e4edc65615219d25c0322dcb">AP_ICEngine::starter_start_time_ms</a></div><div class="ttdeci">uint32_t starter_start_time_ms</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00122">AP_ICEngine.h:122</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_aef90859734ff5a67689d34ad7587872c"><div class="ttname"><a href="classAP__ICEngine.html#aef90859734ff5a67689d34ad7587872c">AP_ICEngine::get_singleton</a></div><div class="ttdeci">static AP_ICEngine * get_singleton()</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00074">AP_ICEngine.h:74</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_aeffbc12c44d7aeaba2771acad3dca4c7"><div class="ttname"><a href="classAP__ICEngine.html#aeffbc12c44d7aeaba2771acad3dca4c7">AP_ICEngine::start_chan_last_value</a></div><div class="ttdeci">uint16_t start_chan_last_value</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00171">AP_ICEngine.h:171</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_af8f955ce6d7bc408b06bcd1643de98d3"><div class="ttname"><a href="classAP__ICEngine.html#af8f955ce6d7bc408b06bcd1643de98d3">AP_ICEngine::pwm_ignition_on</a></div><div class="ttdeci">AP_Int16 pwm_ignition_on</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00111">AP_ICEngine.h:111</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_af95518b4249c271f3c8a6c8ba04f531c"><div class="ttname"><a href="classAP__ICEngine.html#af95518b4249c271f3c8a6c8ba04f531c">AP_ICEngine::idle_percent</a></div><div class="ttdeci">AP_Int8 idle_percent</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00131">AP_ICEngine.h:131</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_afbdeb8f287c78f52bcbf64d8452ab7b9"><div class="ttname"><a href="classAP__ICEngine.html#afbdeb8f287c78f52bcbf64d8452ab7b9">AP_ICEngine::_singleton</a></div><div class="ttdeci">static AP_ICEngine * _singleton</div><div class="ttdef"><b>Definition</b> <a href="AP__ICEngine_8h_source.html#l00077">AP_ICEngine.h:77</a></div></div>
<div class="ttc" id="aclassAP__ICEngine_html_afd17e93a45d569f6ac57160ffa2a5bb5"><div class="ttname"><a href="classAP__ICEngine.html#afd17e93a45d569f6ac57160ffa2a5bb5">AP_ICEngine::update_idle_governor</a></div><div class="ttdeci">void update_idle_governor(int8_t &amp;min_throttle)</div><div class="ttdef"><b>Definition</b> <a href="#l00529">AP_ICEngine.cpp:529</a></div></div>
<div class="ttc" id="aclassAP__Notify_html_a724dd074a094de26e17c72c38ac499e9"><div class="ttname"><a href="classAP__Notify.html#a724dd074a094de26e17c72c38ac499e9">AP_Notify::flags</a></div><div class="ttdeci">static struct notify_flags_and_values_type flags</div><div class="ttdef"><b>Definition</b> <a href="AP__Notify_8h_source.html#l00173">AP_Notify.h:173</a></div></div>
<div class="ttc" id="aclassAP__Parachute_html"><div class="ttname"><a href="classAP__Parachute.html">AP_Parachute</a></div><div class="ttdoc">Class managing the release of a parachute.</div><div class="ttdef"><b>Definition</b> <a href="AP__Parachute_8h_source.html#l00033">AP_Parachute.h:33</a></div></div>
<div class="ttc" id="aclassAP__Parachute_html_a9edc1cc4c168a1a13424d4611bd1a47c"><div class="ttname"><a href="classAP__Parachute.html#a9edc1cc4c168a1a13424d4611bd1a47c">AP_Parachute::release_initiated</a></div><div class="ttdeci">bool release_initiated() const</div><div class="ttdoc">release_initiated - true if the parachute release sequence has been initiated (may wait before actual...</div><div class="ttdef"><b>Definition</b> <a href="AP__Parachute_8h_source.html#l00065">AP_Parachute.h:65</a></div></div>
<div class="ttc" id="aclassAP__Param_html_a5f6dcfce1c0a79cf5bd81283e22f3201"><div class="ttname"><a href="classAP__Param.html#a5f6dcfce1c0a79cf5bd81283e22f3201">AP_Param::setup_object_defaults</a></div><div class="ttdeci">static void setup_object_defaults(const void *object_pointer, const struct GroupInfo *group_info)</div><div class="ttdef"><b>Definition</b> <a href="main_8cpp_source.html#l00010">main.cpp:10</a></div></div>
<div class="ttc" id="aclassAP__Param_html_ad2508e1fcf812a2d2671144d0b5a36be"><div class="ttname"><a href="classAP__Param.html#ad2508e1fcf812a2d2671144d0b5a36be">AP_Param::get_param_by_index</a></div><div class="ttdeci">static bool get_param_by_index(void *obj_ptr, uint8_t idx, ap_var_type old_ptype, void *pvalue)</div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8cpp_source.html#l01077">AP_Param.cpp:1077</a></div></div>
<div class="ttc" id="aclassAP__RPM_html"><div class="ttname"><a href="classAP__RPM.html">AP_RPM</a></div><div class="ttdef"><b>Definition</b> <a href="AP__RPM_8h_source.html#l00029">AP_RPM.h:30</a></div></div>
<div class="ttc" id="aclassAP__RPM_html_a9c5715bbd3d39c3b66960e411644457d"><div class="ttname"><a href="classAP__RPM.html#a9c5715bbd3d39c3b66960e411644457d">AP_RPM::healthy</a></div><div class="ttdeci">bool healthy(uint8_t instance) const</div><div class="ttdef"><b>Definition</b> <a href="AP__RPM_8cpp_source.html#l00220">AP_RPM.cpp:220</a></div></div>
<div class="ttc" id="aclassAP__RPM_html_aa6da697806e00e9173c36ed0c97cf175"><div class="ttname"><a href="classAP__RPM.html#aa6da697806e00e9173c36ed0c97cf175">AP_RPM::get_rpm</a></div><div class="ttdeci">bool get_rpm(uint8_t instance, float &amp;rpm_value) const</div><div class="ttdef"><b>Definition</b> <a href="AP__RPM_8cpp_source.html#l00252">AP_RPM.cpp:252</a></div></div>
<div class="ttc" id="aclassAP__Relay__Params_html_a73c0886b439cc9c4dcc660f5a084f042adfe15510fb533b788896024b37c1985b"><div class="ttname"><a href="classAP__Relay__Params.html#a73c0886b439cc9c4dcc660f5a084f042adfe15510fb533b788896024b37c1985b">AP_Relay_Params::FUNCTION::ICE_STARTER</a></div><div class="ttdeci">@ ICE_STARTER</div></div>
<div class="ttc" id="aclassAP__Relay__Params_html_a73c0886b439cc9c4dcc660f5a084f042ae719c3236c9ae48ded0dd5d5fc27cb20"><div class="ttname"><a href="classAP__Relay__Params.html#a73c0886b439cc9c4dcc660f5a084f042ae719c3236c9ae48ded0dd5d5fc27cb20">AP_Relay_Params::FUNCTION::IGNITION</a></div><div class="ttdeci">@ IGNITION</div></div>
<div class="ttc" id="aclassAP__Relay_html"><div class="ttname"><a href="classAP__Relay.html">AP_Relay</a></div><div class="ttdoc">Class to manage the ArduPilot relay.</div><div class="ttdef"><b>Definition</b> <a href="AP__Relay_8h_source.html#l00033">AP_Relay.h:33</a></div></div>
<div class="ttc" id="aclassAP__Relay_html_a57d529ac3c020c0e73652a7293a8a273"><div class="ttname"><a href="classAP__Relay.html#a57d529ac3c020c0e73652a7293a8a273">AP_Relay::set</a></div><div class="ttdeci">void set(AP_Relay_Params::FUNCTION function, bool value)</div><div class="ttdef"><b>Definition</b> <a href="AP__Relay_8cpp_source.html#l00378">AP_Relay.cpp:378</a></div></div>
<div class="ttc" id="aclassAP__Scheduler_html_a82db30c491d6a4eb2a2c34750d7a1de5"><div class="ttname"><a href="classAP__Scheduler.html#a82db30c491d6a4eb2a2c34750d7a1de5">AP_Scheduler::get_loop_period_s</a></div><div class="ttdeci">float get_loop_period_s()</div><div class="ttdef"><b>Definition</b> <a href="AP__Scheduler_8h_source.html#l00155">AP_Scheduler.h:155</a></div></div>
<div class="ttc" id="aclassRC__Channel_html"><div class="ttname"><a href="classRC__Channel.html">RC_Channel</a></div><div class="ttdoc">Object managing one RC channel.</div><div class="ttdef"><b>Definition</b> <a href="RC__Channel_8h_source.html#l00018">RC_Channel.h:18</a></div></div>
<div class="ttc" id="aclassRC__Channel_html_a35dd43d363695269b38277306426f883"><div class="ttname"><a href="classRC__Channel.html#a35dd43d363695269b38277306426f883">RC_Channel::get_radio_in</a></div><div class="ttdeci">int16_t get_radio_in() const</div><div class="ttdef"><b>Definition</b> <a href="RC__Channel_8h_source.html#l00069">RC_Channel.h:69</a></div></div>
<div class="ttc" id="aclassRC__Channel_html_a491839aced6cfd88ce008423bcaed6a1"><div class="ttname"><a href="classRC__Channel.html#a491839aced6cfd88ce008423bcaed6a1">RC_Channel::AUX_PWM_TRIGGER_HIGH</a></div><div class="ttdeci">static const uint16_t AUX_PWM_TRIGGER_HIGH</div><div class="ttdef"><b>Definition</b> <a href="RC__Channel_8h_source.html#l00330">RC_Channel.h:330</a></div></div>
<div class="ttc" id="aclassRC__Channel_html_a7e23801a755b980004432cb0ec52cbf5"><div class="ttname"><a href="classRC__Channel.html#a7e23801a755b980004432cb0ec52cbf5">RC_Channel::AUX_PWM_TRIGGER_LOW</a></div><div class="ttdeci">static const uint16_t AUX_PWM_TRIGGER_LOW</div><div class="ttdef"><b>Definition</b> <a href="RC__Channel_8h_source.html#l00332">RC_Channel.h:332</a></div></div>
<div class="ttc" id="aclassRC__Channels_html_a3736f2167041c3930941f66c73ec7d1d"><div class="ttname"><a href="classRC__Channels.html#a3736f2167041c3930941f66c73ec7d1d">RC_Channels::channel</a></div><div class="ttdeci">virtual RC_Channel * channel(uint8_t chan)=0</div></div>
<div class="ttc" id="aclassSRV__Channel_html_a9ca1754fc905dddeebec41568a475d68a2b2f8365b3776f0a588082805cd9acbe"><div class="ttname"><a href="classSRV__Channel.html#a9ca1754fc905dddeebec41568a475d68a2b2f8365b3776f0a588082805cd9acbe">SRV_Channel::k_throttle</a></div><div class="ttdeci">@ k_throttle</div><div class="ttdef"><b>Definition</b> <a href="SRV__Channel_8h_source.html#l00114">SRV_Channel.h:114</a></div></div>
<div class="ttc" id="aclassSRV__Channel_html_a9ca1754fc905dddeebec41568a475d68a722f4cff8c7bcd4e2825ab4b977d2fdf"><div class="ttname"><a href="classSRV__Channel.html#a9ca1754fc905dddeebec41568a475d68a722f4cff8c7bcd4e2825ab4b977d2fdf">SRV_Channel::k_ignition</a></div><div class="ttdeci">@ k_ignition</div><div class="ttdef"><b>Definition</b> <a href="SRV__Channel_8h_source.html#l00111">SRV_Channel.h:111</a></div></div>
<div class="ttc" id="aclassSRV__Channel_html_a9ca1754fc905dddeebec41568a475d68a74b4c481896ab920a1185557733423a6"><div class="ttname"><a href="classSRV__Channel.html#a9ca1754fc905dddeebec41568a475d68a74b4c481896ab920a1185557733423a6">SRV_Channel::k_starter</a></div><div class="ttdeci">@ k_starter</div><div class="ttdoc">not used</div><div class="ttdef"><b>Definition</b> <a href="SRV__Channel_8h_source.html#l00113">SRV_Channel.h:113</a></div></div>
<div class="ttc" id="aclassSRV__Channels_html_a6ec155ae75e3d22a0de00e21e5b330a9"><div class="ttname"><a href="classSRV__Channels.html#a6ec155ae75e3d22a0de00e21e5b330a9">SRV_Channels::set_output_pwm</a></div><div class="ttdeci">static void set_output_pwm(SRV_Channel::Aux_servo_function_t function, uint16_t value)</div><div class="ttdef"><b>Definition</b> <a href="SRV__Channel__aux_8cpp_source.html#l00338">SRV_Channel_aux.cpp:338</a></div></div>
<div class="ttc" id="aclassSRV__Channels_html_abd70bd7df5b7206952247f9cae658250"><div class="ttname"><a href="classSRV__Channels.html#abd70bd7df5b7206952247f9cae658250">SRV_Channels::get_output_scaled</a></div><div class="ttdeci">static float get_output_scaled(SRV_Channel::Aux_servo_function_t function)</div><div class="ttdef"><b>Definition</b> <a href="SRV__Channel__aux_8cpp_source.html#l00600">SRV_Channel_aux.cpp:600</a></div></div>
<div class="ttc" id="aclassVector3_html"><div class="ttname"><a href="classVector3.html">Vector3&lt; float &gt;</a></div></div>
<div class="ttc" id="aclassVector3_html_ab3e7f5401dd6e951978bfa746809f74f"><div class="ttname"><a href="classVector3.html#ab3e7f5401dd6e951978bfa746809f74f">Vector3::z</a></div><div class="ttdeci">T z</div><div class="ttdef"><b>Definition</b> <a href="vector3_8h_source.html#l00076">vector3.h:76</a></div></div>
<div class="ttc" id="amonocypher_8cpp_html_afa99ec4acc4ecb2dc3c2d05da15d0e3f"><div class="ttname"><a href="monocypher_8cpp.html#afa99ec4acc4ecb2dc3c2d05da15d0e3f">MAX</a></div><div class="ttdeci">#define MAX(a, b)</div><div class="ttdef"><b>Definition</b> <a href="monocypher_8cpp_source.html#l00072">monocypher.cpp:72</a></div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a52edeef7d5ffaa365e1229b87c170307"><div class="ttname"><a href="namespaceAP__HAL.html#a52edeef7d5ffaa365e1229b87c170307">AP_HAL::panic</a></div><div class="ttdeci">void panic(const char *errormsg,...) FMT_PRINTF(1</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2system_8cpp_source.html#l00327">system.cpp:327</a></div></div>
<div class="ttc" id="anamespaceAP__HAL_html_a77dffbb18891996280308e21316ec186"><div class="ttname"><a href="namespaceAP__HAL.html#a77dffbb18891996280308e21316ec186">AP_HAL::millis</a></div><div class="ttdeci">uint32_t millis()</div><div class="ttdef"><b>Definition</b> <a href="AP__HAL__ChibiOS_2system_8cpp_source.html#l00377">system.cpp:377</a></div></div>
<div class="ttc" id="anamespaceAP_html"><div class="ttname"><a href="namespaceAP.html">AP</a></div><div class="ttdef"><b>Definition</b> <a href="AC__Avoid_8cpp_source.html#l01481">AC_Avoid.cpp:1481</a></div></div>
<div class="ttc" id="anamespaceAP_html_a730acdb902fce56b0e171368b2d2036b"><div class="ttname"><a href="namespaceAP.html#a730acdb902fce56b0e171368b2d2036b">AP::relay</a></div><div class="ttdeci">AP_Relay * relay()</div><div class="ttdef"><b>Definition</b> <a href="AP__Relay_8cpp_source.html#l00684">AP_Relay.cpp:684</a></div></div>
<div class="ttc" id="anamespaceAP_html_a99432cfdb696952c9b7146f155a815aa"><div class="ttname"><a href="namespaceAP.html#a99432cfdb696952c9b7146f155a815aa">AP::ahrs</a></div><div class="ttdeci">AP_AHRS &amp; ahrs()</div><div class="ttdef"><b>Definition</b> <a href="AP__AHRS_8cpp_source.html#l03558">AP_AHRS.cpp:3558</a></div></div>
<div class="ttc" id="anamespaceAP_html_a9c02489e4e6b2c2b5ef79c8a6a58224d"><div class="ttname"><a href="namespaceAP.html#a9c02489e4e6b2c2b5ef79c8a6a58224d">AP::ice</a></div><div class="ttdeci">AP_ICEngine * ice()</div><div class="ttdef"><b>Definition</b> <a href="#l00657">AP_ICEngine.cpp:657</a></div></div>
<div class="ttc" id="anamespaceAP_html_ab75e299618fd1bc72888405984b61a50"><div class="ttname"><a href="namespaceAP.html#ab75e299618fd1bc72888405984b61a50">AP::parachute</a></div><div class="ttdeci">AP_Parachute * parachute()</div><div class="ttdef"><b>Definition</b> <a href="AP__Parachute_8cpp_source.html#l00267">AP_Parachute.cpp:267</a></div></div>
<div class="ttc" id="anamespaceAP_html_acdeafe5406efd2650ba54d24d3aecb7c"><div class="ttname"><a href="namespaceAP.html#acdeafe5406efd2650ba54d24d3aecb7c">AP::scheduler</a></div><div class="ttdeci">AP_Scheduler &amp; scheduler()</div><div class="ttdef"><b>Definition</b> <a href="AP__Scheduler_8cpp_source.html#l00536">AP_Scheduler.cpp:536</a></div></div>
<div class="ttc" id="anamespaceAP_html_ad5986df034b9156395fea23c11cb2210"><div class="ttname"><a href="namespaceAP.html#ad5986df034b9156395fea23c11cb2210">AP::rpm</a></div><div class="ttdeci">AP_RPM * rpm()</div><div class="ttdef"><b>Definition</b> <a href="AP__RPM_8cpp_source.html#l00312">AP_RPM.cpp:312</a></div></div>
<div class="ttc" id="astructAP__Param_1_1GroupInfo_html"><div class="ttname"><a href="structAP__Param_1_1GroupInfo.html">AP_Param::GroupInfo</a></div><div class="ttdef"><b>Definition</b> <a href="AP__Param_8h_source.html#l00199">AP_Param.h:199</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Mar 22 2024 16:14:14 for APM:Libraries by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
